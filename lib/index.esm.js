var t,e;!function(t){t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard"}(t||(t={}));class i{constructor(t,e,i){this.target=t,this.focusType=e,this.needsFocus=i}}class s extends i{constructor(t,e,i=null,s=null){super(i,s,!1),this.x=t,this.y=e}}class n extends s{constructor(e,i,s=null){super(e,i,s,t.Pointer)}correctOffset(t,e){return new n(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new n(this.x,this.y,t)}}class h extends s{constructor(t,e,i=null){super(t,e,i)}correctOffset(t,e){return new h(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new h(this.x,this.y,t)}}class r extends i{constructor(e=null){super(e,t.Pointer,!0)}cloneWithTarget(t){return new r(t)}}!function(t){t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold"}(e||(e={}));class o{constructor(t){this.widget=t,this.lastClickState=e.Released,this.clickState=e.Released,this.clickStateChanged=!1,this.wasClick=!1,this.pointerPos=null,this.startingPointerPos=null}getNormalInRect(t,e,i,s,n,h){return[(t-i)/(s-i),(e-n)/(h-n)]}isPointInRect(t,e,i,s,n,h){return t>=i&&t<s&&e>=n&&e<h}isNormalInRect(t,e){return t>=0&&t<1&&e>=0&&e<1}setClickState(t,i){this.clickState!==t?(this.lastClickState=this.clickState,this.clickState=t,this.wasClick=i&&this.lastClickState===e.Hold,this.clickStateChanged=!0):this.clickStateChanged=!1}handleClickEvent(i,o,l){if(i instanceof r)return o.dropFocus(t.Pointer,this.widget),this.pointerPos=null,this.setClickState(e.Released,!1);if(i instanceof s){this.pointerPos=this.getNormalInRect(i.x,i.y,...l);const s=this.isNormalInRect(...this.pointerPos);if(s)o.pointerStyle="pointer";else if(null===i.target)return o.dropFocus(t.Pointer,this.widget),this.setClickState(e.Released,!1);return i instanceof h?(this.startingPointerPos=this.pointerPos,o.requestFocus(t.Pointer,this.widget),this.setClickState(e.Hold,s)):i instanceof n?(o.dropFocus(t.Pointer,this.widget),s?this.setClickState(e.Hover,s):this.setClickState(e.Released,s)):null===i.target?this.setClickState(e.Hover,s):this.setClickState(e.Hold,s)}this.clickStateChanged=!1}}let l=null;const a=new Map;function c(t,e){if(""===t)return[0,0,0];if(null===l){const t=document.createElement("canvas");if(l=t.getContext("2d"),null===l)throw"Failed to get canvas context"}let i;if(l.font=e,a.has(e))i=a.get(e);else{const t=l.measureText("-");i=Math.abs(t.actualBoundingBoxLeft)+Math.abs(t.actualBoundingBoxRight),a.set(e,i)}const s=l.measureText("-"+t+"-");return[Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight)-2*i,Math.abs(s.actualBoundingBoxAscent),Math.abs(s.actualBoundingBoxDescent)]}class u{constructor(){this._text="",this._font="",this._minWidth=0,this._minAscent=0,this._minDescent=0,this._width=0,this._ascent=0,this._descent=0,this.measureDirty=!0,this._dirty=!1}get dirty(){const t=this._dirty;return this._dirty=!1,t}updateTextDims(){if(!this.measureDirty)return;const[t,e,i]=c(this._text,this._font);this._width=Math.max(t,this._minWidth),this._ascent=Math.max(e,this._minAscent),this._descent=Math.max(i,this._minDescent),this.measureDirty=!1}findOffsetFromIndex(t){return t<=0?0:c(this._text.substring(0,t),this._font)[0]}findIndexOffsetFromOffset(t){if(t<=0)return[0,0];let e=0,i="",s=0;for(const n of this._text){i+=n;const h=c(i,this._font)[0];if(t<(h+s)/2)return[e,s];e++,s=h}return[this._text.length,s]}setDirty(){this._dirty=!0,this.measureDirty=!0}get width(){return this.updateTextDims(),this._width}get ascent(){return this.updateTextDims(),this._ascent}get descent(){return this.updateTextDims(),this._descent}get height(){return this.updateTextDims(),this._ascent+this._descent}set text(t){this._text!==t&&(this._text=t,this.setDirty())}get text(){return this._text}set font(t){this._font!==t&&(this._font=t,this.setDirty())}get font(){return this._font}set minWidth(t){this._minWidth!==t&&(this._minWidth=t,this.setDirty())}get minWidth(){return this._minWidth}set minAscent(t){this._minAscent!==t&&(this._minAscent=t,this.setDirty())}get minAscent(){return this._minAscent}set minDescent(t){this._minDescent!==t&&(this._minDescent=t,this.setDirty())}get minDescent(){return this._minDescent}}class d{constructor(t,e=null){this.callback=e,this._dirty=!1,this._value=t}get value(){return this._value}set value(t){this.setValue(t)}get dirty(){const t=this._dirty;return this._dirty=!1,t}setValue(t,e=!0){if(this._value!==t&&(this._value=t,this._dirty=!0,e&&null!==this.callback))try{this.callback(t)}catch(t){console.error("Exception in Variable callback",t)}}}function g(t){return new Promise(((e,i)=>{function s(){document.body.removeChild(r),document.body.removeChild(h)}function n(){s(),e(l.value)}const h=document.createElement("div");h.id="textInputHandlerOverlay";const r=document.createElement("div");r.id="textInputHandler";const o=document.createElement("p");o.textContent="Change text:";const l=document.createElement("input");l.addEventListener("keyup",(function(t){"Enter"==t.key&&(t.preventDefault(),n())})),l.value=t;const a=document.createElement("div"),c=document.createElement("button");c.addEventListener("click",(function(){s(),e(t)})),c.textContent="Cancel";const u=document.createElement("button");u.addEventListener("click",n),u.textContent="OK",a.appendChild(c),a.appendChild(u),r.appendChild(o),r.appendChild(l),r.appendChild(a),document.body.appendChild(h),document.body.appendChild(r),l.focus({preventScroll:!1})}))}var p,m;!function(t){t[t.CanvasFill=0]="CanvasFill",t[t.ContainerPadding=1]="ContainerPadding",t[t.ContainerSpacing=2]="ContainerSpacing",t[t.ContainerAlignment=3]="ContainerAlignment",t[t.PrimaryFill=4]="PrimaryFill",t[t.AccentFill=5]="AccentFill",t[t.BackgroundFill=6]="BackgroundFill",t[t.BackgroundGlowFill=7]="BackgroundGlowFill",t[t.SliderMinLength=8]="SliderMinLength",t[t.SliderThickness=9]="SliderThickness",t[t.BodyTextFont=10]="BodyTextFont",t[t.BodyTextFill=11]="BodyTextFill",t[t.LabelMinWidth=12]="LabelMinWidth",t[t.LabelMinAscent=13]="LabelMinAscent",t[t.LabelMinDescent=14]="LabelMinDescent",t[t.CheckboxLength=15]="CheckboxLength",t[t.CheckboxInnerPadding=16]="CheckboxInnerPadding",t[t.InputBackgroundFill=17]="InputBackgroundFill",t[t.InputTextFont=18]="InputTextFont",t[t.InputTextFill=19]="InputTextFill",t[t.InputTextFillDisabled=20]="InputTextFillDisabled",t[t.InputTextFillInvalid=21]="InputTextFillInvalid",t[t.InputTextMinWidth=22]="InputTextMinWidth",t[t.InputTextMinAscent=23]="InputTextMinAscent",t[t.InputTextMinDescent=24]="InputTextMinDescent",t[t.InputTextInnerPadding=25]="InputTextInnerPadding",t[t.BlinkRate=26]="BlinkRate",t[t.CursorThickness=27]="CursorThickness",t[t.ScrollBarThickness=28]="ScrollBarThickness"}(p||(p={})),function(t){t[t.Stretch=0]="Stretch",t[t.Start=1]="Start",t[t.Center=2]="Center",t[t.End=3]="End"}(m||(m={}));const f=new Map([[p.CanvasFill,"rgba(0,0,0,0.5)"],[p.ContainerPadding,{left:4,right:4,top:4,bottom:4}],[p.ContainerAlignment,{horizontal:m.Start,vertical:m.Start}],[p.ContainerSpacing,4],[p.PrimaryFill,"rgb(0,127,255)"],[p.AccentFill,"rgb(0,195,255)"],[p.BackgroundFill,"rgb(32,32,32)"],[p.BackgroundGlowFill,"rgb(48,48,48)"],[p.SliderMinLength,100],[p.SliderThickness,10],[p.BodyTextFont,"16px sans"],[p.BodyTextFill,"white"],[p.LabelMinWidth,0],[p.LabelMinAscent,0],[p.LabelMinDescent,3],[p.CheckboxLength,12],[p.CheckboxInnerPadding,2],[p.InputBackgroundFill,"white"],[p.InputTextFont,"16px mono"],[p.InputTextFill,"black"],[p.InputTextFillDisabled,"grey"],[p.InputTextFillInvalid,"red"],[p.InputTextMinWidth,100],[p.InputTextMinAscent,16],[p.InputTextMinDescent,3],[p.InputTextInnerPadding,2],[p.BlinkRate,.8],[p.CursorThickness,1],[p.ScrollBarThickness,10]]);class v{constructor(t=null,e=null){this.properties=null===t?new Map(f):t,this.fallback=e}getProperty(t){let e=this.properties.get(t);if(void 0===e){if(null===this.fallback)throw new Error(`Theme property ${t} is not available`);e=this.fallback.getProperty(t)}return e}getString(t){const e=this.getProperty(t);if("string"!=typeof e)throw new Error(`Theme property ${t} is not a string`);return e}getNumber(t){const e=this.getProperty(t);if("number"!=typeof e)throw new Error(`Theme property ${t} is not a number`);return e}getPadding(t){return this.getProperty(t)}getAlignment(t){return this.getProperty(t)}getAlignment2D(t){return this.getProperty(t)}getFill(t){return this.getString(t)}getFont(t){return this.getString(t)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function y(t,e,i,s){return new(i||(i=Promise))((function(n,h){function r(t){try{l(s.next(t))}catch(t){h(t)}}function o(t){try{l(s.throw(t))}catch(t){h(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}l((s=s.apply(t,e||[])).next())}))}function x(t,e=!0){const i=e?Math.ceil:Math.floor;return Math.pow(2,i(Math.log2(t)))}class _{constructor(t=64,e=64){this._constraints=[0,1/0,0,1/0],this.dirty=!0,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e;const i=this.canvas.getContext("2d",{alpha:!0});if(null===i)throw"Failed to get canvas context";this.context=i}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}set constraints(t){this._constraints[0]===t[0]&&this._constraints[1]===t[1]&&this._constraints[2]===t[2]&&this._constraints[3]===t[3]||(this._constraints[0]=t[0],this._constraints[1]=t[1],this._constraints[2]=t[2],this._constraints[3]=t[3],this.dirty=!0)}get constraints(){return[...this._constraints]}resolveChildsLayout(t){if(!t.layoutDirty&&!this.dirty)return!1;this.dirty=!1;const[e,i]=t.dimensions;t.resolveLayout(...this.constraints);const[s,n]=t.dimensions;if(s!==e||n!==i){const t=x(s);t>this.canvas.width&&(this.canvas.width=t);const e=x(n);return e>this.canvas.height&&(this.canvas.height=e),!0}return!1}paintToCanvas(t){const e=t.dirty;return e&&t.paint(0,0,this.context),e}}class w{constructor(e,i=null,s=new v){this.drivers=new Set,this._enabled=!0,this.pointerStyle="default",this._currentPointerStyle="default",this._foci=new Map([[t.Keyboard,null],[t.Pointer,null]]),this._fociCapturers=new Map([[t.Keyboard,null],[t.Pointer,null]]),this.textInputHandler=null,this._mobileTextInUse=!1,this.viewport=new _,this.child=e,this.pointerStyleHandler=i,this.child.inheritedTheme=s}get constraints(){return this.viewport.constraints}set constraints(t){this.viewport.constraints=t}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t)if(this._enabled=t,t)for(const t of this.drivers)t.onEnable(this);else{for(const t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(const t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){return!!this.enabled&&this.viewport.resolveChildsLayout(this.child)}paint(){return!!this.enabled&&this.viewport.paintToCanvas(this.child)}dispatchEvent(e){var i;if(!this.enabled)return;if(null!==e.focusType&&null===e.target){let t=this._foci.get(e.focusType);if(void 0===t&&(t=null),e.needsFocus&&null===t)return;e=e.cloneWithTarget(t)}this.pointerStyle="default";const s=this.child.dispatchEvent(e,this);if(null===s&&null!==e.focusType&&this.clearFocus(e.focusType),null===e.focusType)return;const n=null!==(i=this._fociCapturers.get(e.focusType))&&void 0!==i?i:null;if(n!==s){e.focusType===t.Pointer&&null!==n&&this.child.dispatchEvent(new r(n),this),this._fociCapturers.set(e.focusType,s);for(const t of this.drivers)t.onFocusCapturerChanged(this,e.focusType,n,s)}}preLayoutUpdate(){if(this.enabled){for(const t of this.drivers)t.update(this);this.child.preLayoutUpdate(this)}}postLayoutUpdate(){this.enabled&&(this.child.postLayoutUpdate(this),this.updatePointerStyle())}updatePointerStyle(t=null){null!==t&&(this.pointerStyle=t),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,null!==this.pointerStyleHandler&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(t,e){if(null!==e){if(e!==this._foci.get(t)){this.clearFocus(t),this._foci.set(t,e);for(const i of this.drivers)i.onFocusChanged(this,t,e)}}}dropFocus(t,e){e===this._foci.get(t)&&this.clearFocus(t)}clearFocus(t){const e=this._foci.get(t);if(null!=e){e.onFocusDropped(t,this),this._foci.set(t,null);for(const e of this.drivers)e.onFocusChanged(this,t,null)}}getFocus(t){var e;return null!==(e=this._foci.get(t))&&void 0!==e?e:null}getFocusCapturer(t){var e;return null!==(e=this._fociCapturers.get(t))&&void 0!==e?e:null}registerDriver(t){this.drivers.has(t)||(this.drivers.add(t),this._enabled&&t.onEnable&&t.onEnable(this))}unregisterDriver(t){this.drivers.delete(t)&&this._enabled&&t.onDisable&&t.onDisable(this)}clearDrivers(){for(const t of this.drivers)this.unregisterDriver(t)}get hasMobileTextInput(){return null!==this.textInputHandler&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(t=""){return y(this,void 0,void 0,(function*(){if(null!==this.textInputHandler&&!this._mobileTextInUse){this._mobileTextInUse=!0;const e=yield this.textInputHandler(t);return this._mobileTextInUse=!1,e}return null}))}}class b extends w{constructor(t,e=new v){super(t,null,e),this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,[this.domElem.width,this.domElem.height]=this.dimensions;const i=this.domElem.getContext("2d",{alpha:!0});if(null===i)throw"Failed to get DOM canvas context";this.domCanvasContext=i,this.pointerStyleHandler=t=>{this.domElem.style.cursor=t}}update(){this.enabled?(this.domElem.style.removeProperty("display"),this.preLayoutUpdate(),this.resolveLayout()&&([this.domElem.width,this.domElem.height]=this.dimensions),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))):this.domElem.style.display="none"}}class k{constructor(t,e,i){this._enabled=!0,this._dirty=!0,this._layoutDirty=!0,this._theme=null,this._inheritedTheme=null,this.width=0,this.height=0,this._flex=0,this.needsClear=e,this.propagatesEvents=i,this._themeOverride=t}get flex(){return this._flex}set flex(t){t!==this._flex&&(this._flex=t,this._layoutDirty=!0)}updateInheritedTheme(){}updateTheme(){null===this._themeOverride?this._theme=this._inheritedTheme:(this._themeOverride.fallback=this._inheritedTheme,this._theme=this._themeOverride)}get theme(){if(null===this._theme)throw"Widget theme is not ready";return this._theme}set enabled(t){t!==this._enabled&&(this._enabled=t,this._dirty=t,this._layoutDirty=!0)}get enabled(){return this._enabled}setThemeOverride(t){this._themeOverride!==t&&(this._themeOverride=t,this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set themeOverride(t){this.setThemeOverride(t)}get themeOverride(){return this._themeOverride}inheritTheme(t){this._inheritedTheme!==t&&(this._inheritedTheme=t,this.updateInheritedTheme(),this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set inheritedTheme(t){this.inheritTheme(t)}get inheritedTheme(){return this._inheritedTheme}get dimensions(){return[this.width,this.height]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return 0==this.width||0==this.height}onFocusDropped(t,e){}handleEvent(t,e){return t.target===this||t instanceof s&&null===t.target?this:null}dispatchEvent(t,e){if(!this._enabled)return null;if(null===t.target){if(t instanceof s&&(t.x<0||t.y<0||t.x>=this.width||t.y>=this.height))return null}else if(t.target!==this&&!this.propagatesEvents)return null;return this.handleEvent(t,e)}handlePreLayoutUpdate(t){}preLayoutUpdate(t){this._enabled&&this.handlePreLayoutUpdate(t)}resolveLayout(t,e,i,s){if(t>e)throw"minWidth must not be greater than maxWidth";if(t<0)throw"minWidth must not be lesser than 0";if(t==1/0)throw"minWidth must not be infinite";if(i>s)throw"minHeight must not be greater than maxHeight";if(i<0)throw"minHeight must not be lesser than 0";if(i==1/0)throw"minHeight must not be infinite";if(!this._enabled)return this.width=0,this.height=0,void(this._layoutDirty=!1);const n=this.width,h=this.height;if(this.handleResolveLayout(t,e,i,s),this.width<t?(this.width=t,console.warn("Horizontal underflow in widget",this.constructor.name)):this.width>e&&(this.width=e,console.warn("Horizontal overflow in widget",this.constructor.name)),this.width<0||this.width==1/0)throw new Error(`Disallowed width in widget ${this.constructor.name}: ${this.width}`);if(this.height<i?(this.height=i,console.warn("Vertical underflow in widget",this.constructor.name)):this.height>s&&(this.height=s,console.warn("Vertical overflow in widget",this.constructor.name)),this.height<0||this.height==1/0)throw new Error(`Disallowed height in widget ${this.constructor.name}: ${this.height}`);this._layoutDirty=!1,n===this.width&&h===this.height||(this._dirty=!0)}handlePostLayoutUpdate(t){}postLayoutUpdate(t){this._enabled&&this.handlePostLayoutUpdate(t)}clear(t,e,i,s,n){n.save(),n.globalCompositeOperation="copy",n.fillStyle=this.theme.getFill(p.CanvasFill),n.beginPath(),n.rect(Math.trunc(t),Math.trunc(e),Math.ceil(i),Math.ceil(s)),n.clip(),n.fill(),n.restore()}handlePainting(t,e,i){}paint(t,e,i){!this.dimensionless&&this._dirty&&(this._enabled&&(this.needsClear&&this.clear(t,e,this.width,this.height,i),i.save(),this.handlePainting(t,e,i),i.restore()),this._dirty=!1)}}class T extends k{constructor(t,e,i,s){super(e,i,s),this._children=[...t]}updateInheritedTheme(){const t=this.inheritedTheme;if(null!==t)for(const e of this.children)e.inheritedTheme=t}get childCount(){return this._children.length}get children(){return this._children.values()}}class P extends T{constructor(t,e,i,s){super([t],e,i,s)}get child(){return this._children[0]}}class C extends P{constructor(t,e=null){super(t,e,!1,!0)}handleEvent(t,e){return this.child.dispatchEvent(t,e)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handleResolveLayout(t,e,i,s){const n=this.child;n.resolveLayout(t,e,i,s),[this.width,this.height]=n.dimensions}handlePainting(t,e,i){this.child.paint(t,e,i)}}class L extends C{constructor(t,e=[0,1/0,0,1/0],i=null){super(t,i),this._constraints=[0,1/0,0,1/0],this._constraints=[...e]}set constraints(t){this._constraints[0]===t[0]&&this._constraints[1]===t[1]&&this._constraints[2]===t[2]&&this._constraints[3]===t[3]||(this._constraints[0]=t[0],this._constraints[1]=t[1],this._constraints[2]=t[2],this._constraints[3]=t[3],this._layoutDirty=!0)}get constraints(){return[...this._constraints]}handleResolveLayout(t,e,i,s){this._constraints[0]>t&&(t=this._constraints[0]),this._constraints[1]<e&&(e=this._constraints[1]),this._constraints[2]>i&&(i=this._constraints[2]),this._constraints[3]<s&&(s=this._constraints[3]),super.handleResolveLayout(t,e,i,s)}}class D extends P{constructor(t,e,i=null){super(t,i,!0,e),this.offsetX=0,this.offsetY=0}handleEvent(t,e){return t instanceof s&&(t=t.correctOffset(this.offsetX,this.offsetY)),this.child.dispatchEvent(t,e)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handleResolveLayout(t,e,i,s){const n=this.theme.getPadding(p.ContainerPadding),h=n.left+n.right,r=n.top+n.bottom;let o=e-h,l=s-r;o<0&&(o=0),l<0&&(l=0);const a=this.theme.getAlignment2D(p.ContainerAlignment),c=a.horizontal==m.Stretch?o:0,u=a.vertical==m.Stretch?l:0;this.child.resolveLayout(c,o,u,l);const d=this.child.dimensions,g=d[0]+h,f=d[1]+r;if(this.width=Math.max(t,g),this.height=Math.max(i,f),this.offsetX=n.left,a.horizontal!==m.Stretch){const t=this.width-g;if(t>0)switch(a.horizontal){case m.Center:this.offsetX+=t/2;break;case m.End:this.offsetX+=t}}if(this.offsetY=n.top,a.vertical!==m.Stretch){const t=this.height-f;if(t>0)switch(a.vertical){case m.Center:this.offsetY+=t/2;break;case m.End:this.offsetY+=t}}}handlePainting(t,e,i){this.child.paint(t+this.offsetX,e+this.offsetY,i)}}class F extends D{constructor(t,e=null,i=null){super(t,!1,i),this.clickHelper=new o(this),this.callback=e}handleEvent(t,e){if(null===this.callback)return this.clickHelper.clickStateChanged=!1,this;if(this.clickHelper.handleClickEvent(t,e,[0,this.width,0,this.height]),this.clickHelper.clickStateChanged&&this.clickHelper.wasClick)try{this.callback()}catch(t){console.error("Exception in Icon callback",t)}return this}}class H extends F{constructor(){super(...arguments),this.backgroundProperty=p.BackgroundFill,this._forced=!1}updateBackground(){var t;if(this._forced)this.backgroundProperty=p.PrimaryFill;else switch(this.clickHelper.clickState){case e.Hold:this.backgroundProperty=p.AccentFill;break;case e.Hover:this.backgroundProperty=p.BackgroundGlowFill;break;default:this.backgroundProperty=p.BackgroundFill}const i=this.theme.getFill(this.backgroundProperty),s=new v(new Map([[p.CanvasFill,i]]),null===(t=this.inheritedTheme)||void 0===t?void 0:t.fallback);super.inheritTheme(s)}set forced(t){t!==this._forced&&(this._forced=t,this.updateBackground())}get forced(){return this._forced}setThemeOverride(t){if(null===t)return super.setThemeOverride(null);try{const e=t.getFill(this.backgroundProperty),i=new v(new Map([[p.CanvasFill,e]]));super.setThemeOverride(i)}catch(t){return super.setThemeOverride(null)}}inheritTheme(t){const e=t.getFill(this.backgroundProperty),i=new v(new Map([[p.CanvasFill,e]]),t);super.inheritTheme(i)}handleEvent(t,e){const i=super.handleEvent(t,e);return this.clickHelper.clickStateChanged&&this.updateBackground(),i}}class E extends D{constructor(t,e=null){super(t,!0,e)}}class M extends E{constructor(t){super(t,new v(new Map([[p.ContainerAlignment,{horizontal:m.Center,vertical:m.Stretch}]])))}}class S extends k{constructor(t,e=null){super(e,!0,!1),this.textGetter=null,this.textHelper=new u,this.source=t}set source(t){t instanceof Function?this.textGetter=t:(this.textGetter=null,this.textHelper.text=t)}get source(){return null!==this.textGetter?this.textGetter:this.textHelper.text}set minWidth(t){this.textHelper.minWidth=t}get minWidth(){return this.textHelper.minWidth}set minAscent(t){this.textHelper.minAscent=t}get minAscent(){return this.textHelper.minAscent}set minDescent(t){this.textHelper.minDescent=t}get minDescent(){return this.textHelper.minDescent}get text(){return this.textHelper.text}handlePreLayoutUpdate(t){null!==this.textGetter&&(this.textHelper.text=this.textGetter()),this.textHelper.font=this.theme.getFont(p.BodyTextFont),this.textHelper.minWidth=this.theme.getNumber(p.LabelMinWidth),this.textHelper.minAscent=this.theme.getNumber(p.LabelMinAscent),this.textHelper.minDescent=this.theme.getNumber(p.LabelMinDescent),this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveLayout(t,e,i,s){this.width=Math.max(Math.min(this.textHelper.width,e),t),this.height=Math.max(Math.min(this.textHelper.height,s),i)}handlePainting(t,e,i){i.font=this.textHelper.font,i.fillStyle=this.theme.getFill(p.BodyTextFill),i.fillText(this.text,t,e+this.height-this.textHelper.descent)}}class I extends H{constructor(t,e=null,i=null){super(new M(new S(t,i)),e,i)}get icon(){return this.child.child}}class W extends L{constructor(t,e=null,i,s=0,n=24,h=24,r=null){function o(){return i.shift?null===e?t:e:t}null===e&&(e=t),super(new I(o,(()=>i.callback(o())),r),[n,1/0,h,1/0],r),this.flex=s}}class B extends T{add(t){if(Array.isArray(t))for(const e of t)this._children.push(e);else this._children.push(t);return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}remove(t){if(Array.isArray(t))for(const e of t){const t=this._children.indexOf(e);-1!==t&&this._children.splice(t,1)}else{const e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1)}return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}clearChildren(){return this._children.length=0,this._layoutDirty=!0,this._dirty=!0,this}}class O extends B{constructor(t,e=null){super([],e,!1,!0),this.backgroundDirty=!0,this.vertical=t}handleEvent(t,e){const i=this.theme.getNumber(p.ContainerSpacing);for(const n of this.children){if(!n.enabled)continue;const h=this.vertical?n.dimensions[1]:n.dimensions[0],r=n.dispatchEvent(t,e);if(null!==r)return r;t instanceof s&&(t=this.vertical?t.correctOffset(0,h+i):t.correctOffset(h+i,0))}return null}handlePreLayoutUpdate(t){for(const e of this.children)e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){for(const e of this.children)e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handleResolveLayout(t,e,i,s){let n=0,h=0,r=this.vertical?e:s;const o=this.vertical?s:e;r==1/0&&(r=0);for(const t of this.children){let i;this.vertical?(t.resolveLayout(r,e,0,1/0),i=t.dimensions[0]):(t.resolveLayout(0,1/0,r,s),i=t.dimensions[1]),n+=t.flex,i>h&&(h=i)}const l=this.vertical?t:i;h<l&&(h=l);const a=this.theme.getNumber(p.ContainerSpacing);let c=Math.trunc(this.childCount/2)*a;for(const t of this.children)c+=this.vertical?t.dimensions[1]:t.dimensions[0];const u=o-c;if(u==1/0||u<=0){if(this.vertical?(this.width=h,this.height=Math.min(c,s)):(this.width=Math.min(c,e),this.height=h),u>=0)return;let t=o;for(const i of this.children){const n=this.vertical?i.dimensions[1]:i.dimensions[0];n>t?(this.vertical?i.resolveLayout(r,e,0,t):i.resolveLayout(0,t,r,s),t=0):t=Math.max(0,t-n-a)}}else{for(const t of this.children){const i=u*t.flex/n;this.vertical?t.resolveLayout(r,e,0,i):t.resolveLayout(0,i,r,s)}this.vertical?(this.width=h,this.height=s):(this.width=e,this.height=h)}}handlePainting(t,e,i){const s=this.theme.getNumber(p.ContainerSpacing);this.backgroundDirty&&s>0&&this.clear(t,e,this.width,this.height,i),this.backgroundDirty=!1;for(const n of this.children){if(!n.enabled)continue;const h=this.vertical?n.dimensions[1]:n.dimensions[0];n.paint(t,e,i),this.vertical?e+=h+s:t+=h+s}}}class A extends O{constructor(t=null){super(!1,t)}}class R extends A{constructor(t,e,i=0,s=24,n=24,h=null){super(new v(new Map([[p.ContainerSpacing,0]])));for(const r of t)if("function"==typeof r){const t=r;this.add(t(e,h))}else{if("string"!=typeof r[0]||"string"!=typeof r[1])throw new Error(`Unknown virtual key row template format for entry: ${r}`);{const t=r[0],o=r[1];for(let r=0;r<t.length;r++){let l=null;r<o.length&&(l=o[r]),this.add(new W(t[r],l,e,i,s,n,h))}}}}}class U extends L{constructor(t,e,i=0,s=24,n=24,h=null){super(new I(t,e,h),[s,1/0,n,1/0],h),this.flex=i}}class N extends U{constructor(t,e,i,s=0,n=24,h=24,r=null){super(t,(()=>i.callback(e)),s,n,h,r)}}class V extends N{constructor(t,e=0,i=60,s=24,n=null){super("Backspace","Backspace",t,e,i,s,n)}}class X extends N{constructor(t,e=0,i=24,s=24,n=null){super("Esc","Escape",t,e,i,s,n)}}class Y extends N{constructor(t,e=0,i=72,s=24,n=null){super("Enter","Enter",t,e,i,s,n)}}class Q extends U{constructor(t,e=0,i=84,s=24,n=null){super("Shift",(()=>{t.shift=!t.shift,this.child.forced=t.shift,t.callback("Shift")}),e,i,s,n),this.child.forced=t.shift}}class K extends N{constructor(t,e=1,i=84,s=24,n=null){super("Space"," ",t,e,i,s,n)}}class G extends O{constructor(t=null){super(!0,t)}}const $=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],function(t,e){return new Y(t,void 0,void 0,void 0,e)}],[function(t,e){return new Q(t,void 0,void 0,void 0,e)},["zxcvbnm,./","ZXCVBNM<>?"]],[function(t,e){return new V(t,void 0,void 0,void 0,e)},function(t,e){return new K(t,void 0,void 0,void 0,e)},function(t,e){return new X(t,void 0,void 0,void 0,e)}]];class z extends G{constructor(t,e=$,i=0,s=24,n=24,h=null){super(h);const r={callback:e=>{t.keyPress(e)},shift:!1};for(const t of e)this.add(new R(t,r,i,s,n,h))}}class q extends E{constructor(t){super(t,new v(new Map([[p.ContainerAlignment,{horizontal:m.Center,vertical:m.Center}]])))}}class j extends b{constructor(t,e=$,i=new v){super(new q(new z(t,e)),i),this.keyboardDriver=t}update(){this.enabled=null!==this.keyboardDriver.getFocusedRoot(),super.update()}}class J extends w{constructor(t,e=$,i=null,s=new v){super(new q(new z(t,e)),i,s),this.keyboardDriver=t}updateVisibility(){this.enabled=null!==this.keyboardDriver.getFocusedRoot()}}class Z extends i{constructor(e,i){super(i,t.Keyboard,!0),this.key=e}}class tt extends Z{cloneWithTarget(t){return new tt(this.key,t)}}class et extends Z{cloneWithTarget(t){return new et(this.key,t)}}class it{constructor(){this.eventQueues=new Map,this.keysDown=new Set,this.focus=null}getEventQueue(t){if(null===t)return null;const e=this.eventQueues.get(t);return void 0===e?null:e}changeFocusedRoot(e){null!==this.focus&&this.focus.clearFocus(t.Keyboard),this.focus=e,this.keysDown.clear()}getFocusedRoot(){return this.focus}clearFocus(){this.changeFocusedRoot(null)}keyDown(t){this.keysDown.add(t);const e=this.getEventQueue(this.focus);null!==e&&e.push(new et(t,null))}keyUp(t){if(this.keysDown.delete(t)){const e=this.getEventQueue(this.focus);null!==e&&e.push(new tt(t,null))}}keyPress(t){const e=this.isKeyDown(t);this.keyDown(t),e||this.keyUp(t)}isKeyDown(t){return this.keysDown.has(t)}onEnable(t){this.eventQueues.has(t)||this.eventQueues.set(t,[])}onDisable(t){this.eventQueues.has(t)&&(this.eventQueues.delete(t),t===this.focus&&this.clearFocus())}update(t){const e=this.getEventQueue(t);if(null!==e){for(const i of e)t.dispatchEvent(i);e.length=0}}onFocusChanged(e,i,s){i===t.Keyboard&&(e==this.focus?null===s&&this.clearFocus():null!==s&&this.changeFocusedRoot(e))}onFocusCapturerChanged(t,e,i,s){}}class st extends it{constructor(){super(...arguments),this.domElems=new Set}bindDOMElem(t,e=!0){this.domElems.has(t)||(this.domElems.add(t),e&&(t.addEventListener("keydown",(t=>{this.keyDown(t.key)})),t.addEventListener("keyup",(t=>{this.keyUp(t.key)}))),t.addEventListener("blur",(t=>{this.shouldClearFocus(t.relatedTarget)&&this.clearFocus()})))}shouldClearFocus(t){return null===t||!this.domElems.has(t)}}function nt(t,e){const i=e.getBoundingClientRect();return[(t.clientX-i.left)/i.width,(t.clientY-i.top)/i.height]}class ht extends s{constructor(e,i,s=null){super(e,i,s,t.Pointer)}correctOffset(t,e){return new ht(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new ht(this.x,this.y,t)}}var rt;!function(t){t[t.None=0]="None",t[t.Hovering=1]="Hovering",t[t.Pressing=2]="Pressing"}(rt||(rt={}));class ot{constructor(){this.states=new Map,this.nextPointerID=0,this.hints=new Map}unassignPointer(e,i){null!==i.pointer&&this.setPointerHint(i.pointer,rt.None),i.pointer=null,i.hovering&&i.eventQueue.push(new r(e.getFocusCapturer(t.Pointer))),i.hovering=!1,i.pressing=!1}registerPointer(){const t=this.nextPointerID++;return this.setPointerHint(t,rt.None),t}unregisterPointer(t){for(const[e,i]of this.states)i.pointer===t&&this.unassignPointer(e,i);this.hints.delete(t)}movePointer(e,i,s,o,l=null){const a=this.states.get(e);if(void 0===a)return;const c=null===a.pointer;c&&(a.pointer=i),null===l&&(l=a.pressing);const u=a.pointer===i;if(!u||c)for(const[t,s]of this.states)t!==e&&s.pointer===i&&this.unassignPointer(t,s);if(!u&&(!l||a.pressing))return;const[d,g]=e.dimensions,p=s*d,m=o*g;let f;l!==a.pressing?(f=l?new h(p,m):new n(p,m),a.pressing=l,l&&a.pointer!==i&&null!==a.pointer&&(a.eventQueue.push(new r(e.getFocusCapturer(t.Pointer))),this.setPointerHint(a.pointer,rt.None),a.pointer=i)):f=new ht(p,m),a.eventQueue.push(f),a.hovering=!0,a.pressing?this.setPointerHint(i,rt.Pressing):this.setPointerHint(i,rt.Hovering)}leavePointer(e,i){const s=this.states.get(e);void 0!==s&&s.hovering&&s.pointer==i&&(s.hovering=!1,s.pressing=!1,s.eventQueue.push(new r(e.getFocusCapturer(t.Pointer))),this.setPointerHint(i,rt.None))}leaveAnyPointer(t){for(const e of this.states.keys())this.leavePointer(e,t)}setPointerHint(t,e){return this.hints.get(t)!==e&&(this.hints.set(t,e),!0)}getPointerHint(t){var e;return null!==(e=this.hints.get(t))&&void 0!==e?e:rt.None}onEnable(t){this.states.set(t,{eventQueue:[],pointer:null,pressing:!1,hovering:!1})}onDisable(t){t.dispatchEvent(new r);const e=this.states.get(t);void 0!==e&&null!==e.pointer&&this.setPointerHint(e.pointer,rt.None),this.states.delete(t)}update(t){const e=this.states.get(t);if(void 0!==e){for(const i of e.eventQueue)t.dispatchEvent(i);e.eventQueue.length=0}}onFocusChanged(t,e,i){}onFocusCapturerChanged(t,e,i,s){}}class lt extends ot{constructor(){super(),this.domElems=new WeakMap,this.mousePointerID=this.registerPointer()}bindDOMElem(t,e){let i=this.domElems.get(t);void 0!==i?this.removeListeners(i):(i={domElem:e,pointermoveListen:null,pointerdownListen:null,pointerupListen:null,pointerleaveListen:null},this.domElems.set(t,i)),t.enabled&&this.addListeners(t,i)}addListeners(t,e){const i=e.domElem;e.pointermoveListen=e=>{e.isPrimary&&this.movePointer(t,this.mousePointerID,...nt(e,i))},e.pointerdownListen=e=>{e.isPrimary&&this.movePointer(t,this.mousePointerID,...nt(e,i),!0)},e.pointerupListen=e=>{e.isPrimary&&this.movePointer(t,this.mousePointerID,...nt(e,i),!1)},e.pointerleaveListen=e=>{e.isPrimary&&this.leavePointer(t,this.mousePointerID)},i.addEventListener("pointermove",e.pointermoveListen),i.addEventListener("pointerdown",e.pointerdownListen),i.addEventListener("pointerup",e.pointerupListen),i.addEventListener("pointerleave",e.pointerleaveListen)}removeListeners(t){null!==t.pointermoveListen&&(t.domElem.removeEventListener("pointermove",t.pointermoveListen),t.pointermoveListen=null),null!==t.pointerdownListen&&(t.domElem.removeEventListener("pointerdown",t.pointerdownListen),t.pointerdownListen=null),null!==t.pointerupListen&&(t.domElem.removeEventListener("pointerup",t.pointerupListen),t.pointerupListen=null),null!==t.pointerleaveListen&&(t.domElem.removeEventListener("pointerleave",t.pointerleaveListen),t.pointerleaveListen=null)}onEnable(t){super.onEnable(t);const e=this.domElems.get(t);void 0!==e&&this.addListeners(t,e)}onDisable(t){super.onDisable(t);const e=this.domElems.get(t);void 0!==e&&this.removeListeners(e)}}class at extends ot{constructor(){super(...arguments),this.sources=new Set}handlePointerRay(t,e,i,s){const[n,h,r]=this.castRay(i,s);null===n?this.leaveAnyPointer(t):this.movePointer(n,t,h,r,e)}addSource(t){this.sources.has(t)||(t.setRayPointerDriver(this),this.sources.add(t))}setPointerHint(t,e){const i=super.setPointerHint(t,e);for(const i of this.sources)i.onPointerHintChanged(t,e);return i}}class ct extends v{constructor(t=new v){super(new Map,t)}getFill(t){return super.getFill(t),"#"+Math.floor(16777215*Math.random()).toString(16)}}function ut(t,e,i=null){return s=>{let n=!0,h=s;for(const i of t)if([n,h]=i(h),!n)return[!1,e];if(null!==i)try{i(h)}catch(t){console.warn("Exception in CompositeValidator callback:",t)}return[!0,h]}}function dt(t){return[!0,t]}function gt(t=null){return null===t?dt:e=>(t(e),[!0,e])}const pt=/^-?(\.\d+|\d+(\.(\d+)?)?)(e\d+)?$/;function mt(t){return pt.test(t)?[!0,parseFloat(t)]:[!1,NaN]}const ft=/^-?\d+$/;function vt(t){return ft.test(t)?[!0,parseInt(t)]:[!1,NaN]}function yt(t,e){return i=>i<t||i>e?[!1,i]:[!0,i]}class xt extends k{constructor(t,e="",i=null){super(i,!1,!1),this.blinkStart=0,this.blinkWasOn=null,this.cursorPos=0,this.cursorOffset=0,this.cursorOffsetDirty=!1,this._editingEnabled=!0,this._hideText=!1,this.textHelper=new u,this.variable=new d(e,(e=>{const[i,s]=t(e);i&&(this._validValue=s),i!==this._valid&&(this._valid=i,this._dirty=!0)})),[this._valid,this._validValue]=t(e)}get blinkOn(){if(0===this.blinkStart)return null;const t=this.theme.getNumber(p.BlinkRate);return 0===Math.trunc((Date.now()-this.blinkStart)/(500*t)%2)}get editingEnabled(){return this._editingEnabled}set editingEnabled(t){this._editingEnabled!==t&&(this._editingEnabled=t,t||(this.blinkStart=0,this.moveCursorTo(0)),this._dirty=!0)}get hideText(){return this._hideText}set hideText(t){this._hideText!==t&&(this._hideText=t,this.cursorOffsetDirty=!0,this._dirty=!0)}set text(t){this.variable.value=t}get text(){return this.variable.value}get displayedText(){return this._hideText?"●".repeat(this.variable.value.length):this.variable.value}get valid(){return this._valid}get validValue(){return this._validValue}set minWidth(t){this.textHelper.minWidth=t}get minWidth(){return this.textHelper.minWidth}set minAscent(t){this.textHelper.minAscent=t}get minAscent(){return this.textHelper.minAscent}set minDescent(t){this.textHelper.minDescent=t}get minDescent(){return this.textHelper.minDescent}moveCursorTo(t){this.cursorPos=Math.min(Math.max(t,0),this.text.length),this.cursorOffsetDirty=!0,this._dirty=!0}moveCursor(t){this.moveCursorTo(this.cursorPos+t)}insertText(t){this.text=this.text.substring(0,this.cursorPos)+t+this.text.substring(this.cursorPos),this.moveCursor(t.length)}deleteText(t){t>0?this.text=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+t):t<0&&(this.text=this.text.substring(0,this.cursorPos+t)+this.text.substring(this.cursorPos),this.moveCursor(t))}onFocusDropped(e,i){e===t.Keyboard&&(this.blinkStart=0)}handleEvent(e,i){if(!this._editingEnabled)return this;if(e instanceof s){if(i.pointerStyle="text",e instanceof h){const s=this.theme.getNumber(p.InputTextInnerPadding);[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset(e.x-s),this.blinkStart=Date.now(),this._dirty=!0,i.requestFocus(t.Keyboard,this)}else e instanceof n&&i.hasMobileTextInput&&i.getTextInput(this.text).then((t=>{null!==t&&this.text!==t&&(this.text=t,this.moveCursorTo(t.length))}));return this}if(e instanceof et){if(1===e.key.length)this.insertText(e.key);else if("Backspace"===e.key)this.deleteText(-1);else if("Delete"===e.key)this.deleteText(1);else if("ArrowLeft"===e.key)this.moveCursor(-1);else if("ArrowRight"===e.key)this.moveCursor(1);else if("Home"===e.key)this.moveCursorTo(0);else{if("End"!==e.key)return"Escape"===e.key?(i.dropFocus(t.Keyboard,this),this):this;this.moveCursorTo(this.text.length)}this.blinkStart=Date.now()}return this}handlePreLayoutUpdate(e){this.editingEnabled||e.dropFocus(t.Keyboard,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.theme.getFont(p.InputTextFont),this.textHelper.minWidth=this.theme.getNumber(p.InputTextMinWidth),this.textHelper.minAscent=this.theme.getNumber(p.InputTextMinAscent),this.textHelper.minDescent=this.theme.getNumber(p.InputTextMinDescent),this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.cursorOffsetDirty=!1),this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveLayout(t,e,i,s){const n=2*this.theme.getNumber(p.InputTextInnerPadding);this.width=e!==1/0?e:Math.max(t,this.textHelper.width+n),this.height=s!==1/0?s:Math.max(i,this.textHelper.height+n)}handlePainting(t,e,i){i.fillStyle=this.theme.getFill(p.InputBackgroundFill),i.fillRect(t,e,this.width,this.height),i.font=this.theme.getFont(p.InputTextFont),this._editingEnabled?this._valid?i.fillStyle=this.theme.getFill(p.InputTextFill):i.fillStyle=this.theme.getFill(p.InputTextFillInvalid):i.fillStyle=this.theme.getFill(p.InputTextFillDisabled);const s=this.theme.getNumber(p.InputTextInnerPadding);i.fillText(this.displayedText,t+s,e+this.height-this.textHelper.descent-s);const n=this.blinkOn;if(this.blinkWasOn=n,!n)return;const h=this.theme.getNumber(p.CursorThickness);i.fillRect(t+this.cursorOffset,e+s,h,this.height-2*s)}}class _t extends xt{constructor(t=null,e="",i=null){super(gt(t),e,i)}}class wt extends E{constructor(t){super(t,new v(new Map([[p.ContainerAlignment,{horizontal:m.Center,vertical:m.Center}],[p.ContainerPadding,{left:0,right:0,top:0,bottom:0}]])))}}class bt extends k{constructor(t=null,e=!1,i=null){super(i,!0,!1),this.offsetX=0,this.offsetY=0,this.actualLength=0,this.variable=new d(e,t),this.clickHelper=new o(this)}set checked(t){this.variable.value=t}get checked(){return this.variable.value}handleEvent(t,e){return this.clickHelper.handleClickEvent(t,e,[this.offsetX,this.actualLength,this.offsetY,this.actualLength]),this.clickHelper.clickStateChanged&&this.clickHelper.wasClick&&(this.checked=!this.checked),this}handlePreLayoutUpdate(t){this.variable.dirty&&(this._dirty=!0)}handleResolveLayout(t,e,i,s){const n=this.theme.getNumber(p.CheckboxLength);this.actualLength=Math.min(n,e,s),this.width=this.actualLength,this.height=this.actualLength,this.width<t&&(this.width=t),this.height<i&&(this.height=i),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(t,i,s){const n=this.clickHelper.clickState===e.Hover||this.clickHelper.clickState===e.Hold;if(s.fillStyle=n?this.theme.getFill(p.BackgroundGlowFill):this.theme.getFill(p.BackgroundFill),s.fillRect(this.offsetX,this.offsetY,this.actualLength,this.actualLength),this.checked){s.fillStyle=n?this.theme.getFill(p.AccentFill):this.theme.getFill(p.PrimaryFill);const e=this.theme.getNumber(p.CheckboxInnerPadding),h=this.actualLength-2*e;h<=0?s.fillRect(t+this.offsetX,i+this.offsetY,this.actualLength,this.actualLength):s.fillRect(t+this.offsetX+e,i+this.offsetY+e,h,h)}}}class kt extends k{constructor(t,e=null,i=null,s=null,n=null){super(n,!0,!1),this.lastSrc=null,this._rotation=0,this.offsetX=0,this.offsetY=0,this.actualWidth=0,this.actualHeight=0,this._image=t,this._imageWidth=e,this._imageHeight=i,this.viewBox=s}set image(t){t!==this._image&&(this._image=t,this.lastSrc=null)}get image(){return this._image}get imageWidth(){return this._imageWidth}set imageWidth(t){this._imageWidth!==t&&(this._imageWidth=t,this._layoutDirty=!0)}get imageHeight(){return this._imageHeight}set imageHeight(t){this._imageHeight!==t&&(this._imageHeight=t,this._layoutDirty=!0)}handlePreLayoutUpdate(t){var e,i;(null===(e=this._image)||void 0===e?void 0:e.src)!==this.lastSrc&&(null===(i=this._image)||void 0===i?void 0:i.complete)&&(this._dirty=!0)}handleResolveLayout(t,e,i,s){let n=this._imageWidth;null===n&&(n=null===this.viewBox?this._image.width:this.viewBox[2]),this.width=Math.max(Math.min(n,e),t);let h=this._imageHeight;null===h&&(h=null===this.viewBox?this._image.height:this.viewBox[3]),this.height=Math.max(Math.min(h,s),i);const r=this.width/n,o=this.height/h,l=Math.min(r,o);this.actualWidth=n*l,this.actualHeight=h*l,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=(this.height-this.actualHeight)/2}set rotation(t){t!==this._rotation&&(this._rotation=t,this._dirty=!0)}get rotation(){return this._rotation}handlePainting(t,e,i){var s;if(!(null===(s=this._image)||void 0===s?void 0:s.complete))return void(this.lastSrc=null);this.lastSrc=this._image.src;let n=this.offsetX,h=this.offsetY;0!==this.rotation&&(i.save(),i.translate(t+this.offsetX+this.actualWidth/2,e+this.offsetY+this.actualHeight/2),n=-this.actualWidth/2,h=-this.actualHeight/2,i.rotate(this.rotation)),null===this.viewBox?i.drawImage(this._image,n,h,this.actualWidth,this.actualHeight):i.drawImage(this._image,...this.viewBox,n,h,this.actualWidth,this.actualHeight),0!==this.rotation&&i.restore()}}class Tt extends F{constructor(t,e=null,i=null,s=null,n=null,h=null){super(new q(new kt(t,e,i,s,h)),n,h)}get icon(){return this.child.child}}class Pt extends k{constructor(t=1,e=0,i=0,s=null){super(s,!0,!1),this.flex=t,this.minWidth=e,this.minHeight=i}handleResolveLayout(t,e,i,s){this.width=e!==1/0?e:Math.max(t,this.minWidth),this.height=s!==1/0?s:Math.max(i,this.minHeight)}}class Ct extends A{constructor(t,e=null,i=!1,s=null){super(s),this.add([new S(t,s),new Pt(1,0,0,s),new bt(e,i,s)])}}class Lt extends P{constructor(t,e=!1,i=!1,s=null){super(t,s,!1,!0),this._minWidth=0,this._minHeight=0,this._offset=[0,0],this.viewport=new _,this._widthTied=e,this._heightTied=i}get canvasDimensions(){return this.viewport.canvasDimensions}get offset(){return[...this._offset]}set offset(t){this._offset[0]===t[0]&&this._offset[1]===t[1]||(this._offset[0]=t[0],this._offset[1]=t[1],this._dirty=!0)}set constraints(t){this.viewport.constraints=t}get constraints(){return this.viewport.constraints}get widthTied(){return this._widthTied}set widthTied(t){this._widthTied!==t&&(this._widthTied=t,this._layoutDirty=!0)}get heightTied(){return this._heightTied}set heightTied(t){this._heightTied!==t&&(this._heightTied=t,this._layoutDirty=!0)}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth!==t&&(this._minWidth=t,this._layoutDirty=!0)}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight!==t&&(this._minHeight=t,this._layoutDirty=!0)}handleEvent(t,e){if(null===t.target&&!(t instanceof s))return null;const[i,n]=this.child.dimensions,h=this.offset[0],r=h+i,o=this.offset[1],l=o+n;if(t instanceof s){if(null===t.target){if(t.x<h)return null;if(t.x>=r)return null;if(t.y<o)return null;if(t.y>=l)return null}t=t.correctOffset(h,o)}return this.child.dispatchEvent(t,e)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0);const i=this._widthTied||this._heightTied;e.layoutDirty&&i?this._layoutDirty=!0:i||this.viewport.resolveChildsLayout(e)}handleResolveLayout(t,e,i,s){let n=!0,h=!0;const r=Math.min(Math.max(t,this._minWidth),e),o=Math.min(Math.max(i,this._minHeight),s);if(this._widthTied||this._heightTied){const r=this.viewport.constraints;this._widthTied&&(r[0]=t,r[1]=e),this._heightTied&&(r[2]=i,r[3]=s);const o=this.child;this.viewport.constraints=r,this.viewport.resolveChildsLayout(o),this._widthTied&&(this.width=o.dimensions[0],n=!1),this._heightTied&&(this.height=o.dimensions[1],h=!1)}n&&(this.width=e!==1/0?e:r),h&&(this.height=s!==1/0?s:o)}handlePainting(t,e,i){this.viewport.paintToCanvas(this.child),i.save();const s=new Path2D;s.rect(Math.trunc(t),Math.trunc(e),Math.ceil(this.width),Math.ceil(this.height)),i.clip(s),i.globalCompositeOperation="copy",i.fillStyle=this.theme.getFill(p.CanvasFill),i.fill(s);const[n,h]=this.child.dimensions,[r,o]=this.offset,l=t+r,a=e+o,c=new Path2D;c.rect(Math.trunc(l),Math.trunc(a),Math.ceil(n),Math.ceil(h)),i.clip(c),i.drawImage(this.viewport.canvas,0,0,n,h,l,a,n,h),i.restore()}}class Dt extends Lt{}class Ft extends k{constructor(t=null,e=0,i=1,s=0,n=0,h=!1,r=null){super(r,!0,!1),this.offsetX=0,this.offsetY=0,this.actualWidth=0,this.actualHeight=0,this.clickHelper=new o(this),this.variable=new d(n,t),this.minValue=e,this.maxValue=i,this.snapIncrement=s,this.vertical=h}set value(t){this.snapIncrement>0&&(t=Math.round(t/this.snapIncrement)*this.snapIncrement),t<this.minValue?t=this.minValue:t>this.maxValue&&(t=this.maxValue),this.variable.value=t}get value(){return this.variable.value}handleEvent(t,i){const s=[this.offsetX,this.offsetX+this.actualWidth,this.offsetY,this.offsetY+this.actualHeight];if(this.clickHelper.handleClickEvent(t,i,s),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState==e.Hold)&&null!==this.clickHelper.pointerPos){const t=this.clickHelper.pointerPos[0];this.value=this.minValue+t*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handleResolveLayout(t,e,i,s){const n=this.theme.getNumber(p.SliderThickness),h=this.theme.getNumber(p.SliderMinLength);this.vertical?(this.height=s!=1/0?s:Math.max(h,i),this.actualHeight=this.height,this.offsetY=0,this.width=Math.min(Math.max(n,t),e),this.actualWidth=Math.min(this.width,n),this.offsetX=(this.width-this.actualWidth)/2):(this.width=e!=1/0?e:Math.max(h,t),this.actualWidth=this.width,this.offsetY=0,this.height=Math.min(Math.max(n,i),s),this.actualHeight=Math.min(this.height,n),this.offsetX=(this.height-this.actualHeight)/2)}handlePainting(t,i,s){t+=this.offsetX,i+=this.offsetY;[e.Hover,e.Hold].includes(this.clickHelper.clickState)?s.fillStyle=this.theme.getFill(p.AccentFill):s.fillStyle=this.theme.getFill(p.PrimaryFill);const n=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);s.fillRect(t,i,n,this.actualHeight),s.fillStyle=this.theme.getFill(p.BackgroundFill);const h=this.actualWidth-n;s.fillRect(t+n,i,h,this.actualHeight)}}class Ht extends C{constructor(t,e){super(t,null),this.scopeTheme=e}setThemeOverride(t){this.scopeTheme=t,super.inheritTheme(this.scopeTheme)}inheritTheme(t){super.inheritTheme(this.scopeTheme)}}export{m as Alignment,L as ArtificialConstraint,V as BackspaceKey,D as BaseContainer,_t as BasicTextInput,N as BasicVirtualKey,F as Button,wt as Center,bt as Checkbox,o as ClickHelper,e as ClickState,G as Column,E as Container,st as DOMKeyboardDriver,lt as DOMPointerDriver,b as DOMRoot,j as DOMVirtualKeyboardRoot,ct as DebugTheme,g as DefaultTextInputHandler,dt as DefaultTextValidator,Y as EnterKey,X as EscapeKey,i as Event,H as FilledButton,mt as FloatValidator,t as FocusType,W as GlyphVirtualKey,kt as Icon,Tt as IconButton,vt as IntValidator,Z as KeyEvent,et as KeyPress,tt as KeyRelease,it as KeyboardDriver,S as Label,Ct as LabelledCheckbox,r as Leave,ut as MakeCompositeValidator,gt as MakeDefaultTextValidatorWithCallback,yt as MakeRangeValidator,q as Margin,O as MultiContainer,B as MultiParent,T as Parent,C as PassthroughWidget,ot as PointerDriver,s as PointerEvent,rt as PointerHint,ht as PointerMove,h as PointerPress,n as PointerRelease,at as RayPointerDriver,w as Root,A as Row,Dt as ScrollableViewportWidget,Q as ShiftKey,P as SingleParent,Ft as Slider,K as SpaceKey,Pt as Spacing,I as TextButton,u as TextHelper,xt as TextInput,M as TextMargin,v as Theme,p as ThemeProperty,Ht as ThemeScope,d as Variable,_ as Viewport,Lt as ViewportWidget,U as VirtualKey,R as VirtualKeyRow,z as VirtualKeyboard,J as VirtualKeyboardRoot,k as Widget,$ as defaultVirtualKeyboardTemplate,nt as getPointerEventNormPos,c as measureTextDims,x as roundToPower2};
//# sourceMappingURL=index.esm.js.map
