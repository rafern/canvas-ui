var bt=Object.defineProperty;var si=Object.getOwnPropertyDescriptor;var At=Object.getOwnPropertySymbols;var oi=Object.prototype.hasOwnProperty,li=Object.prototype.propertyIsEnumerable;var Vt=(l,i,e)=>i in l?bt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[i]=e,A=(l,i)=>{for(var e in i||(i={}))oi.call(i,e)&&Vt(l,e,i[e]);if(At)for(var e of At(i))li.call(i,e)&&Vt(l,e,i[e]);return l};var a=(l,i)=>bt(l,"name",{value:i,configurable:!0});var w=(l,i,e,t)=>{for(var r=t>1?void 0:t?si(i,e):i,n=l.length-1,s;n>=0;n--)(s=l[n])&&(r=(t?s(i,e,r):s(r))||r);return t&&r&&bt(i,e,r),r};var Bt=(l,i,e)=>new Promise((t,r)=>{var n=h=>{try{o(e.next(h))}catch(d){r(d)}},s=h=>{try{o(e.throw(h))}catch(d){r(d)}},o=h=>h.done?t(h.value):Promise.resolve(h.value).then(n,s);o((e=e.apply(l,i)).next())});var Ot="Failed to get DOM canvas context. Make sure the 2D canvas context is supported",yt="Text render group generation is incorrectly implemented. Please report this bug if you are not responsible for text rendering for this Widget.",S={CANVAS_CONTEXT:`${Ot}.`,REUSABLE_CANVAS_CONTEXT:`${Ot} and the canvas is not being reused with a different rendering context.`,NEGATIVE_TEXT_GROUP:`Unexpected text render group with negative width detected. ${yt}`,EMPTY_LINE_RANGE:`Unexpected line range without any text render groups. Empty lines must contain a zero-width text render group. ${yt}`,ROGUE_NEWLINE:`Unexpected line range with newline character in the middle of the range instead of at the end. Text after newline character was ignored. ${yt}`,VIDEO_API_AVAILABLE:"HTMLVideoElement.requestVideoFrameCallback is available and will be used; if video playback is choppy or broken, please report it on Github",DIMENSIONLESS_CANVAS:"Canvas has 0 width or height. Are you using an empty Root? If not, make sure to not over-constrain the Widgets.",NON_POW2_CANVAS:"Canvas has a width or height that is not a power of 2, which may create mipmapping issues for 3D engines. Make sure to use power of 2 starting and maximum canvas dimensions.",DOM_DRIVER_REBIND:"Re-binding DOM driver. Are you calling bindDOMElem with the same HTML element multiple times?",PARENTLESS_CLIPVP:"Attempt to use ClippedViewport without a parent. If you are implementing a custom Root subclass, keep in mind that a Viewport with a rendering context must be used; ClippedViewport can't be used because it inherits a parent Viewport's rendering context."};function ae(l){return typeof l=="string"?l:"<Symbol()>"}a(ae,"propStr");function Ae(l){return typeof l=="string"?`"${l}"`:String(l)}a(Ae,"valueStr");var Nt="This may be caused by floating pointer precision errors.",b={INVALID_BACKGROUND_FILL:l=>`Unknown theme property: ${ae(l)}. Valid background fill theme properties: "primaryFill", "accentFill", "backgroundGlowFill" and "backgroundFill".`,SWAPPED_MIN_MAX_NAMED:(l,i,e,t)=>`${ae(t)} value (${Ae(i)}) can't be smaller than ${ae(e)} value (${Ae(l)}).`,SWAPPED_MIN_MAX:(l,i)=>b.SWAPPED_MIN_MAX_NAMED(l,i,"Minimum","Maximum"),INVALID_VALUE:(l,i,e=!1)=>`${ae(l)} value (${Ae(i)}) must be a valid${e?" non-negative":""} finite number. Make sure that it's not infinite and not NaN.`,NEGATIVE_VALUE:(l,i)=>`${ae(l)} value (${Ae(i)}) must be greater or equal to zero.`,NON_ARRAY_VALUE:(l,i)=>`${ae(l)} value (${Ae(i)}) must be an array.`,INVALID_MIN:l=>b.INVALID_VALUE("Minimum",l),INVALID_MAX:l=>b.INVALID_VALUE("Maximum",l),INVALID_INC:l=>b.INVALID_VALUE("Increment",l),NEGATIVE_INC:l=>b.NEGATIVE_VALUE("Increment",l),SWAPPED_MIN_MAX_DIMS:(l,i,e,t)=>`${b.SWAPPED_MIN_MAX_NAMED(l,i,e,t)} Set ${ae(e)} to ${ae(t)}. ${Nt}`,NEGATIVE_DIMS:(l,i)=>`${b.NEGATIVE_VALUE(i,l)} Set ${ae(i)} to 0. ${Nt}`,BROKEN_CONSTRAINTS:(l,i,e,t)=>`${e?"Horizont":"Vertic"}al ${t?"ov":"und"}erflow in Widget; Limit: ${i}, actual value: ${l}.`,INVALID_DIMS:(l,i)=>b.INVALID_VALUE(l?"Width":"Height",i,!0),INACTIVE_WIDGET:l=>`Cannot get ${l} property; Widget is not active. Make sure the Widget is in a UI tree and to never directly call Widget update, layout resolution or painting methods.`,INVALID_ACTIVATION:l=>`Attempt to ${l?"":"de"}activate ${l?"":"in"}active Widget. Make sure the Widget is not being reused in another Root without first removing it from the first Root.`,INVALID_KB_ROW_TEMPLATE:l=>`Unknown virtual key row template format for entry: ${l}. A key row template must either be a function that returns a VirtualKey instance, or a pair of symbols.`,INVALID_ENUM:(l,i,e)=>`Unknown ${i} value: ${l}. Make sure ${e} is being passed as an enum value instead of its corresponding hardcoded value; this value may have become invalid due to an update.`,OVERCAPTURING_WIDGET:l=>`TabSelect event captured by widget (${l.constructor.name}), but reachedRelative was false; a widget type is probably capturing events by default. Make sure to only capture events that you need so that other Widgets aren't broken.`,MAYBE_DIMENSIONLESS:l=>`ViewportWidget has no minimum ${l} and ${l} isn't bi-directionally coupled, therefore, it may be dimensionless. Set a minimum ${l} and/or bi-directionally couple the ${l}.`,UNTARGETABLE_EVENT:l=>`${l} events cannot be targetted to a specific widget. Target ignored`};function Ut(){console.groupCollapsed("Stack trace"),console.trace(),console.groupEnd()}a(Ut,"groupedStackTrace");function at(l){return function(i,e){let t=new WeakMap;Object.defineProperty(i,e,{set:function(r){let n=t.get(this);r!==n&&(t.set(this,r),l.call(this,n))},get:function(){return t.get(this)},enumerable:!0,configurable:!0})}}a(at,"watchField");function ht(l){return at(function(i){this[l]=!0})}a(ht,"flagField");var ve=ht("_dirty"),ee=ht("_layoutDirty");function G(l){return at(function(i){for(let e of l)this[e]=!0})}a(G,"multiFlagField");var Ri=G(["_dirty","_layoutDirty"]);function He(l,i=!1){return function(e,t){let r=new WeakMap;Object.defineProperty(e,t,{set:function(n){if(Array.isArray(n)){let s=r.get(this);if(Array.isArray(s)){if(n.length!==s.length){s.length=n.length;for(let o=0;o<n.length;o++)s[o]=n[o];l.call(this)}else for(let o=0;o<n.length;o++)if(s[o]!==n[o]){for(let h=0;h<n.length;h++)s[h]=n[h];l.call(this);return}}else r.set(this,[...n]),l.call(this)}else if(i)r.set(this,n),l.call(this);else throw new Error(b.NON_ARRAY_VALUE(t,n))},get:function(){let n=r.get(this);return Array.isArray(n)?[...n]:n},enumerable:!0,configurable:!0})}}a(He,"watchArrayField");function Xt(l,i=!1){return He(function(){this[l]=!0},i)}a(Xt,"flagArrayField");function Kt(l=!1){return Xt("_dirty",l)}a(Kt,"paintArrayField");function Yt(l=!1){return Xt("_layoutDirty",l)}a(Yt,"layoutArrayField");function ai(l,i=!1){return He(function(){for(let e of l)this[e]=!0},i)}a(ai,"multiFlagArrayField");function $t(l=!1){return ai(["_dirty","_layoutDirty"],l)}a($t,"paintLayoutArrayField");var U=class{constructor(i,e,t,r=!1){this.target=i,this.focusType=e,this.needsFocus=t,this.reversed=r}};a(U,"Event");var we=class extends U{constructor(e,t,r,n,s,o){super(n,s,o);this.shift=e,this.ctrl=t,this.alt=r}};a(we,"ModifierEvent");var W=class extends we{constructor(e,t,r,n,s,o=null,h=null){super(r,n,s,o,h,!1);this.x=e,this.y=t}};a(W,"PointerEvent");var F=class{constructor(i,e){this.parent=null;this.child=i,this.relativeCoordinates=e,this.constraints=[0,1/0,0,1/0],this.rect=[0,0,0,0],this.offset=[0,0]}updateEverything(){this.child.forceDirty(),this.updateChildPos()}forceLayoutDirty(){this.child.forceDirty()}updateChildPos(){if(!this.relativeCoordinates&&this.child.active){let[i,e,t,r]=this.rect,[n,s]=this.offset,o=i+n,h=e+s,[d,c]=this.child.position;(o!==d||h!==c)&&(this.child.resolvePosition(o,h),this.child.finalizeBounds())}}resolveLayout(){if(!this.child.layoutDirty)return!1;let[i,e]=this.child.dimensions;this.child.resolveDimensionsAsTop(...this.constraints),this.relativeCoordinates?this.child.resolvePosition(0,0):this.child.resolvePosition(...this.child.idealPosition),this.child.finalizeBounds();let[t,r]=this.child.dimensions;return t!==i||r!==e}dispatchEvent(i){if(i instanceof W){let[e,t,r,n]=this.rect,s=e+r,o=t+n;if(i.target===null&&(i.x<e||i.x>=s||i.y<t||i.y>=o))return null;if(this.relativeCoordinates){let[h,d]=this.offset,c=e+h,u=t+d;(c!==0||u!==0)&&(i=i.correctOffset(c,u))}}return this.child.dispatchEvent(i)}getClippedViewport(){let[i,e,t,r]=this.rect,[n,s]=this.child.dimensions,[o,h]=this.offset,d=i+t,c=e+r,u=i+o,m=e+h,f=Math.min(Math.max(u,i),d),p=Math.min(Math.max(m,e),c),g=Math.min(Math.max(u+n,i),d)-f,_=Math.min(Math.max(m+s,e),c)-p;return[i,e,t,r,u,m,f,p,g,_]}};a(F,"BaseViewport"),F.dimensionlessWarned=!1,F.powerOf2Warned=!1,F.maxRelayout=4,w([He(F.prototype.forceLayoutDirty)],F.prototype,"constraints",2),w([He(F.prototype.updateEverything)],F.prototype,"rect",2),w([He(F.prototype.updateChildPos)],F.prototype,"offset",2);function vt(l,i=!0){return Math.pow(2,(i?Math.ceil:Math.floor)(Math.log2(l)))}a(vt,"roundToPower2");function xt(l){return(l&l-1)===0}a(xt,"isPower2");var te=class extends F{constructor(e,t=1,r=!1,n=64,s=64){super(e,!0);this.maxCanvasWidth=16384;this.maxCanvasHeight=16384;this._forceResize=!0;this._prevESX=1;this._prevESY=1;this.shrunk=!1;this.resolution=t,this.preventBleeding=r,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=s;let o=this.canvas.getContext("2d",{alpha:!0});if(o===null)throw new Error(S.CANVAS_CONTEXT);this.context=o,this.child.forceDirty()}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}resolveLayout(){let[e,t]=this.realDimensions,r=super.resolveLayout();if(r||this._forceResize){this._forceResize=!1;let[n,s]=this.realDimensions;(e>n||t>s)&&(this.shrunk=!0);let[o,h]=this.child.dimensions,d=o*this.resolution,c=h*this.resolution,u=Math.min(Math.max(vt(d),this.canvas.width),this.maxCanvasWidth),m=Math.min(Math.max(vt(c),this.canvas.height),this.maxCanvasHeight);u===0||m===0?F.dimensionlessWarned||(F.dimensionlessWarned=!0,console.warn(S.DIMENSIONLESS_CANVAS)):(!xt(u)||!xt(m))&&(F.powerOf2Warned||(F.powerOf2Warned=!0,console.warn(S.NON_POW2_CANVAS)));let f=this.canvas.width,p=this.canvas.height,[g,_]=this.effectiveScale,v=f!==0&&p!==0;if((g!==this._prevESX||_!==this._prevESY)&&(this._prevESX=g,this._prevESY=_,v=!1,r=!0,this.child.forceDirty(!1),this.child.finalizeBounds()),u!==f||m!==p){r=!0;let x=null;if(v){x=document.createElement("canvas"),x.width=f,x.height=p;let T=x.getContext("2d");if(T===null)throw new Error(S.CANVAS_CONTEXT);T.globalCompositeOperation="copy",T.drawImage(this.canvas,0,0,f,p,0,0,f,p)}this.canvas.width=u,this.canvas.height=m,x!==null&&(this.context.globalCompositeOperation="copy",this.context.drawImage(x,0,0,x.width,x.height,0,0,Math.min(x.width,this.maxCanvasWidth),Math.min(x.height,this.maxCanvasHeight)),this.context.globalCompositeOperation="source-over")}}return r}get effectiveScale(){let[e,t]=this.child.dimensions;return[Math.min(this.maxCanvasWidth/e,this.resolution),Math.min(this.maxCanvasHeight/t,this.resolution)]}get realDimensions(){let[e,t]=this.child.dimensions;return[Math.min(this.maxCanvasWidth,Math.ceil(e*this.resolution)),Math.min(this.maxCanvasHeight,Math.ceil(t*this.resolution))]}paintToInternal(e){let t=this.child.dirty,[r,n]=this.effectiveScale,s=r!==1||n!==1;if(s&&(this.context.save(),this.context.scale(r,n)),this.child.paint(e),s&&this.context.restore(),this.preventBleeding&&this.shrunk){this.shrunk=!1;let[o,h]=this.realDimensions,d=this.maxCanvasWidth-o,c=this.maxCanvasHeight-h;d>0&&c>0?(this.context.clearRect(o,0,d,h),this.context.clearRect(0,h,this.maxCanvasWidth,this.maxCanvasHeight)):d>0?this.context.clearRect(o,0,d,this.maxCanvasHeight):c>0&&this.context.clearRect(0,h,this.maxCanvasWidth,this.maxCanvasHeight)}return t}paint(e,t){let r=this.paintToInternal(e);if(this.parent!==null){let[n,s,o,h,d,c,u,m,f,p]=this.getClippedViewport(),g=this.parent.context;if(g.save(),g.globalCompositeOperation="copy",g.fillStyle=t,g.beginPath(),g.rect(n,s,o,h),g.clip(),f!==0&&p!==0){let[_,v]=this.effectiveScale;g.drawImage(this.canvas,(u-d)*_,(m-c)*v,f*_,p*v,u,m,f,p)}g.rect(u,m,f,p),g.clip("evenodd"),g.fill(),g.restore()}return r}};a(te,"CanvasViewport"),w([ve],te.prototype,"maxCanvasWidth",2),w([ve],te.prototype,"maxCanvasHeight",2),w([ht("_forceResize")],te.prototype,"resolution",2);var Ve=class extends F{get context(){if(this.parent===null)throw S.PARENTLESS_CLIPVP;return this.parent.context}get effectiveScale(){if(this.parent===null)throw S.PARENTLESS_CLIPVP;return this.parent.effectiveScale}constructor(i){super(i,!1)}paint(i,e){let t=this.child.dirty,[r,n,s,o,h,d,c,u,m,f]=this.getClippedViewport(),p=this.context;return p.save(),p.globalCompositeOperation="copy",p.fillStyle=e,p.beginPath(),p.rect(r,n,s,o),p.clip(),p.rect(c,u,m,f),p.clip("evenodd"),p.fill(),p.restore(),m===0||f===0?(this.child.dryPaint(),t):(p.save(),p.beginPath(),p.rect(r,n,s,o),p.clip(),this.child.paint(i),p.restore(),t)}};a(Ve,"ClippedViewport");var hi=(n=>(n.SpaceBetween="between",n.SpaceAround="around",n[n.Start=0]="Start",n[n.Center=.5]="Center",n[n.End=1]="End",n))(hi||{});var di=(r=>(r.Stretch="stretch",r[r.Start=0]="Start",r[r.Center=.5]="Center",r[r.End=1]="End",r))(di||{});var Be=class extends U{constructor(e,t){super(null,null,!1);this.originallyRelativeTo=e,this.bounds=[...t]}cloneWithTarget(e){return e!==null&&!Be.targetWarned&&(Be.targetWarned=!0,console.warn(b.UNTARGETABLE_EVENT("AutoScroll"))),new Be(this.originallyRelativeTo,this.bounds)}},j=Be;a(j,"AutoScroll"),j.targetWarned=!1;var Oe=class extends U{constructor(e,t){super(null,null,!1,t);this.relativeTo=e,this.reachedRelative=e===null}cloneWithTarget(e){e!==null&&!Oe.targetWarned&&(Oe.targetWarned=!0,console.warn(b.UNTARGETABLE_EVENT("TabSelect")));let t=new Oe(this.relativeTo,this.reversed);return t.reachedRelative=this.reachedRelative,t}},N=Oe;a(N,"TabSelect"),N.targetWarned=!1;var Ne=null,Z=[],Gt=64,ci=1e4;function dt(l,i){let e=new Date().getTime(),t=null,r=-1,n=Z.length-1;for(let o=0;o<Z.length;o++){let h=Z[o];if(h[0]===i&&h[1]===l){t=h,r=o;break}e-h[4]>ci&&(n=o)}if(t){let o=++t[3];if(t[4]=e,r>0){let h=0;for(;h<r&&!(Z[h][3]<=o);h++);h!==r&&(Z.splice(r,1),Z.splice(h,0,t))}return t[2]}if(Ne===null&&(Ne=document.createElement("canvas").getContext("2d"),Ne===null))throw new Error(S.CANVAS_CONTEXT);Ne.font=i;let s=Ne.measureText(l);if(Gt>0){Z.length===Gt&&Z.splice(n,1);let o=0;for(;o<Z.length&&!(Z[o][3]<=1);o++);Z.splice(o,0,[i,l,s,1,e])}return s}a(dt,"measureTextDims");var ui=new Set([`
`,"	"]),zt=(e=>(e[e.Normal=0]="Normal",e[e.Shrink=1]="Shrink",e))(zt||{}),fi=(t=>(t[t.Start=0]="Start",t[t.Center=.5]="Center",t[t.End=1]="End",t))(fi||{}),mi="~!@#$%^&*()_+`1234567890-=qwertyuiop[]\\QWERTYUIOP{}|asdfghjkl;'ASDFGHJKL:\"zxcvbnm,./ZXCVBNM<>?",D=class{constructor(){this.text="";this.font="";this.maxWidth=1/0;this.lineHeight=null;this.lineSpacing=null;this.tabWidth=4;this.wrapMode=0;this.alignMode=0;this._width=0;this._height=0;this._lineHeight=0;this._lineSpacing=0;this._tabWidth=0;this.measureDirty=!0;this.maxWidthDirty=!1;this.lineHeightSpacingDirty=!0;this.tabWidthDirty=!0;this._dirty=!1;this._lineRanges=[];this.hasWrappedLines=!1}get dirty(){let i=this._dirty;return this._dirty=!1,i}measureTextSlice(i,e,t){let r=dt(this.text.slice(e,t),this.font);return i===0?r.width+Math.max(0,r.actualBoundingBoxLeft):i+r.width}getLineRangeWidthUntil(i,e){if(e<=i[0][0])return 0;let t=0;for(;t<i.length;t++){let s=i[t],o=s[1];if(e==o)return s[2];if(e>=s[0]&&e<o)break}if(t===i.length)return i[t-1][2];let r=0;t>0&&(r=i[t-1][2]);let n=i[t];return n[3]?r+n[2]*(e-n[0])/(n[1]-n[0]):this.measureTextSlice(r,n[0],e)}measureText(i,e,t,r){var u,m;let n=0;for(;n<r.length;n++){let f=r[n];if(i>=f[0]&&i<f[1]){i=f[0];break}}if(n>0){let f=r[n-1];f[1]!==i&&(i=f[1],--n>0?f=r[n]:f=null),f!==null&&!f[3]&&!ui.has(this.text[i])&&(i=f[0],n--)}let s=0;n>0&&(s=r[n-1][2]);let o=i,h=[];for(;o<e;)if(this.text[o]==="	"){let f=this.actualTabWidth;s=(Math.floor(s/f)+1)*f,h.push([o,++o,s,!0])}else if(this.text[o]===`
`){h.push([o,++o,s,!0]),o<e&&console.warn(S.ROGUE_NEWLINE);break}else{let f=this.text.indexOf(`
`,o+1);f===-1&&(f=1/0);let p=this.text.indexOf("	",o+1);p===-1&&(p=1/0);let g=Math.min(f,p,e);s=this.measureTextSlice(s,o,g),h.push([o,g,s,!1]),o=g}let d=n+h.length,c=(m=(u=h[h.length-1])!=null?u:r[n-1])!=null?m:null;return c===null?(r.length=0,r.push([i,i,0,!1]),!0):d===1&&c[1]-c[0]<=1||c[2]<=t?(r.length=n,r.push(...h),!0):!1}updateTextDims(){if(this.lineHeightSpacingDirty){this.lineHeightSpacingDirty=!1;let e=this._lineHeight,t=this._lineSpacing;if(this.lineHeight===null||this.lineSpacing===null){let r=dt(mi,this.font);this.lineHeight===null?this._lineHeight=r.actualBoundingBoxAscent:this._lineHeight=this.lineHeight,this.lineSpacing===null?this._lineSpacing=r.actualBoundingBoxDescent:this._lineSpacing=this.lineSpacing}else this._lineHeight=this.lineHeight,this._lineSpacing=this.lineSpacing;(e!==this._lineHeight||t!==this._lineSpacing)&&(this.measureDirty=!0)}if(this.maxWidthDirty&&(this.maxWidthDirty=!1,this.maxWidth===1/0?this.hasWrappedLines&&(this.measureDirty=!0):(this.hasWrappedLines||this._width>this.maxWidth)&&(this.measureDirty=!0)),this.tabWidthDirty&&(this.tabWidthDirty=!1,this._tabWidth=dt(" ",this.font).width*this.tabWidth),!this.measureDirty)return;this.measureDirty=!1,this.hasWrappedLines=!1;let i=this._lineHeight+this._lineSpacing;if(this.text.length===0)this._height=i,this._width=this.maxWidth===1/0?0:this.maxWidth,this._lineRanges.length=1,this._lineRanges[0]=[[0,0,0,!1]];else if(this.maxWidth===1/0){this._lineRanges.length=0;let e=0;this._height=0,this._width=0;let t=this.text;for(;;){let r=this.text.indexOf(`
`,e),n=r===-1,s=n?t.length:r+1,o=[];this.measureText(e,s,1/0,o),this._lineRanges.push(o),this._height+=i;let h=o[o.length-1][2];if(h>this._width&&(this._width=h),n)break;e=s}}else{this._lineRanges.length=0;let e=[],t=this.text,r=/\s/,n=-1;for(let s=0;s<=t.length;){let o=r.test(t[s]),h=s===t.length;if(o||h){if(n>=0&&!this.measureText(n,s,this.maxWidth,e)){this.hasWrappedLines=!0;let d=[];if(this.measureText(n,s,this.maxWidth,d)){if(e.length===0)throw new Error(S.EMPTY_LINE_RANGE);this._lineRanges.push(e),e=d}else{let c=n;for(;c<s-1&&this.measureText(c,c+1,this.maxWidth,e);c++);this._lineRanges.push(e),e=d,s=c,n=c;continue}}if(n=-1,h){if(e.length===0){let d=this._lineRanges[this._lineRanges.length-1];if(d===void 0)e.push([0,0,0,!1]);else{let c=d[d.length-1];c===void 0?e.push([0,0,0,!1]):e.push([c[1],c[1],0,!1])}}this._lineRanges.push(e);break}if(t[s]===`
`)this.measureText(s,s+1,1/0,e),this._lineRanges.push(e),e=[];else if(!this.measureText(s,s+1,this.maxWidth,e))if(this.wrapMode===1){let d=s;do s++;while(t[s]!==`
`&&r.test(t[s]));let c=e[e.length-1];e.push([d,s,c!==void 0?c[2]:0,!0]),this._lineRanges.push(e),e=[];continue}else this.hasWrappedLines=!0,this._lineRanges.push(e),e=[],this.measureText(s,s+1,1/0,e)}else n===-1&&(n=s);s++}this._width=this.maxWidth,this._height=i*this._lineRanges.length}}paintGroup(i,e,t,r,n){!e[3]&&e[2]>t&&i.fillText(this.text.slice(e[0],e[1]),r,n)}paint(i,e,t,r){i.save(),i.beginPath(),i.rect(t,r,this.width,this.height),i.clip(),i.font=this.font,i.fillStyle=e,i.textBaseline="alphabetic",this.updateTextDims();let n=this.fullLineHeight,s=r+this._lineHeight;for(let o=0;o<this._lineRanges.length;o++){let h=0,d=this.getLineShift(o);for(let c of this._lineRanges[o])this.paintGroup(i,c,h,t+h+d,s),h=c[2];s+=n}i.restore()}findOffsetFromIndex(i){if(this.updateTextDims(),i<=0||this._lineRanges.length===0)return[this.getLineShift(0),0];let e=0;for(let t of this._lineRanges){if(i<t[t.length-1][1])break;e++}return e>=this._lineRanges.length&&(e=this._lineRanges.length-1,i=this.text.length),[this.getLineRangeWidthUntil(this._lineRanges[e],i)+this.getLineShift(e),e*this.fullLineHeight]}findIndexOffsetFromOffset(i){let e=this.fullLineHeight,t=this.getLineShift(0);if(this.text===""||i[0]<=t&&i[1]<e||i[1]<0)return[0,[t,0]];let r=Math.floor(i[1]/e);if(this.updateTextDims(),r>=this._lineRanges.length){let v=this.text.length;return[v,this.findOffsetFromIndex(v)]}let n=r*e,s=this._lineRanges[r],o=this.getLineShift(r);if(s.length===1&&s[0][0]===s[0][1])return[s[0][0],[s[0][2]+o,n]];let h=s[0][0],d=s[s.length-1][1];this.text[d-1]===`
`&&d--;let c=-1,u=0,m=i[0]-o,f=h,p=d+1,g=0,_=0;do{let v=f+Math.floor((p-f)/2),x=this.getLineRangeWidthUntil(s,v);x>=m?(p=v,c=v,u=x):(f=v+1,g=v,_=x)}while(f!==p);if(g<d){let v=g+1,x=u;c!==v&&(x=this.getLineRangeWidthUntil(s,v));let T=_+(x-_)/2;if(m>=T)return[v,[x+o,n]]}return[g,[_+o,n]]}getLine(i){if(i<=0)return 0;this.updateTextDims();for(let e=0;e<this._lineRanges.length;e++){let t=this._lineRanges[e],r=t[t.length-1];if(i<r[1])return e}return this._lineRanges.length-1}getLineStart(i){if(i<=0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let e=this._lineRanges[this._lineRanges.length-1];return e[e.length-1][1]}return this._lineRanges[i][0][0]}getLineEnd(i,e=!0){if(i<0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let s=this._lineRanges[this._lineRanges.length-1];return s[s.length-1][1]}let t=this._lineRanges[i],r=t[t.length-1],n=r[1];return!e&&n>0&&this.text[n-1]===`
`&&r[0]!==r[1]?n-1:n}getLineShift(i){let e=this.alignMode;if(e===0)return 0;if(this.updateTextDims(),i<0)i=0;else if(i>=this._lineRanges.length)return this.width*e;let t=this._lineRanges[i];return(this.width-t[t.length-1][2])*e}get width(){return this.updateTextDims(),this._width}get height(){return this.updateTextDims(),this._height}get lineRanges(){return this.updateTextDims(),[...this._lineRanges]}get actualLineHeight(){return this.updateTextDims(),this._lineHeight}get actualLineSpacing(){return this.updateTextDims(),this._lineSpacing}get actualTabWidth(){return this.updateTextDims(),this._tabWidth}get fullLineHeight(){return this.updateTextDims(),this._lineHeight+this._lineSpacing}};a(D,"TextHelper"),w([G(["_dirty","measureDirty"])],D.prototype,"text",2),w([G(["_dirty","measureDirty","lineHeightSpacingDirty","tabWidthDirty"])],D.prototype,"font",2),w([G(["_dirty","maxWidthDirty"])],D.prototype,"maxWidth",2),w([G(["_dirty","measureDirty","lineHeightSpacingDirty"])],D.prototype,"lineHeight",2),w([G(["_dirty","measureDirty","lineHeightSpacingDirty"])],D.prototype,"lineSpacing",2),w([G(["_dirty","measureDirty","tabWidthDirty"])],D.prototype,"tabWidth",2),w([G(["_dirty","measureDirty"])],D.prototype,"wrapMode",2),w([G(["_dirty"])],D.prototype,"alignMode",2);var M=class{constructor(i,e){this.listener=null;this._fallbackTheme=e,typeof i!="undefined"&&(this._canvasFill=i.canvasFill,this._containerPadding=i.containerPadding,this._containerAlignment=i.containerAlignment,this._multiContainerSpacing=i.multiContainerSpacing,this._multiContainerAlignment=i.multiContainerAlignment,this._primaryFill=i.primaryFill,this._accentFill=i.accentFill,this._backgroundFill=i.backgroundFill,this._backgroundGlowFill=i.backgroundGlowFill,this._sliderMinLength=i.sliderMinLength,this._sliderThickness=i.sliderThickness,this._bodyTextFont=i.bodyTextFont,this._bodyTextFill=i.bodyTextFill,this._bodyTextHeight=i.bodyTextHeight,this._bodyTextSpacing=i.bodyTextSpacing,this._bodyTextAlign=i.bodyTextAlign,this._checkboxLength=i.checkboxLength,this._checkboxInnerPadding=i.checkboxInnerPadding,this._inputBackgroundFill=i.inputBackgroundFill,this._inputSelectBackgroundFill=i.inputSelectBackgroundFill,this._inputTextFont=i.inputTextFont,this._inputTextFill=i.inputTextFill,this._inputTextFillDisabled=i.inputTextFillDisabled,this._inputTextFillInvalid=i.inputTextFillInvalid,this._inputTextHeight=i.inputTextHeight,this._inputTextSpacing=i.inputTextSpacing,this._inputTextInnerPadding=i.inputTextInnerPadding,this._inputTextMinWidth=i.inputTextMinWidth,this._inputTextAlign=i.inputTextAlign,this._blinkRate=i.blinkRate,this._cursorThickness=i.cursorThickness,this._scrollBarThickness=i.scrollBarThickness,this._scrollBarMinPercent=i.scrollBarMinPercent,this._scrollBarMinPixels=i.scrollBarMinPixels,this._radioButtonLength=i.radioButtonLength,this._radioButtonInnerPadding=i.radioButtonInnerPadding)}get fallbackTheme(){return this._fallbackTheme}set fallbackTheme(i){if(this._fallbackTheme===i)return;let e=this._fallbackTheme;typeof e!="undefined"&&this.listener!==null&&e.unsubscribe(this.listener),typeof i!="undefined"&&(this.listener=t=>this.onThemeUpdated(t),i.subscribe(this.listener)),this._fallbackTheme=i,this.onThemeUpdated()}onThemeUpdated(i=null){}get canvasFill(){var i,e,t;return(t=(e=this._canvasFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.canvasFill)!=null?t:"rgba(0,0,0,0.5)"}set canvasFill(i){this._canvasFill!==i&&(this._canvasFill=i,this.onThemeUpdated("canvasFill"))}get containerPadding(){var i,e,t;return(t=(e=this._containerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerPadding)!=null?t:{left:4,right:4,top:4,bottom:4}}set containerPadding(i){this._containerPadding!==i&&(this._containerPadding=i,this.onThemeUpdated("containerPadding"))}get containerAlignment(){var i,e,t;return(t=(e=this._containerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerAlignment)!=null?t:{horizontal:0,vertical:0}}set containerAlignment(i){this._containerAlignment!==i&&(this._containerAlignment=i,this.onThemeUpdated("containerAlignment"))}get multiContainerSpacing(){var i,e,t;return(t=(e=this._multiContainerSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerSpacing)!=null?t:4}set multiContainerSpacing(i){this._multiContainerSpacing!==i&&(this._multiContainerSpacing=i,this.onThemeUpdated("multiContainerSpacing"))}get multiContainerAlignment(){var i,e,t;return(t=(e=this._multiContainerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerAlignment)!=null?t:{main:"between",cross:"stretch"}}set multiContainerAlignment(i){this._multiContainerAlignment!==i&&(this._multiContainerAlignment=i,this.onThemeUpdated("multiContainerAlignment"))}get primaryFill(){var i,e,t;return(t=(e=this._primaryFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.primaryFill)!=null?t:"rgb(0,127,255)"}set primaryFill(i){this._primaryFill!==i&&(this._primaryFill=i,this.onThemeUpdated("primaryFill"))}get accentFill(){var i,e,t;return(t=(e=this._accentFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.accentFill)!=null?t:"rgb(0,195,255)"}set accentFill(i){this._accentFill!==i&&(this._accentFill=i,this.onThemeUpdated("accentFill"))}get backgroundFill(){var i,e,t;return(t=(e=this._backgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundFill)!=null?t:"rgb(32,32,32)"}set backgroundFill(i){this._backgroundFill!==i&&(this._backgroundFill=i,this.onThemeUpdated("backgroundFill"))}get backgroundGlowFill(){var i,e,t;return(t=(e=this._backgroundGlowFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundGlowFill)!=null?t:"rgb(48,48,48)"}set backgroundGlowFill(i){this._backgroundGlowFill!==i&&(this._backgroundGlowFill=i,this.onThemeUpdated("backgroundGlowFill"))}get sliderMinLength(){var i,e,t;return(t=(e=this._sliderMinLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderMinLength)!=null?t:100}set sliderMinLength(i){this._sliderMinLength!==i&&(this._sliderMinLength=i,this.onThemeUpdated("sliderMinLength"))}get sliderThickness(){var i,e,t;return(t=(e=this._sliderThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderThickness)!=null?t:10}set sliderThickness(i){this._sliderThickness!==i&&(this._sliderThickness=i,this.onThemeUpdated("sliderThickness"))}get bodyTextFont(){var i,e,t;return(t=(e=this._bodyTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFont)!=null?t:"1rem sans-serif"}set bodyTextFont(i){this._bodyTextFont!==i&&(this._bodyTextFont=i,this.onThemeUpdated("bodyTextFont"))}get bodyTextFill(){var i,e,t;return(t=(e=this._bodyTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFill)!=null?t:"white"}set bodyTextFill(i){this._bodyTextFill!==i&&(this._bodyTextFill=i,this.onThemeUpdated("bodyTextFill"))}get bodyTextHeight(){var i,e,t;return(t=(e=this._bodyTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextHeight)!=null?t:null}set bodyTextHeight(i){this._bodyTextHeight!==i&&(this._bodyTextHeight=i,this.onThemeUpdated("bodyTextHeight"))}get bodyTextSpacing(){var i,e,t;return(t=(e=this._bodyTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextSpacing)!=null?t:null}set bodyTextSpacing(i){this._bodyTextSpacing!==i&&(this._bodyTextSpacing=i,this.onThemeUpdated("bodyTextSpacing"))}get bodyTextAlign(){var i,e,t;return(t=(e=this._bodyTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextAlign)!=null?t:0}set bodyTextAlign(i){this._bodyTextAlign!==i&&(this._bodyTextAlign=i,this.onThemeUpdated("bodyTextAlign"))}get checkboxLength(){var i,e,t;return(t=(e=this._checkboxLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxLength)!=null?t:12}set checkboxLength(i){this._checkboxLength!==i&&(this._checkboxLength=i,this.onThemeUpdated("checkboxLength"))}get checkboxInnerPadding(){var i,e,t;return(t=(e=this._checkboxInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxInnerPadding)!=null?t:2}set checkboxInnerPadding(i){this._checkboxInnerPadding!==i&&(this._checkboxInnerPadding=i,this.onThemeUpdated("checkboxInnerPadding"))}get inputBackgroundFill(){var i,e,t;return(t=(e=this._inputBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputBackgroundFill)!=null?t:"white"}set inputBackgroundFill(i){this._inputBackgroundFill!==i&&(this._inputBackgroundFill=i,this.onThemeUpdated("inputBackgroundFill"))}get inputSelectBackgroundFill(){var i,e,t;return(t=(e=this._inputSelectBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputSelectBackgroundFill)!=null?t:"rgb(0,195,255)"}set inputSelectBackgroundFill(i){this._inputSelectBackgroundFill!==i&&(this._inputSelectBackgroundFill=i,this.onThemeUpdated("inputSelectBackgroundFill"))}get inputTextFont(){var i,e,t;return(t=(e=this._inputTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFont)!=null?t:"1rem monospace"}set inputTextFont(i){this._inputTextFont!==i&&(this._inputTextFont=i,this.onThemeUpdated("inputTextFont"))}get inputTextFill(){var i,e,t;return(t=(e=this._inputTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFill)!=null?t:"black"}set inputTextFill(i){this._inputTextFill!==i&&(this._inputTextFill=i,this.onThemeUpdated("inputTextFill"))}get inputTextFillDisabled(){var i,e,t;return(t=(e=this._inputTextFillDisabled)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillDisabled)!=null?t:"grey"}set inputTextFillDisabled(i){this._inputTextFillDisabled!==i&&(this._inputTextFillDisabled=i,this.onThemeUpdated("inputTextFillDisabled"))}get inputTextFillInvalid(){var i,e,t;return(t=(e=this._inputTextFillInvalid)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillInvalid)!=null?t:"red"}set inputTextFillInvalid(i){this._inputTextFillInvalid!==i&&(this._inputTextFillInvalid=i,this.onThemeUpdated("inputTextFillInvalid"))}get inputTextHeight(){var i,e,t;return(t=(e=this._inputTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextHeight)!=null?t:null}set inputTextHeight(i){this._inputTextHeight!==i&&(this._inputTextHeight=i,this.onThemeUpdated("inputTextHeight"))}get inputTextSpacing(){var i,e,t;return(t=(e=this._inputTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextSpacing)!=null?t:null}set inputTextSpacing(i){this._inputTextSpacing!==i&&(this._inputTextSpacing=i,this.onThemeUpdated("inputTextSpacing"))}get inputTextInnerPadding(){var i,e,t;return(t=(e=this._inputTextInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextInnerPadding)!=null?t:2}set inputTextInnerPadding(i){this._inputTextInnerPadding!==i&&(this._inputTextInnerPadding=i,this.onThemeUpdated("inputTextInnerPadding"))}get inputTextMinWidth(){var i,e,t;return(t=(e=this._inputTextMinWidth)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextMinWidth)!=null?t:100}set inputTextMinWidth(i){this._inputTextMinWidth!==i&&(this._inputTextMinWidth=i,this.onThemeUpdated("inputTextMinWidth"))}get inputTextAlign(){var i,e,t;return(t=(e=this._inputTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextAlign)!=null?t:0}set inputTextAlign(i){this._inputTextAlign!==i&&(this._inputTextAlign=i,this.onThemeUpdated("inputTextAlign"))}get blinkRate(){var i,e,t;return(t=(e=this._blinkRate)!=null?e:(i=this._fallbackTheme)==null?void 0:i.blinkRate)!=null?t:.8}set blinkRate(i){this._blinkRate!==i&&(this._blinkRate=i,this.onThemeUpdated("blinkRate"))}get cursorThickness(){var i,e,t;return(t=(e=this._cursorThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.cursorThickness)!=null?t:1}set cursorThickness(i){this._cursorThickness!==i&&(this._cursorThickness=i,this.onThemeUpdated("cursorThickness"))}get scrollBarThickness(){var i,e,t;return(t=(e=this._scrollBarThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarThickness)!=null?t:8}set scrollBarThickness(i){this._scrollBarThickness!==i&&(this._scrollBarThickness=i,this.onThemeUpdated("scrollBarThickness"))}get scrollBarMinPercent(){var i,e,t;return(t=(e=this._scrollBarMinPercent)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPercent)!=null?t:.1}set scrollBarMinPercent(i){this._scrollBarMinPercent!==i&&(this._scrollBarMinPercent=i,this.onThemeUpdated("scrollBarMinPercent"))}get scrollBarMinPixels(){var i,e,t;return(t=(e=this._scrollBarMinPixels)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPixels)!=null?t:20}set scrollBarMinPixels(i){this._scrollBarMinPixels!==i&&(this._scrollBarMinPixels=i,this.onThemeUpdated("scrollBarMinPixels"))}get radioButtonLength(){var i,e,t;return(t=(e=this._radioButtonLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.radioButtonLength)!=null?t:12}set radioButtonLength(i){this._radioButtonLength!==i&&(this._radioButtonLength=i,this.onThemeUpdated("radioButtonLength"))}get radioButtonInnerPadding(){var i,e,t;return(t=(e=this._radioButtonInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.radioButtonInnerPadding)!=null?t:2}set radioButtonInnerPadding(i){this._radioButtonInnerPadding!==i&&(this._radioButtonInnerPadding=i,this.onThemeUpdated("radioButtonInnerPadding"))}};a(M,"BaseTheme");var pi=Math.PI*2,y=class extends M{constructor(e,t,r){var n,s;super(r);this._dirty=!0;this._layoutDirty=!0;this.width=0;this.height=0;this.x=0;this.y=0;this.idealWidth=0;this.idealHeight=0;this.idealX=0;this.idealY=0;this._root=null;this._viewport=null;this._parent=null;this.tabFocusable=!1;this.needsClear=e,this.propagatesEvents=t,this._enabled=(n=r==null?void 0:r.enabled)!=null?n:!0,this._flex=(s=r==null?void 0:r.flex)!=null?s:0}get flex(){return this._flex}set flex(e){e!==this._flex&&(this._flex=e,this._layoutDirty=!0)}set enabled(e){e!==this._enabled&&(this._enabled=e,this.forceDirty())}get enabled(){return this._enabled}set inheritedTheme(e){this.fallbackTheme=e}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){super.onThemeUpdated(e),this.needsClear&&(e===null||e==="canvasFill")&&(this._dirty=!0)}get dimensions(){return[this.width,this.height]}get idealDimensions(){return[this.idealWidth,this.idealHeight]}get position(){return[this.x,this.y]}get idealPosition(){return[this.idealX,this.idealY]}get bounds(){let e=this.x,t=this.y;return[e,e+this.width,t,t+this.height]}get idealBounds(){let e=this.idealX,t=this.idealY;return[e,e+this.idealWidth,t,t+this.idealHeight]}get rect(){return[this.x,this.y,this.width,this.height]}get idealRect(){return[this.idealX,this.idealY,this.idealWidth,this.idealHeight]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return this.width==0||this.height==0}onFocusGrabbed(e){}onFocusDropped(e){}handleEvent(e){return e.target===this?this:null}dispatchEvent(e){if(!this._enabled)return null;if(e.target===null){if(e instanceof W){if(e.x<this.x||e.y<this.y||e.x>=this.x+this.width||e.y>=this.y+this.height)return null}else if(e instanceof j){if(e.originallyRelativeTo===this)return this;if(!this.propagatesEvents)return null}}else if(e.target!==this&&!this.propagatesEvents)return null;let t=null;if(e.reversed&&(t=this.handleEvent(e)),e instanceof N)if(e.reachedRelative){if(this.tabFocusable&&(t===this||t===null))return this}else e.relativeTo===this&&(e.reachedRelative=!0);return e.reversed||(t=this.handleEvent(e)),t}handlePreLayoutUpdate(){}preLayoutUpdate(){this._enabled&&this.handlePreLayoutUpdate()}resolveDimensions(e,t,r,n){if(!this._enabled){this.width=0,this.height=0,this.idealWidth=0,this.idealHeight=0,this._layoutDirty=!1;return}if(e==1/0)throw new Error(b.INVALID_VALUE("minWidth",e));if(e>t&&(console.warn(b.SWAPPED_MIN_MAX_DIMS(e,t,"minWidth","maxWidth")),e=t),e<0&&(console.warn(b.NEGATIVE_DIMS(e,"minWidth")),e=0),r==1/0)throw new Error(b.INVALID_VALUE("minHeight",r));r>n&&(console.warn(b.SWAPPED_MIN_MAX_DIMS(r,n,"minHeight","maxHeight")),r=n),r<0&&(console.warn(b.NEGATIVE_DIMS(r,"minHeight")),r=0);let s=this.idealWidth,o=this.idealHeight;if(this.handleResolveDimensions(e,t,r,n),this.idealWidth<e?(this.idealWidth=e,console.error(b.BROKEN_CONSTRAINTS(this.idealWidth,e,!0,!1))):this.idealWidth>t&&(this.idealWidth=t,console.error(b.BROKEN_CONSTRAINTS(this.idealWidth,t,!0,!0))),this.idealWidth<0||!isFinite(this.idealWidth)||isNaN(this.idealWidth))throw new Error(b.INVALID_DIMS(!0,this.idealWidth));if(this.idealHeight<r?(this.idealHeight=r,console.error(b.BROKEN_CONSTRAINTS(this.idealHeight,r,!1,!1))):this.idealHeight>n&&(this.idealHeight=n,console.error(b.BROKEN_CONSTRAINTS(this.idealHeight,n,!1,!0))),this.idealHeight<0||!isFinite(this.idealHeight)||isNaN(this.idealHeight))throw new Error(b.INVALID_DIMS(!1,this.idealHeight));this._layoutDirty=!1,(s!==this.idealWidth||o!==this.idealHeight)&&(this._dirty=!0)}resolveDimensionsAsTop(e,t,r,n){this.resolveDimensions(e,t,r,n),(t===1/0||n===1/0)&&this.resolveDimensions(e,t===1/0?this.idealWidth:t,r,n===1/0?this.idealHeight:n)}resolvePosition(e,t){this.idealX=e,this.idealY=t}finalizeBounds(){let[e,t]=this.viewport.effectiveScale,r=Math.floor(this.idealX*e)/e,n=Math.floor(this.idealY*t)/t,s=Math.ceil((this.idealX+this.idealWidth)*e)/e-r,o=Math.ceil((this.idealY+this.idealHeight)*t)/t-n;(r!==this.x||n!==this.y||s!==this.width||o!==this.height)&&(this._dirty=!0),this.x=r,this.y=n,this.width=s,this.height=o}handlePostLayoutUpdate(){}postLayoutUpdate(){this._enabled&&this.handlePostLayoutUpdate()}clear(e,t,r,n,s=null){let o=this.viewport.context;o.save(),o.globalCompositeOperation="copy",o.fillStyle=s!=null?s:this.canvasFill,o.beginPath(),o.rect(e,t,r,n),o.clip(),o.fill(),o.restore()}clearStart(e=null){let t=this.viewport.context;t.save(),t.globalCompositeOperation="copy",t.fillStyle=e!=null?e:this.canvasFill,t.beginPath()}clearEnd(e="nonzero"){let t=this.viewport.context;t.clip(e),t.fill(),t.restore()}paintCircle(e,t,r){let n=this.viewport.context;n.beginPath(),n.arc(e,t,r,0,pi),n.fill()}handlePainting(e){}paint(e=!1){if(this.dimensionless)return this.dryPaint();if(!(!this._dirty&&!e)){if(this._enabled){this.needsClear&&this.clear(this.x,this.y,this.width,this.height);let t=this.viewport.context;t.save(),this.handlePainting(e),t.restore()}this._dirty=!1}}dryPaint(){this._dirty=!1}forceDirty(e=!0){this._dirty=!0,e&&(this._layoutDirty=!0)}get active(){return this._root!==null}get root(){if(!this.active)throw new Error(b.INACTIVE_WIDGET("root"));return this._root}get viewport(){if(!this.active)throw new Error(b.INACTIVE_WIDGET("viewport"));return this._viewport}get parent(){if(!this.active)throw new Error(b.INACTIVE_WIDGET("parent"));return this._parent}activate(e,t,r){if(this.active)throw new Error(b.INVALID_ACTIVATION(!0));this._root=e,this._viewport=t,this._parent=r,this.forceDirty()}deactivate(){if(!this.active)throw new Error(b.INVALID_ACTIVATION(!1));this._root=null,this._viewport=null,this._parent=null}autoScroll(){this.root.dispatchEvent(new j(this,[0,this.idealWidth,0,this.idealHeight]))}};a(y,"Widget");var _e=class extends y{constructor(e,t,r,n){super(t,r,n);this._children=[...e]}set inheritedTheme(e){super.inheritedTheme=e;for(let t of this.children)t.inheritedTheme=e}get inheritedTheme(){return super.inheritedTheme}dryPaint(){super.dryPaint();for(let e of this.children)e.dryPaint()}forceDirty(e=!0){super.forceDirty(e);for(let t of this.children)t.forceDirty(e)}get childCount(){return this._children.length}get children(){return this._children.values()}activate(e,t,r){super.activate(e,t,r);for(let n of this.children)n.activate(e,t,this)}deactivate(){super.deactivate();for(let e of this.children)e.deactivate()}finalizeBounds(){super.finalizeBounds();for(let e of this.children)e.finalizeBounds()}};a(_e,"Parent");var Ue=class extends _e{add(i){if(Array.isArray(i)){let e=this.active;for(let t of i)this._children.push(t),t.inheritedTheme=this.inheritedTheme,e&&t.activate(this.root,this.viewport,this)}else this._children.push(i),i.inheritedTheme=this.inheritedTheme,this.active&&i.activate(this.root,this.viewport,this);return this.forceDirty(),this}remove(i){if(Array.isArray(i)){let e=this.active;for(let t of i){let r=this._children.indexOf(t);r!==-1&&this._children.splice(r,1),e&&t.deactivate()}}else{let e=this._children.indexOf(i);e!==-1&&this._children.splice(e,1),this.active&&i.deactivate()}return this.forceDirty(),this}clearChildren(){if(this.active)for(let i of this._children)i.deactivate();return this._children.length=0,this.forceDirty(),this}};a(Ue,"MultiParent");var he=class extends Ue{constructor(e,t){super([],!1,!0,t);this.backgroundDirty=!0;this.unusedSpace=0;this.enabledChildCount=0;this.vertical=e}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="multiContainerAlignment"?this._layoutDirty=!0:e==="multiContainerSpacing"&&(this._layoutDirty=!0)}handleEvent(e){let t=this.children;e.reversed&&(t=Array.from(t).reverse());for(let r of t){if(!r.enabled)continue;let n=r.dispatchEvent(e);if(n!==null)return n}return null}handlePreLayoutUpdate(){for(let e of this.children)e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){for(let e of this.children)e.postLayoutUpdate(),e.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=0,o=0,h=0,d=this.vertical?n:t;this.multiContainerAlignment.cross==="stretch"&&(h=this.vertical?t:n,h==1/0&&(h=this.vertical?e:r)),this.enabledChildCount=0;for(let P of this.children){if(!P.enabled){P.resolveDimensions(0,0,0,0);continue}this.enabledChildCount++;let[I,H]=P.idealDimensions;this.vertical?P.resolveDimensions(h,t,0,1/0):P.resolveDimensions(0,1/0,h,n);let[O,Y]=P.idealDimensions;s+=P.flex,o=Math.max(this.vertical?O:Y,o),(O!==I||Y!==H)&&(this.backgroundDirty=!0)}let u=this.vertical?e:r;o<u&&(o=u);let m=this.multiContainerSpacing,f=Math.max(this.enabledChildCount-1,0)*m;for(let P of this.children)!P.enabled||(f+=this.vertical?P.idealDimensions[1]:P.idealDimensions[0]);let p=d-f;if(p==1/0||p<=0){let P=this.idealWidth,I=this.idealHeight;this.vertical?(this.idealWidth=o,this.idealHeight=Math.min(f,n)):(this.idealWidth=Math.min(f,t),this.idealHeight=o),(this.idealWidth!==P||this.idealHeight!==I)&&(this.backgroundDirty=!0),this.unusedSpace=0;let H=d;for(let O of this.children){if(!O.enabled)continue;let[Y,ye]=O.idealDimensions;if(this.vertical){let $=Math.min(H,ye);O.resolveDimensions(h,t,$,$)}else{let $=Math.min(H,Y);O.resolveDimensions($,$,h,n)}let[le,ot]=O.idealDimensions;(le!==Y||ot!==ye)&&(this.backgroundDirty=!0);let lt=this.vertical?ye:Y;H=Math.max(0,H-lt-m)}return}let g=0,_=0;s>0&&(_=p/s);for(let P of this.children){if(!P.enabled)continue;g!==0&&(g+=m);let I=_*P.flex,[H,O]=P.idealDimensions;if(this.vertical){let le=I+O;P.resolveDimensions(h,t,le,le)}else{let le=I+H;P.resolveDimensions(le,le,h,n)}let[Y,ye]=P.idealDimensions;g+=this.vertical?ye:Y,(Y!==H||ye!==O)&&(this.backgroundDirty=!0)}let v=this.idealWidth,x=this.idealHeight,T;this.vertical?(T=n,this.idealWidth=o,this.idealHeight=T):(T=t,this.idealWidth=T,this.idealHeight=o),(this.idealWidth!==v||this.idealHeight!==x)&&(this.backgroundDirty=!0),this.unusedSpace=Math.max(T-g,0)}resolvePosition(e,t){super.resolvePosition(e,t);let r=this.multiContainerAlignment,n=r.main==="around",s=r.main==="between"||n,o=s?0:r.main,h=r.cross==="stretch"?0:r.cross,d=this.enabledChildCount-1+(n?2:0),c;d<=0?c=0:c=this.unusedSpace/d;let u=this.multiContainerSpacing;s&&(u+=c);let m=(this.vertical?t:e)+o*this.unusedSpace;n&&(m+=c);for(let f of this.children){if(!f.enabled)continue;let[p,g]=f.idealPosition,[_,v]=f.idealDimensions;this.vertical?(f.resolvePosition(e+h*(this.idealWidth-_),m),m+=v+u):(f.resolvePosition(m,t+h*(this.idealHeight-v)),m+=_+u);let[x,T]=f.idealPosition;(x!==p||T!==g)&&(this.backgroundDirty=!0)}}handlePainting(e){let t=[];for(let r of this.children)r.paint(e),r.enabled&&(this.backgroundDirty||e)&&t.push(r.rect);if(this.backgroundDirty||e){this.clearStart();let r=this.viewport.context;r.rect(...this.rect);for(let n of t)r.rect(...n);this.clearEnd("evenodd")}this.backgroundDirty=!1}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(e=!0){super.forceDirty(e),this.backgroundDirty=!0}};a(he,"MultiContainer");var de=class extends _e{constructor(i,e,t,r){super([i],e,t,r)}get child(){return this._children[0]}};a(de,"SingleParent");var ce=class extends de{constructor(e,t,r){super(e,!1,t,r);this.backgroundDirty=!0}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}handleEvent(e){return this.child.dispatchEvent(e)}handlePreLayoutUpdate(){let e=this.child;e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let e=this.child;e.postLayoutUpdate(),e.dirty&&(this._dirty=!0),this.backgroundDirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.containerPadding,o=s.left+s.right,h=s.top+s.bottom,d=t-o,c=n-h;d<0&&(d=0),c<0&&(c=0);let u=this.containerAlignment,m=0;u.horizontal==="stretch"&&(d!==1/0?m=d:m=Math.max(e-o,0));let f=0;u.vertical==="stretch"&&(c!==1/0?f=c:f=Math.max(r-h,0));let[p,g]=this.child.idealDimensions;this.child.resolveDimensions(m,d,f,c);let[_,v]=this.child.idealDimensions,[x,T]=[this.idealWidth,this.idealHeight];this.idealWidth=Math.max(e,_+o),this.idealHeight=Math.max(r,v+h),(this.idealWidth!==x||this.idealHeight!==T||_!==p||v!==g)&&(this.backgroundDirty=!0)}resolvePosition(e,t){super.resolvePosition(e,t);let r=this.containerPadding,n=this.containerAlignment,[s,o]=this.child.idealDimensions,h=s+r.left+r.right,d=o+r.top+r.bottom,c=e+r.left;if(n.horizontal!=="stretch"){let p=this.idealWidth-h;p>0&&(c+=p*n.horizontal)}let u=t+r.top;if(n.vertical!=="stretch"){let p=this.idealHeight-d;p>0&&(u+=p*n.vertical)}let[m,f]=this.child.idealPosition;this.child.resolvePosition(c,u),(m!==c||f!==u)&&(this.backgroundDirty=!0)}handleBaseContainerPainting(e,t=null){if(this.backgroundDirty||e){this.clearStart(t);let r=this.viewport.context;r.rect(...this.rect),r.rect(...this.child.rect),this.clearEnd("evenodd"),this.backgroundDirty=!1}this.child.paint(e)}handlePainting(e){this.handleBaseContainerPainting(e)}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(e=!0){super.forceDirty(e),this.backgroundDirty=!0}};a(ce,"BaseContainer");var gi=(t=>(t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard",t[t.Tab=2]="Tab",t))(gi||{});var Qt=(t=>(t[t.Pixel=0]="Pixel",t[t.Line=1]="Line",t[t.Page=2]="Page",t))(Qt||{});function jt(l){switch(l){case 0:return 0;case 1:return 1;case 2:return 2;default:return null}}a(jt,"parseDOMDeltaMode");var z=class extends W{constructor(e,t,r,n,s,o,h,d,c,u,m=null){super(e,t,d,c,u,m,0);this.deltaX=r,this.deltaY=n,this.deltaZ=s,this.deltaMode=o,this.fromDrag=h}correctOffset(e,t){return new z(this.x-e,this.y-t,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(e){return new z(this.x,this.y,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,e)}getDeltaPixels(e,t,r,n,s=0){let o=1/0,h=1/0,d=1/0;if(e||this.deltaMode!==2){let c=t*z.PageLinesError;o=r-Math.min(r*z.PagePercentError,c),h=n-Math.min(n*z.PagePercentError,c),d=s-Math.min(s*z.PagePercentError,c)}switch(this.deltaMode){case 0:return[Math.min(o,Math.abs(this.deltaX))*Math.sign(this.deltaX),Math.min(h,Math.abs(this.deltaY))*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ))*Math.sign(this.deltaZ)];case 1:return[Math.min(o,Math.abs(this.deltaX)*t)*Math.sign(this.deltaX),Math.min(h,Math.abs(this.deltaY)*t)*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ)*t)*Math.sign(this.deltaZ)];case 2:{let c=t*z.PageLinesError;return[(Math.abs(this.deltaX)*r-Math.min(r*z.PagePercentError,c))*Math.sign(this.deltaX),(Math.abs(this.deltaY)*n-Math.min(n*z.PagePercentError,c))*Math.sign(this.deltaY),(Math.abs(this.deltaZ)*s-Math.min(s*z.PagePercentError,c))*Math.sign(this.deltaZ)]}default:throw new Error(b.INVALID_ENUM(this.deltaMode,"PointerWheelMode","deltaMode"))}}},L=z;a(L,"PointerWheel"),L.PageLinesError=3,L.PagePercentError=.1;var Q=class extends we{constructor(e,t,r,n,s){super(t,r,n,s,1,!0);this.key=e}};a(Q,"KeyEvent");var R=class extends Q{cloneWithTarget(i){return new R(this.key,this.shift,this.ctrl,this.alt,i)}};a(R,"KeyPress");var E=class extends U{constructor(i=null){super(i,0,!0)}cloneWithTarget(i){return new E(i)}};a(E,"Leave");var ie=class extends M{constructor(e,t){super(e,t);this.subscribers=new Set}get fallbackTheme(){return super.fallbackTheme}set fallbackTheme(e){super.fallbackTheme=e}onThemeUpdated(e=null){for(let t of this.subscribers)t(e)}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}};a(ie,"Theme");var ct=class{constructor(i,e){this.drivers=new Set;this._enabled=!0;this.pointerStyle="default";this._currentPointerStyle="default";this._foci=new Map([[1,null],[0,null],[2,null]]);this._fociCapturers=new Map([[1,null],[0,null],[2,null]]);this.textInputHandler=null;this._mobileTextInUse=!1;var t,r;this.viewport=new te(i,e==null?void 0:e.resolution,e==null?void 0:e.preventBleeding,e==null?void 0:e.canvasStartingWidth,e==null?void 0:e.canvasStartingHeight),this.pointerStyleHandler=(t=e==null?void 0:e.pointerStyleHandler)!=null?t:null,this.child.inheritedTheme=(r=e==null?void 0:e.theme)!=null?r:new ie,this.child.activate(this,this.viewport,null)}get constraints(){return this.viewport.constraints}set constraints(i){this.viewport.constraints=i}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(i){if(this._enabled!==i)if(this._enabled=i,i)for(let t of this.drivers)t.onEnable(this);else{for(let t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(let t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){return this.enabled?this.viewport.resolveLayout():!1}paint(){return this.enabled?this.viewport.paintToInternal(!1):!1}dispatchEvent(i){if(!this.enabled)return!1;if(i.focusType!==null&&i.target===null){let r=this._foci.get(i.focusType);if(typeof r=="undefined"&&(r=null),i.needsFocus&&r===null)return i instanceof R&&i.key==="Tab"&&this.dispatchEvent(new N(this.getFocus(2),i.shift)),!1;i=i.cloneWithTarget(r)}(i instanceof W&&!(i instanceof L)||i instanceof E)&&(this.pointerStyle="default");let e=this.child.dispatchEvent(i);if(e===null&&(i instanceof R&&(i.key==="Tab"?this.dispatchEvent(new N(this.getFocus(2),i.shift)):i.key==="Escape"&&this.clearFocus(1)),i instanceof N&&i.relativeTo!==null&&(i=new N(null,i.reversed),e=this.child.dispatchEvent(i))),i instanceof N&&(i.reachedRelative&&e===null&&(e=this.child.dispatchEvent(i)),e&&(!i.reachedRelative&&!ct.badTabCaptureWarned&&(ct.badTabCaptureWarned=!0,console.warn(b.OVERCAPTURING_WIDGET(e)),Ut()),this.requestFocus(2,e))),i.focusType===null)return e!==null;let t=this.getFocusCapturer(i.focusType);if(t===e)return e!==null;i.focusType===0&&t!==null&&this.child.dispatchEvent(new E(t)),this._fociCapturers.set(i.focusType,e);for(let r of this.drivers)r.onFocusCapturerChanged(this,i.focusType,t,e);return e!==null}preLayoutUpdate(){if(!!this.enabled){for(let i of this.drivers)i.update(this);this.child.preLayoutUpdate()}}postLayoutUpdate(){!this.enabled||(this.child.postLayoutUpdate(),this.updatePointerStyle())}updatePointerStyle(i=null){i!==null&&(this.pointerStyle=i),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,this.pointerStyleHandler!==null&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(i,e){if(e!==null){let t=this._foci.get(i);if(e!==t){this.clearFocus(i),this._foci.set(i,e),e.onFocusGrabbed(i);for(let n of this.drivers)n.onFocusChanged(this,i,e)}let r=null;if(i===1&&(r=2),i===2&&(r=1),r!==null&&e!==this._foci.get(r)){this.clearFocus(r),this._foci.set(r,e),e.onFocusGrabbed(r);for(let n of this.drivers)n.onFocusChanged(this,r,e)}}}dropFocus(i,e){let t=this._foci.get(i);e===t&&this.clearFocus(i)}clearFocus(i){let e=this._foci.get(i);if(e){e.onFocusDropped(i),this._foci.set(i,null);for(let t of this.drivers)t.onFocusChanged(this,i,null)}}getFocus(i){var e;return(e=this._foci.get(i))!=null?e:null}getFocusCapturer(i){var e;return(e=this._fociCapturers.get(i))!=null?e:null}registerDriver(i){this.drivers.has(i)||(this.drivers.add(i),this._enabled&&i.onEnable&&i.onEnable(this))}unregisterDriver(i){!this.drivers.delete(i)||this._enabled&&i.onDisable&&i.onDisable(this)}clearDrivers(){for(let i of this.drivers)this.unregisterDriver(i)}get hasMobileTextInput(){return this.textInputHandler!==null&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(i=""){return Bt(this,null,function*(){if(this.textInputHandler!==null&&!this._mobileTextInUse){this._mobileTextInUse=!0;let e=yield this.textInputHandler(i);return this._mobileTextInUse=!1,e}return null})}get resolution(){return this.viewport.resolution}set resolution(i){this.viewport.resolution=i}get preventBleeding(){return this.viewport.preventBleeding}set preventBleeding(i){this.viewport.preventBleeding=i}get maxCanvasWidth(){return this.viewport.maxCanvasWidth}set maxCanvasWidth(i){this.viewport.maxCanvasWidth=i}get maxCanvasHeight(){return this.viewport.maxCanvasHeight}set maxCanvasHeight(i){this.viewport.maxCanvasHeight=i}get effectiveScale(){return this.viewport.effectiveScale}get child(){return this.viewport.child}destroy(){this.enabled=!1,this.clearDrivers(),this.child.deactivate(),this.textInputHandler=null}},C=ct;a(C,"Root"),C.badTabCaptureWarned=!1;var B=new Map;function xe(l){let i=B.get(l);return i===void 0?(console.warn(`Unknown debug feature "${l}"; defaulting to not enabled`),!1):i[0]}a(xe,"isDebugFeatureEnabled");function bi(l,i){let e=B.get(l);if(e===void 0){console.warn(`Unknown debug feature "${l}"; ignored`);return}let[t,r]=e;i===void 0&&(i=!t),t!==i&&(e[0]=i,console.info(`[canvas-ui] ${i?"En":"Dis"}abled "${l}" debug feature`))}a(bi,"toggleDebugFeature");function yi(){for(let[l,i]of B)console.info(`[canvas-ui] "${l}" (${i[0]?"en":"dis"}abled): ${i[1]}`)}a(yi,"listDebugFeatures");function ut(l,i){let e=`${l.name}.${i}`,t=`watchflag.${e}`;if(B.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=`watchflag.${e}.strace`;if(B.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=new WeakMap;Object.defineProperty(l.prototype,i,{get(){return n.get(this)},set(s){if(xe(t)&&!n.get(this)&&s){let h=`[canvas-ui ${t}] ${this.constructor.name}.${i} set to true`;xe(r)?(console.groupCollapsed(h),console.trace(),console.groupEnd()):console.debug(h)}n.set(this,s)}}),B.set(t,[!1,`Show when ${e} is set to true`]),B.set(r,[!1,`Print stack trace when ${t} shows that a flag has been set`])}a(ut,"injectWatchflagFeature");function ft(l,i,e=null){let t=`${l.name}.${i}`,r=`trace.${t}`;if(B.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=[],s=new Map,o=l.prototype[i],h=0;function d(){h===0&&(xe(r)&&console.debug(`[canvas-ui ${r}] Trace:
${n.join(`
`)}`),h=0,n.length=0,s.clear())}a(d,"logMsgStack"),l.prototype[i]=function(...c){h++;let u=s.get(this);if(u===void 0){u=n.length,s.set(this,u);let f;h>1?f="  ".repeat(h-2)+"> ":f="",n.push(`${f}${this.constructor.name}`)}else n[u]+=", recall";e!==null&&(n[u]+=e.apply(this,c));let m=new Date().getTime();try{let f=o.apply(this,c);return n[u]+=` <${new Date().getTime()-m} ms>`,f}catch(f){throw n[u]+=" <exception thrown>",f}finally{h--,d()}},B.set(r,[!1,`Trace ${t} method calls`])}a(ft,"injectTraceFeature");function q(l,i){let e=`${l.name}.${i}`,t=`randomfill.${e}`;if(B.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=Object.getOwnPropertyDescriptor(l.prototype,i);Object.defineProperty(l.prototype,i,{get(){if(xe(t))return"#"+Math.floor(Math.random()*16777215).toString(16);if((r==null?void 0:r.get)!==void 0)return r.get.apply(this)},set(n){(r==null?void 0:r.set)!==void 0&&r.set.apply(this,[n])}}),B.set(t,[!1,`(EPILEPSY WARNING) Override the ${e} theme property with a new random colour every time the theme property's value is fetched. Useful for visualising widget painting`])}a(q,"injectRandomFillFeature");function k(l,i){let e=`${l.name}.${i}`,t=`stacktrace.${e}`;if(B.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=l.prototype[i];l.prototype[i]=function(...n){return xe(t)&&(console.groupCollapsed(`[canvas-ui ${t}] ${l.name}.${i} called`),console.trace(),console.groupEnd()),r.apply(this,n)},B.set(t,[!1,`Print stack trace when ${e} is called`])}a(k,"injectStackTraceFeature");function mt(l,i){let e=Math.abs(l)%1;return e<i?!0:e>1-i}a(mt,"isWhole");var Zt=!1;function hn(){if(Zt){console.warn("[canvas-ui] Already injected debug code; ignored");return}Zt=!0,ft(y,"paint",u=>u?" (forced)":""),ft(y,"resolveDimensions",(u,m,f,p)=>` (${u}, ${m}, ${f}, ${p})`),ft(y,"resolvePosition",(u,m)=>` (${u}, ${m})`),ft(y,"dispatchEvent",u=>` (${u.constructor.name})`),k(C,"resolveLayout"),k(C,"paint"),k(C,"dispatchEvent"),k(C,"preLayoutUpdate"),k(C,"postLayoutUpdate"),k(C,"updatePointerStyle"),k(C,"requestFocus"),k(C,"dropFocus"),k(C,"clearFocus"),k(C,"getFocus"),k(C,"getFocusCapturer"),k(C,"registerDriver"),k(C,"unregisterDriver"),k(C,"clearDrivers"),k(C,"getTextInput"),k(y,"onThemeUpdated"),k(y,"onFocusDropped"),k(y,"handleEvent"),k(y,"dispatchEvent"),k(y,"handlePreLayoutUpdate"),k(y,"preLayoutUpdate"),k(y,"handleResolveDimensions"),k(y,"resolveDimensions"),k(y,"resolveDimensionsAsTop"),k(y,"resolvePosition"),k(y,"handlePostLayoutUpdate"),k(y,"postLayoutUpdate"),k(y,"clear"),k(y,"clearStart"),k(y,"clearEnd"),k(y,"roundRect"),k(y,"handlePainting"),k(y,"paint"),k(y,"dryPaint"),k(y,"forceDirty"),k(y,"scaleFont"),ut(y,"_dirty"),ut(y,"_layoutDirty"),ut(ce,"backgroundDirty"),ut(he,"backgroundDirty"),q(M,"canvasFill"),q(M,"primaryFill"),q(M,"accentFill"),q(M,"backgroundFill"),q(M,"backgroundGlowFill"),q(M,"bodyTextFill"),q(M,"inputBackgroundFill"),q(M,"inputSelectBackgroundFill"),q(M,"inputTextFill"),q(M,"inputTextFillDisabled"),q(M,"inputTextFillInvalid"),B.set("textrendergroups",[!1,"Draw text render groups in a TextHelper with alternating background colours (green and red). Width overriding groups have a blue background and zero-width groups have a black background. Throws an exception on negative width groups"]);let l=new Map,i=D.prototype.paint;D.prototype.paint=function(u,m,f,p){l.set(this,!1),i.apply(this,[u,m,f,p])};let e=D.prototype.paintGroup;D.prototype.paintGroup=function(u,m,f,p,g){if(xe("textrendergroups")){let _=u.fillStyle,v=this.actualLineHeight,x=this.fullLineHeight;if(!m[3]&&m[2]>f){let T=l.get(this);u.fillStyle=T?"rgba(255, 0, 0, 0.5)":"rgba(0, 255, 0, 0.5)",u.fillRect(p,g-v,m[2]-f,x),l.set(this,!T),u.fillStyle=_}else{let T=m[2]-f;if(u.fillStyle=T>0?"rgba(0, 0, 255, 0.5)":"rgba(0, 0, 0, 0.5)",T==0)T=4;else if(T<0)throw new Error(S.NEGATIVE_TEXT_GROUP);u.fillRect(p,g-v,T,x)}}e.apply(this,[u,m,f,p,g])},B.set("warnsubpixels",[!1,"Print a console warning whenever a Widget is detected to have non-integer width, height, x or y. Only warned once per Widget type"]);let t=new Set,r=new Set,n=new Set,s=new Set,o='[canvas-ui warnsubpixels] Widget type "',h='" has a non-integer ',d=", which will create clipping issues due to subpixels. This message won't be shown again for this widget type",c=y.prototype.finalizeBounds;y.prototype.finalizeBounds=function(){c.apply(this);let u=this.constructor.name;if(xe("warnsubpixels")){let[m,f]=this.root.effectiveScale,[p,g]=this.position;!mt(p*m,1e-10)&&!t.has(u)&&(t.add(u),console.warn(`${o}${u}${h}X coordinate (${p})${d}`)),!mt(g*f,1e-10)&&!r.has(u)&&(r.add(u),console.warn(`${o}${u}${h}Y coordinate (${g})${d}`));let[_,v]=this.dimensions;!mt(_*m,1e-10)&&!n.has(u)&&(n.add(u),console.warn(`${o}${u}${h}width (${_})${d}`)),!mt(v*f,1e-10)&&!s.has(u)&&(s.add(u),console.warn(`${o}${u}${h}height (${v})${d}`))}},window.canvasDebug={enabled:xe,toggle:bi,list:yi},console.info("[canvas-ui] Injected debug code; the library will be slower"),console.info("[canvas-ui] Check if a debug feature is enabled in the console with canvasDebug.enabled(debugFeature: string)"),console.info("[canvas-ui] Enable a debug feature in the console with canvasDebug.toggle(debugFeature: string, enabled?: boolean)"),console.info("[canvas-ui] List debug features in the console with canvasDebug.list()")}a(hn,"injectDebugCode");function cn(l){return new Promise((i,e)=>{function t(){document.body.removeChild(s)}a(t,"closePopup");function r(){t(),i(l)}a(r,"cancelHandler");function n(){t(),i(d.value)}a(n,"okHandler");let s=document.createElement("div");s.id="textInputHandlerOverlay";let o=document.createElement("div");o.id="textInputHandler";let h=document.createElement("p");h.textContent="Change text:";let d=document.createElement("textarea");d.value=l;let c=document.createElement("div"),u=document.createElement("button");u.addEventListener("click",r),u.textContent="Cancel";let m=document.createElement("button");m.addEventListener("click",n),m.textContent="OK",c.appendChild(u),c.appendChild(m),o.appendChild(h),o.appendChild(d),o.appendChild(c),s.appendChild(o),document.body.appendChild(s),d.focus({preventScroll:!1})})}a(cn,"DefaultTextInputHandler");var ue=class extends U{constructor(e,t=null){super(t,1,!1);this.text=e}cloneWithTarget(e){return new ue(this.text,e)}};a(ue,"TextPasteEvent");var Xe=class extends C{constructor(e,t){super(e,t);this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,this.updateDOMDims();let r=this.domElem.getContext("2d",{alpha:!0});if(r===null)throw new Error(S.REUSABLE_CANVAS_CONTEXT);this.domCanvasContext=r,this.pointerStyleHandler===null&&(this.pointerStyleHandler=n=>{this.domElem.style.cursor=n}),this.domElem.addEventListener("paste",n=>{n.preventDefault(),n.clipboardData!==null&&this.dispatchEvent(new ue(n.clipboardData.getData("text")))}),this.domElem.contentEditable="true",this.domElem.style.outline="0px solid transparent",this.domElem.style.caretColor="transparent",this.domElem.style.cursor="default"}update(){if(this.enabled)this.domElem.style.removeProperty("display");else{this.domElem.style.display="none";return}this.preLayoutUpdate(),this.resolveLayout()&&(this.updateDOMDims(),this.autoScale()),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))}updateDOMDims(){let[e,t]=this.effectiveScale,[r,n]=this.dimensions;this.domElem.width=Math.round(r*e),this.domElem.height=Math.round(n*t)}autoScale(){let[e,t]=this.effectiveScale;this.domElem.style.width=(this.domElem.width/e).toString()+"px",this.domElem.style.height=(this.domElem.height/t).toString()+"px"}};a(Xe,"DOMRoot");var ke=class extends de{constructor(i,e){super(i,!1,!0,e)}handleEvent(i){return this.child.dispatchEvent(i)}handlePreLayoutUpdate(){let i=this.child;i.preLayoutUpdate(),i.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let i=this.child;i.postLayoutUpdate(),i.dirty&&(this._dirty=!0)}handleResolveDimensions(i,e,t,r){let n=this.child;n.resolveDimensions(i,e,t,r),[this.idealWidth,this.idealHeight]=n.idealDimensions}resolvePosition(i,e){super.resolvePosition(i,e),this.child.resolvePosition(i,e)}handlePainting(i){this.child.paint(i)}};a(ke,"PassthroughWidget");var Re=class extends ke{constructor(e,t,r){super(e,r);this.constraints=[...t]}handleResolveDimensions(e,t,r,n){let s=Math.min(Math.max(this.constraints[0],e),t),o=Math.min(Math.max(this.constraints[2],r),n),h=Math.min(Math.max(this.constraints[1],e),t),d=Math.min(Math.max(this.constraints[3],r),n);s>h&&(s=h),o>d&&(o=d),super.handleResolveDimensions(s,h,o,d)}};a(Re,"ArtificialConstraint"),w([Yt()],Re.prototype,"constraints",2);var re=class extends y{constructor(e="",t){var r;super(!0,!1,t);this.wrapText=!0;this.textHelper=new D,this.textHelper.wrapMode=1,this.text=e,this.wrapText=(r=t==null?void 0:t.wrapText)!=null?r:!0}set text(e){this.textHelper.text=e}get text(){return this.textHelper.text}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="labelMinWidth"||e==="labelMinAscent"||e==="labelMinDescent"?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFill"&&(this._dirty=!0)}handlePreLayoutUpdate(){this.textHelper.font=this.bodyTextFont,this.textHelper.lineHeight=this.bodyTextHeight,this.textHelper.lineSpacing=this.bodyTextSpacing,this.textHelper.alignMode=this.bodyTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,r,n){this.textHelper.maxWidth=this.wrapText?t:1/0,this.textHelper.dirty&&(this._dirty=!0),this.idealWidth=Math.max(Math.min(this.textHelper.width,t),e),this.idealHeight=Math.max(Math.min(this.textHelper.height,n),r)}handlePainting(e){let t=this.viewport.context;this.wrapText||(t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip()),this.textHelper.paint(t,this.bodyTextFill,this.idealX,this.idealY),this.wrapText||t.restore()}};a(re,"Label"),w([ee],re.prototype,"wrapText",2);var vi=(t=>(t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold",t))(vi||{});var Ke=class{constructor(i){this.clickHelpers=i}get lastClickState(){let i=0;for(let e of this.clickHelpers)e.lastClickState>i&&(i=e.lastClickState);return i}get clickState(){let i=0;for(let e of this.clickHelpers)e.clickState>i&&(i=e.clickState);return i}get clickStateChanged(){for(let i of this.clickHelpers)if(i.clickStateChanged)return!0;return!1}get wasClick(){for(let i of this.clickHelpers)if(i.wasClick&&i.clickStateChanged)return!0;return!1}};a(Ke,"CompoundClickHelper");var Pe=class{constructor(i){this.lastClickState=0;this.clickState=0;this.clickStateChanged=!1;this.wasClick=!1;this.widget=i}setClickState(i,e){this.clickState!==i?(this.lastClickState=this.clickState,this.clickState=i,this.wasClick=e&&this.lastClickState===2,this.clickStateChanged=!0):this.clickStateChanged=!1}};a(Pe,"GenericClickHelper");var fe=class extends Q{cloneWithTarget(i){return new fe(this.key,this.shift,this.ctrl,this.alt,i)}};a(fe,"KeyRelease");var We=class extends W{constructor(e,t,r,n,s,o,h=null,d=null){super(e,t,n,s,o,h,d);this.button=r}get isLeft(){return this.button===0}get isPrimary(){return this.isLeft}get isRight(){return this.button===1}get isSecondary(){return this.isRight}get isMiddle(){return this.button===2}get isTertiary(){return this.isMiddle}};a(We,"PointerButtonEvent");var X=class extends We{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o,0)}correctOffset(i,e){return new X(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new X(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(X,"PointerRelease");var V=class extends We{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o)}correctOffset(i,e){return new V(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new V(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(V,"PointerPress");var ne=class extends Pe{constructor(){super(...arguments);this.pointerPos=null;this.startingPointerPos=null;this.pointerButton=0}getNormalInRect(e,t,r,n,s,o){return[(e-r)/(n-r),(t-s)/(o-s)]}isPointInRect(e,t,r,n,s,o){return e>=r&&e<n&&t>=s&&t<o}isNormalInRect(e,t){return e>=0&&e<1&&t>=0&&t<1}handleClickEvent(e,t,r){if(e instanceof E)return t.dropFocus(0,this.widget),this.pointerPos=null,this.setClickState(0,!1);if(e instanceof W){this.pointerPos=this.getNormalInRect(e.x,e.y,...r);let n=this.isNormalInRect(...this.pointerPos);if(n)t.pointerStyle="pointer";else if(e.target===null)return t.dropFocus(0,this.widget),this.setClickState(0,!1);return e instanceof V&&e.button===this.pointerButton?(this.startingPointerPos=this.pointerPos,t.requestFocus(0,this.widget),this.setClickState(2,n)):e instanceof X&&e.button===this.pointerButton?(t.dropFocus(0,this.widget),n?this.setClickState(1,n):this.setClickState(0,n)):e.target===null?this.setClickState(1,n):this.setClickState(2,n)}else this.clickStateChanged=!1}};a(ne,"ClickHelper");var me=class extends Ke{constructor(e){let t=new ne(e),r=new Pe(e);super([t,r]);this.pointerClickHelper=t,this.keyboardClickHelper=r,this.widget=e}onFocusGrabbed(e){return e===1?(this.keyboardClickHelper.setClickState(1,!0),this.widget.autoScroll(),!0):!1}onFocusDropped(e){return e===1?(this.keyboardClickHelper.setClickState(0,!1),!0):!1}handleEvent(e,t,r,n){if(e instanceof L)return[!1,!1];if(e instanceof Q){if(e.key!=="Enter")return[!1,!1]}else if(!(e instanceof W||e instanceof E))return[!1,!1];return r?(e instanceof R?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(2,!0),this.widget.autoScroll()):e instanceof fe?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(1,!0)):(this.keyboardClickHelper.clickStateChanged=!1,this.pointerClickHelper.handleClickEvent(e,t,n)),[this.clickStateChanged&&this.wasClick,!0]):(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.clickStateChanged=!1,[!1,!0])}};a(me,"ButtonClickHelper");var Ce=class extends ce{constructor(e,t,r){super(e,!1,r);this.clickHelper=new me(this),this.callback=t,this.tabFocusable=!0}click(){if(this.callback!==null)try{this.callback()}catch(e){console.error("Exception in Icon callback:",e)}}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)}handleEvent(e){let[t,r]=this.clickHelper.handleEvent(e,this.root,this.callback!==null,this.bounds);return t&&this.click(),r?this:null}};a(Ce,"Button");var Se=class extends Ce{constructor(e,t=null,r){var n;super(e,t,r);this.backgroundProperty="backgroundFill";this.forced=(n=r==null?void 0:r.forced)!=null?n:!1,this.childTheme=new ie({canvasFill:this.getBackgroundFill()}),this.child.inheritedTheme=this.childTheme}updateBackground(){let e=this.backgroundProperty;if(this.forced)this.backgroundProperty="primaryFill";else switch(this.clickHelper.clickState){case 2:this.backgroundProperty="accentFill";break;case 1:this.backgroundProperty="backgroundGlowFill";break;default:this.backgroundProperty="backgroundFill";break}e!==this.backgroundProperty&&(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill())}getBackgroundFill(){switch(this.backgroundProperty){case"primaryFill":return this.primaryFill;case"accentFill":return this.accentFill;case"backgroundGlowFill":return this.backgroundGlowFill;case"backgroundFill":return this.backgroundFill;default:throw new Error(b.INVALID_BACKGROUND_FILL(this.backgroundProperty))}}set inheritedTheme(e){e!==this.fallbackTheme&&(this.fallbackTheme=e,this.childTheme.fallbackTheme=e)}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){e===null?(this._layoutDirty=!0,this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e===this.backgroundProperty?(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}onFocusGrabbed(e){super.onFocusGrabbed(e),e===1&&this.updateBackground()}onFocusDropped(e){super.onFocusDropped(e),e===1&&this.updateBackground()}handleEvent(e){let t=super.handleEvent(e);return this.clickHelper.clickStateChanged&&this.updateBackground(),t}handlePainting(e){this.handleBaseContainerPainting(e,this.getBackgroundFill())}};a(Se,"FilledButton"),w([at(Se.prototype.updateBackground)],Se.prototype,"forced",2);var Ye=class extends Se{constructor(i,e=null,t){t=A({containerAlignment:{horizontal:.5,vertical:"stretch"},bodyTextAlign:.5,wrapText:!1},t),super(new re(i,t),e,t)}};a(Ye,"TextButton");var K=class extends Re{constructor(i,e,t=24,r=24,n){super(new Ye(i,e,n),[t,1/0,r,1/0],n)}};a(K,"VirtualKey");var $e=class extends K{constructor(e,t,r,n=24,s=24,o){super("",()=>r.callback(this.currentGlyph),n,s,o);this.glyph=e,this.altGlyph=t===null?e:t,this.keyContext=r,this.child.child.text=this.currentGlyph}handlePreLayoutUpdate(){this.child.child.text=this.currentGlyph,super.handlePreLayoutUpdate()}get currentGlyph(){return this.keyContext.shift?this.altGlyph:this.glyph}};a($e,"GlyphVirtualKey");var pe=class extends he{constructor(i){super(!1,i)}};a(pe,"Row");var Ge=class extends pe{constructor(i,e,t=24,r=24,n){super(n);for(let s of i)if(typeof s=="function"){let o=s;this.add(o(e,n))}else if(typeof s[0]=="string"&&typeof s[1]=="string"){let o=s[0],h=s[1];for(let d=0;d<o.length;d++){let c=null;d<h.length&&(c=h[d]),this.add(new $e(o[d],c,e,t,r,n))}}else throw new Error(b.INVALID_KB_ROW_TEMPLATE(s))}};a(Ge,"VirtualKeyRow");var J=class extends K{constructor(i,e,t,r=24,n=24,s){super(i,()=>t.callback(e),r,n,s)}};a(J,"BasicVirtualKey");var ze=class extends J{constructor(i,e=60,t=24,r){super("Backspace","Backspace",i,e,t,r)}};a(ze,"BackspaceKey");var Qe=class extends J{constructor(i,e=24,t=24,r){super("Esc","Escape",i,e,t,r)}};a(Qe,"EscapeKey");var je=class extends J{constructor(i,e=72,t=24,r){super("Enter","Enter",i,e,t,r)}};a(je,"EnterKey");var Ze=class extends K{constructor(i,e=84,t=24,r){super("Shift",()=>{i.shift=!i.shift,this.child.forced=i.shift,i.callback("Shift")},e,t,r),this.child.forced=i.shift}};a(Ze,"ShiftKey");var qe=class extends J{constructor(i,e=84,t=24,r){r=A({flex:1},r),super("Space"," ",i,e,t,r)}};a(qe,"SpaceKey");var Je=class extends he{constructor(i){super(!0,i)}};a(Je,"Column");function xi(l,i){return new je(l,void 0,void 0,i)}a(xi,"EnterKeyTemplate");function Ti(l,i){return new Ze(l,void 0,void 0,i)}a(Ti,"ShiftKeyTemplate");function wi(l,i){return new ze(l,void 0,void 0,i)}a(wi,"BackspaceKeyTemplate");function _i(l,i){return new qe(l,void 0,void 0,i)}a(_i,"SpaceKeyTemplate");function ki(l,i){return new Qe(l,void 0,void 0,i)}a(ki,"EscapeKeyTemplate");var et=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],xi],[Ti,["zxcvbnm,./","ZXCVBNM<>?"]],[wi,_i,ki]],De=class extends Je{constructor(i,e=et,t=24,r=24,n){n=A({multiContainerAlignment:{main:"between",cross:"stretch"}},n),super(n);let s={callback:o=>{i.keyPress(o,s.shift,s.ctrl,s.alt)},shift:!1,ctrl:!1,alt:!1};for(let o of e)this.add(new Ge(o,s,t,r,n))}};a(De,"VirtualKeyboard");var ge=class extends ce{constructor(i,e){super(i,!0,e)}};a(ge,"Container");var Ee=class extends ge{constructor(i,e){e=A({containerAlignment:{horizontal:.5,vertical:.5}},e),super(i,e)}};a(Ee,"Margin");var Tt=class extends Xe{constructor(e,t){var r;super(new Ee(new De(e,(r=t==null?void 0:t.keyboardTemplate)!=null?r:et)),t);this.keyboardDriver=e}update(){this.enabled=this.keyboardDriver.needsInput,super.update()}};a(Tt,"DOMVirtualKeyboardRoot");var wt=class extends C{constructor(e,t){var r;super(new Ee(new De(e,(r=t==null?void 0:t.keyboardTemplate)!=null?r:et)),t);this.keyboardDriver=e}updateVisibility(){this.enabled=this.keyboardDriver.needsInput}};a(wt,"VirtualKeyboardRoot");var tt=class{constructor(){this.eventQueues=new Map;this.keysDown=new Set;this.focus=null;this.lastActivity=null}getEventQueue(i){if(i===null)return null;let e=this.eventQueues.get(i);return typeof e=="undefined"?null:e}changeFocusedRoot(i){this.focus!==i&&(this.focus!==null&&this.focus.clearFocus(1),this.focus=i,this.keysDown.clear())}getFocusedRoot(){return this.focus}getEffectiveFocusedRoot(){return this.focus?this.focus:this.lastActivity?this.lastActivity:this.eventQueues.size>0?this.eventQueues.keys().next().value:null}clearFocus(){this.changeFocusedRoot(null)}keyDown(i,e,t,r){this.keysDown.add(i);let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new R(i,e,t,r,null))}keyUp(i,e,t,r){if(this.keysDown.delete(i)){let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new fe(i,e,t,r,null))}}keyPress(i,e,t,r){let n=this.isKeyDown(i);this.keyDown(i,e,t,r),n||this.keyUp(i,e,t,r)}isKeyDown(i){return this.keysDown.has(i)}onEnable(i){this.eventQueues.has(i)||this.eventQueues.set(i,[])}onDisable(i){this.eventQueues.has(i)&&(this.eventQueues.delete(i),i===this.focus&&this.clearFocus())}update(i){let e=this.getEventQueue(i);if(e!==null){for(let t of e)i.dispatchEvent(t);e.length=0}}onFocusChanged(i,e,t){t!==null&&(this.lastActivity=i),e===1&&i!==this.focus&&t!==null&&this.changeFocusedRoot(i)}onFocusCapturerChanged(i,e,t,r){}get needsInput(){return this.focus!==null&&this.focus.getFocus(1)!==null}};a(tt,"KeyboardDriver");var Pi=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp","Tab"," "]),Wi=new Set(["a","A"]),Ci=new Set(["Tab"]);function qt(l){return[l.key,l.shiftKey,l.ctrlKey,l.altKey]}a(qt,"unpackKeyboardEvent");var _t=class extends tt{constructor(){super(...arguments);this.domElems=new Map}maybePreventDefault(e){var t,r;(Pi.has(e.key)||Wi.has(e.key)&&e.ctrlKey)&&(Ci.has(e.key)||((r=(t=this.getFocusedRoot())==null?void 0:t.getFocus(1))!=null?r:null)!==null)&&e.preventDefault()}bindDOMElem(e,t=!0){let r=this.domElems.get(e);r!==void 0?(console.warn(S.DOM_DRIVER_REBIND),this.removeListeners(e,r)):(r={blurListen:null,keydownListen:null,keyupListen:null},this.domElems.set(e,r)),this.addListeners(e,r,t)}unbindDOMElem(e){let t=this.domElems.get(e);t!==void 0&&(this.removeListeners(e,t),this.domElems.delete(e))}addListeners(e,t,r=!0){t.blurListen=n=>{this.shouldClearFocus(n.relatedTarget)&&this.clearFocus()},e.addEventListener("blur",t.blurListen),r&&(t.keydownListen=n=>{this.maybePreventDefault(n),this.keyDown(...qt(n))},t.keyupListen=n=>{this.maybePreventDefault(n),this.keyUp(...qt(n))},e.addEventListener("keydown",t.keydownListen),e.addEventListener("keyup",t.keyupListen))}removeListeners(e,t){t.blurListen&&(e.removeEventListener("blur",t.blurListen),t.blurListen=null),t.keydownListen&&(e.removeEventListener("keydown",t.keydownListen),t.keydownListen=null),t.keyupListen&&(e.removeEventListener("keyup",t.keyupListen),t.keyupListen=null)}shouldClearFocus(e){return e===null||!this.domElems.has(e)}};a(_t,"DOMKeyboardDriver");function kt(l,i){let e=i.getBoundingClientRect();return[(l.clientX-e.left)/e.width,(l.clientY-e.top)/e.height]}a(kt,"getPointerEventNormPos");var se=class extends W{constructor(i,e,t,r,n,s=null){super(i,e,t,r,n,s,0)}correctOffset(i,e){return new se(this.x-i,this.y-e,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new se(this.x,this.y,this.shift,this.ctrl,this.alt,i)}};a(se,"PointerMove");var Si=(t=>(t[t.None=0]="None",t[t.Hovering=1]="Hovering",t[t.Pressing=2]="Pressing",t))(Si||{});var Fe=class{constructor(){this.states=new Map;this.nextPointerID=0;this.hints=new Map;this.dragToScroll=new Map}unassignPointer(i,e){e.pointer!==null&&this.setPointerHint(e.pointer,0),e.pointer=null,e.hovering&&e.eventQueue.push(new E(i.getFocusCapturer(0))),e.hovering=!1,e.pressing=0,e.dragLast=null}registerPointer(i=!1){let e=this.nextPointerID++;return this.setPointerHint(e,0),this.dragToScroll.set(e,i),e}unregisterPointer(i){for(let[e,t]of this.states)t.pointer===i&&this.unassignPointer(e,t);this.hints.delete(i),this.dragToScroll.delete(i)}canQueueEvent(i,e,t,r){let n=t.pointer===null;n&&(t.pointer=e);let s=t.pointer===e;if(!s||n)for(let[o,h]of this.states)o!==i&&h.pointer===e&&this.unassignPointer(o,h);return!s&&(!r||t.pressing>0)?!1:(r&&t.pointer!==e&&(this.unassignPointer(i,t),t.pointer=e),!0)}denormaliseCoords(i,e,t){let[r,n]=i.dimensions;return[e*r,t*n]}movePointer(i,e,t,r,n,s,o,h){let d=this.states.get(i);if(typeof d=="undefined"||(n===null&&(n=d.pressing),!this.canQueueEvent(i,e,d,n>0)))return;d.hovering=!0;let[c,u]=this.denormaliseCoords(i,t,r);if(n!==d.pressing){let m=Math.floor(Math.log2(Math.max(n,d.pressing)));for(let f=0;f<=m;f++){let p=(d.pressing>>f&1)===1,g=(n>>f&1)===1;p!==g&&(g?d.eventQueue.push(new V(c,u,f,s,o,h)):d.eventQueue.push(new X(c,u,f,s,o,h)))}d.pressing=n}else d.eventQueue.push(new se(c,u,s,o,h));d.pressing>0?this.setPointerHint(e,2):this.setPointerHint(e,1)}leavePointer(i,e){let t=this.states.get(i);typeof t!="undefined"&&t.hovering&&t.pointer==e&&(t.hovering=!1,t.pressing=0,t.dragLast=null,t.eventQueue.push(new E(i.getFocusCapturer(0))),this.setPointerHint(e,0))}leaveAnyPointer(i){for(let e of this.states.keys())this.leavePointer(e,i)}wheelPointer(i,e,t,r,n,s,o,h,d,c,u){let m=this.states.get(i);if(typeof m=="undefined"||!this.canQueueEvent(i,e,m,!0))return;m.hovering=!0;let[f,p]=this.denormaliseCoords(i,t,r);m.eventQueue.push(new L(f,p,n,s,o,h,!1,d,c,u))}setPointerHint(i,e){return this.hints.get(i)!==e?(this.hints.set(i,e),!0):!1}getPointerHint(i){var e;return(e=this.hints.get(i))!=null?e:0}onEnable(i){this.states.set(i,{eventQueue:[],pointer:null,pressing:0,hovering:!1,dragLast:null,dragOrigin:[0,0]})}onDisable(i){i.dispatchEvent(new E);let e=this.states.get(i);typeof e!="undefined"&&e.pointer!==null&&(this.setPointerHint(e.pointer,0),e.dragLast=null),this.states.delete(i)}update(i){let e=this.states.get(i);if(typeof e=="undefined")return;let t=e.pointer===null?!1:this.dragToScroll.get(e.pointer);for(let r of e.eventQueue){if(r instanceof W&&e.dragLast!==null){let[n,s]=e.dragLast;i.dispatchEvent(new L(...e.dragOrigin,n-r.x,s-r.y,0,0,!1,!1,!1,!0)),r instanceof X?e.dragLast=null:(e.dragLast[0]=r.x,e.dragLast[1]=r.y);continue}i.dispatchEvent(r)?e.dragLast=null:t&&r instanceof V&&(e.dragLast=[r.x,r.y],e.dragOrigin[0]=r.x,e.dragOrigin[1]=r.y)}e.eventQueue.length=0}onFocusChanged(i,e,t){}onFocusCapturerChanged(i,e,t,r){}};a(Fe,"PointerDriver");function Jt(l){return[l.shiftKey,l.ctrlKey,l.altKey]}a(Jt,"unpackModifiers");var Pt=class extends Fe{constructor(){super();this.domElems=new WeakMap;this.pointers=new Map;this.mousePointerID=this.registerPointer(!1)}bindDOMElem(e,t){let r=this.domElems.get(e);r!==void 0?(console.warn(S.DOM_DRIVER_REBIND),this.removeListeners(r)):(r={domElem:t,pointerListen:null,pointerleaveListen:null,wheelListen:null,contextMenuListen:null},this.domElems.set(e,r),t.style.touchAction="none"),e.enabled&&this.addListeners(e,r)}unbindDOMElem(e){let t=this.domElems.get(e);t!==void 0&&(this.removeListeners(t),this.domElems.delete(e))}getPointerID(e){let t=this.pointers.get(e.pointerId);return t===void 0&&(e.pointerType==="mouse"?t=this.mousePointerID:t=this.registerPointer(!0),this.pointers.set(e.pointerId,t)),t}addListeners(e,t){let r=t.domElem;t.pointerListen===null&&(t.pointerListen=n=>{this.movePointer(e,this.getPointerID(n),...kt(n,r),n.buttons,...Jt(n))},r.addEventListener("pointermove",t.pointerListen),r.addEventListener("pointerdown",t.pointerListen),r.addEventListener("pointerup",t.pointerListen)),t.pointerleaveListen===null&&(t.pointerleaveListen=n=>{this.leavePointer(e,this.getPointerID(n))},r.addEventListener("pointerleave",t.pointerleaveListen)),t.wheelListen===null&&(t.wheelListen=n=>{let s=jt(n.deltaMode);s!==null&&(this.wheelPointer(e,this.mousePointerID,...kt(n,r),n.deltaX,n.deltaY,n.deltaZ,s,...Jt(n)),n.preventDefault())},r.addEventListener("wheel",t.wheelListen,{passive:!1})),t.contextMenuListen===null&&(t.contextMenuListen=n=>{n.preventDefault()},r.addEventListener("contextmenu",t.contextMenuListen))}removeListeners(e){e.pointerListen!==null&&(e.domElem.removeEventListener("pointermove",e.pointerListen),e.domElem.removeEventListener("pointerdown",e.pointerListen),e.domElem.removeEventListener("pointerup",e.pointerListen),e.pointerListen=null),e.pointerleaveListen!==null&&(e.domElem.removeEventListener("pointerleave",e.pointerleaveListen),e.pointerleaveListen=null),e.wheelListen!==null&&(e.domElem.removeEventListener("wheel",e.wheelListen),e.wheelListen=null),e.contextMenuListen!==null&&(e.domElem.removeEventListener("contextmenu",e.contextMenuListen),e.contextMenuListen=null)}onEnable(e){super.onEnable(e);let t=this.domElems.get(e);t!==void 0&&this.addListeners(e,t)}onDisable(e){super.onDisable(e);let t=this.domElems.get(e);t!==void 0&&this.removeListeners(t)}};a(Pt,"DOMPointerDriver");var Wt=class extends Fe{constructor(){super(...arguments);this.sources=new Set}handlePointerRay(e,t,r,n,s,o,h){let[d,c,u]=this.castRay(r,n);d===null?this.leaveAnyPointer(e):this.movePointer(d,e,c,u,t,s,o,h)}addSource(e){this.sources.has(e)||(e.setRayPointerDriver(this),this.sources.add(e))}setPointerHint(e,t){let r=super.setPointerHint(e,t);for(let n of this.sources)n.onPointerHintChanged(e,t);return r}};a(Wt,"RayPointerDriver");var be=class{constructor(i,e,t=!0){this.callbacks=new Set;this._value=i,e&&this.watch(e,t)}get value(){return this._value}set value(i){this.setValue(i)}hasCallback(i){return this.callbacks.has(i)}watch(i,e=!0){return this.hasCallback(i)?!1:(this.callbacks.add(i),e&&this.doCallback(i),!0)}unwatch(i){return this.callbacks.delete(i)}setValue(i,e=!0){if(this._value===i)return!1;if(this._value=i,e)for(let t of this.callbacks)this.doCallback(t);return!0}doCallback(i){try{i(this._value,this)}catch(e){console.error("Exception in Variable callback:",e)}}};a(be,"Variable");var it=class extends be{constructor(e,t=null,r,n=!0){super(e,r,!1);this._valid=!0;this.validator=t,this.validate(e),r&&n&&this.doCallback(r)}get valid(){return this._valid}get validValue(){return this._validValue}setValue(e,t=!0){return this.value===e?!1:(this.validate(e),super.setValue(e,t))}validate(e){if(this.validator){let[t,r]=this.validator(e);this._valid=t,t&&(this._validValue=r)}}};a(it,"ValidatedVariable");var Ct=class extends ie{constructor(i=new ie){super(void 0,i)}get canvasFill(){return"#"+Math.floor(Math.random()*16777215).toString(16)}set canvasFill(i){super.canvasFill=i}};a(Ct,"DebugTheme");var St=class extends K{constructor(i,e=42,t=24,r){super("Alt",()=>{i.alt=!i.alt,this.child.forced=i.alt,i.callback("Alt")},e,t,r),this.child.forced=i.alt}};a(St,"AltKey");var Dt=class extends K{constructor(i,e=42,t=24,r){super("Ctrl",()=>{i.ctrl=!i.ctrl,this.child.forced=i.ctrl,i.callback("Control")},e,t,r),this.child.forced=i.ctrl}};a(Dt,"ControlKey");var Di=(t=>(t[t.None=0]="None",t[t.Bi=1]="Bi",t[t.Uni=2]="Uni",t))(Di||{});var Et=class extends ge{constructor(i,e){e=A({containerAlignment:{horizontal:.5,vertical:.5},containerPadding:{left:0,right:0,top:0,bottom:0}},e),super(i,e)}};a(Et,"Center");var rt=class extends y{constructor(e=new be(!1),t){super(!0,!1,t);this.offsetX=0;this.offsetY=0;this.actualLength=0;this.tabFocusable=!0,this.variable=e,this.callback=this.handleChange.bind(this),this.clickHelper=new me(this)}handleChange(){this._dirty=!0}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="checkboxLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="checkboxInnerPadding")&&(this._dirty=!0)}set checked(e){this.variable.value=e}get checked(){return this.variable.value}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(e,this.root,!0,[t,t+this.actualLength,r,r+this.actualLength]);return n&&(this.checked=!this.checked),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(e,t,r,n){let s=Math.min(this.checkboxLength,t,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<e&&(this.idealWidth=e),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.checkboxLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){let t=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;t?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.offsetX+this.x,s=this.offsetY+this.y;if(r.fillRect(n,s,this.actualLength,this.actualLength),this.checked){t?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let o=this.checkboxInnerPadding,h=this.actualLength-o*2;h<=0?r.fillRect(n,s,this.actualLength,this.actualLength):r.fillRect(n+o,s+o,h,h)}}};a(rt,"Checkbox");var Ei=/^.*\.(webm|og[gv]|m(p4|4v|ov)|avi|qt)$/i,Fi=(t=>(t[t.Contain=0]="Contain",t[t.Cover=1]="Cover",t[t.Fill=2]="Fill",t))(Fi||{}),oe=class extends y{constructor(e,t){var r,n,s,o,h;super(!0,!1,t);this.lastSrc=null;this.rotation=0;this.imageWidth=null;this.imageHeight=null;this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.loadedmetadataListener=null;this.canplayListener=null;this.frameCallback=null;if(typeof e=="string")if(Ei.test(e)){let d=document.createElement("video");d.src=e,d.preload="auto",e=d}else{let d=document.createElement("img");d.src=e,e=d}this._image=e,this.rotation=(r=t==null?void 0:t.rotation)!=null?r:0,this.viewBox=(n=t==null?void 0:t.viewBox)!=null?n:null,this.imageWidth=(s=t==null?void 0:t.width)!=null?s:null,this.imageHeight=(o=t==null?void 0:t.height)!=null?o:null,this.fit=(h=t==null?void 0:t.fit)!=null?h:0,this.setupVideoEvents()}setupVideoEvents(){if(this.image instanceof HTMLVideoElement&&(this.loadedmetadataListener=e=>this._layoutDirty=!0,this.image.addEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener=e=>this._dirty=!0,this.image.addEventListener("canplay",this.canplayListener),"requestVideoFrameCallback"in this.image)){console.warn(S.VIDEO_API_AVAILABLE);let e=this.image;this.frameCallback=(t,r)=>{this._dirty=!0,this.image===e&&this.frameCallback!==null&&this.image.requestVideoFrameCallback(this.frameCallback)},this.image.requestVideoFrameCallback(this.frameCallback)}}set image(e){e!==this._image&&(this._image instanceof HTMLVideoElement&&(this.loadedmetadataListener!==null&&this._image.removeEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener!==null&&this._image.removeEventListener("canplay",this.canplayListener)),this._image=e,this.lastSrc=null,this.loadedmetadataListener=null,this.canplayListener=null,this.frameCallback=null,this.setupVideoEvents())}get image(){return this._image}handlePreLayoutUpdate(){var e,t;this._image instanceof HTMLVideoElement?!this._image.paused&&this.frameCallback===null&&(this._dirty=!0):((e=this._image)==null?void 0:e.src)!==this.lastSrc&&((t=this._image)==null?void 0:t.complete)&&(this._layoutDirty=!0,this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.imageWidth;s===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?s=this._image.videoWidth:s=this._image.naturalWidth:s=this.viewBox[2]),this.idealWidth=Math.max(Math.min(s,t),e);let o=this.imageHeight;switch(o===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?o=this._image.videoHeight:o=this._image.naturalHeight:o=this.viewBox[3]),this.idealHeight=Math.max(Math.min(o,n),r),this.fit){case 0:case 1:{let h=this.idealWidth/s,d=this.idealHeight/o,c;this.fit===0?c=Math.min(h,d):c=Math.max(h,d),this.actualWidth=s*c,this.actualHeight=o*c,this.offsetX=(this.idealWidth-this.actualWidth)/2,this.offsetY=(this.idealHeight-this.actualHeight)/2;break}case 2:this.actualWidth=this.idealWidth,this.actualHeight=this.idealHeight,this.offsetX=0,this.offsetY=0;break;default:throw new Error(b.INVALID_ENUM(this.fit,"IconFit","fit"))}}handlePainting(e){var h;if(this._image instanceof HTMLImageElement&&!((h=this._image)!=null&&h.complete)){this.lastSrc=null;return}this.lastSrc=this._image.src;let t=this.x+this.offsetX,r=this.y+this.offsetY,n=this.rotation!==0,s=n||this.fit===1,o=this.viewport.context;s&&(o.save(),o.beginPath(),o.rect(this.x,this.y,this.width,this.height),o.clip(),n&&(o.translate(this.x+this.offsetX+this.actualWidth/2,this.y+this.offsetY+this.actualHeight/2),t=-this.actualWidth/2,r=-this.actualHeight/2,o.rotate(this.rotation))),this.viewBox===null?o.drawImage(this._image,t,r,this.actualWidth,this.actualHeight):o.drawImage(this._image,...this.viewBox,t,r,this.actualWidth,this.actualHeight),s&&o.restore()}dryPaint(){var e;this._image instanceof HTMLImageElement&&((e=this._image)==null?void 0:e.complete)?this.lastSrc=this._image.src:this.lastSrc=null,super.dryPaint()}};a(oe,"Icon"),w([ve],oe.prototype,"rotation",2),w([$t(!0)],oe.prototype,"viewBox",2),w([ee],oe.prototype,"imageWidth",2),w([ee],oe.prototype,"imageHeight",2),w([ve],oe.prototype,"fit",2);var Ft=class extends Ce{constructor(i,e,t){super(new oe(i,t),e,t)}};a(Ft,"IconButton");var Me=class extends y{constructor(e){var t,r;e=A({flex:1},e);super(!0,!1,e);this.minWidth=(t=e==null?void 0:e.minWidth)!=null?t:0,this.minHeight=(r=e==null?void 0:e.minHeight)!=null?r:0}handleResolveDimensions(e,t,r,n){t!==1/0?this.idealWidth=t:this.idealWidth=Math.max(e,this.minWidth),n!==1/0?this.idealHeight=n:this.idealHeight=Math.max(r,this.minHeight)}};a(Me,"Spacing");var Mt=class extends pe{constructor(i,e,t){super(t),this.add([new re(i,t),new Me(t),new rt(e,t)])}};a(Mt,"LabelledCheckbox");var nt=class extends y{constructor(e,t,r){super(!0,!1,r);this.offsetX=0;this.offsetY=0;this.actualLength=0;this._wasSelected=!1;this.tabFocusable=!0,this.variable=e,this.value=t,this.clickHelper=new me(this),this.callback=this.handleChange.bind(this),this._wasSelected=this.selected}handleChange(){this.selected!==this._wasSelected&&(this._dirty=!0)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="radioButtonLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="radioButtonInnerPadding")&&(this._dirty=!0)}select(){this.variable.value=this.value}get selected(){return this.variable.value===this.value}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(e,this.root,!0,[t,t+this.actualLength,r,r+this.actualLength]);return n&&this.select(),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(e,t,r,n){let s=Math.min(this.radioButtonLength,t,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<e&&(this.idealWidth=e),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.radioButtonLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){this._wasSelected=this.selected;let t=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;t?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.actualLength/2,s=this.offsetX+this.x+n,o=this.offsetY+this.y+n;if(this.paintCircle(s,o,n),this.selected){t?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let h=this.actualLength-this.radioButtonInnerPadding*2;if(h<=0)this.paintCircle(s,o,n);else{let d=h/2;this.paintCircle(s,o,d)}}}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}};a(nt,"RadioButton");var Lt=class extends pe{constructor(i,e,t,r){super(r),this.add([new re(i,r),new Me(r),new nt(e,t,r)])}};a(Lt,"LabelledRadioButton");var Le=class extends de{constructor(e,t){var r,n,s,o,h,d;super(e,!1,!0,t);this._constraints=[0,1/0,0,1/0];this.forceRePaint=!0;this.reservedX=0;this.reservedY=0;this.useCanvas=(r=t==null?void 0:t.useCanvas)!=null?r:!1,this.useCanvas?this.internalViewport=new te(e):this.internalViewport=new Ve(e),this.minWidth=(n=t==null?void 0:t.minWidth)!=null?n:0,this.minHeight=(s=t==null?void 0:t.minHeight)!=null?s:0,this._widthCoupling=(o=t==null?void 0:t.widthCoupling)!=null?o:0,this._heightCoupling=(h=t==null?void 0:t.heightCoupling)!=null?h:0,this._constraints=(d=t==null?void 0:t.constraints)!=null?d:[0,1/0,0,1/0]}get offset(){return[...this.internalViewport.offset]}set offset(e){(this.internalViewport.offset[0]!==e[0]||this.internalViewport.offset[1]!==e[1])&&(this.internalViewport.offset=[e[0],e[1]],this._dirty=!0)}set constraints(e){(e[0]!==this._constraints[0]||e[1]!==this._constraints[1]||e[2]!==this._constraints[2]||e[3]!==this._constraints[3])&&(this._constraints[0]=e[0],this._constraints[1]=e[1],this._constraints[2]=e[2],this._constraints[3]=e[3],this.internalViewport.constraints=e)}get constraints(){return[...this._constraints]}get widthCoupling(){return this._widthCoupling}set widthCoupling(e){this._widthCoupling!==e&&(this._widthCoupling=e,this._layoutDirty=!0)}get heightCoupling(){return this._heightCoupling}set heightCoupling(e){this._heightCoupling!==e&&(this._heightCoupling=e,this._layoutDirty=!0)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="canvasFill"&&(this._dirty=!0)}getBoundsOf(e){let[t,r]=e.idealDimensions,[n,s]=e.idealPosition,[o,h]=this.child.idealPosition,d=this.idealX+this.offset[0]+n-o,c=this.idealY+this.offset[1]+s-h;return[d,d+t,c,c+r]}handleEvent(e){return this.internalViewport.dispatchEvent(e)}handlePreLayoutUpdate(){let e=this.child;e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0),this.useCanvas&&(this.internalViewport.resolution=this.root.resolution)}handlePostLayoutUpdate(){this.internalViewport.rect=[this.x,this.y,this.width,this.height];let e=this.child;e.postLayoutUpdate(),e.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=Math.max(t-this.reservedX,0),o=Math.max(n-this.reservedY,0),h=Math.min(Math.max(e,this.minWidth)-this.reservedX,s),d=Math.min(Math.max(r,this.minHeight)-this.reservedY,o);this._widthCoupling!==1&&(this.idealWidth=h,this._widthCoupling===2&&(h=this.idealWidth)),this.idealWidth===0&&this.minWidth===0&&this._widthCoupling!==1&&console.warn(b.MAYBE_DIMENSIONLESS("width")),this._heightCoupling!==1&&(this.idealHeight=d,this._heightCoupling===2&&(d=this.idealHeight)),this.idealHeight===0&&this.minHeight===0&&this._heightCoupling!==1&&console.warn(b.MAYBE_DIMENSIONLESS("height"));let c=[...this._constraints];this._widthCoupling!==0&&(c[0]=h,this._widthCoupling===1&&(c[1]=s)),this._heightCoupling!==0&&(c[2]=d,this._heightCoupling===1&&(c[3]=o));let u=this.child;this.internalViewport.constraints=c,this.internalViewport.resolveLayout(),this._widthCoupling===1&&(this.idealWidth=Math.max(0,u.idealDimensions[0])),this._heightCoupling===1&&(this.idealHeight=Math.max(0,u.idealDimensions[1]))}activate(e,t,r){y.prototype.activate.call(this,e,t,r),this.internalViewport.parent=t,this.child.activate(e,this.internalViewport,r)}deactivate(){this.internalViewport.parent=null,super.deactivate()}handlePainting(e){this.internalViewport.paint(e||this.forceRePaint,this.canvasFill),this.forceRePaint=!1}};a(Le,"ViewportWidget"),w([ee],Le.prototype,"minWidth",2),w([ee],Le.prototype,"minHeight",2);var ei=(t=>(t[t.Overlay=0]="Overlay",t[t.Layout=1]="Layout",t[t.Hidden=2]="Hidden",t))(ei||{}),st=class extends Le{constructor(e,t){var r;super(e,t);this.effectiveWidth=0;this.effectiveHeight=0;this.verticalDragged=null;this.startingScroll=0;this.startingOffset=0;this.lastScroll=0;this.horizWasPainted=!1;this.vertWasPainted=!1;this._scrollLineHeight=0;this._scrollbarMode=(r=t==null?void 0:t.scrollbarMode)!=null?r:0,this.horizontalClickHelper=new ne(this),this.verticalClickHelper=new ne(this),this.updateScrollLineHeight()}get scrollbarMode(){return this._scrollbarMode}set scrollbarMode(e){if(this._scrollbarMode!==e){let t=this.scroll;this._scrollbarMode=e,this.scroll=t,this._layoutDirty=!0,this._dirty=!0}}get offset(){return super.offset}set offset(e){let[t,r]=this.child.idealDimensions;super.offset=[-Math.max(Math.min(-e[0],t-this.effectiveWidth),0),-Math.max(Math.min(-e[1],r-this.effectiveHeight),0)]}get widthCoupling(){return super.widthCoupling}set widthCoupling(e){let t=this.scroll;super.widthCoupling=e,this.scroll=t}get heightCoupling(){return super.heightCoupling}set heightCoupling(e){let t=this.scroll;super.heightCoupling=e,this.scroll=t}get scroll(){let[e,t]=this.offset,[r,n]=this.child.idealDimensions,s=r-this.effectiveWidth,o=n-this.effectiveHeight;return[s===0?0:Math.min(Math.max(-e/s,0),1),o===0?0:Math.min(Math.max(-t/o,0),1)]}set scroll(e){let[t,r]=this.child.idealDimensions;this.offset=[-e[0]*(t-this.effectiveWidth),-e[1]*(r-this.effectiveHeight)]}getClickHelper(e){return e?this.verticalClickHelper:this.horizontalClickHelper}handleEventScrollbar(e,t,r,n){if(this.verticalDragged!==null&&this.verticalDragged!==e)return!1;let[s,o]=this.getScrollbarRects(e,t),h=this._scrollbarMode===0,d=h?s:o,c=[d[0],d[0]+d[2],d[1],d[1]+d[3]],u=this.getClickHelper(e);u.handleClickEvent(r,n,c);let m=u.clickState,f=u.clickStateChanged;if(f&&(this._dirty=!0),m===2){if(u.pointerPos===null||!(r instanceof W))return!0;let p=e?1:0,g=this.scroll,_=h;_||(_=u.isPointInRect(r.x,r.y,s[0],s[0]+s[2],s[1],s[1]+s[3]));let v;if(h?v=u.getNormalInRect(r.x,r.y,o[0],o[0]+o[2],o[1],o[1]+o[3])[p]:v=u.pointerPos[p],f){if(!_){let x=e?this.effectiveHeight:this.effectiveWidth,T=this.child.idealDimensions[p],P=x/T;g[p]=(v-P/2)/(1-P),this.scroll=g}this.startingOffset=v,this.startingScroll=g[p],this.verticalDragged=e}else{let x=e?this.effectiveHeight:this.effectiveWidth,T=this.child.idealDimensions[p],P=x/T,I=v-this.startingOffset;g[p]=this.startingScroll+I/(1-P),this.scroll=g}return!0}else{if(m===1)return!0;if(f)return this.verticalDragged=null,!0}return!1}clampOffset(e){let[t,r]=this.child.idealDimensions,n=-(t-this.effectiveWidth);n>=0?e[0]=0:e[0]<n&&(e[0]=n);let s=-(r-this.effectiveHeight);s>=0?e[1]=0:e[1]<s&&(e[1]=s)}handleWheelEvent(e){let t=this.offset,[r,n]=t,[s,o]=e.getDeltaPixels(!0,this._scrollLineHeight,this.idealWidth,this.idealHeight);t[0]-=e.shift?o:s,t[1]-=e.shift?s:o,this.clampOffset(t),this.offset=t;let[h,d]=this.offset,c=h!==r||d!==n,u=this.lastScroll,m=new Date().getTime();return this.lastScroll=m,c?!0:e.fromDrag?!1:m-u<200}updateScrollLineHeight(){let e=new D;e.font=this.bodyTextFont,e.lineHeight=this.bodyTextHeight,e.lineSpacing=this.bodyTextSpacing,this._scrollLineHeight=e.fullLineHeight}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="bodyTextHeight"||e==="bodyTextSpacing"?this.updateScrollLineHeight():e==="scrollBarThickness"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundFill"||e==="scrollBarMinPercent"||e==="scrollBarMinPixels"||e==="primaryFill"||e==="accentFill"||e==="backgroundGlowFill")&&(this._dirty=!0)}handleEvent(e){let t=this.widthCoupling===1,r=this.heightCoupling===1;if(this._scrollbarMode!==2&&(e instanceof E||e instanceof W)&&(e.target===null||e.target===this)){let[s,o]=this.child.idealDimensions,h=this._scrollbarMode===0,d=!h&&!t&&!r,c=s>this.idealWidth,u=o>this.idealHeight,m=!1;if(!t&&(c||!h)&&this.handleEventScrollbar(!1,u||d,e,this.root)&&(m=!0),!r&&(u||!h)&&this.handleEventScrollbar(!0,c||d,e,this.root)&&(m=!0),m)return e instanceof L&&this.handleWheelEvent(e),this}let n=super.handleEvent(e);if(n!==null&&e instanceof j){let s=this._scrollbarMode===1,o=s&&!r,h=s&&!t,d=this.effectiveWidth,c=this.effectiveHeight;if(!o||!h){let $=this.scrollBarThickness,[Ie,gt]=this.child.idealDimensions,ti=Ie>this.idealWidth,ii=gt>this.idealHeight,ri=this.scrollbarNeedsPaint(!1,ti),ni=this.scrollbarNeedsPaint(!0,ii);this._scrollbarMode!==2&&(!o&&ni&&(d=Math.max(0,d-$)),!h&&ri&&(c=Math.max(0,c-$)))}let[u,m]=n.idealPosition,[f,p]=this.offset,g=f,_=p;this.internalViewport.relativeCoordinates&&(u+=this.idealX+f,m+=this.idealY+p);let[v,x,T,P]=e.bounds;v+=u,x+=u,T+=m,P+=m;let I=this.idealX+d,H=this.idealY+c,O=!t&&!(v>=this.idealX&&x<=I)&&!(this.idealX>=v&&I<=x);if(O){let $=x-v>d,Ie=v<this.idealX;$!==Ie?f+=this.idealX-v:f+=I-x}let Y=!r&&!(T>=this.idealY&&P<=H)&&!(this.idealY>=T&&H<=P);if(Y){let $=P-T>c,Ie=T<this.idealY;$!==Ie?p+=this.idealY-T:p+=H-P}(O||Y)&&(this.offset=[f,p]);let[ye,le]=this.offset,ot=ye-g+u-this.idealX,lt=le-_+m-this.idealY;return e.bounds[0]+=ot,e.bounds[1]+=ot,e.bounds[2]+=lt,e.bounds[3]+=lt,this}return n===null&&e instanceof L&&this.handleWheelEvent(e)?this:n}handleResolveDimensions(e,t,r,n){let s=this.scrollBarThickness,o=this._scrollbarMode===1;this.reservedX=o&&this.heightCoupling!==1?s:0,this.reservedY=o&&this.widthCoupling!==1?s:0,super.handleResolveDimensions(e,t,r,n),this.effectiveWidth=this.idealWidth,this.effectiveHeight=this.idealHeight,this.idealWidth=Math.min(Math.max(this.idealWidth+this.reservedX,e),t),this.idealHeight=Math.min(Math.max(this.idealHeight+this.reservedY,r),n)}handlePostLayoutUpdate(){super.handlePostLayoutUpdate();let e=this.offset;this.clampOffset(e),this.offset=e}handlePainting(e){let[t,r]=this.child.idealDimensions,n=t>this.effectiveWidth,s=r>this.effectiveHeight,o=this.scrollbarNeedsPaint(!1,n),h=this.scrollbarNeedsPaint(!0,s);this.horizWasPainted!==o||this.vertWasPainted!==h?(this.horizWasPainted=o,this.vertWasPainted=h,this.forceRePaint=!0):this.scrollbarMode===0&&(this.forceRePaint=!0),super.handlePainting(e);let d=this._scrollbarMode===1&&this.widthCoupling!==1&&this.heightCoupling!==1;if(o&&this.paintScrollbar(!1,n,s||d),h&&this.paintScrollbar(!0,s,n||d),d){let c=this.scrollBarThickness,u=this.viewport.context;u.fillStyle=this.backgroundFill,u.fillRect(this.x+this.width-c,this.y+this.height-c,c,c)}}getScrollbarRects(e,t){let r=this._scrollbarMode===0,n=e?1:0,s=this.scroll[n],o=this.child.idealDimensions[n],h=e?this.effectiveHeight:this.effectiveWidth,d=Math.min(this.scrollBarThickness,this.width/2,this.height/2),c=this.scrollBarMinPercent,u=this.scrollBarMinPixels,m=h;r&&(m-=t?d:0);let f=Math.min(Math.max(u,Math.max(h/o,c)*m),h),p=(m-f)*s,g,_,v,x;e?(g=this.idealX+this.idealWidth-d,_=this.idealY+p,v=d,x=f):(g=this.idealX+p,_=this.idealY+this.idealHeight-d,v=f,x=d);let T,P,I,H;return e?(T=g,P=this.idealY,I=d,H=m):(T=this.idealX,P=_,I=m,H=d),[[g,_,v,x],[T,P,I,H]]}scrollbarNeedsPaint(e,t){return this._scrollbarMode===2||!t&&this._scrollbarMode===0?!1:e?this.heightCoupling!==1:this.widthCoupling!==1}paintScrollbar(e,t,r){let[n,s]=this.getScrollbarRects(e,r),o=this.viewport.context;if(this._scrollbarMode!==0&&(o.fillStyle=this.backgroundFill,o.fillRect(...s)),t)switch(this.getClickHelper(e).clickState){case 0:o.fillStyle=this.primaryFill;break;case 1:case 2:o.fillStyle=this.accentFill;break}else o.fillStyle=this.backgroundGlowFill;o.fillRect(...n)}};a(st,"ScrollableViewportWidget");var pt=class extends y{constructor(e=new be(0),t=0,r=1,n){var o,h;super(!0,!1,n);this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.keyboardFocused=!1;this.dragBounds=[0,0,0,0];if(r<t)throw new Error(b.SWAPPED_MIN_MAX(t,r));if(!isFinite(t)||isNaN(t))throw new Error(b.INVALID_MIN(t));if(!isFinite(r)||isNaN(r))throw new Error(b.INVALID_MAX(r));let s=(o=n==null?void 0:n.snapIncrement)!=null?o:0;if(!isFinite(s)||isNaN(s))throw new Error(b.INVALID_INC(r));if(s<0)throw new Error(b.NEGATIVE_INC(r));this.clickHelper=new ne(this),this.minValue=t,this.maxValue=r,this.snapIncrement=s,this.vertical=(h=n==null?void 0:n.vertical)!=null?h:!1,this.tabFocusable=!0,this.variable=e,this.callback=this.handleChange.bind(this)}handleChange(){this._dirty=!0}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}set value(e){this.setValue(e)}get value(){return this.variable.value}clamp(e){return e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),e}setValue(e,t=!0){this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),this.variable.setValue(this.clamp(e),t)}stepValue(e,t){let r=this.snapIncrement;r===0&&(r=.01*(this.maxValue-this.minValue)),r*=t;let n=e?1:-1;this.value=this.clamp((Math.round(this.value/r)+n)*r)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="sliderThickness"||e==="sliderMinLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="accentFill"||e==="primaryFill"||e==="backgroundFill")&&(this._dirty=!0)}onFocusGrabbed(e){e===1&&(this.keyboardFocused=!0)}onFocusDropped(e){e===1&&(this.keyboardFocused=!1)}handleEvent(e){if(e instanceof L||!(e instanceof W||e instanceof Q||e instanceof E)||e instanceof R&&(e.key==="Tab"||e.key==="Escape"))return null;if(e instanceof Q){if(e instanceof R){let t=e.shift?10:1;e.key==="ArrowLeft"||e.key==="ArrowDown"?this.stepValue(!1,t):(e.key==="ArrowRight"||e.key==="ArrowUp")&&this.stepValue(!0,t)}return this}if(e instanceof V||this.clickHelper.clickState!==2){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY;this.dragBounds=[t,t+this.actualWidth,r,r+this.actualHeight]}if(this.clickHelper.handleClickEvent(e,this.root,this.dragBounds),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState===2)&&this.clickHelper.pointerPos!==null){let t=this.clickHelper.pointerPos[0];this.value=this.minValue+t*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handleResolveDimensions(e,t,r,n){let s=this.sliderThickness,o=this.sliderMinLength;this.vertical?(n!=1/0?this.idealHeight=n:this.idealHeight=Math.max(o,r),this.idealWidth=Math.min(Math.max(s,e),t)):(t!=1/0?this.idealWidth=t:this.idealWidth=Math.max(o,e),this.idealHeight=Math.min(Math.max(s,r),n))}finalizeBounds(){super.finalizeBounds(),this.vertical?(this.actualWidth=Math.min(this.width,this.sliderThickness),this.actualHeight=this.height,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=0):(this.actualWidth=this.width,this.actualHeight=Math.min(this.height,this.sliderThickness),this.offsetX=0,this.offsetY=(this.height-this.actualHeight)/2)}handlePainting(e){let t=this.x+this.offsetX,r=this.y+this.offsetY,n=this.viewport.context,s=this.keyboardFocused||this.clickHelper.clickState===1||this.clickHelper.clickState===2;s?n.fillStyle=this.accentFill:n.fillStyle=this.primaryFill;let o=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);n.fillRect(t,r,o,this.actualHeight),s?n.fillStyle=this.backgroundGlowFill:n.fillStyle=this.backgroundFill;let h=this.actualWidth-o;n.fillRect(t+o,r,h,this.actualHeight)}};a(pt,"Slider"),w([ve],pt.prototype,"keyboardFocused",2);var Te=class extends y{constructor(e=new it(""),t){var r,n,s,o,h;super(!1,!1,t);this.blinkStart=0;this.blinkWasOn=null;this.cursorPos=0;this.cursorOffset=[0,0];this.selectPos=0;this.selectOffset=[0,0];this.cursorOffsetDirty=!1;this.offset=[0,0];this.dragging=!1;this.lastClick=0;this.dragStart=-1;this.successiveClickCount=0;this.needsAutoScroll=!1;this.tabFocusable=!0,this.textHelper=new D,this.variable=e,this.callback=this.handleChange.bind(this),this.hideText=(r=t==null?void 0:t.hideText)!=null?r:!1,this.wrapText=(n=t==null?void 0:t.wrapText)!=null?n:!0,this.inputFilter=(s=t==null?void 0:t.inputFilter)!=null?s:null,this.typeableTab=(o=t==null?void 0:t.typeableTab)!=null?o:!1,this._editingEnabled=(h=t==null?void 0:t.editingEnabled)!=null?h:!0}handleChange(){this._dirty=!0}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0,this.cursorOffsetDirty=!0):e==="inputTextInnerPadding"||e==="inputTextFont"||e==="inputTextHeight"||e==="inputTextSpacing"?(this._layoutDirty=!0,this._dirty=!0):e==="inputBackgroundFill"||e==="inputTextFill"||e==="inputTextFillInvalid"||e==="inputTextFillDisabled"||e==="cursorThickness"?this._dirty=!0:e==="inputTextAlign"&&(this.cursorOffsetDirty=!0)}get blinkOn(){if(this.blinkStart===0)return null;let e=this.blinkRate;return Math.trunc((Date.now()-this.blinkStart)/(500*e)%2)===0}get editingEnabled(){return this._editingEnabled}set editingEnabled(e){this._editingEnabled!==e&&(this._editingEnabled=e,e||(this.blinkStart=0,this.moveCursorTo(0,!1)),this._dirty=!0)}set text(e){this.variable.value=e;let t=this.variable.value.length;this.cursorPos>t&&(this.cursorPos=t,this.cursorOffsetDirty=!0),this.selectPos>t&&(this.selectPos=t,this.cursorOffsetDirty=!0)}get text(){return this.variable.value}get displayedText(){return this.hideText?"\u25CF".repeat(this.variable.value.length):this.variable.value}get line(){return this.textHelper.getLine(this.cursorPos)}autoScrollCaret(){this.blinkStart!==0&&(this.needsAutoScroll=!0)}moveCursorTo(e,t){this.cursorPos=Math.min(Math.max(e,0),this.text.length),t||(this.selectPos=this.cursorPos),this.cursorOffsetDirty=!0,this._dirty=!0,this.autoScrollCaret()}moveCursor(e,t){this.moveCursorTo(this.cursorPos+e,t)}moveCursorFromOffset(e,t,r){[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset([e,t]),r||(this.selectPos=this.cursorPos,this.selectOffset=this.cursorOffset),this.blinkStart=Date.now(),this._dirty=!0,this.autoScrollCaret()}moveCursorLine(e,t){this.moveCursorFromOffset(this.cursorOffset[0],this.cursorOffset[1]+(.5+e)*this.textHelper.fullLineHeight,t)}moveCursorStart(e){this.moveCursorTo(this.textHelper.getLineStart(this.line),e)}moveCursorEnd(e){this.moveCursorTo(this.textHelper.getLineEnd(this.line,!1),e)}moveCursorWord(e,t){if(e==0)return;let r=/\w/,n=this.text,s=this.cursorPos;if(e>0)for(;e>0;){let o=!1;for(;s<=n.length;s++)if(s<n.length&&r.test(n[s]))o=!0;else if(o)break;e--}else for(;e<0;){s--;let o=!1;for(;s>=0;s--)if(s>=0&&r.test(n[s]))o=!0;else if(o)break;s++,e++}this.moveCursorTo(s,t)}deleteRange(e,t){e!==t&&(this.variable.value=this.text.substring(0,e)+this.text.substring(t),this.cursorPos=this.selectPos=e,this.cursorOffsetDirty=!0,this.autoScrollCaret())}deleteWord(e){if(e===0)return;if(this.cursorPos!==this.selectPos){this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));return}let t=this.cursorPos;this.moveCursorWord(e,!1),t!==this.cursorPos&&this.deleteRange(Math.min(t,this.cursorPos),Math.max(t,this.cursorPos))}insertText(e){if(!(this.inputFilter!==null&&!this.inputFilter(e)))if(this.selectPos===this.cursorPos)this.variable.value=this.text.substring(0,this.cursorPos)+e+this.text.substring(this.cursorPos),this.moveCursor(e.length,!1);else{let t=Math.min(this.cursorPos,this.selectPos),r=Math.max(this.cursorPos,this.selectPos);this.variable.value=this.text.substring(0,t)+e+this.text.substring(r),this.moveCursorTo(t+e.length,!1)}}deleteText(e){e!==0&&(this.cursorPos!==this.selectPos?this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos)):e>0?(this.variable.value=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+e),this.cursorOffsetDirty=!0,this.autoScrollCaret()):(this.variable.value=this.text.substring(0,this.cursorPos+e)+this.text.substring(this.cursorPos),this.moveCursor(e,!1)))}selectRangeAt(e){let t=this.text,r=/\w/,n=r.test(t[e]),s=e;for(;e>=0&&r.test(t[e])===n;e--);let o=e+1;for(e=s;e<t.length&&r.test(t[e])===n;e++);return this.autoScrollCaret(),[o,e]}onFocusGrabbed(e){e===1&&this.blinkStart===0&&(this.blinkStart=Date.now(),this.selectPos=this.variable.value.length,this.cursorPos=this.selectPos,this.cursorOffsetDirty=!0,this.autoScrollCaret())}onFocusDropped(e){e===1&&(this.blinkStart=0)}handleEvent(e){if(!this._editingEnabled)return null;let t=this.root;if(e instanceof E)return this.dragging=!1,this.lastClick=0,this;if(e instanceof L)return null;if(e instanceof W){if(t.pointerStyle="text",e instanceof V||e instanceof se){let r=e instanceof V&&e.isPrimary;if(r){this.dragging=!0;let s=new Date().getTime();s-this.lastClick<500?(this.successiveClickCount++,this.successiveClickCount>2&&(this.successiveClickCount=0)):this.successiveClickCount=0,this.lastClick=s}else if(!this.dragging)return this;let n=this.inputTextInnerPadding;if(this.moveCursorFromOffset(e.x-this.idealX-n+this.offset[0],e.y-this.idealY-n+this.offset[1],!r&&this.dragging||r&&e.shift),r&&(this.cursorPos!==this.dragStart&&(this.successiveClickCount=0),this.dragStart=this.cursorPos),this.successiveClickCount>0){let s,o;if(this.successiveClickCount===1){let[h,d]=this.selectRangeAt(this.dragStart),[c,u]=this.selectRangeAt(this.cursorPos);s=Math.min(h,c),o=Math.max(d,u)}else{let h=Math.min(this.cursorPos,this.dragStart),d=this.textHelper.getLine(h);s=this.textHelper.getLineStart(d);let c=Math.max(this.cursorPos,this.dragStart),u=this.textHelper.getLine(c);o=this.textHelper.getLineEnd(u)}this.cursorPos>=this.dragStart?(this.selectPos=s,this.cursorPos=o):(this.selectPos=o,this.cursorPos=s),this.cursorOffsetDirty=!0}t.requestFocus(1,this)}else e instanceof X&&e.isPrimary&&(this.dragging=!1,t.hasMobileTextInput&&t.getTextInput(this.text).then(r=>{r===null||this.inputFilter!==null&&!this.inputFilter(r)||this.text!==r&&(this.text=r,this.moveCursorTo(r.length,!1))}));return this}else if(e instanceof R){if(this.dragging=!1,this.lastClick=0,e.alt)return this;if(e.ctrl){if(e.key==="Backspace")this.deleteWord(-1);else if(e.key==="Delete")this.deleteWord(1);else if(e.key==="ArrowLeft")this.moveCursorWord(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursorWord(1,e.shift);else if(e.key==="c"||e.key==="C"){if(this.cursorPos===this.selectPos)return this;let r=this.text.slice(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));if(navigator.clipboard)navigator.clipboard.writeText(r);else return this}else if(e.key==="a"||e.key==="A")this.cursorPos=this.text.length,this.selectPos=0,this.cursorOffsetDirty=!0,this._dirty=!0;else return this;return this.blinkStart=Date.now(),this}if(e.key.length===1)this.insertText(e.key);else if(e.key==="Backspace")this.deleteText(-1);else if(e.key==="Delete")this.deleteText(1);else if(e.key==="ArrowLeft")this.moveCursor(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursor(1,e.shift);else if(e.key==="ArrowUp")this.moveCursorLine(-1,e.shift);else if(e.key==="ArrowDown")this.moveCursorLine(1,e.shift);else if(e.key==="PageUp"||e.key==="PageDown"){let r=e.key==="PageUp"?-1:1,[n,s,o,h]=this.viewport.rect,d=Math.max(Math.floor(h/this.textHelper.fullLineHeight),3);this.moveCursorLine(d*r,e.shift)}else if(e.key==="Home")this.moveCursorStart(e.shift);else if(e.key==="End")this.moveCursorEnd(e.shift);else{if(e.key==="Escape")return null;if(e.key==="Enter")this.insertText(`
`);else if(e.key==="Tab")if(this.typeableTab){if(e.shift)return t.dispatchEvent(new N(this,!1)),this;this.insertText("	")}else return null;else return this}this.blinkStart=Date.now()}else if(e instanceof ue)e.target===this&&(this.insertText(e.text),this.blinkStart=Date.now());else if(e.target!==this)return null;return this}handlePreLayoutUpdate(){this.editingEnabled||this.root.dropFocus(1,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.inputTextFont,this.textHelper.lineHeight=this.inputTextHeight,this.textHelper.lineSpacing=this.inputTextSpacing,this.textHelper.alignMode=this.inputTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handlePostLayoutUpdate(){this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.selectPos===this.cursorPos?(this.selectOffset[0]=this.cursorOffset[0],this.selectOffset[1]=this.cursorOffset[1]):this.selectOffset=this.textHelper.findOffsetFromIndex(this.selectPos),this.cursorOffsetDirty=!1);let e=this.inputTextInnerPadding,t=this.textHelper.width,r=this.textHelper.height,n=this.idealWidth-e*2,s=this.idealHeight-e*2,o=this.offset,[h,d]=this.cursorOffset;if(t>n){let c=Math.min(20,n/2),u=o[0]+c,m=o[0]+n-c;h>m&&(o[0]+=h-m),h<u&&(o[0]-=u-h),o[0]+n>t&&(o[0]=t-n),o[0]<0&&(o[0]=0)}else o[0]=0;if(r>s){let c=this.textHelper.fullLineHeight;if(c>=s)o[1]=d+Math.max(this.textHelper.actualLineHeight-s,0);else{let u=s<2*c?0:c/2,m=o[1]+u,f=o[1]+s-u-c;d<m&&(o[1]-=m-d),d>f&&(o[1]+=d-f),o[1]+s>r&&(o[1]=r-s),o[1]<0&&(o[1]=0)}}else o[1]=0;this.offset=o,this.needsAutoScroll&&(this.needsAutoScroll=!1,this.root.dispatchEvent(new j(this,this.caretBounds)))}handleResolveDimensions(e,t,r,n){let s=2*this.inputTextInnerPadding;this.textHelper.maxWidth=this.wrapText?Math.max(t-s,0):1/0,this.textHelper.dirty&&(this._dirty=!0);let o=Math.min(Math.max(this.inputTextMinWidth,e),t);this.idealWidth=Math.min(Math.max(o,this.textHelper.width+s),t),this.idealHeight=Math.min(Math.max(r,this.textHelper.height+s),n)}get caretRect(){let e=this.inputTextInnerPadding;return[e+this.cursorOffset[0]-this.offset[0],e+this.cursorOffset[1]-this.offset[1],this.cursorThickness,this.textHelper.fullLineHeight]}get caretAbsoluteRect(){let[e,t,r,n]=this.caretRect;return[e+this.idealX,t+this.idealY,r,n]}get caretBounds(){let[e,t,r,n]=this.caretRect;return[e,e+r,t,t+n]}handlePainting(e){let t=this.viewport.context;t.fillStyle=this.inputBackgroundFill,t.fillRect(this.x,this.y,this.width,this.height),t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip();let r=this.inputTextInnerPadding;if(this.cursorPos!==this.selectPos)if(t.fillStyle=this.inputSelectBackgroundFill,this.cursorOffset[1]===this.selectOffset[1]){let o=Math.min(this.cursorOffset[0],this.selectOffset[0]),h=Math.max(this.cursorOffset[0],this.selectOffset[0]);t.fillRect(this.idealX+r+o-this.offset[0],this.idealY+r+this.cursorOffset[1]-this.offset[1],h-o,this.textHelper.fullLineHeight)}else{let o,h;this.cursorOffset[1]<this.selectOffset[1]?(o=this.cursorOffset,h=this.selectOffset):(h=this.cursorOffset,o=this.selectOffset);let d=this.textHelper.fullLineHeight,c=this.idealWidth+this.offset[0]-o[0]-r;c>0&&t.fillRect(this.idealX+r+o[0]-this.offset[0],this.idealY+r+o[1]-this.offset[1],c,d);let u=h[0]+r-this.offset[0];u>0&&t.fillRect(this.idealX,this.idealY+r+h[1]-this.offset[1],u,d);let m=o[1]+d,f=h[1]-m;f>0&&t.fillRect(this.idealX,this.idealY+r+m-this.offset[1],this.idealWidth,f)}let n;this._editingEnabled?this.variable.valid?n=this.inputTextFill:n=this.inputTextFillInvalid:n=this.inputTextFillDisabled,this.textHelper.paint(t,n,this.idealX+r-this.offset[0],this.idealY+r-this.offset[1]);let s=this.blinkOn;this.blinkWasOn=s,s&&(t.fillStyle=n,t.fillRect(...this.caretAbsoluteRect)),t.restore()}};a(Te,"TextInput"),w([G(["cursorOffsetDirty","_dirty"])],Te.prototype,"hideText",2),w([Kt()],Te.prototype,"offset",2),w([ee],Te.prototype,"wrapText",2);var Ht=class extends st{constructor(i,e){e=A({widthCoupling:2,heightCoupling:2,scrollbarMode:2,typeableTab:!0},e),super(new Te(i,e),e)}get textInput(){return this.child}};a(Ht,"TextArea");var Rt=class extends ge{constructor(i,e){e=A({containerAlignment:{horizontal:.5,vertical:"stretch"}},e),super(i,e)}};a(Rt,"TextMargin");var It=class extends ke{constructor(e,t){super(e);this.scopeTheme=t}set inheritedTheme(e){super.inheritedTheme=this.scopeTheme}get inheritedTheme(){return this.scopeTheme}};a(It,"ThemeScope");export{di as Alignment,St as AltKey,Re as ArtificialConstraint,j as AutoScroll,Di as AxisCoupling,ze as BackspaceKey,ce as BaseContainer,M as BaseTheme,F as BaseViewport,J as BasicVirtualKey,Ce as Button,me as ButtonClickHelper,te as CanvasViewport,Et as Center,rt as Checkbox,ne as ClickHelper,vi as ClickState,Ve as ClippedViewport,Je as Column,Ke as CompoundClickHelper,ge as Container,Dt as ControlKey,_t as DOMKeyboardDriver,Pt as DOMPointerDriver,Xe as DOMRoot,Tt as DOMVirtualKeyboardRoot,Ct as DebugTheme,cn as DefaultTextInputHandler,b as DynMsg,je as EnterKey,Qe as EscapeKey,U as Event,Se as FilledButton,hi as FlexAlignment,gi as FocusType,Pe as GenericClickHelper,$e as GlyphVirtualKey,oe as Icon,Ft as IconButton,Fi as IconFit,Q as KeyEvent,R as KeyPress,fe as KeyRelease,tt as KeyboardDriver,re as Label,Mt as LabelledCheckbox,Lt as LabelledRadioButton,E as Leave,Ee as Margin,we as ModifierEvent,S as Msg,he as MultiContainer,Ue as MultiParent,_e as Parent,ke as PassthroughWidget,We as PointerButtonEvent,Fe as PointerDriver,W as PointerEvent,Si as PointerHint,se as PointerMove,V as PointerPress,X as PointerRelease,L as PointerWheel,Qt as PointerWheelMode,nt as RadioButton,Wt as RayPointerDriver,C as Root,pe as Row,st as ScrollableViewportWidget,ei as ScrollbarMode,Ze as ShiftKey,de as SingleParent,pt as Slider,qe as SpaceKey,Me as Spacing,N as TabSelect,fi as TextAlignMode,Ht as TextArea,Ye as TextButton,D as TextHelper,Te as TextInput,Rt as TextMargin,ue as TextPasteEvent,ie as Theme,It as ThemeScope,it as ValidatedVariable,be as Variable,Le as ViewportWidget,K as VirtualKey,Ge as VirtualKeyRow,De as VirtualKeyboard,wt as VirtualKeyboardRoot,y as Widget,zt as WrapMode,et as defaultVirtualKeyboardTemplate,Xt as flagArrayField,ht as flagField,kt as getPointerEventNormPos,Ut as groupedStackTrace,hn as injectDebugCode,q as injectRandomFillFeature,k as injectStackTraceFeature,ft as injectTraceFeature,ut as injectWatchflagFeature,xe as isDebugFeatureEnabled,xt as isPower2,Yt as layoutArrayField,ee as layoutField,yi as listDebugFeatures,dt as measureTextDims,ai as multiFlagArrayField,G as multiFlagField,Kt as paintArrayField,ve as paintField,$t as paintLayoutArrayField,Ri as paintLayoutField,jt as parseDOMDeltaMode,vt as roundToPower2,bi as toggleDebugFeature,He as watchArrayField,at as watchField};
//# sourceMappingURL=index.esm.js.map
