function t(t){return new Promise(((e,i)=>{function s(){document.body.removeChild(l),document.body.removeChild(r)}function n(){s(),e(h.value)}const r=document.createElement("div");r.id="textInputHandlerOverlay";const l=document.createElement("div");l.id="textInputHandler";const o=document.createElement("p");o.textContent="Change text:";const h=document.createElement("input");h.addEventListener("keyup",(function(t){"Enter"==t.key&&(t.preventDefault(),n())})),h.value=t;const a=document.createElement("div"),c=document.createElement("button");c.addEventListener("click",(function(){s(),e(t)})),c.textContent="Cancel";const u=document.createElement("button");u.addEventListener("click",n),u.textContent="OK",a.appendChild(c),a.appendChild(u),l.appendChild(o),l.appendChild(h),l.appendChild(a),document.body.appendChild(r),document.body.appendChild(l),h.focus({preventScroll:!1})}))}class e{constructor(t,e=null){this.properties=t,this.fallback=e}getProperty(t){let e=this.properties.get(t);if(void 0===e){if(null===this.fallback)throw new Error(`Theme property ${t} is not available`);e=this.fallback.getProperty(t)}return e}getString(t){const e=this.getProperty(t);if("string"!=typeof e)throw new Error(`Theme property ${t} is not a string`);return e}getNumber(t){const e=this.getProperty(t);if("number"!=typeof e)throw new Error(`Theme property ${t} is not a number`);return e}getPadding(t){return this.getProperty(t)}getAlignment(t){return this.getProperty(t)}getAlignment2D(t){return this.getProperty(t)}getFill(t){return this.getString(t)}getFont(t){return this.getString(t)}getSize(t){return this.getNumber(t)}}var i,s;!function(t){t[t.CanvasFill=0]="CanvasFill",t[t.ContainerPadding=1]="ContainerPadding",t[t.ContainerSpacing=2]="ContainerSpacing",t[t.ContainerAlignment=3]="ContainerAlignment",t[t.PrimaryFill=4]="PrimaryFill",t[t.AccentFill=5]="AccentFill",t[t.BackgroundFill=6]="BackgroundFill",t[t.BackgroundGlowFill=7]="BackgroundGlowFill",t[t.SliderFlexRatio=8]="SliderFlexRatio",t[t.SliderMainBasis=9]="SliderMainBasis",t[t.SliderCrossBasis=10]="SliderCrossBasis",t[t.BodyTextFont=11]="BodyTextFont",t[t.BodyTextFill=12]="BodyTextFill",t[t.LabelMinWidth=13]="LabelMinWidth",t[t.LabelMinAscent=14]="LabelMinAscent",t[t.LabelMinDescent=15]="LabelMinDescent",t[t.CheckboxLength=16]="CheckboxLength",t[t.CheckboxInnerPadding=17]="CheckboxInnerPadding",t[t.InputBackgroundFill=18]="InputBackgroundFill",t[t.InputTextFont=19]="InputTextFont",t[t.InputTextFill=20]="InputTextFill",t[t.InputTextFillDisabled=21]="InputTextFillDisabled",t[t.InputTextFillInvalid=22]="InputTextFillInvalid",t[t.InputTextFlexRatio=23]="InputTextFlexRatio",t[t.InputTextMinWidth=24]="InputTextMinWidth",t[t.InputTextMinAscent=25]="InputTextMinAscent",t[t.InputTextMinDescent=26]="InputTextMinDescent",t[t.BlinkRate=27]="BlinkRate",t[t.CursorPadding=28]="CursorPadding",t[t.CursorThickness=29]="CursorThickness",t[t.ScrollBarThickness=30]="ScrollBarThickness"}(i||(i={})),function(t){t[t.Stretch=0]="Stretch",t[t.Start=1]="Start",t[t.Center=2]="Center",t[t.End=3]="End"}(s||(s={}));const n=new e(new Map([[i.CanvasFill,"rgba(0,0,0,0.5)"],[i.ContainerPadding,{left:4,right:4,top:4,bottom:4}],[i.ContainerAlignment,{horizontal:s.Start,vertical:s.Start}],[i.ContainerSpacing,4],[i.PrimaryFill,"rgb(0,127,255)"],[i.AccentFill,"rgb(0,195,255)"],[i.BackgroundFill,"rgb(32,32,32)"],[i.BackgroundGlowFill,"rgb(48,48,48)"],[i.SliderFlexRatio,1],[i.SliderMainBasis,100],[i.SliderCrossBasis,10],[i.BodyTextFont,"16px sans"],[i.BodyTextFill,"white"],[i.LabelMinWidth,0],[i.LabelMinAscent,0],[i.LabelMinDescent,3],[i.CheckboxLength,12],[i.CheckboxInnerPadding,2],[i.InputBackgroundFill,"white"],[i.InputTextFont,"16px mono"],[i.InputTextFill,"black"],[i.InputTextFillDisabled,"grey"],[i.InputTextFillInvalid,"red"],[i.InputTextFlexRatio,1],[i.InputTextMinWidth,100],[i.InputTextMinAscent,16],[i.InputTextMinDescent,3],[i.BlinkRate,.8],[i.CursorPadding,2],[i.CursorThickness,2],[i.ScrollBarThickness,10]]));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function r(t,e,i,s){return new(i||(i=Promise))((function(n,r){function l(t){try{h(s.next(t))}catch(t){r(t)}}function o(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(l,o)}h((s=s.apply(t,e||[])).next())}))}var l,o;!function(t){t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard"}(l||(l={}));class h{constructor(t,e,i){this.target=t,this.focusType=e,this.needsFocus=i}}class a extends h{constructor(t=null){super(t,l.Pointer,!0)}cloneWithTarget(t){return new a(t)}}function c(t,e=!0){const i=e?Math.ceil:Math.floor;return Math.pow(2,i(Math.log2(t)))}class u{constructor(t,e,i){this.hBasis=0,this.vBasis=0,this.hFlex=0,this.vFlex=0,this.sizeChanged=!1,this.maxWidth=t,this.maxHeight=e,this.vertical=i}clone(){const t=new u(this.maxWidth,this.maxHeight,this.vertical);return t.hBasis=this.hBasis,t.vBasis=this.vBasis,t.hFlex=this.hFlex,t.vFlex=this.vFlex,t}addBasis(t,e){this.vertical?(this.vBasis+=e,t>this.hBasis&&(this.hBasis=t)):(this.hBasis+=t,e>this.vBasis&&(this.vBasis=e))}}class d{constructor(t=64,e=64){this._maxDimensions=[0,0],this.forceLayout=!1,this.vertical=!0,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e;const i=this.canvas.getContext("2d",{alpha:!0});if(null===i)throw"Failed to get canvas context";this.context=i}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}set maxDimensions(t){this._maxDimensions[0]===t[0]&&this._maxDimensions[1]===t[1]||(this._maxDimensions[0]=t[0],this._maxDimensions[1]=t[1],this.forceLayout=!0)}get maxDimensions(){return[this._maxDimensions[0],this._maxDimensions[1]]}populateChildsLayout(t){if(this.forceLayout&&(this.forceLayout=!1,t.forceLayoutDirty()),!t.layoutDirty)return null;const e=new u(this._maxDimensions[0],this._maxDimensions[1],this.vertical);return t.populateLayout(e),e}resolveChildsLayout(t,e){if(!t.layoutDirty||null===e)return!1;const[i,s]=t.dimensions;t.resolveLayout(e);const[n,r]=t.dimensions;let l=!1;if(n!==i||r!==s){const t=c(n);t>this.canvas.width&&(this.canvas.width=t);const e=c(r);e>this.canvas.height&&(this.canvas.height=e),l=!0}return(e.sizeChanged||l)&&t.forceLayoutDirty(),l}paintToCanvas(t){const e=t.dirty;return e&&t.paint(0,0,...t.dimensions,this.context),e}}class p{constructor(t,e=null,i=n){this.drivers=new Set,this._enabled=!0,this.pointerStyle="default",this._currentPointerStyle="default",this._foci=new Map([[l.Keyboard,null],[l.Pointer,null]]),this._fociCapturers=new Map([[l.Keyboard,null],[l.Pointer,null]]),this.textInputHandler=null,this._mobileTextInUse=!1,this.viewport=new d,this.child=t,this.pointerStyleHandler=e,this.child.inheritedTheme=i}get maxDimensions(){return this.viewport.maxDimensions}set maxDimensions(t){this.viewport.maxDimensions=t}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t)if(this._enabled=t,t)for(const t of this.drivers)t.onEnable(this);else{for(const t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(const t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){if(!this.enabled)return!1;const t=this.viewport.populateChildsLayout(this.child);return this.viewport.resolveChildsLayout(this.child,t)}paint(){return!!this.enabled&&this.viewport.paintToCanvas(this.child)}dispatchEvent(t){var e;if(!this.enabled)return;if(null!==t.focusType&&null===t.target){let e=this._foci.get(t.focusType);if(void 0===e&&(e=null),t.needsFocus&&null===e)return;t=t.cloneWithTarget(e)}this.pointerStyle="default";const[i,s]=this.dimensions,n=this.child.dispatchEvent(t,i,s,this);if(null===n&&null!==t.focusType&&this.clearFocus(t.focusType),null===t.focusType)return;const r=null!==(e=this._fociCapturers.get(t.focusType))&&void 0!==e?e:null;if(r!==n){t.focusType===l.Pointer&&null!==r&&this.child.dispatchEvent(new a(r),i,s,this),this._fociCapturers.set(t.focusType,n);for(const e of this.drivers)e.onFocusCapturerChanged(this,t.focusType,r,n)}}preLayoutUpdate(){if(this.enabled){for(const t of this.drivers)t.update(this);this.child.preLayoutUpdate(this)}}postLayoutUpdate(){this.enabled&&(this.child.postLayoutUpdate(this),this.updatePointerStyle())}updatePointerStyle(t=null){null!==t&&(this.pointerStyle=t),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,null!==this.pointerStyleHandler&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(t,e){if(null!==e){if(e!==this._foci.get(t)){this.clearFocus(t),this._foci.set(t,e);for(const i of this.drivers)i.onFocusChanged(this,t,e)}}}dropFocus(t,e){e===this._foci.get(t)&&this.clearFocus(t)}clearFocus(t){const e=this._foci.get(t);if(null!=e){e.onFocusDropped(t,this),this._foci.set(t,null);for(const e of this.drivers)e.onFocusChanged(this,t,null)}}getFocus(t){var e;return null!==(e=this._foci.get(t))&&void 0!==e?e:null}getFocusCapturer(t){var e;return null!==(e=this._fociCapturers.get(t))&&void 0!==e?e:null}registerDriver(t){this.drivers.has(t)||(this.drivers.add(t),this._enabled&&t.onEnable&&t.onEnable(this))}unregisterDriver(t){this.drivers.delete(t)&&this._enabled&&t.onDisable&&t.onDisable(this)}clearDrivers(){for(const t of this.drivers)this.unregisterDriver(t)}get hasMobileTextInput(){return null!==this.textInputHandler&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(t=""){return r(this,void 0,void 0,(function*(){if(null!==this.textInputHandler&&!this._mobileTextInUse){this._mobileTextInUse=!0;const e=yield this.textInputHandler(t);return this._mobileTextInUse=!1,e}return null}))}}class v extends p{constructor(t,e=n){super(t,null,e),this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,[this.domElem.width,this.domElem.height]=this.dimensions;const i=this.domElem.getContext("2d",{alpha:!0});if(null===i)throw"Failed to get DOM canvas context";this.domCanvasContext=i,this.pointerStyleHandler=t=>{this.domElem.style.cursor=t}}update(){this.enabled?(this.domElem.style.removeProperty("display"),this.preLayoutUpdate(),this.resolveLayout()&&([this.domElem.width,this.domElem.height]=this.dimensions),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))):this.domElem.style.display="none"}}class f extends h{constructor(t,e,i=null,s=null){super(i,s,!1),this.x=t,this.y=e}}class g extends f{constructor(t,e,i=null){super(t,e,i,l.Pointer)}correctOffset(t,e){return new g(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new g(this.x,this.y,t)}}class m extends f{constructor(t,e,i=null){super(t,e,i)}correctOffset(t,e){return new m(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new m(this.x,this.y,t)}}class y{constructor(t,e,i){this._enabled=!0,this._dirty=!0,this._layoutDirty=!0,this._theme=null,this._inheritedTheme=null,this.resolvedWidth=0,this.resolvedHeight=0,this.needsClear=e,this.propagatesEvents=i,this._themeOverride=t}updateInheritedTheme(){}updateTheme(){null===this._themeOverride?this._theme=this._inheritedTheme:(this._themeOverride.fallback=this._inheritedTheme,this._theme=this._themeOverride)}get theme(){if(null===this._theme)throw"Widget theme is not ready";return this._theme}set enabled(t){t!==this._enabled&&(this._enabled=t,this._dirty=t,this._layoutDirty=!0)}get enabled(){return this._enabled}setThemeOverride(t){this._themeOverride!==t&&(this._themeOverride=t,this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set themeOverride(t){this.setThemeOverride(t)}get themeOverride(){return this._themeOverride}inheritTheme(t){this._inheritedTheme!==t&&(this._inheritedTheme=t,this.updateInheritedTheme(),this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set inheritedTheme(t){this.inheritTheme(t)}get inheritedTheme(){return this._inheritedTheme}get dimensions(){return[this.resolvedWidth,this.resolvedHeight]}get dirty(){return this._dirty}get layoutDirty(){return this._layoutDirty}onFocusDropped(t,e){}handleEvent(t,e,i,s){return t.target===this||t instanceof f&&null===t.target?this:null}dispatchEvent(t,e,i,s){if(!this._enabled)return null;if(null===t.target){if(t instanceof f&&(t.x<0||t.y<0||t.x>=e||t.y>=i))return null}else if(t.target!==this&&!this.propagatesEvents)return null;return this.handleEvent(t,e,i,s)}handlePreLayoutUpdate(t){}preLayoutUpdate(t){this._enabled&&this.handlePreLayoutUpdate(t)}handlePopulateLayout(t){throw"Widget.handlePopulateLayout must be implemented"}handleResolveLayout(t){throw"Widget.handleResolveLayout must be implemented"}populateLayout(t){this._enabled&&this.handlePopulateLayout(t)}resolveLayout(t){if(!this._enabled)return this.resolvedWidth=0,this.resolvedHeight=0,void(this._layoutDirty=!1);if(this._layoutDirty){const e=this.resolvedWidth,i=this.resolvedHeight;this.handleResolveLayout(t),this._layoutDirty=!1,e===this.resolvedWidth&&i===this.resolvedHeight||(this._dirty=!0)}}forceLayoutDirty(){this._layoutDirty=!0,this._dirty=!0}handlePostLayoutUpdate(t){}postLayoutUpdate(t){this._enabled&&this.handlePostLayoutUpdate(t)}clear(t,e,s,n,r){r.save(),r.globalCompositeOperation="copy",r.fillStyle=this.theme.getFill(i.CanvasFill),r.beginPath(),r.rect(Math.trunc(t),Math.trunc(e),Math.ceil(s),Math.ceil(n)),r.clip(),r.fill(),r.restore()}handlePainting(t,e,i,s,n){}paint(t,e,i,s,n){this._dirty&&(this._enabled&&(this.needsClear&&this.clear(t,e,i,s,n),n.save(),this.handlePainting(t,e,i,s,n),n.restore()),this._dirty=!1)}}!function(t){t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold"}(o||(o={}));class x extends y{constructor(){super(...arguments),this.lastClickState=o.Released,this.clickState=o.Released,this.clickStateChanged=!1,this.wasClick=!1,this.pointerPos=null,this.startingPointerPos=null}getNormalInRect(t,e,i,s,n,r){return[(t-i)/(s-i),(e-n)/(r-n)]}isPointInRect(t,e,i,s,n,r){return t>=i&&t<s&&e>=n&&e<r}isNormalInRect(t,e){return t>=0&&t<1&&e>=0&&e<1}setClickState(t,e){this.clickState!==t?(this.lastClickState=this.clickState,this.clickState=t,this.wasClick=e&&this.lastClickState===o.Hold,this.clickStateChanged=!0):this.clickStateChanged=!1}handleClickEvent(t,e,i){if(t instanceof a)return e.dropFocus(l.Pointer,this),this.pointerPos=null,this.setClickState(o.Released,!1);if(t instanceof f){this.pointerPos=this.getNormalInRect(t.x,t.y,...i);const s=this.isNormalInRect(...this.pointerPos);if(s)e.pointerStyle="pointer";else if(null===t.target)return e.dropFocus(l.Pointer,this),this.setClickState(o.Released,!1);return t instanceof m?(this.startingPointerPos=this.pointerPos,e.requestFocus(l.Pointer,this),this.setClickState(o.Hold,s)):t instanceof g?(e.dropFocus(l.Pointer,this),s?this.setClickState(o.Hover,s):this.setClickState(o.Released,s)):null===t.target?this.setClickState(o.Hover,s):this.setClickState(o.Hold,s)}this.clickStateChanged=!1}}const b=(t,e,i=[])=>{const s=Object.getOwnPropertyDescriptors(e);for(let t of i)delete s[t];Object.defineProperties(t,s)},_=(t,e=[t])=>{const i=Object.getPrototypeOf(t);return null===i?e:_(i,[...e,i])},C=(t,e,i=[])=>{var s;const n=null!==(s=((...t)=>{if(0===t.length)return;let e;const i=t.map((t=>_(t)));for(;i.every((t=>t.length>0));){const t=i.map((t=>t.pop())),s=t[0];if(!t.every((t=>t===s)))break;e=s}return e})(...t))&&void 0!==s?s:Object.prototype,r=Object.create(n),l=_(n);for(let e of t){let t=_(e);for(let e=t.length-1;e>=0;e--){let s=t[e];-1===l.indexOf(s)&&(b(r,s,["constructor",...i]),l.push(s))}}return r.constructor=e,r},w=t=>t.filter(((e,i)=>t.indexOf(e)==i)),B=new Map,L=t=>B.get(t),P=(t,e)=>{var i,s;const n=w([...Object.getOwnPropertyNames(t),...Object.getOwnPropertyNames(e)]),r={};for(let l of n)r[l]=w([...null!==(i=null==t?void 0:t[l])&&void 0!==i?i:[],...null!==(s=null==e?void 0:e[l])&&void 0!==s?s:[]]);return r},k=(t,e)=>{var i,s,n,r;return{property:P(null!==(i=null==t?void 0:t.property)&&void 0!==i?i:{},null!==(s=null==e?void 0:e.property)&&void 0!==s?s:{}),method:P(null!==(n=null==t?void 0:t.method)&&void 0!==n?n:{},null!==(r=null==e?void 0:e.method)&&void 0!==r?r:{})}},D=new Map,S=(...t)=>{const e=((...t)=>{var e;const i=new Set,s=new Set([...t]);for(;s.size>0;)for(let t of s){const n=[..._(t.prototype).map((t=>t.constructor)),...null!==(e=L(t))&&void 0!==e?e:[]].filter((t=>!i.has(t)));for(let t of n)s.add(t);i.add(t),s.delete(t)}return[...i]})(...t).map((t=>D.get(t))).filter((t=>!!t));return 0==e.length?{}:1==e.length?e[0]:e.reduce(((t,e)=>((t,e)=>{var i,s,n,r,l,o;return{class:w([...null!==(i=null==t?void 0:t.class)&&void 0!==i?i:[],...null!==(s=null==e?void 0:e.class)&&void 0!==s?s:[]]),static:k(null!==(n=null==t?void 0:t.static)&&void 0!==n?n:{},null!==(r=null==e?void 0:e.static)&&void 0!==r?r:{}),instance:k(null!==(l=null==t?void 0:t.instance)&&void 0!==l?l:{},null!==(o=null==e?void 0:e.instance)&&void 0!==o?o:{})}})(t,e)))};function F(...t){var e,i,s;const n=t.map((t=>t.prototype));function r(...e){for(const i of t)b(this,new i(...e))}r.prototype=C(n,r),Object.setPrototypeOf(r,C(t,null,["prototype"]));let l=r;{const n=S(...t);for(let t of null!==(e=null==n?void 0:n.class)&&void 0!==e?e:[])l=t(l);T(null!==(i=null==n?void 0:n.static)&&void 0!==i?i:{},l),T(null!==(s=null==n?void 0:n.instance)&&void 0!==s?s:{},l.prototype)}var o,h;return o=l,h=t,B.set(o,h),l}const T=(t,e)=>{const i=t.property,s=t.method;if(i)for(let t in i)for(let s of i[t])s(e,t);if(s)for(let t in s)for(let i of s[t])i(e,t,Object.getOwnPropertyDescriptor(e,t))};class M extends y{constructor(t,e,i,s){super(e,i,s),this._children=[...t]}updateInheritedTheme(){const t=this.inheritedTheme;if(null!==t)for(const e of this.children)e.inheritedTheme=t}forceLayoutDirty(){if(super.forceLayoutDirty(),this.enabled&&null!==this._children)for(const t of this.children)t.forceLayoutDirty()}get childCount(){return this._children.length}get children(){return this._children.values()}}class E extends M{constructor(t,e,i,s){super([t],e,i,s)}get child(){return this._children[0]}}class H extends E{constructor(t,e,i=null){super(t,i,!1,e),this._backgroundDirty=!0}handleEvent(t,e,i,s){const[n,r,l,o]=this.calcChildViewport(0,0,e,i);return t instanceof f&&(t=t.correctOffset(n,l)),this.child.dispatchEvent(t,r-n,o-l,s)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}forceLayoutDirty(){this._backgroundDirty=!0,super.forceLayoutDirty()}handlePopulateLayout(t){const e=this.theme.getPadding(i.ContainerPadding);let s=t.maxWidth;const n=e.left+e.right;t.vertical&&(s-=n);let r=t.maxHeight;const l=e.top+e.bottom;t.vertical||(r-=l);const o=new u(s,r,t.vertical);this.child.populateLayout(o),t.addBasis(o.hBasis+n,o.vBasis+l),t.hFlex+=o.hFlex,t.vFlex+=o.vFlex;const h=o.hBasis+n;h>t.maxWidth&&(t.maxWidth=h);const a=o.vBasis+l;a>t.maxHeight&&(t.maxHeight=a)}handleResolveLayout(t){const e=this.theme.getPadding(i.ContainerPadding),s=e.left+e.right;let n=t.maxWidth;t.vertical&&(n-=s);const r=e.top+e.bottom;let l=t.maxHeight;t.vertical||(l-=r);const o=t.clone();o.maxWidth=n,o.maxHeight=l;const h=this.child;h.resolveLayout(o);const[a,c]=h.dimensions;if(isNaN(a)||isNaN(c)||a<0||c<0)throw console.error("Child resolved to invalid dimensions:",a,c,h),new Error("Child resolved to invalid dimensions");o.sizeChanged&&(t.sizeChanged=!0);const u=this.resolvedWidth,d=this.resolvedHeight;this.resolvedWidth=a+s,this.resolvedHeight=c+r,u===this.resolvedWidth&&d===this.resolvedHeight||(this._backgroundDirty=!0)}handlePainting(t,e,i,s,n){this._backgroundDirty&&this.clear(t,e,i,s,n),this._backgroundDirty=!1;const[r,l,o,h]=this.calcChildViewport(t,e,i,s);this.child.paint(r,o,l-r,h-o,n)}calcChildViewport(t,e,n,r){const l=this.theme.getPadding(i.ContainerPadding);let o=t+l.left,h=t+n-l.right,a=e+l.top,c=e+r-l.bottom;if(o>h||a>c)return console.warn("Not enough space for padding in Container widget! Falling back to using no padding"),[t,e,n,r];const u=this.theme.getAlignment2D(i.ContainerAlignment);if(u.horizontal!==s.Stretch){const t=h-o-this.resolvedWidth;if(t>0)switch(u.horizontal){case s.Start:h-=t;break;case s.Center:o+=t/2,h-=t/2;break;case s.End:o+=t}}if(u.vertical!==s.Stretch){const t=c-a-this.resolvedHeight;if(t>0)switch(u.vertical){case s.Start:c-=t;break;case s.Center:a+=t/2,c-=t/2;break;case s.End:a+=t}}return[o,h,a,c]}}class I extends(F(x,H)){constructor(t,e=null,i=null){super(t,!1,i),this.callback=e}handleEvent(t,e,i,s){if(null===this.callback)return this.clickStateChanged=!1,this;if(this.handleClickEvent(t,s,[0,e,0,i]),this.clickStateChanged&&this.wasClick)try{this.callback()}catch(t){console.error("Exception in Icon callback",t)}return this}}class R extends I{constructor(){super(...arguments),this.backgroundProperty=i.BackgroundFill,this._forced=!1}updateBackground(){var t;if(this._forced)this.backgroundProperty=i.PrimaryFill;else switch(this.clickState){case o.Hold:this.backgroundProperty=i.AccentFill;break;case o.Hover:this.backgroundProperty=i.BackgroundGlowFill;break;default:this.backgroundProperty=i.BackgroundFill}const s=this.theme.getFill(this.backgroundProperty),n=new e(new Map([[i.CanvasFill,s]]),null===(t=this.inheritedTheme)||void 0===t?void 0:t.fallback);super.inheritTheme(n),this._backgroundDirty=!0}set forced(t){t!==this._forced&&(this._forced=t,this.updateBackground())}get forced(){return this._forced}setThemeOverride(t){if(this._backgroundDirty=!0,null===t)return super.setThemeOverride(null);try{const s=t.getFill(this.backgroundProperty),n=new e(new Map([[i.CanvasFill,s]]));super.setThemeOverride(n)}catch(t){return super.setThemeOverride(null)}}inheritTheme(t){this._backgroundDirty=!0;const s=t.getFill(this.backgroundProperty),n=new e(new Map([[i.CanvasFill,s]]),t);super.inheritTheme(n)}handlePostLayoutUpdate(t){super.handlePostLayoutUpdate(t),this._dirty&&(this._backgroundDirty=!0)}handleEvent(t,e,i,s){const n=super.handleEvent(t,e,i,s);return this.clickStateChanged&&this.updateBackground(),n}}class W extends y{constructor(){super(...arguments),this._flexRatio=1,this._mainBasis=0,this._crossBasis=0,this._internalMainBasis=0,this._internalCrossBasis=0,this._effectiveMainBasis=0,this._effectiveCrossBasis=0,this._vertical=null,this.lastVertical=!0}get flexRatio(){return this._flexRatio}set flexRatio(t){this._flexRatio!==t&&(this._flexRatio=t,this._layoutDirty=!0)}get vertical(){return this._vertical}set vertical(t){this._vertical!==t&&(this._vertical=t,this._layoutDirty=!0)}get mainBasis(){return this._mainBasis}set mainBasis(t){this._mainBasis!==t&&(this._mainBasis=t,this.updateEffectiveMainBasis())}get crossBasis(){return this._crossBasis}set crossBasis(t){this._crossBasis!==t&&(this._crossBasis=t,this.updateEffectiveCrossBasis())}get internalMainBasis(){return this._internalMainBasis}set internalMainBasis(t){this._internalMainBasis!==t&&(this._internalMainBasis=t,this.updateEffectiveMainBasis())}get internalCrossBasis(){return this._internalCrossBasis}set internalCrossBasis(t){this._internalCrossBasis!==t&&(this._internalCrossBasis=t,this.updateEffectiveCrossBasis())}updateEffectiveMainBasis(){const t=Math.max(this._mainBasis,this._internalMainBasis);this._effectiveMainBasis!==t&&(this._effectiveMainBasis=t,this._layoutDirty=!0)}updateEffectiveCrossBasis(){const t=Math.max(this._crossBasis,this._internalCrossBasis);this._effectiveCrossBasis!==t&&(this._effectiveCrossBasis=t,this._layoutDirty=!0)}handlePopulateLayout(t){var e;const i=null!==(e=this.vertical)&&void 0!==e?e:t.vertical;this.lastVertical=i,t.vertical===i?i?(this._flexRatio>0&&(t.vFlex+=this._flexRatio),t.vBasis+=this._effectiveMainBasis,this._effectiveCrossBasis>t.hBasis&&(t.hBasis=this._effectiveCrossBasis)):(this._flexRatio>0&&(t.hFlex+=this._flexRatio),t.hBasis+=this._effectiveMainBasis,this._effectiveCrossBasis>t.vBasis&&(t.vBasis=this._effectiveCrossBasis)):i?(t.hBasis+=this._effectiveCrossBasis,this._effectiveMainBasis>t.vBasis&&(t.vBasis=this._effectiveMainBasis)):(t.vBasis+=this._effectiveCrossBasis,this._effectiveMainBasis>t.hBasis&&(t.hBasis=this._effectiveMainBasis))}handleResolveLayout(t){var e;let i;const s=null!==(e=this.vertical)&&void 0!==e?e:t.vertical;t.vertical!==s?i=this._flexRatio>0?s?t.maxHeight:t.maxWidth:this._effectiveMainBasis:this._flexRatio>0?(i=s?(t.maxHeight-t.vBasis)*this._flexRatio/t.vFlex:(t.maxWidth-t.hBasis)*this._flexRatio/t.hFlex,i=this._effectiveMainBasis+Math.max(0,i)):i=this._effectiveMainBasis,s?(this.resolvedWidth=this._effectiveCrossBasis,this.resolvedHeight=i):(this.resolvedWidth=i,this.resolvedHeight=this._effectiveCrossBasis)}}let O=null;const U=new Map;function A(t,e){if(""===t)return[0,0,0];if(null===O){const t=document.createElement("canvas");if(O=t.getContext("2d"),null===O)throw"Failed to get canvas context"}let i;if(O.font=e,U.has(e))i=U.get(e);else{const t=O.measureText("-");i=Math.abs(t.actualBoundingBoxLeft)+Math.abs(t.actualBoundingBoxRight),U.set(e,i)}const s=O.measureText("-"+t+"-");return[Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight)-2*i,Math.abs(s.actualBoundingBoxAscent),Math.abs(s.actualBoundingBoxDescent)]}class V extends y{constructor(){super(...arguments),this._text="",this._font="",this._minLabelWidth=0,this._minLabelAscent=0,this._minLabelDescent=0,this._labelWidth=0,this._labelAscent=0,this._labelDescent=0,this.labelDirty=!0}updateTextDims(){if(!this.labelDirty)return;const[t,e,i]=A(this._text,this._font);this._labelWidth=Math.max(t,this._minLabelWidth),this._labelAscent=Math.max(e,this._minLabelAscent),this._labelDescent=Math.max(i,this._minLabelDescent),this.labelDirty=!1}findOffsetFromIndex(t){return t<=0?0:A(this._text.substring(0,t),this._font)[0]}findIndexOffsetFromOffset(t){if(t<=0)return[0,0];let e=0,i="",s=0;for(const n of this._text){i+=n;const r=A(i,this._font)[0];if(t<(r+s)/2)return[e,s];e++,s=r}return[this._text.length,s]}setLabelDirty(){this.labelDirty=!0,this._layoutDirty=!0}get labelWidth(){return this.updateTextDims(),this._labelWidth}get labelAscent(){return this.updateTextDims(),this._labelAscent}get labelDescent(){return this.updateTextDims(),this._labelDescent}get labelHeight(){return this.updateTextDims(),this._labelAscent+this._labelDescent}setText(t){this._text!==t&&(this._text=t,this._dirty=!0,this.setLabelDirty())}setFont(t){this._font!==t&&(this._font=t,this._dirty=!0,this.setLabelDirty())}setMinLabelWidth(t){this._minLabelWidth!==t&&(this._minLabelWidth=t,this.setLabelDirty())}setMinLabelAscent(t){this._minLabelAscent!==t&&(this._minLabelAscent=t,this.setLabelDirty())}setMinLabelDescent(t){this._minLabelDescent!==t&&(this._minLabelDescent=t,this.setLabelDirty())}}class z extends(F(W,V)){constructor(t,e=null){super(e,!0,!1),this.textGetter=null,this.text=t,this.flexRatio=0,this.vertical=!1}set text(t){t instanceof Function?this.textGetter=t:(this.textGetter=null,this.setText(t))}get text(){return null!==this.textGetter?this.textGetter:this._text}get currentText(){return this._text}handlePreLayoutUpdate(t){null!==this.textGetter&&this.setText(this.textGetter()),this.setFont(this.theme.getFont(i.BodyTextFont)),this.setMinLabelWidth(this.theme.getSize(i.LabelMinWidth)),this.setMinLabelAscent(this.theme.getSize(i.LabelMinAscent)),this.setMinLabelDescent(this.theme.getSize(i.LabelMinDescent)),this.internalMainBasis=this.labelWidth,this.internalCrossBasis=this.labelHeight}handlePainting(t,e,s,n,r){r.font=this._font,r.fillStyle=this.theme.getFill(i.BodyTextFill),r.fillText(this._text,t,e+n-this.labelDescent)}}class N extends R{constructor(t,e=null,i=null){super(new z(t,i),e,i)}}class Q extends N{constructor(t,e,i,s=null){super(t,(()=>i.callback(e)),s)}}class K extends Q{constructor(t,e=null){super("Backspace","Backspace",t,e)}}class G extends Q{constructor(t,e=null){super("Esc","Escape",t,e)}}class j extends Q{constructor(t,e=null){super("Enter","Enter",t,e)}}class $ extends N{constructor(t,e=null){super("Shift",(()=>{t.shift=!t.shift,this.forced=t.shift,t.callback("Shift")}),e),this.forced=t.shift}}class q extends Q{constructor(t,e=null){super("Space"," ",t,e)}}class X extends M{add(t){if(Array.isArray(t))for(const e of t)this._children.push(e);else this._children.push(t);return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}remove(t){if(Array.isArray(t))for(const e of t){const t=this._children.indexOf(e);-1!==t&&this._children.splice(t,1)}else{const e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1)}return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}clearChildren(){return this._children.length=0,this._layoutDirty=!0,this._dirty=!0,this}}class Y extends X{constructor(t,e=null){super([],e,!1,!0),this.backgroundDirty=!0,this.innerContext=null,this.vertical=t}handleEvent(t,e,s,n){const r=this.theme.getSize(i.ContainerSpacing);for(const i of this.children){if(!i.enabled)continue;const l=this.vertical?i.dimensions[1]:i.dimensions[0];let o,h;this.vertical?(o=e,h=l):(o=l,h=s);const a=i.dispatchEvent(t,o,h,n);if(null!==a)return a;t instanceof f&&(t=this.vertical?t.correctOffset(0,l+r):t.correctOffset(l+r,0))}return null}handlePreLayoutUpdate(t){let e=!1;for(const i of this.children)i.preLayoutUpdate(t),i.layoutDirty&&(e=!0);e&&this.forceLayoutDirty()}handlePostLayoutUpdate(t){for(const e of this.children)e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}forceLayoutDirty(){this.backgroundDirty=!0,super.forceLayoutDirty()}handlePopulateLayout(t){const e=this.vertical===t.vertical;let s;e?s=t:(this.innerContext=new u(t.maxWidth,t.maxHeight,this.vertical),s=this.innerContext);for(const t of this.children)t.populateLayout(s);const n=this.childCount,r=this.theme.getSize(i.ContainerSpacing);if(n>1&&r>0){const t=r*(n-1);s.vertical?s.vBasis+=t:s.hBasis+=t}e||t.addBasis(s.hBasis,s.vBasis),s.hBasis>t.maxWidth&&(t.maxWidth=s.hBasis),s.vBasis>t.maxHeight&&(t.maxHeight=s.vBasis)}handleResolveLayout(t){const e=this.vertical===t.vertical;let s;if(e)s=t;else{if(s=this.innerContext,null===s)throw"Unexpected null innerContext";t.maxWidth>s.maxWidth&&(s.maxWidth=t.maxWidth),t.maxHeight>s.maxHeight&&(s.maxHeight=t.maxHeight)}let n=0,r=0,l=0,o=0,h=0;for(const t of this.children){if(!t.enabled){t.resolveLayout(s);continue}h++;const[e,i]=t.dimensions;t.resolveLayout(s);const[a,c]=t.dimensions;if(isNaN(a)||isNaN(c)||a<0||c<0)throw console.error("Child resolved to invalid dimensions:",a,c,t),new Error("Child resolved to invalid dimensions");this.vertical?c!==i&&(s.sizeChanged=!0):a!==e&&(s.sizeChanged=!0),l+=a,a>n&&(n=a),o+=c,c>r&&(r=c)}!e&&s.sizeChanged&&(t.sizeChanged=!0),this.innerContext=null;const a=this.theme.getSize(i.ContainerSpacing);let c=0;h>1&&a>0&&(c=a*(h-1)),this.vertical?(this.resolvedWidth=n,this.resolvedHeight=o+c):(this.resolvedWidth=l+c,this.resolvedHeight=r)}handlePainting(t,e,s,n,r){const l=this.theme.getSize(i.ContainerSpacing);this.backgroundDirty&&l>0&&this.clear(t,e,s,n,r),this.backgroundDirty=!1;const o=this.vertical?e+n:t+s;for(const i of this.children){if(!i.enabled)continue;let h,a,c=!1;this.vertical?(h=s,a=i.dimensions[1],e+a>o&&(c=!0,a=o-e)):(h=i.dimensions[0],a=n,t+h>o&&(c=!0,h=o-t)),i.paint(t,e,h,a,r),c&&console.warn("MultiContainer overflow, children may be painted with 0 length"),this.vertical?e+=a+l:t+=h+l}}}class J extends Y{constructor(t=null){super(!0,t)}}class Z extends N{constructor(t,e=null,i,s=null){function n(){return i.shift?null===e?t:e:t}null===e&&(e=t),super(n,(()=>i.callback(n())),s)}}class tt extends Y{constructor(t=null){super(!1,t)}}class et extends tt{constructor(t,e,i=null){super(i);for(const s of t)if("function"==typeof s){const t=s;this.add(t(e,i))}else{if("string"!=typeof s[0]||"string"!=typeof s[1])throw new Error(`Unknown virtual key row template format for entry: ${s}`);{const t=s[0],n=s[1];for(let s=0;s<t.length;s++){let r=null;s<n.length&&(r=n[s]),this.add(new Z(t[s],r,e,i))}}}}}const it=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],function(t,e){return new j(t,e)}],[function(t,e){return new $(t,e)},["zxcvbnm,./","ZXCVBNM<>?"]],[function(t,e){return new K(t,e)},function(t,e){return new q(t,e)},function(t,e){return new G(t,e)}]];class st extends J{constructor(t,e=it,i=null){super(i);const s={callback:e=>{t.keyPress(e)},shift:!1};for(const t of e)this.add(new et(t,s,i))}}class nt extends v{constructor(t,e=it,i=n){super(new st(t,e),i),this.keyboardDriver=t}update(){this.enabled=null!==this.keyboardDriver.getFocusedRoot(),super.update()}}class rt extends p{constructor(t,e=it,i=null,s=n){super(new st(t,e),i,s),this.keyboardDriver=t}updateVisibility(){this.enabled=null!==this.keyboardDriver.getFocusedRoot()}}class lt extends h{constructor(t,e){super(e,l.Keyboard,!0),this.key=t}}class ot extends lt{cloneWithTarget(t){return new ot(this.key,t)}}class ht extends lt{cloneWithTarget(t){return new ht(this.key,t)}}class at{constructor(){this.eventQueues=new Map,this.keysDown=new Set,this.focus=null}getEventQueue(t){if(null===t)return null;const e=this.eventQueues.get(t);return void 0===e?null:e}changeFocusedRoot(t){null!==this.focus&&this.focus.clearFocus(l.Keyboard),this.focus=t,this.keysDown.clear()}getFocusedRoot(){return this.focus}clearFocus(){this.changeFocusedRoot(null)}keyDown(t){this.keysDown.add(t);const e=this.getEventQueue(this.focus);null!==e&&e.push(new ht(t,null))}keyUp(t){if(this.keysDown.delete(t)){const e=this.getEventQueue(this.focus);null!==e&&e.push(new ot(t,null))}}keyPress(t){const e=this.isKeyDown(t);this.keyDown(t),e||this.keyUp(t)}isKeyDown(t){return this.keysDown.has(t)}onEnable(t){this.eventQueues.has(t)||this.eventQueues.set(t,[])}onDisable(t){this.eventQueues.has(t)&&(this.eventQueues.delete(t),t===this.focus&&this.clearFocus())}update(t){const e=this.getEventQueue(t);if(null!==e){for(const i of e)t.dispatchEvent(i);e.length=0}}onFocusChanged(t,e,i){e===l.Keyboard&&(t==this.focus?null===i&&this.clearFocus():null!==i&&this.changeFocusedRoot(t))}onFocusCapturerChanged(t,e,i,s){}}class ct extends at{constructor(){super(...arguments),this.domElems=new Set}bindDOMElem(t,e=!0){this.domElems.has(t)||(this.domElems.add(t),e&&(t.addEventListener("keydown",(t=>{t.preventDefault(),this.keyDown(t.key)})),t.addEventListener("keyup",(t=>{t.preventDefault(),this.keyUp(t.key)}))),t.addEventListener("blur",(t=>{this.shouldClearFocus(t.relatedTarget)&&this.clearFocus()})))}shouldClearFocus(t){return null===t||!this.domElems.has(t)}}class ut extends f{constructor(t,e,i=null){super(t,e,i,l.Pointer)}correctOffset(t,e){return new ut(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new ut(this.x,this.y,t)}}var dt;!function(t){t[t.None=0]="None",t[t.Hovering=1]="Hovering",t[t.Pressing=2]="Pressing"}(dt||(dt={}));class pt{constructor(){this.states=new Map,this.nextPointerID=0,this.hints=new Map}unassignPointer(t,e){null!==e.pointer&&this.setPointerHint(e.pointer,dt.None),e.pointer=null,e.hovering&&e.eventQueue.push(new a(t.getFocusCapturer(l.Pointer))),e.hovering=!1,e.pressing=!1}registerPointer(){const t=this.nextPointerID++;return this.setPointerHint(t,dt.None),t}unregisterPointer(t){for(const[e,i]of this.states)i.pointer===t&&this.unassignPointer(e,i);this.hints.delete(t)}movePointer(t,e,i,s,n=null){const r=this.states.get(t);if(void 0===r)return;const o=null===r.pointer;o&&(r.pointer=e),null===n&&(n=r.pressing);const h=r.pointer===e;if(!h||o)for(const[i,s]of this.states)i!==t&&s.pointer===e&&this.unassignPointer(t,r);if(!h&&(!n||r.pressing))return;const[c,u]=t.dimensions,d=i*c,p=s*u;let v;n!==r.pressing?(v=n?new m(d,p):new g(d,p),r.pressing=n,n&&r.pointer!==e&&null!==r.pointer&&(r.eventQueue.push(new a(t.getFocusCapturer(l.Pointer))),this.setPointerHint(r.pointer,dt.None),r.pointer=e)):v=new ut(d,p),r.eventQueue.push(v),r.hovering=!0,r.pressing?this.setPointerHint(e,dt.Pressing):this.setPointerHint(e,dt.Hovering)}leavePointer(t,e){const i=this.states.get(t);void 0!==i&&i.hovering&&i.pointer==e&&(i.hovering=!1,i.pressing=!1,i.eventQueue.push(new a(t.getFocusCapturer(l.Pointer))),this.setPointerHint(e,dt.None))}leaveAnyPointer(t){for(const e of this.states.keys())this.leavePointer(e,t)}setPointerHint(t,e){return this.hints.get(t)!==e&&(this.hints.set(t,e),!0)}getPointerHint(t){var e;return null!==(e=this.hints.get(t))&&void 0!==e?e:dt.None}onEnable(t){this.states.set(t,{eventQueue:[],pointer:null,pressing:!1,hovering:!1})}onDisable(t){t.dispatchEvent(new a);const e=this.states.get(t);void 0!==e&&null!==e.pointer&&this.setPointerHint(e.pointer,dt.None),this.states.delete(t)}update(t){const e=this.states.get(t);if(void 0!==e){for(const i of e.eventQueue)t.dispatchEvent(i);e.eventQueue.length=0}}onFocusChanged(t,e,i){}onFocusCapturerChanged(t,e,i,s){}}function vt(t,e){const i=e.getBoundingClientRect();return[(t.clientX-i.left)/i.width,(t.clientY-i.top)/i.height]}class ft extends pt{constructor(){super(),this.domElems=new WeakMap,this.mousePointerID=this.registerPointer()}bindDOMElem(t,e){let i=this.domElems.get(t);void 0!==i?this.removeListeners(i):(i={domElem:e,pointermoveListen:null,pointerdownListen:null,pointerupListen:null,pointerleaveListen:null},this.domElems.set(t,i)),t.enabled&&this.addListeners(t,i)}addListeners(t,e){const i=e.domElem;e.pointermoveListen=e=>{e.isPrimary&&this.movePointer(t,this.mousePointerID,...vt(e,i))},e.pointerdownListen=e=>{e.isPrimary&&this.movePointer(t,this.mousePointerID,...vt(e,i),!0)},e.pointerupListen=e=>{e.isPrimary&&this.movePointer(t,this.mousePointerID,...vt(e,i),!1)},e.pointerleaveListen=e=>{e.isPrimary&&this.leavePointer(t,this.mousePointerID)},i.addEventListener("pointermove",e.pointermoveListen),i.addEventListener("pointerdown",e.pointerdownListen),i.addEventListener("pointerup",e.pointerupListen),i.addEventListener("pointerleave",e.pointerleaveListen)}removeListeners(t){null!==t.pointermoveListen&&(t.domElem.removeEventListener("pointermove",t.pointermoveListen),t.pointermoveListen=null),null!==t.pointerdownListen&&(t.domElem.removeEventListener("pointerdown",t.pointerdownListen),t.pointerdownListen=null),null!==t.pointerupListen&&(t.domElem.removeEventListener("pointerup",t.pointerupListen),t.pointerupListen=null),null!==t.pointerleaveListen&&(t.domElem.removeEventListener("pointerleave",t.pointerleaveListen),t.pointerleaveListen=null)}onEnable(t){super.onEnable(t);const e=this.domElems.get(t);void 0!==e&&this.addListeners(t,e)}onDisable(t){super.onDisable(t);const e=this.domElems.get(t);void 0!==e&&this.removeListeners(e)}}class gt extends pt{constructor(){super(...arguments),this.sources=new Set}handlePointerRay(t,e,i,s){const[n,r,l]=this.castRay(i,s);null===n?this.leaveAnyPointer(t):this.movePointer(n,t,r,l,e)}addSource(t){this.sources.has(t)||(t.setRayPointerDriver(this),this.sources.add(t))}setPointerHint(t,e){const i=super.setPointerHint(t,e);for(const i of this.sources)i.onPointerHintChanged(t,e);return i}}class mt extends y{constructor(){super(...arguments),this._boxWidth=0,this._boxHeight=0}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth!==t&&(this._boxWidth=t,this._layoutDirty=!0)}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight!==t&&(this._boxHeight=t,this._layoutDirty=!0)}handlePopulateLayout(t){t.addBasis(this._boxWidth,this._boxHeight)}handleResolveLayout(t){this.resolvedWidth=this._boxWidth,this.resolvedHeight=this._boxHeight}}class yt extends y{constructor(){super(...arguments),this.callback=null}get value(){if(void 0===this._value)throw"Value has not been set yet";return this._value}set value(t){this.setValue(t)}setValue(t,e=!0){if(this._value!==t&&(this._value=t,this._dirty=!0,e&&null!==this.callback))try{this.callback(t)}catch(t){console.error("Exception in Variable callback",t)}}}class xt extends yt{}class bt extends yt{}class _t extends yt{}class Ct extends e{constructor(t){super(new Map,t)}getFill(t){return super.getFill(t),"#"+Math.floor(16777215*Math.random()).toString(16)}}function wt(t,e,i=null){return s=>{let n=!0,r=s;for(const i of t)if([n,r]=i(r),!n)return[!1,e];if(null!==i)try{i(r)}catch(t){console.warn("Exception in CompositeValidator callback:",t)}return[!0,r]}}function Bt(t){return[!0,t]}function Lt(t=null){return null===t?Bt:e=>(t(e),[!0,e])}const Pt=/^-?(\.\d+|\d+(\.(\d+)?)?)(e\d+)?$/;function kt(t){return Pt.test(t)?[!0,parseFloat(t)]:[!1,NaN]}const Dt=/^-?\d+$/;function St(t){return Dt.test(t)?[!0,parseInt(t)]:[!1,NaN]}function Ft(t,e){return i=>i<t||i>e?[!1,i]:[!0,i]}class Tt extends(F(W,V,_t)){constructor(t,e="",i=null){super(i,!1,!1),this.blinkStart=0,this.blinkWasOn=null,this.cursorPos=0,this.cursorOffset=0,this.cursorOffsetDirty=!1,this._editingEnabled=!0,this._hideText=!1,this.setValue(e,!1),[this._valid,this._validValue]=t(e),this.callback=e=>{const[i,s]=t(e);i&&(this._validValue=s),i!==this._valid&&(this._valid=i,this._dirty=!0)},this.vertical=!1}get blinkOn(){if(0===this.blinkStart)return null;const t=this.theme.getSize(i.BlinkRate);return 0===Math.trunc((Date.now()-this.blinkStart)/(500*t)%2)}get editingEnabled(){return this._editingEnabled}set editingEnabled(t){this._editingEnabled!==t&&(this._editingEnabled=t,t||(this.blinkStart=0,this.moveCursorTo(0)),this._dirty=!0)}get hideText(){return this._hideText}set hideText(t){this._hideText!==t&&(this._hideText=t,this.cursorOffsetDirty=!0,this._dirty=!0)}get text(){return this._hideText?"●".repeat(this.value.length):this.value}get valid(){return this._valid}get validValue(){return this._validValue}moveCursorTo(t){this.cursorPos=Math.min(Math.max(t,0),this.value.length),this.cursorOffsetDirty=!0,this._dirty=!0}moveCursor(t){this.moveCursorTo(this.cursorPos+t)}insertText(t){this.value=this.value.substring(0,this.cursorPos)+t+this.value.substring(this.cursorPos),this.moveCursor(t.length)}deleteText(t){t>0?this.value=this.value.substring(0,this.cursorPos)+this.value.substring(this.cursorPos+t):t<0&&(this.value=this.value.substring(0,this.cursorPos+t)+this.value.substring(this.cursorPos),this.moveCursor(t))}onFocusDropped(t,e){t===l.Keyboard&&(this.blinkStart=0)}handleEvent(t,e,i,s){if(!this._editingEnabled)return this;if(t instanceof f)return s.pointerStyle="text",t instanceof m?([this.cursorPos,this.cursorOffset]=this.findIndexOffsetFromOffset(t.x),this.blinkStart=Date.now(),this._dirty=!0,s.requestFocus(l.Keyboard,this)):t instanceof g&&s.hasMobileTextInput&&s.getTextInput(this.value).then((t=>{null!==t&&this.value!==t&&(this.value=t,this.moveCursorTo(t.length))})),this;if(t instanceof ht){if(1===t.key.length)this.insertText(t.key);else if("Backspace"===t.key)this.deleteText(-1);else if("Delete"===t.key)this.deleteText(1);else if("ArrowLeft"===t.key)this.moveCursor(-1);else if("ArrowRight"===t.key)this.moveCursor(1);else if("Home"===t.key)this.moveCursorTo(0);else{if("End"!==t.key)return"Escape"===t.key?(s.dropFocus(l.Keyboard,this),this):this;this.moveCursorTo(this.value.length)}this.blinkStart=Date.now()}return this}handlePreLayoutUpdate(t){this.editingEnabled||t.dropFocus(l.Keyboard,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0);const e=this.theme.getSize(i.CursorPadding)+this.theme.getSize(i.CursorThickness);this.setText(this.text),this.setFont(this.theme.getFont(i.InputTextFont)),this.setMinLabelWidth(this.theme.getSize(i.InputTextMinWidth)-e),this.setMinLabelAscent(this.theme.getSize(i.InputTextMinAscent)),this.setMinLabelDescent(this.theme.getSize(i.InputTextMinDescent)),this.cursorOffsetDirty&&(this.cursorOffset=this.findOffsetFromIndex(this.cursorPos),this.cursorOffsetDirty=!1),this.flexRatio=this.theme.getSize(i.InputTextFlexRatio),this.internalMainBasis=this.labelWidth+e,this.internalCrossBasis=this.labelHeight}handlePainting(t,e,s,n,r){r.fillStyle=this.theme.getFill(i.InputBackgroundFill),r.fillRect(t,e,s,n),r.font=this.theme.getFont(i.InputTextFont),this._editingEnabled?this._valid?r.fillStyle=this.theme.getFill(i.InputTextFill):r.fillStyle=this.theme.getFill(i.InputTextFillInvalid):r.fillStyle=this.theme.getFill(i.InputTextFillDisabled),r.fillText(this.text,t,e+n-this.labelDescent);const l=this.blinkOn;if(this.blinkWasOn=l,!l)return;const o=this.theme.getSize(i.CursorPadding),h=this.theme.getSize(i.CursorThickness);r.fillRect(t+this.cursorOffset,e+o,h,n-2*o)}}class Mt extends Tt{constructor(t=null,e="",i=null){super(Lt(t),e,i)}}class Et extends H{constructor(t,e=null){super(t,!0,e)}}class Ht extends Et{constructor(t){super(t,new e(new Map([[i.ContainerAlignment,{horizontal:s.Center,vertical:s.Center}],[i.ContainerPadding,{left:0,right:0,top:0,bottom:0}]])))}}class It extends(F(mt,x,xt)){constructor(t=null,e=!1,i=null){super(i,!0,!1),this.callback=t,this.setValue(e,!1)}getBoxRect(t,e,s,n){const r=this.theme.getSize(i.CheckboxLength),l=Math.min(r,s,n),o=t+(s-l)/2,h=e+(n-l)/2;return[o,o+l,h,h+l]}handleEvent(t,e,i,s){const n=this.getBoxRect(0,0,e,i);return this.handleClickEvent(t,s,n),this.clickStateChanged&&this.wasClick&&(this.value=!this.value),this}handlePreLayoutUpdate(t){const e=this.theme.getSize(i.CheckboxLength);this.boxWidth=e,this.boxHeight=e}handlePainting(t,e,s,n,r){const[l,h,a,c]=this.getBoxRect(t,e,s,n),u=h-l,d=[o.Hover,o.Hold].includes(this.clickState);if(r.fillStyle=d?this.theme.getFill(i.BackgroundGlowFill):this.theme.getFill(i.BackgroundFill),r.fillRect(l,a,u,u),this.value){r.fillStyle=d?this.theme.getFill(i.AccentFill):this.theme.getFill(i.PrimaryFill);const t=this.theme.getSize(i.CheckboxInnerPadding),e=u-2*t;e<=0?r.fillRect(l,a,u,u):r.fillRect(l+t,a+t,e,e)}}}class Rt extends mt{constructor(t,e=null,i=null,s=null,n=null){super(n,!0,!1),this.lastSrc=null,this._rotation=0,this._image=t,this.width=e,this.height=i,this.viewBox=s,this.updateDimensions()}updateDimensions(){let t=this.width;null===t&&(t=null===this.viewBox?this._image.width:this.viewBox[2]),this.boxWidth!==t&&(this.boxWidth=t);let e=this.height;null===e&&(e=null===this.viewBox?this._image.height:this.viewBox[3]),this.boxHeight!==e&&(this.boxHeight=e)}set image(t){t!==this._image&&(this._image=t,this.lastSrc=null)}get image(){return this._image}getIconRect(t,e,i,s){const n=i/this.boxWidth,r=s/this.boxHeight,l=Math.min(n,r),o=this.boxWidth*l,h=this.boxHeight*l;return[t+(i-o)/2,e+(s-h)/2,o,h]}handlePreLayoutUpdate(t){var e,i;(null===(e=this._image)||void 0===e?void 0:e.src)!==this.lastSrc&&(null===(i=this._image)||void 0===i?void 0:i.complete)&&(this._dirty=!0),this.updateDimensions()}set rotation(t){t!==this._rotation&&(this._rotation=t,this._dirty=!0)}get rotation(){return this._rotation}handlePainting(t,e,i,s,n){var r;if(!(null===(r=this._image)||void 0===r?void 0:r.complete))return void(this.lastSrc=null);this.lastSrc=this._image.src;const[l,o,h,a]=this.getIconRect(t,e,i,s);let c=l,u=o;0!==this.rotation&&(n.save(),n.translate(l+h/2,o+a/2),c=-h/2,u=-a/2,n.rotate(this.rotation)),null===this.viewBox?n.drawImage(this._image,c,u,h,a):n.drawImage(this._image,...this.viewBox,c,u,h,a),0!==this.rotation&&n.restore()}}class Wt extends W{constructor(t=1,e=0,i=0,s=null,n=null){super(n,!0,!1),this.flexRatio=t,this.mainBasis=e,this.crossBasis=i,this.vertical=s}}class Ot extends tt{constructor(t,e=null,i=!1,s=null){super(s),this.add([new z(t,s),new Wt(1,0,0,!1,s),new It(e,i,s)])}}class Ut extends Et{constructor(t){super(t,new e(new Map([[i.ContainerAlignment,{horizontal:s.Center,vertical:s.Center}]])))}}class At extends E{constructor(t,e=null){super(t,e,!1,!0)}handleEvent(t,e,i,s){return this.child.dispatchEvent(t,e,i,s)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handlePopulateLayout(t){this.child.populateLayout(t)}handleResolveLayout(t){const e=this.child;e.resolveLayout(t),[this.resolvedWidth,this.resolvedHeight]=e.dimensions}handlePainting(t,e,i,s,n){this.child.paint(t,e,i,s,n)}}class Vt extends(F(E,W)){constructor(t,e=!1,i=!1,s=null){super(t,s,!1,!0),this._offset=[0,0],this.lastChildLayoutCtx=null,this.maxDimensions=[0,0],this.lastViewportDims=[0,0],this.viewport=new d,this.mainBasisTied=e,this.crossBasisTied=i}get canvasDimensions(){return this.viewport.canvasDimensions}get offset(){return[...this._offset]}set offset(t){this._offset[0]===t[0]&&this._offset[1]===t[1]||(this._offset[0]=t[0],this._offset[1]=t[1],this._dirty=!0)}getChildMainBasis(t){if(null===this.lastChildLayoutCtx)return 0;const e=t?this.lastChildLayoutCtx.vBasis:this.lastChildLayoutCtx.hBasis;return isNaN(e)?0:e}getChildCrossBasis(t){return this.getChildMainBasis(!t)}getMaxMainBasis(t){return t?this.maxDimensions[1]:this.maxDimensions[0]}getMaxCrossBasis(t){return this.getMaxMainBasis(!t)}handleEvent(t,e,i,s){if(null===t.target&&!(t instanceof f))return null;const[n,r]=this.child.dimensions,l=this.offset[0],o=l+n,h=this.offset[1],a=h+r;if(t instanceof f){if(null===t.target){if(t.x<l)return null;if(t.x>=o)return null;if(t.y<h)return null;if(t.y>=a)return null}t=t.correctOffset(l,h)}return this.child.dispatchEvent(t,o-l,a-h,s)}handlePreLayoutUpdate(t){let e=this.vertical;null===e&&(e=!0);const i=this.child;if(e!==this.viewport.vertical&&(this.viewport.vertical=e,i.forceLayoutDirty()),i.preLayoutUpdate(t),i.layoutDirty){if(this._layoutDirty=!0,this.lastChildLayoutCtx=this.viewport.populateChildsLayout(i),this.mainBasisTied){let t=this.getChildMainBasis(e);const i=this.getMaxMainBasis(e);0!==i&&t>i&&(t=i),this.internalMainBasis=t}else this.internalMainBasis=0;if(this.crossBasisTied){let t=this.getChildCrossBasis(e);const i=this.getMaxCrossBasis(e);0!==i&&t>i&&(t=i),this.internalCrossBasis=t}else this.internalCrossBasis=0}}handlePostLayoutUpdate(t){const e=this.child;if(null!==this.lastChildLayoutCtx){let[t,i]=[...this.maxDimensions];(this.viewport.vertical?this.crossBasisTied:this.mainBasisTied)&&(0===t||this.resolvedWidth<t)&&(t=this.resolvedWidth),(this.viewport.vertical?this.mainBasisTied:this.crossBasisTied)&&(0===i||this.resolvedHeight<i)&&(i=this.resolvedHeight),this.viewport.maxDimensions=[t,i],this.lastChildLayoutCtx.maxWidth=t,this.lastChildLayoutCtx.maxHeight=i,this.viewport.resolveChildsLayout(e,this.lastChildLayoutCtx),this.lastChildLayoutCtx=null}e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handlePainting(t,e,s,n,r){this.lastViewportDims=[s,n],this.viewport.paintToCanvas(this.child),r.save();const l=new Path2D;l.rect(Math.trunc(t),Math.trunc(e),Math.ceil(s),Math.ceil(n)),r.clip(l),r.globalCompositeOperation="copy",r.fillStyle=this.theme.getFill(i.CanvasFill),r.fill(l);const[o,h]=this.child.dimensions,[a,c]=this.offset,u=t+a,d=e+c,p=new Path2D;p.rect(Math.trunc(u),Math.trunc(d),Math.ceil(o),Math.ceil(h)),r.clip(p),r.drawImage(this.viewport.canvas,0,0,o,h,u,d,o,h),r.restore()}}class zt extends(F(W,x,bt)){constructor(t=null,e=100,i=100,s=0,n=null){super(n,!0,!1),this.callback=t,this.setValue(s,!1),this._end=e,this._barLength=i,this.dragValue=s}get end(){return this._end}set end(t){this._end!==t&&(this._end=t,this._dirty=!0)}get barLength(){return this._barLength}set barLength(t){this._barLength!==t&&(this._barLength=t,this._dirty=!0)}setValue(t,e=!0){super.setValue(Math.max(Math.min(this._end-this._barLength,t),0),e)}getBarRect(t,e,i,s){if(this.lastVertical){const n=Math.min(this.crossBasis,i),r=t+(i-n)/2;return[r,r+n,e,e+s]}{const n=Math.min(this.crossBasis,s),r=e+(s-n)/2;return[t,t+i,r,r+n]}}handleEvent(t,e,i,s){if(this.handleClickEvent(t,s,this.getBarRect(0,0,e,i)),this.clickState==o.Hold&&null!==this.pointerPos)if(this.clickStateChanged){let t;t=this.lastVertical?this.pointerPos[1]*this._end:this.pointerPos[0]*this._end;let e=this.value;null===e&&(e=0),(t<e||t>=e+this._barLength)&&(e=t-this._barLength/2,this.value=e),this.dragValue=e}else if(null!==this.startingPointerPos){let t;t=this.lastVertical?this.pointerPos[1]-this.startingPointerPos[1]:this.pointerPos[0]-this.startingPointerPos[0],this.value=this.dragValue+t*this._end}return this.clickStateChanged&&(this._dirty=!0),this}handlePreLayoutUpdate(t){this.flexRatio=0,this.crossBasis=this.theme.getSize(i.ScrollBarThickness)}handlePainting(t,e,s,n,r){const[l,h,a,c]=this.getBarRect(t,e,s,n),[u,d]=[h-l,c-a];let p=this.value;null===p&&(p=0);const v=p/this._end,f=this._barLength/this._end;r.fillStyle=this.theme.getFill(i.BackgroundFill),r.fillRect(l,a,u,d);if([o.Hover,o.Hold].includes(this.clickState)?r.fillStyle=this.theme.getFill(i.AccentFill):r.fillStyle=this.theme.getFill(i.PrimaryFill),this.lastVertical){let t=f*d;t>d&&(t=d),r.fillRect(l,a+v*d,u,t)}else{let t=f*u;t>u&&(t=u),r.fillRect(l+v*u,a,t,d)}}}class Nt extends At{constructor(t,e,i=!1,s=!1,n=null){super(new J(n),n),this.viewport=new Vt(t,i,s,n),this.viewport.vertical=e,this.vScrollHide=!1,this.hScrollHide=!1,this.vScroll=new zt((t=>{null===t&&(t=0),this.viewport.offset=[this.viewport.offset[0],-t]}),0,0,0,n),this.vScroll.vertical=!0;const r=new tt(n).add([this.viewport,this.vScroll]);this.hScroll=new zt((t=>{null===t&&(t=0),this.viewport.offset=[-t,this.viewport.offset[1]]}),0,0,0,n),this.hScroll.vertical=!1;this.child.add([r,this.hScroll])}get maxDimensions(){return this.viewport.maxDimensions}set maxDimensions(t){this.viewport.maxDimensions=t}get flexRatio(){return this.viewport.flexRatio}set flexRatio(t){this.viewport.flexRatio=t}get mainBasis(){return this.viewport.mainBasis}set mainBasis(t){this.viewport.mainBasis=t}get crossBasis(){return this.viewport.crossBasis}set crossBasis(t){this.viewport.crossBasis=t}get containedChild(){return this.viewport.child}resetScroll(){this.hScroll.value=0,this.vScroll.value=0}handlePreLayoutUpdate(t){const[e,i]=this.viewport.child.dimensions,[s,n]=this.viewport.dimensions;s<e&&!this.hScrollHide?this.hScroll.enabled=!0:(this.hScroll.value=0,this.hScroll.enabled=!1),n<i&&!this.vScrollHide?this.vScroll.enabled=!0:(this.vScroll.value=0,this.vScroll.enabled=!1),super.handlePreLayoutUpdate(t)}handlePostLayoutUpdate(t){[this.hScroll.end,this.vScroll.end]=this.viewport.child.dimensions,this.hScroll.barLength=this.viewport.lastViewportDims[0],this.vScroll.barLength=this.viewport.lastViewportDims[1],super.handlePostLayoutUpdate(t)}}class Qt extends(F(W,x,bt)){constructor(t=null,e=0,i=1,s=0,n=0,r=null){super(r,!0,!1),this.callback=t,this.setValue(n,!1),this.minValue=e,this.maxValue=i,this.snapIncrement=s,this.vertical=!1}getSliderRect(t,e,i,s){const n=Math.min(this.crossBasis,s),r=e+(s-n)/2;return[t,t+i,r,r+n]}handleEvent(t,e,i,s){if(this.handleClickEvent(t,s,this.getSliderRect(0,0,e,i)),(this.clickStateChanged&&this.wasClick||this.clickState==o.Hold)&&null!==this.pointerPos){const t=this.pointerPos[0];let e=this.minValue+t*(this.maxValue-this.minValue);this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),this.value=e}return this.clickStateChanged&&(this._dirty=!0),this}handlePreLayoutUpdate(t){this.flexRatio=this.theme.getSize(i.SliderFlexRatio),this.mainBasis=this.theme.getSize(i.SliderMainBasis),this.crossBasis=this.theme.getSize(i.SliderCrossBasis)}handlePainting(t,e,s,n,r){const[l,h,a,c]=this.getSliderRect(t,e,s,n),[u,d]=[h-l,c-a];let p=this.value;null===p&&(p=0);const v=(p-this.minValue)/(this.maxValue-this.minValue);[o.Hover,o.Hold].includes(this.clickState)?r.fillStyle=this.theme.getFill(i.AccentFill):r.fillStyle=this.theme.getFill(i.PrimaryFill);const f=v*u;r.fillRect(l,a,f,d),r.fillStyle=this.theme.getFill(i.BackgroundFill);const g=u-f;r.fillRect(l+f,a,g,d)}}class Kt extends At{constructor(t,e){super(t,null),this.scopeTheme=e}setThemeOverride(t){this.scopeTheme=t,super.inheritTheme(this.scopeTheme)}inheritTheme(t){super.inheritTheme(this.scopeTheme)}}export{s as Alignment,K as BackspaceKey,H as BaseContainer,Q as BasicKey,Mt as BasicTextInput,xt as BooleanVariable,mt as BoxLayout,I as Button,Ht as Center,It as Checkbox,o as ClickState,x as Clickable,J as Column,Et as Container,ct as DOMKeyboardDriver,ft as DOMPointerDriver,v as DOMRoot,nt as DOMVirtualKeyboardRoot,Ct as DebugTheme,t as DefaultTextInputHandler,Bt as DefaultTextValidator,j as EnterKey,G as EscapeKey,h as Event,R as FilledButton,W as FlexLayout,kt as FloatValidator,l as FocusType,Z as GlyphKey,Rt as Icon,St as IntValidator,lt as KeyEvent,ht as KeyPress,ot as KeyRelease,et as KeyRow,at as KeyboardDriver,z as Label,V as Labelable,Ot as LabelledCheckbox,u as LayoutContext,a as Leave,wt as MakeCompositeValidator,Lt as MakeDefaultTextValidatorWithCallback,Ft as MakeRangeValidator,Ut as Margin,Y as MultiContainer,X as MultiParent,bt as NumberVariable,M as Parent,At as PassthroughWidget,pt as PointerDriver,f as PointerEvent,dt as PointerHint,ut as PointerMove,m as PointerPress,g as PointerRelease,gt as RayPointerDriver,p as Root,tt as Row,zt as ScrollBar,Nt as ScrollableViewportWidget,$ as ShiftKey,E as SingleParent,Qt as Slider,q as SpaceKey,Wt as Spacing,_t as StringVariable,N as TextButton,Tt as TextInput,e as Theme,i as ThemeProperty,Kt as ThemeScope,yt as Variable,d as Viewport,Vt as ViewportWidget,st as VirtualKeyboard,rt as VirtualKeyboardRoot,y as Widget,n as defaultTheme,it as defaultVirtualKeyboardTemplate,A as measureTextDims};
