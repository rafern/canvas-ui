var We=(l,e,t)=>new Promise((i,r)=>{var n=u=>{try{a(t.next(u))}catch(d){r(d)}},o=u=>{try{a(t.throw(u))}catch(d){r(d)}},a=u=>u.done?i(u.value):Promise.resolve(u.value).then(n,o);a((t=t.apply(l,e)).next())});var m;(function(t){t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard"})(m||(m={}));var H=class{constructor(e,t,i){this.target=e,this.focusType=t,this.needsFocus=i}};var b=class extends H{constructor(e,t,i=null,r=null){super(i,r,!1);this.x=e,this.y=t}};var E=class extends b{constructor(e,t,i=null){super(e,t,i,m.Pointer)}correctOffset(e,t){return new E(this.x-e,this.y-t,this.target)}cloneWithTarget(e){return new E(this.x,this.y,e)}};var R=class extends b{constructor(e,t,i=null){super(e,t,i)}correctOffset(e,t){return new R(this.x-e,this.y-t,this.target)}cloneWithTarget(e){return new R(this.x,this.y,e)}};var P=class extends H{constructor(e=null){super(e,m.Pointer,!0)}cloneWithTarget(e){return new P(e)}};var y;(function(i){i[i.Released=0]="Released",i[i.Hover=1]="Hover",i[i.Hold=2]="Hold"})(y||(y={}));var F=class{constructor(e){this.widget=e;this.lastClickState=0;this.clickState=0;this.clickStateChanged=!1;this.wasClick=!1;this.pointerPos=null;this.startingPointerPos=null}getNormalInRect(e,t,i,r,n,o){return[(e-i)/(r-i),(t-n)/(o-n)]}isPointInRect(e,t,i,r,n,o){return e>=i&&e<r&&t>=n&&t<o}isNormalInRect(e,t){return e>=0&&e<1&&t>=0&&t<1}setClickState(e,t){this.clickState!==e?(this.lastClickState=this.clickState,this.clickState=e,this.wasClick=t&&this.lastClickState===2,this.clickStateChanged=!0):this.clickStateChanged=!1}handleClickEvent(e,t,i){if(e instanceof P)return t.dropFocus(m.Pointer,this.widget),this.pointerPos=null,this.setClickState(0,!1);if(e instanceof b){this.pointerPos=this.getNormalInRect(e.x,e.y,...i);let r=this.isNormalInRect(...this.pointerPos);if(r)t.pointerStyle="pointer";else if(e.target===null)return t.dropFocus(m.Pointer,this.widget),this.setClickState(0,!1);return e instanceof R?(this.startingPointerPos=this.pointerPos,t.requestFocus(m.Pointer,this.widget),this.setClickState(2,r)):e instanceof E?(t.dropFocus(m.Pointer,this.widget),r?this.setClickState(1,r):this.setClickState(0,r)):e.target===null?this.setClickState(1,r):this.setClickState(2,r)}else this.clickStateChanged=!1}};var A=null,le=new Map,ae="|";function oe(l,e){if(l==="")return[0,0,0];if(A===null&&(A=document.createElement("canvas").getContext("2d"),A===null))throw new Error("Failed to get canvas context");A.font=e;let t;if(le.has(e))t=le.get(e);else{let r=A.measureText(ae);t=Math.abs(r.actualBoundingBoxLeft)+Math.abs(r.actualBoundingBoxRight),le.set(e,t)}let i=A.measureText(ae+l+ae);return[Math.abs(i.actualBoundingBoxLeft)+Math.abs(i.actualBoundingBoxRight)-t*2,Math.abs(i.actualBoundingBoxAscent),Math.abs(i.actualBoundingBoxDescent)]}var O=class{constructor(){this._text="";this._font="";this._minWidth=0;this._minAscent=0;this._minDescent=0;this._width=0;this._ascent=0;this._descent=0;this.measureDirty=!0;this._dirty=!1}get dirty(){let e=this._dirty;return this._dirty=!1,e}updateTextDims(){if(!this.measureDirty)return;let[e,t,i]=oe(this._text,this._font);this._width=Math.max(e,this._minWidth),this._ascent=Math.max(t,this._minAscent),this._descent=Math.max(i,this._minDescent),this.measureDirty=!1}findOffsetFromIndex(e){return e<=0?0:oe(this._text.substring(0,e),this._font)[0]}findIndexOffsetFromOffset(e){if(e<=0)return[0,0];let t=0,i="",r=0;for(let n of this._text){i+=n;let o=oe(i,this._font)[0],a=(o+r)/2;if(e<a)return[t,r];t++,r=o}return[this._text.length,r]}setDirty(){this._dirty=!0,this.measureDirty=!0}get width(){return this.updateTextDims(),this._width}get ascent(){return this.updateTextDims(),this._ascent}get descent(){return this.updateTextDims(),this._descent}get height(){return this.updateTextDims(),this._ascent+this._descent}set text(e){this._text!==e&&(this._text=e,this.setDirty())}get text(){return this._text}set font(e){this._font!==e&&(this._font=e,this.setDirty())}get font(){return this._font}set minWidth(e){this._minWidth!==e&&(this._minWidth=e,this.setDirty())}get minWidth(){return this._minWidth}set minAscent(e){this._minAscent!==e&&(this._minAscent=e,this.setDirty())}get minAscent(){return this._minAscent}set minDescent(e){this._minDescent!==e&&(this._minDescent=e,this.setDirty())}get minDescent(){return this._minDescent}};var M=class{constructor(e,t=null){this.callback=t;this._dirty=!1;this._value=e}get value(){return this._value}set value(e){this.setValue(e)}get dirty(){let e=this._dirty;return this._dirty=!1,e}setValue(e,t=!0){if(this._value!==e&&(this._value=e,this._dirty=!0,t&&this.callback!==null))try{this.callback(e)}catch(i){console.error("Exception in Variable callback",i)}}};function Tt(l){return new Promise((e,t)=>{function i(){document.body.removeChild(u),document.body.removeChild(a)}function r(){i(),e(l)}function n(){i(),e(c.value)}function o(_){_.key=="Enter"&&(_.preventDefault(),n())}let a=document.createElement("div");a.id="textInputHandlerOverlay";let u=document.createElement("div");u.id="textInputHandler";let d=document.createElement("p");d.textContent="Change text:";let c=document.createElement("input");c.addEventListener("keyup",o),c.value=l;let f=document.createElement("div"),x=document.createElement("button");x.addEventListener("click",r),x.textContent="Cancel";let T=document.createElement("button");T.addEventListener("click",n),T.textContent="OK",f.appendChild(x),f.appendChild(T),u.appendChild(d),u.appendChild(c),u.appendChild(f),document.body.appendChild(a),document.body.appendChild(u),c.focus({preventScroll:!1})})}var s;(function(h){h[h.CanvasFill=0]="CanvasFill",h[h.ContainerPadding=1]="ContainerPadding",h[h.ContainerSpacing=2]="ContainerSpacing",h[h.ContainerAlignment=3]="ContainerAlignment",h[h.PrimaryFill=4]="PrimaryFill",h[h.AccentFill=5]="AccentFill",h[h.BackgroundFill=6]="BackgroundFill",h[h.BackgroundGlowFill=7]="BackgroundGlowFill",h[h.SliderMinLength=8]="SliderMinLength",h[h.SliderThickness=9]="SliderThickness",h[h.BodyTextFont=10]="BodyTextFont",h[h.BodyTextFill=11]="BodyTextFill",h[h.LabelMinWidth=12]="LabelMinWidth",h[h.LabelMinAscent=13]="LabelMinAscent",h[h.LabelMinDescent=14]="LabelMinDescent",h[h.CheckboxLength=15]="CheckboxLength",h[h.CheckboxInnerPadding=16]="CheckboxInnerPadding",h[h.InputBackgroundFill=17]="InputBackgroundFill",h[h.InputTextFont=18]="InputTextFont",h[h.InputTextFill=19]="InputTextFill",h[h.InputTextFillDisabled=20]="InputTextFillDisabled",h[h.InputTextFillInvalid=21]="InputTextFillInvalid",h[h.InputTextMinWidth=22]="InputTextMinWidth",h[h.InputTextMinAscent=23]="InputTextMinAscent",h[h.InputTextMinDescent=24]="InputTextMinDescent",h[h.InputTextInnerPadding=25]="InputTextInnerPadding",h[h.BlinkRate=26]="BlinkRate",h[h.CursorThickness=27]="CursorThickness",h[h.ScrollBarThickness=28]="ScrollBarThickness"})(s||(s={}));var g;(function(r){r[r.Stretch=0]="Stretch",r[r.Start=1]="Start",r[r.Center=2]="Center",r[r.End=3]="End"})(g||(g={}));var Ee=new Map([[s.CanvasFill,"rgba(0,0,0,0.5)"],[s.ContainerPadding,{left:4,right:4,top:4,bottom:4}],[s.ContainerAlignment,{horizontal:g.Start,vertical:g.Start}],[s.ContainerSpacing,4],[s.PrimaryFill,"rgb(0,127,255)"],[s.AccentFill,"rgb(0,195,255)"],[s.BackgroundFill,"rgb(32,32,32)"],[s.BackgroundGlowFill,"rgb(48,48,48)"],[s.SliderMinLength,100],[s.SliderThickness,10],[s.BodyTextFont,"16px sans"],[s.BodyTextFill,"white"],[s.LabelMinWidth,0],[s.LabelMinAscent,0],[s.LabelMinDescent,3],[s.CheckboxLength,12],[s.CheckboxInnerPadding,2],[s.InputBackgroundFill,"white"],[s.InputTextFont,"16px mono"],[s.InputTextFill,"black"],[s.InputTextFillDisabled,"grey"],[s.InputTextFillInvalid,"red"],[s.InputTextMinWidth,100],[s.InputTextMinAscent,16],[s.InputTextMinDescent,3],[s.InputTextInnerPadding,2],[s.BlinkRate,.8],[s.CursorThickness,1],[s.ScrollBarThickness,10]]),v=class{constructor(e=null,t=null){e===null?this.properties=new Map(Ee):this.properties=e,this.fallback=t}getProperty(e){let t=this.properties.get(e);if(t===void 0){if(this.fallback===null)throw new Error(`Theme property ${e} is not available`);t=this.fallback.getProperty(e)}return t}getString(e){let t=this.getProperty(e);if(typeof t!="string")throw new Error(`Theme property ${e} is not a string`);return t}getNumber(e){let t=this.getProperty(e);if(typeof t!="number")throw new Error(`Theme property ${e} is not a number`);return t}getPadding(e){return this.getProperty(e)}getAlignment(e){return this.getProperty(e)}getAlignment2D(e){return this.getProperty(e)}getFill(e){return this.getString(e)}getFont(e){return this.getString(e)}};function he(l,e=!0){return Math.pow(2,(e?Math.ceil:Math.floor)(Math.log2(l)))}var U=class{constructor(e=64,t=64){this._constraints=[0,1/0,0,1/0];this.dirty=!0;this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t;let i=this.canvas.getContext("2d",{alpha:!0});if(i===null)throw new Error("Failed to get canvas context");this.context=i}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}set constraints(e){(this._constraints[0]!==e[0]||this._constraints[1]!==e[1]||this._constraints[2]!==e[2]||this._constraints[3]!==e[3])&&(this._constraints[0]=e[0],this._constraints[1]=e[1],this._constraints[2]=e[2],this._constraints[3]=e[3],this.dirty=!0)}get constraints(){return[...this._constraints]}resolveChildsLayout(e){if(!e.layoutDirty&&!this.dirty)return!1;this.dirty=!1;let[t,i]=e.dimensions;if(e.resolveDimensions(...this.constraints),this._constraints[1]===1/0||this._constraints[3]===1/0){let[o,a,u,d]=this._constraints,[c,f]=e.dimensions;e.resolveDimensions(o,a===1/0?c:a,u,d===1/0?f:d)}e.resolvePosition(0,0);let[r,n]=e.dimensions;if(r!==t||n!==i){let o=Math.max(he(r),this.canvas.width),a=Math.max(he(n),this.canvas.height);if(o!==this.canvas.width||a!==this.canvas.height){let u=null;if(t!==0&&i!==0){u=document.createElement("canvas");let d=u.getContext("2d");if(d===null)throw new Error("Failed to get context of temporary canvas for resizing original canvas");d.globalCompositeOperation="copy",d.drawImage(this.canvas,0,0,r,n,0,0,r,n)}this.canvas.width=o,this.canvas.height=a,u!==null&&(this.context.globalCompositeOperation="copy",this.context.drawImage(u,0,0,r,n,0,0,r,n),this.context.globalCompositeOperation="source-over")}return!0}else return!1}paintToCanvas(e){let t=e.dirty;return t&&e.paint(this.context),t}};var N=class{constructor(e,t=null,i=new v){this.drivers=new Set;this._enabled=!0;this.pointerStyle="default";this._currentPointerStyle="default";this._foci=new Map([[m.Keyboard,null],[m.Pointer,null]]);this._fociCapturers=new Map([[m.Keyboard,null],[m.Pointer,null]]);this.textInputHandler=null;this._mobileTextInUse=!1;this.viewport=new U,this.child=e,this.pointerStyleHandler=t,this.child.inheritedTheme=i}get constraints(){return this.viewport.constraints}set constraints(e){this.viewport.constraints=e}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e)if(this._enabled=e,e)for(let i of this.drivers)i.onEnable(this);else{for(let i of this.drivers)i.onDisable(this);this.updatePointerStyle("default");for(let i of this._foci.keys())this.clearFocus(i)}}get canvas(){return this.viewport.canvas}resolveLayout(){return this.enabled?this.viewport.resolveChildsLayout(this.child):!1}paint(){return this.enabled?this.viewport.paintToCanvas(this.child):!1}dispatchEvent(e){var r;if(!this.enabled)return;if(e.focusType!==null&&e.target===null){let n=this._foci.get(e.focusType);if(typeof n=="undefined"&&(n=null),e.needsFocus&&n===null)return;e=e.cloneWithTarget(n)}this.pointerStyle="default";let t=this.child.dispatchEvent(e,this);if(t===null&&e.focusType!==null&&this.clearFocus(e.focusType),e.focusType===null)return;let i=(r=this._fociCapturers.get(e.focusType))!=null?r:null;if(i!==t){e.focusType===m.Pointer&&i!==null&&this.child.dispatchEvent(new P(i),this),this._fociCapturers.set(e.focusType,t);for(let n of this.drivers)n.onFocusCapturerChanged(this,e.focusType,i,t)}}preLayoutUpdate(){if(!!this.enabled){for(let e of this.drivers)e.update(this);this.child.preLayoutUpdate(this)}}postLayoutUpdate(){!this.enabled||(this.child.postLayoutUpdate(this),this.updatePointerStyle())}updatePointerStyle(e=null){e!==null&&(this.pointerStyle=e),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,this.pointerStyleHandler!==null&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(e,t){if(t!==null){let i=this._foci.get(e);if(t!==i){this.clearFocus(e),this._foci.set(e,t);for(let r of this.drivers)r.onFocusChanged(this,e,t)}}}dropFocus(e,t){let i=this._foci.get(e);t===i&&this.clearFocus(e)}clearFocus(e){let t=this._foci.get(e);if(t!==null&&typeof t!="undefined"){t.onFocusDropped(e,this),this._foci.set(e,null);for(let i of this.drivers)i.onFocusChanged(this,e,null)}}getFocus(e){var t;return(t=this._foci.get(e))!=null?t:null}getFocusCapturer(e){var t;return(t=this._fociCapturers.get(e))!=null?t:null}registerDriver(e){this.drivers.has(e)||(this.drivers.add(e),this._enabled&&e.onEnable&&e.onEnable(this))}unregisterDriver(e){!this.drivers.delete(e)||this._enabled&&e.onDisable&&e.onDisable(this)}clearDrivers(){for(let e of this.drivers)this.unregisterDriver(e)}get hasMobileTextInput(){return this.textInputHandler!==null&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(e=""){return We(this,null,function*(){if(this.textInputHandler!==null&&!this._mobileTextInUse){this._mobileTextInUse=!0;let t=yield this.textInputHandler(e);return this._mobileTextInUse=!1,t}return null})}};var ue=class extends N{constructor(e,t=new v){super(e,null,t);this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,[this.domElem.width,this.domElem.height]=this.dimensions;let i=this.domElem.getContext("2d",{alpha:!0});if(i===null)throw new Error("Failed to get DOM canvas context");this.domCanvasContext=i,this.pointerStyleHandler=r=>{this.domElem.style.cursor=r}}update(){if(this.enabled)this.domElem.style.removeProperty("display");else{this.domElem.style.display="none";return}this.preLayoutUpdate(),this.resolveLayout()&&([this.domElem.width,this.domElem.height]=this.dimensions),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))}};var C=class{constructor(e,t,i){this._enabled=!0;this._dirty=!0;this._layoutDirty=!0;this._theme=null;this._inheritedTheme=null;this.width=0;this.height=0;this.x=0;this.y=0;this._flex=0;this.needsClear=t,this.propagatesEvents=i,this._themeOverride=e}get flex(){return this._flex}set flex(e){e!==this._flex&&(this._flex=e,this._layoutDirty=!0)}updateInheritedTheme(){}updateTheme(){this._themeOverride===null?this._theme=this._inheritedTheme:(this._themeOverride.fallback=this._inheritedTheme,this._theme=this._themeOverride)}get theme(){if(this._theme===null)throw new Error("Widget theme is not ready");return this._theme}set enabled(e){e!==this._enabled&&(this._enabled=e,this._dirty=e,this._layoutDirty=!0)}get enabled(){return this._enabled}setThemeOverride(e){this._themeOverride!==e&&(this._themeOverride=e,this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set themeOverride(e){this.setThemeOverride(e)}get themeOverride(){return this._themeOverride}inheritTheme(e){this._inheritedTheme!==e&&(this._inheritedTheme=e,this.updateInheritedTheme(),this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set inheritedTheme(e){this.inheritTheme(e)}get inheritedTheme(){return this._inheritedTheme}get dimensions(){return[this.width,this.height]}get position(){return[this.x,this.y]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return this.width==0||this.height==0}onFocusDropped(e,t){}handleEvent(e,t){return e.target===this||e instanceof b&&e.target===null?this:null}dispatchEvent(e,t){if(!this._enabled)return null;if(e.target===null){if(e instanceof b&&(e.x<this.x||e.y<this.y||e.x>=this.x+this.width||e.y>=this.y+this.height))return null}else if(e.target!==this&&!this.propagatesEvents)return null;return this.handleEvent(e,t)}handlePreLayoutUpdate(e){}preLayoutUpdate(e){this._enabled&&this.handlePreLayoutUpdate(e)}resolveDimensions(e,t,i,r){if(!this._enabled){this.width=0,this.height=0,this._layoutDirty=!1;return}if(e==1/0)throw new Error("minWidth must not be infinite");if(e>t)throw new Error(`minWidth (${e}) must not be greater than maxWidth ${t}`);if(e<0)throw new Error(`minWidth (${e}) must not be lesser than 0`);if(i==1/0)throw new Error("minHeight must not be infinite");if(i>r)throw new Error(`minHeight (${i}) must not be greater than maxHeight ${r}`);if(i<0)throw new Error(`minHeight (${i}) must not be lesser than 0`);let n=this.width,o=this.height;if(this.handleResolveDimensions(e,t,i,r),this.width<e?(this.width=e,console.warn("Horizontal underflow in widget"),console.trace()):this.width>t&&(this.width=t,console.warn("Horizontal overflow in widget"),console.trace()),this.width<0||!isFinite(this.width)||isNaN(this.width))throw new Error(`Disallowed width (${this.width}) in widget`);if(this.height<i?(this.height=i,console.warn("Vertical underflow in widget"),console.trace()):this.height>r&&(this.height=r,console.warn("Vertical overflow in widget"),console.trace()),this.height<0||!isFinite(this.height)||isNaN(this.height))throw new Error(`Disallowed height (${this.height}) in widget`);this._layoutDirty=!1,(n!==this.width||o!==this.height)&&(this._dirty=!0)}afterPositionResolved(){}resolvePosition(e,t){(e!==this.x||t!==this.y)&&(this._dirty=!0),this.x=e,this.y=t,this.afterPositionResolved()}handlePostLayoutUpdate(e){}postLayoutUpdate(e){this._enabled&&this.handlePostLayoutUpdate(e)}clear(e,t,i,r,n,o=null){o===null&&(o=this.theme.getFill(s.CanvasFill)),n.save(),n.globalCompositeOperation="copy",n.fillStyle=o,n.beginPath(),n.rect(Math.trunc(e),Math.trunc(t),Math.ceil(i),Math.ceil(r)),n.clip(),n.fill(),n.restore()}clearStart(e,t=null){t===null&&(t=this.theme.getFill(s.CanvasFill)),e.save(),e.globalCompositeOperation="copy",e.fillStyle=t,e.beginPath()}clearEnd(e,t="nonzero"){e.clip(t),e.fill(),e.restore()}roundRect(e,t,i,r,n=!1){let o=n?Math.ceil:Math.floor,a=n?Math.floor:Math.ceil;return e=o(e),t=o(t),[e,t,a(e+i)-e,a(t+r)-t]}handlePainting(e){}paint(e){this.dimensionless||!this._dirty||(this._enabled&&(this.needsClear&&this.clear(this.x,this.y,this.width,this.height,e),e.save(),this.handlePainting(e),e.restore()),this._dirty=!1)}};var G=class extends C{constructor(e,t,i,r){super(t,i,r);this._children=[...e]}updateInheritedTheme(){let e=this.inheritedTheme;if(e!==null)for(let t of this.children)t.inheritedTheme=e}get childCount(){return this._children.length}get children(){return this._children.values()}};var K=class extends G{constructor(e,t,i,r){super([e],t,i,r)}get child(){return this._children[0]}};var Q=class extends K{constructor(e,t=null){super(e,t,!1,!0)}handleEvent(e,t){return this.child.dispatchEvent(e,t)}handlePreLayoutUpdate(e){let t=this.child;t.preLayoutUpdate(e),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(e){let t=this.child;t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,i,r){let n=this.child;n.resolveDimensions(e,t,i,r),[this.width,this.height]=n.dimensions}afterPositionResolved(){this.child.resolvePosition(this.x,this.y)}handlePainting(e){this.child.paint(e)}};var X=class extends Q{constructor(e,t=[0,1/0,0,1/0],i=null){super(e,i);this._constraints=[0,1/0,0,1/0];this._constraints=[...t]}set constraints(e){(this._constraints[0]!==e[0]||this._constraints[1]!==e[1]||this._constraints[2]!==e[2]||this._constraints[3]!==e[3])&&(this._constraints[0]=e[0],this._constraints[1]=e[1],this._constraints[2]=e[2],this._constraints[3]=e[3],this._layoutDirty=!0)}get constraints(){return[...this._constraints]}handleResolveDimensions(e,t,i,r){t=Math.min(this._constraints[1],t),r=Math.min(this._constraints[3],r),e=Math.min(Math.max(this._constraints[0],e),t),i=Math.min(Math.max(this._constraints[2],i),r),super.handleResolveDimensions(e,t,i,r)}};var Y=class extends K{constructor(e,t,i=null){super(e,i,!1,t);this.backgroundDirty=!0}setThemeOverride(e){super.setThemeOverride(e),this.backgroundDirty=!0}inheritTheme(e){super.inheritTheme(e),this.backgroundDirty=!0}handleEvent(e,t){return this.child.dispatchEvent(e,t)}handlePreLayoutUpdate(e){let t=this.child;t.preLayoutUpdate(e),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(e){let t=this.child;t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0),this.backgroundDirty&&(this._dirty=!0)}handleResolveDimensions(e,t,i,r){let n=this.theme.getPadding(s.ContainerPadding),o=n.left+n.right,a=n.top+n.bottom,u=t-o,d=r-a;u<0&&(u=0),d<0&&(d=0);let c=this.theme.getAlignment2D(s.ContainerAlignment),f=c.horizontal===g.Stretch?Math.max(e-o,0):0,x=c.vertical===g.Stretch?Math.max(i-a,0):0,[T,_]=this.child.dimensions;this.child.resolveDimensions(f,u,x,d);let[D,p]=this.child.dimensions,[w,k]=[this.width,this.height];this.width=Math.max(e,D+o),this.height=Math.max(i,p+a),(this.width!==w||this.height!==k||D!==T||p!==_)&&(this.backgroundDirty=!0)}afterPositionResolved(){let e=this.theme.getPadding(s.ContainerPadding),t=this.theme.getAlignment2D(s.ContainerAlignment),[i,r]=this.child.dimensions,n=i+e.left+e.right,o=r+e.top+e.bottom,a=this.x+e.left;if(t.horizontal!==g.Stretch){let f=this.width-n;if(f>0)switch(t.horizontal){case g.Center:a+=f/2;break;case g.End:a+=f;break}}let u=this.y+e.top;if(t.vertical!==g.Stretch){let f=this.height-o;if(f>0)switch(t.vertical){case g.Center:u+=f/2;break;case g.End:u+=f;break}}let[d,c]=this.child.position;this.child.resolvePosition(a,u),(d!==a||c!==u)&&(this.backgroundDirty=!0)}handlePainting(e){this.backgroundDirty&&(this.clearStart(e),e.rect(...this.roundRect(this.x,this.y,this.width,this.height)),e.rect(...this.roundRect(...this.child.position,...this.child.dimensions,!0)),this.clearEnd(e,"evenodd"),this.backgroundDirty=!1),this.child.paint(e)}};var $=class extends Y{constructor(e,t=null,i=null){super(e,!1,i);this.clickHelper=new F(this),this.callback=t}handleEvent(e,t){if(this.callback===null)return this.clickHelper.clickStateChanged=!1,this;if(this.clickHelper.handleClickEvent(e,t,[this.x,this.x+this.width,this.y,this.y+this.height]),this.clickHelper.clickStateChanged&&this.clickHelper.wasClick)try{this.callback()}catch(i){console.error("Exception in Icon callback",i)}return this}};var de=class extends ${constructor(){super(...arguments);this.backgroundProperty=s.BackgroundFill;this._forced=!1}updateBackground(){var i;if(this._forced)this.backgroundProperty=s.PrimaryFill;else switch(this.clickHelper.clickState){case y.Hold:this.backgroundProperty=s.AccentFill;break;case y.Hover:this.backgroundProperty=s.BackgroundGlowFill;break;default:this.backgroundProperty=s.BackgroundFill;break}let e=this.theme.getFill(this.backgroundProperty),t=new v(new Map([[s.CanvasFill,e]]),(i=this.inheritedTheme)==null?void 0:i.fallback);super.inheritTheme(t)}set forced(e){e!==this._forced&&(this._forced=e,this.updateBackground())}get forced(){return this._forced}setThemeOverride(e){if(e===null)return super.setThemeOverride(null);try{let t=e.getFill(this.backgroundProperty),i=new v(new Map([[s.CanvasFill,t]]));super.setThemeOverride(i)}catch(t){return super.setThemeOverride(null)}}inheritTheme(e){let t=e.getFill(this.backgroundProperty),i=new v(new Map([[s.CanvasFill,t]]),e);super.inheritTheme(i)}handleEvent(e,t){let i=super.handleEvent(e,t);return this.clickHelper.clickStateChanged&&this.updateBackground(),i}};var z=class extends C{constructor(e,t=null){super(t,!0,!1);this.textGetter=null;this.textHelper=new O,this.source=e}set source(e){e instanceof Function?this.textGetter=e:(this.textGetter=null,this.textHelper.text=e)}get source(){return this.textGetter!==null?this.textGetter:this.textHelper.text}set minWidth(e){this.textHelper.minWidth=e}get minWidth(){return this.textHelper.minWidth}set minAscent(e){this.textHelper.minAscent=e}get minAscent(){return this.textHelper.minAscent}set minDescent(e){this.textHelper.minDescent=e}get minDescent(){return this.textHelper.minDescent}get text(){return this.textHelper.text}handlePreLayoutUpdate(e){this.textGetter!==null&&(this.textHelper.text=this.textGetter()),this.textHelper.font=this.theme.getFont(s.BodyTextFont),this.textHelper.minWidth=this.theme.getNumber(s.LabelMinWidth),this.textHelper.minAscent=this.theme.getNumber(s.LabelMinAscent),this.textHelper.minDescent=this.theme.getNumber(s.LabelMinDescent),this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,i,r){this.width=Math.max(Math.min(this.textHelper.width,t),e),this.height=Math.max(Math.min(this.textHelper.height,r),i)}handlePainting(e){e.font=this.textHelper.font,e.fillStyle=this.theme.getFill(s.BodyTextFill),e.fillText(this.text,this.x,this.y+this.height-this.textHelper.descent)}};var q=class extends de{constructor(e,t=null,i=null){var o;let r=new Map((o=i==null?void 0:i.properties)!=null?o:[]);r.set(s.ContainerAlignment,{horizontal:g.Center,vertical:g.Stretch});let n=new v(r);super(new z(e,i),t,n)}};var me=class extends X{constructor(e,t=null,i,r=0,n=24,o=24,a=null){t===null&&(t=e);function u(){return i.shift?t===null?e:t:e}super(new q(u,()=>i.callback(u()),a),[n,1/0,o,1/0],a);this.flex=r}};var pe=class extends G{add(e){if(Array.isArray(e))for(let t of e)this._children.push(t);else this._children.push(e);return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}remove(e){if(Array.isArray(e))for(let t of e){let i=this._children.indexOf(t);i!==-1&&this._children.splice(i,1)}else{let t=this._children.indexOf(e);t!==-1&&this._children.splice(t,1)}return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}clearChildren(){return this._children.length=0,this._layoutDirty=!0,this._dirty=!0,this}};var j=class extends pe{constructor(e,t=null){super([],t,!1,!0);this.backgroundDirty=!0;this.unusedSpace=0;this.vertical=e}handleEvent(e,t){for(let i of this.children){if(!i.enabled)continue;let r=i.dispatchEvent(e,t);if(r!==null)return r}return null}handlePreLayoutUpdate(e){for(let t of this.children)t.preLayoutUpdate(e),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(e){for(let t of this.children)t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,i,r){this.backgroundDirty=!0;let n=0,o=0,a=this.vertical?t:r,u=this.vertical?r:t;a==1/0&&(a=0);let d=0;for(let p of this.children){if(!p.enabled)continue;d++;let w;this.vertical?(p.resolveDimensions(a,t,0,1/0),w=p.dimensions[0]):(p.resolveDimensions(0,1/0,a,r),w=p.dimensions[1]),n+=p.flex,w>o&&(o=w)}let c=this.vertical?e:i;o<c&&(o=c);let f=this.theme.getNumber(s.ContainerSpacing),x=Math.max(d-1,0)*f;for(let p of this.children)!p.enabled||(x+=this.vertical?p.dimensions[1]:p.dimensions[0]);let T=u-x;if(T==1/0||T<=0){if(this.vertical?(this.width=o,this.height=Math.min(x,r)):(this.width=Math.min(x,t),this.height=o),this.unusedSpace=0,T>=0)return;let p=u;for(let w of this.children){if(!w.enabled)continue;let k=this.vertical?w.dimensions[1]:w.dimensions[0];k>p?(this.vertical?w.resolveDimensions(a,t,0,p):w.resolveDimensions(0,p,a,r),p=0):p=Math.max(0,p-k-f)}return}let _=0;if(n===0)_=x;else for(let p of this.children){if(!p.enabled)continue;_!==0&&(_+=f);let w=T*p.flex/n;if(this.vertical){let k=w+p.dimensions[1];p.resolveDimensions(a,t,k,k),_+=p.dimensions[1]}else{let k=w+p.dimensions[0];p.resolveDimensions(k,k,a,r),_+=p.dimensions[0]}}let D;this.vertical?(D=r,this.width=o,this.height=D):(D=t,this.width=D,this.height=o),this.unusedSpace=Math.max(D-_,0)}afterPositionResolved(){let e=this.theme.getNumber(s.ContainerSpacing);{let t=this.vertical?this.y:this.x;for(let i of this.children)!i.enabled||(this.vertical?(i.resolvePosition(this.x,t),t+=i.dimensions[1]+e):(i.resolvePosition(t,this.y),t+=i.dimensions[0]+e))}}handlePainting(e){let t=[];for(let i of this.children)!i.enabled||(i.paint(e),this.backgroundDirty&&t.push(this.roundRect(...i.position,...i.dimensions)));if(this.backgroundDirty){this.clearStart(e),e.rect(...this.roundRect(this.x,this.y,this.width,this.height));for(let i of t)e.rect(...i);this.clearEnd(e,"evenodd")}this.backgroundDirty=!1}};var J=class extends j{constructor(e=null){super(!1,e)}};var ce=class extends J{constructor(e,t,i=0,r=24,n=24,o=null){super(o);for(let a of e)if(typeof a=="function"){let u=a;this.add(u(t,o))}else if(typeof a[0]=="string"&&typeof a[1]=="string"){let u=a[0],d=a[1];for(let c=0;c<u.length;c++){let f=null;c<d.length&&(f=d[c]),this.add(new me(u[c],f,t,i,r,n,o))}}else throw new Error(`Unknown virtual key row template format for entry: ${a}`)}};var Z=class extends X{constructor(e,t,i=0,r=24,n=24,o=null){super(new q(e,t,o),[r,1/0,n,1/0],o);this.flex=i}};var V=class extends Z{constructor(e,t,i,r=0,n=24,o=24,a=null){super(e,()=>i.callback(t),r,n,o,a)}};var fe=class extends V{constructor(e,t=0,i=60,r=24,n=null){super("Backspace","Backspace",e,t,i,r,n)}};var ge=class extends V{constructor(e,t=0,i=24,r=24,n=null){super("Esc","Escape",e,t,i,r,n)}};var ve=class extends V{constructor(e,t=0,i=72,r=24,n=null){super("Enter","Enter",e,t,i,r,n)}};var ye=class extends Z{constructor(e,t=0,i=84,r=24,n=null){super("Shift",()=>{e.shift=!e.shift,this.child.forced=e.shift,e.callback("Shift")},t,i,r,n);this.child.forced=e.shift}};var be=class extends V{constructor(e,t=1,i=84,r=24,n=null){super("Space"," ",e,t,i,r,n)}};var xe=class extends j{constructor(e=null){super(!0,e)}};function Re(l,e){return new ve(l,void 0,void 0,void 0,e)}function Ve(l,e){return new ye(l,void 0,void 0,void 0,e)}function He(l,e){return new fe(l,void 0,void 0,void 0,e)}function Fe(l,e){return new be(l,void 0,void 0,void 0,e)}function Me(l,e){return new ge(l,void 0,void 0,void 0,e)}var ee=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],Re],[Ve,["zxcvbnm,./","ZXCVBNM<>?"]],[He,Fe,Me]],te=class extends xe{constructor(e,t=ee,i=0,r=24,n=24,o=null){super(o);let a={callback:u=>{e.keyPress(u)},shift:!1};for(let u of t)this.add(new ce(u,a,i,r,n,o))}};var S=class extends Y{constructor(e,t=null){super(e,!0,t)}};var L=class extends S{constructor(e){let t=new v(new Map([[s.ContainerAlignment,{horizontal:g.Center,vertical:g.Center}]]));super(e,t)}};var Ke=class extends ue{constructor(e,t=ee,i=new v){super(new L(new te(e,t)),i);this.keyboardDriver=e}update(){this.enabled=this.keyboardDriver.getFocusedRoot()!==null,super.update()}};var Se=class extends N{constructor(e,t=ee,i=null,r=new v){super(new L(new te(e,t)),i,r);this.keyboardDriver=e}updateVisibility(){this.enabled=this.keyboardDriver.getFocusedRoot()!==null}};var ie=class extends H{constructor(e,t){super(t,m.Keyboard,!0);this.key=e}};var re=class extends ie{cloneWithTarget(e){return new re(this.key,e)}};var I=class extends ie{cloneWithTarget(e){return new I(this.key,e)}};var Te=class{constructor(){this.eventQueues=new Map;this.keysDown=new Set;this.focus=null}getEventQueue(e){if(e===null)return null;let t=this.eventQueues.get(e);return typeof t=="undefined"?null:t}changeFocusedRoot(e){this.focus!==null&&this.focus.clearFocus(m.Keyboard),this.focus=e,this.keysDown.clear()}getFocusedRoot(){return this.focus}clearFocus(){this.changeFocusedRoot(null)}keyDown(e){this.keysDown.add(e);let t=this.getEventQueue(this.focus);t!==null&&t.push(new I(e,null))}keyUp(e){if(this.keysDown.delete(e)){let t=this.getEventQueue(this.focus);t!==null&&t.push(new re(e,null))}}keyPress(e){let t=this.isKeyDown(e);this.keyDown(e),t||this.keyUp(e)}isKeyDown(e){return this.keysDown.has(e)}onEnable(e){this.eventQueues.has(e)||this.eventQueues.set(e,[])}onDisable(e){this.eventQueues.has(e)&&(this.eventQueues.delete(e),e===this.focus&&this.clearFocus())}update(e){let t=this.getEventQueue(e);if(t!==null){for(let i of t)e.dispatchEvent(i);t.length=0}}onFocusChanged(e,t,i){t===m.Keyboard&&(e==this.focus?i===null&&this.clearFocus():i!==null&&this.changeFocusedRoot(e))}onFocusCapturerChanged(e,t,i,r){}};var Le=class extends Te{constructor(){super(...arguments);this.domElems=new Set}bindDOMElem(e,t=!0){this.domElems.has(e)||(this.domElems.add(e),t&&(e.addEventListener("keydown",i=>{this.keyDown(i.key)}),e.addEventListener("keyup",i=>{this.keyUp(i.key)})),e.addEventListener("blur",i=>{this.shouldClearFocus(i.relatedTarget)&&this.clearFocus()}))}shouldClearFocus(e){return e===null||!this.domElems.has(e)}};function se(l,e){let t=e.getBoundingClientRect();return[(l.clientX-t.left)/t.width,(l.clientY-t.top)/t.height]}var B=class extends b{constructor(e,t,i=null){super(e,t,i,m.Pointer)}correctOffset(e,t){return new B(this.x-e,this.y-t,this.target)}cloneWithTarget(e){return new B(this.x,this.y,e)}};var W;(function(i){i[i.None=0]="None",i[i.Hovering=1]="Hovering",i[i.Pressing=2]="Pressing"})(W||(W={}));var ne=class{constructor(){this.states=new Map;this.nextPointerID=0;this.hints=new Map}unassignPointer(e,t){t.pointer!==null&&this.setPointerHint(t.pointer,W.None),t.pointer=null,t.hovering&&t.eventQueue.push(new P(e.getFocusCapturer(m.Pointer))),t.hovering=!1,t.pressing=!1}registerPointer(){let e=this.nextPointerID++;return this.setPointerHint(e,W.None),e}unregisterPointer(e){for(let[t,i]of this.states)i.pointer===e&&this.unassignPointer(t,i);this.hints.delete(e)}movePointer(e,t,i,r,n=null){let o=this.states.get(e);if(typeof o=="undefined")return;let a=o.pointer===null;a&&(o.pointer=t),n===null&&(n=o.pressing);let u=o.pointer===t;if(!u||a)for(let[_,D]of this.states)_!==e&&D.pointer===t&&this.unassignPointer(_,D);if(!u&&(!n||o.pressing))return;let[d,c]=e.dimensions,f=i*d,x=r*c,T;n!==o.pressing?(n?T=new R(f,x):T=new E(f,x),o.pressing=n,n&&o.pointer!==t&&o.pointer!==null&&(o.eventQueue.push(new P(e.getFocusCapturer(m.Pointer))),this.setPointerHint(o.pointer,W.None),o.pointer=t)):T=new B(f,x),o.eventQueue.push(T),o.hovering=!0,o.pressing?this.setPointerHint(t,W.Pressing):this.setPointerHint(t,W.Hovering)}leavePointer(e,t){let i=this.states.get(e);typeof i!="undefined"&&i.hovering&&i.pointer==t&&(i.hovering=!1,i.pressing=!1,i.eventQueue.push(new P(e.getFocusCapturer(m.Pointer))),this.setPointerHint(t,W.None))}leaveAnyPointer(e){for(let t of this.states.keys())this.leavePointer(t,e)}setPointerHint(e,t){return this.hints.get(e)!==t?(this.hints.set(e,t),!0):!1}getPointerHint(e){var t;return(t=this.hints.get(e))!=null?t:W.None}onEnable(e){this.states.set(e,{eventQueue:[],pointer:null,pressing:!1,hovering:!1})}onDisable(e){e.dispatchEvent(new P);let t=this.states.get(e);typeof t!="undefined"&&t.pointer!==null&&this.setPointerHint(t.pointer,W.None),this.states.delete(e)}update(e){let t=this.states.get(e);if(typeof t!="undefined"){for(let i of t.eventQueue)e.dispatchEvent(i);t.eventQueue.length=0}}onFocusChanged(e,t,i){}onFocusCapturerChanged(e,t,i,r){}};var Ie=class extends ne{constructor(){super();this.domElems=new WeakMap;this.mousePointerID=this.registerPointer()}bindDOMElem(e,t){let i=this.domElems.get(e);typeof i!="undefined"?this.removeListeners(i):(i={domElem:t,pointermoveListen:null,pointerdownListen:null,pointerupListen:null,pointerleaveListen:null},this.domElems.set(e,i)),e.enabled&&this.addListeners(e,i)}addListeners(e,t){let i=t.domElem;t.pointermoveListen=r=>{r.isPrimary&&this.movePointer(e,this.mousePointerID,...se(r,i))},t.pointerdownListen=r=>{r.isPrimary&&this.movePointer(e,this.mousePointerID,...se(r,i),!0)},t.pointerupListen=r=>{r.isPrimary&&this.movePointer(e,this.mousePointerID,...se(r,i),!1)},t.pointerleaveListen=r=>{r.isPrimary&&this.leavePointer(e,this.mousePointerID)},i.addEventListener("pointermove",t.pointermoveListen),i.addEventListener("pointerdown",t.pointerdownListen),i.addEventListener("pointerup",t.pointerupListen),i.addEventListener("pointerleave",t.pointerleaveListen)}removeListeners(e){e.pointermoveListen!==null&&(e.domElem.removeEventListener("pointermove",e.pointermoveListen),e.pointermoveListen=null),e.pointerdownListen!==null&&(e.domElem.removeEventListener("pointerdown",e.pointerdownListen),e.pointerdownListen=null),e.pointerupListen!==null&&(e.domElem.removeEventListener("pointerup",e.pointerupListen),e.pointerupListen=null),e.pointerleaveListen!==null&&(e.domElem.removeEventListener("pointerleave",e.pointerleaveListen),e.pointerleaveListen=null)}onEnable(e){super.onEnable(e);let t=this.domElems.get(e);typeof t!="undefined"&&this.addListeners(e,t)}onDisable(e){super.onDisable(e);let t=this.domElems.get(e);typeof t!="undefined"&&this.removeListeners(t)}};var Ae=class extends ne{constructor(){super(...arguments);this.sources=new Set}handlePointerRay(e,t,i,r){let[n,o,a]=this.castRay(i,r);n===null?this.leaveAnyPointer(e):this.movePointer(n,e,o,a,t)}addSource(e){this.sources.has(e)||(e.setRayPointerDriver(this),this.sources.add(e))}setPointerHint(e,t){let i=super.setPointerHint(e,t);for(let r of this.sources)r.onPointerHintChanged(e,t);return i}};var Be=class extends v{constructor(e=new v){super(new Map,e)}getFill(e){return super.getFill(e),"#"+Math.floor(Math.random()*16777215).toString(16)}};function nn(l,e,t=null){return i=>{let r=!0,n=i;for(let o of l)if([r,n]=o(n),!r)return[!1,e];if(t!==null)try{t(n)}catch(o){console.warn("Exception in CompositeValidator callback:",o)}return[!0,n]}}function Oe(l){return[!0,l]}function ke(l=null){return l===null?Oe:e=>(l(e),[!0,e])}var Ue=/^-?(\.\d+|\d+(\.(\d+)?)?)(e\d+)?$/;function ln(l){return Ue.test(l)?[!0,parseFloat(l)]:[!1,NaN]}var Ne=/^-?\d+$/;function hn(l){return Ne.test(l)?[!0,parseInt(l)]:[!1,NaN]}function dn(l,e){return t=>t<l?[!1,t]:t>e?[!1,t]:[!0,t]}var we=class extends C{constructor(e,t="",i=null){super(i,!1,!1);this.blinkStart=0;this.blinkWasOn=null;this.cursorPos=0;this.cursorOffset=0;this.cursorOffsetDirty=!1;this._editingEnabled=!0;this._hideText=!1;this.textHelper=new O,this.variable=new M(t,r=>{let[n,o]=e(r);n&&(this._validValue=o),n!==this._valid&&(this._valid=n,this._dirty=!0)}),[this._valid,this._validValue]=e(t)}get blinkOn(){if(this.blinkStart===0)return null;let e=this.theme.getNumber(s.BlinkRate);return Math.trunc((Date.now()-this.blinkStart)/(500*e)%2)===0}get editingEnabled(){return this._editingEnabled}set editingEnabled(e){this._editingEnabled!==e&&(this._editingEnabled=e,e||(this.blinkStart=0,this.moveCursorTo(0)),this._dirty=!0)}get hideText(){return this._hideText}set hideText(e){this._hideText!==e&&(this._hideText=e,this.cursorOffsetDirty=!0,this._dirty=!0)}set text(e){this.variable.value=e}get text(){return this.variable.value}get displayedText(){return this._hideText?"\u25CF".repeat(this.variable.value.length):this.variable.value}get valid(){return this._valid}get validValue(){return this._validValue}set minWidth(e){this.textHelper.minWidth=e}get minWidth(){return this.textHelper.minWidth}set minAscent(e){this.textHelper.minAscent=e}get minAscent(){return this.textHelper.minAscent}set minDescent(e){this.textHelper.minDescent=e}get minDescent(){return this.textHelper.minDescent}moveCursorTo(e){this.cursorPos=Math.min(Math.max(e,0),this.text.length),this.cursorOffsetDirty=!0,this._dirty=!0}moveCursor(e){this.moveCursorTo(this.cursorPos+e)}insertText(e){this.text=this.text.substring(0,this.cursorPos)+e+this.text.substring(this.cursorPos),this.moveCursor(e.length)}deleteText(e){e>0?this.text=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+e):e<0&&(this.text=this.text.substring(0,this.cursorPos+e)+this.text.substring(this.cursorPos),this.moveCursor(e))}onFocusDropped(e,t){e===m.Keyboard&&(this.blinkStart=0)}handleEvent(e,t){if(!this._editingEnabled)return this;if(e instanceof b){if(t.pointerStyle="text",e instanceof R){let i=this.theme.getNumber(s.InputTextInnerPadding);[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset(e.x-i),this.blinkStart=Date.now(),this._dirty=!0,t.requestFocus(m.Keyboard,this)}else e instanceof E&&t.hasMobileTextInput&&t.getTextInput(this.text).then(i=>{i!==null&&this.text!==i&&(this.text=i,this.moveCursorTo(i.length))});return this}else if(e instanceof I){if(e.key.length===1)this.insertText(e.key);else if(e.key==="Backspace")this.deleteText(-1);else if(e.key==="Delete")this.deleteText(1);else if(e.key==="ArrowLeft")this.moveCursor(-1);else if(e.key==="ArrowRight")this.moveCursor(1);else if(e.key==="Home")this.moveCursorTo(0);else if(e.key==="End")this.moveCursorTo(this.text.length);else return e.key==="Escape"?(t.dropFocus(m.Keyboard,this),this):this;this.blinkStart=Date.now()}return this}handlePreLayoutUpdate(e){this.editingEnabled||e.dropFocus(m.Keyboard,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.theme.getFont(s.InputTextFont),this.textHelper.minWidth=this.theme.getNumber(s.InputTextMinWidth),this.textHelper.minAscent=this.theme.getNumber(s.InputTextMinAscent),this.textHelper.minDescent=this.theme.getNumber(s.InputTextMinDescent),this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.cursorOffsetDirty=!1),this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,i,r){let n=2*this.theme.getNumber(s.InputTextInnerPadding);t!==1/0?this.width=t:this.width=Math.max(e,this.textHelper.width+n),r!==1/0?this.height=r:this.height=Math.max(i,this.textHelper.height+n)}handlePainting(e){e.fillStyle=this.theme.getFill(s.InputBackgroundFill),e.fillRect(this.x,this.y,this.width,this.height),e.font=this.theme.getFont(s.InputTextFont),this._editingEnabled?this._valid?e.fillStyle=this.theme.getFill(s.InputTextFill):e.fillStyle=this.theme.getFill(s.InputTextFillInvalid):e.fillStyle=this.theme.getFill(s.InputTextFillDisabled);let t=this.theme.getNumber(s.InputTextInnerPadding);e.fillText(this.displayedText,this.x+t,this.y+this.height-this.textHelper.descent-t);let i=this.blinkOn;if(this.blinkWasOn=i,!i)return;let r=this.theme.getNumber(s.CursorThickness);e.fillRect(this.x+this.cursorOffset,this.y+t,r,this.height-t*2)}};var Ge=class extends we{constructor(e=null,t="",i=null){let r=ke(e);super(r,t,i)}};var Qe=class extends S{constructor(e){let t=new v(new Map([[s.ContainerAlignment,{horizontal:g.Center,vertical:g.Center}],[s.ContainerPadding,{left:0,right:0,top:0,bottom:0}]]));super(e,t)}};var Ce=class extends C{constructor(e=null,t=!1,i=null){super(i,!0,!1);this.offsetX=0;this.offsetY=0;this.actualLength=0;this.variable=new M(t,e),this.clickHelper=new F(this)}set checked(e){this.variable.value=e}get checked(){return this.variable.value}handleEvent(e,t){let i=this.x+this.offsetX,r=this.y+this.offsetY;return this.clickHelper.handleClickEvent(e,t,[i,i+this.actualLength,r,r+this.actualLength]),this.clickHelper.clickStateChanged&&this.clickHelper.wasClick&&(this.checked=!this.checked),this}handlePreLayoutUpdate(e){this.variable.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,i,r){let n=this.theme.getNumber(s.CheckboxLength);this.actualLength=Math.min(n,t,r),this.width=this.actualLength,this.height=this.actualLength,this.width<e&&(this.width=e),this.height<i&&(this.height=i),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){let t=this.clickHelper.clickState===y.Hover||this.clickHelper.clickState===y.Hold;if(t?e.fillStyle=this.theme.getFill(s.BackgroundGlowFill):e.fillStyle=this.theme.getFill(s.BackgroundFill),e.fillRect(this.offsetX,this.offsetY,this.actualLength,this.actualLength),this.checked){t?e.fillStyle=this.theme.getFill(s.AccentFill):e.fillStyle=this.theme.getFill(s.PrimaryFill);let i=this.theme.getNumber(s.CheckboxInnerPadding),r=this.actualLength-i*2;r<=0?e.fillRect(this.x+this.offsetX,this.y+this.offsetY,this.actualLength,this.actualLength):e.fillRect(this.x+this.offsetX+i,this.y+this.offsetY+i,r,r)}}};var _e=class extends C{constructor(e,t=null,i=null,r=null,n=null){super(n,!0,!1);this.lastSrc=null;this._rotation=0;this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this._image=e,this._imageWidth=t,this._imageHeight=i,this.viewBox=r}set image(e){e!==this._image&&(this._image=e,this.lastSrc=null)}get image(){return this._image}get imageWidth(){return this._imageWidth}set imageWidth(e){this._imageWidth!==e&&(this._imageWidth=e,this._layoutDirty=!0)}get imageHeight(){return this._imageHeight}set imageHeight(e){this._imageHeight!==e&&(this._imageHeight=e,this._layoutDirty=!0)}handlePreLayoutUpdate(e){var t,i;((t=this._image)==null?void 0:t.src)!==this.lastSrc&&((i=this._image)==null?void 0:i.complete)&&(this._dirty=!0)}handleResolveDimensions(e,t,i,r){let n=this._imageWidth;n===null&&(this.viewBox===null?n=this._image.width:n=this.viewBox[2]),this.width=Math.max(Math.min(n,t),e);let o=this._imageHeight;o===null&&(this.viewBox===null?o=this._image.height:o=this.viewBox[3]),this.height=Math.max(Math.min(o,r),i);let a=this.width/n,u=this.height/o,d=Math.min(a,u);this.actualWidth=n*d,this.actualHeight=o*d,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=(this.height-this.actualHeight)/2}set rotation(e){e!==this._rotation&&(this._rotation=e,this._dirty=!0)}get rotation(){return this._rotation}handlePainting(e){var r;if(!((r=this._image)==null?void 0:r.complete)){this.lastSrc=null;return}this.lastSrc=this._image.src;let t=this.offsetX,i=this.offsetY;this.rotation!==0&&(e.save(),e.translate(this.x+this.offsetX+this.actualWidth/2,this.y+this.offsetY+this.actualHeight/2),t=-this.actualWidth/2,i=-this.actualHeight/2,e.rotate(this.rotation)),this.viewBox===null?e.drawImage(this._image,t,i,this.actualWidth,this.actualHeight):e.drawImage(this._image,...this.viewBox,t,i,this.actualWidth,this.actualHeight),this.rotation!==0&&e.restore()}};var Xe=class extends ${constructor(e,t=null,i=null,r=null,n=null,o=null){super(new L(new _e(e,t,i,r,o)),n,o)}get icon(){return this.child.child}};var Pe=class extends C{constructor(e=1,t=0,i=0,r=null){super(r,!0,!1);this.flex=e,this.minWidth=t,this.minHeight=i}handleResolveDimensions(e,t,i,r){t!==1/0?this.width=t:this.width=Math.max(e,this.minWidth),r!==1/0?this.height=r:this.height=Math.max(i,this.minHeight)}};var Ye=class extends J{constructor(e,t=null,i=!1,r=null){super(r);this.add([new z(e,r),new Pe(1,0,0,r),new Ce(t,i,r)])}};var De=class extends K{constructor(e,t=!1,i=!1,r=null){super(e,r,!1,!0);this._minWidth=0;this._minHeight=0;this._offset=[0,0];this.viewport=new U,this._widthTied=t,this._heightTied=i}get canvasDimensions(){return this.viewport.canvasDimensions}get offset(){return[...this._offset]}set offset(e){(this._offset[0]!==e[0]||this._offset[1]!==e[1])&&(this._offset[0]=e[0],this._offset[1]=e[1],this._dirty=!0)}set constraints(e){this.viewport.constraints=e}get constraints(){return this.viewport.constraints}get widthTied(){return this._widthTied}set widthTied(e){this._widthTied!==e&&(this._widthTied=e,this._layoutDirty=!0)}get heightTied(){return this._heightTied}set heightTied(e){this._heightTied!==e&&(this._heightTied=e,this._layoutDirty=!0)}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth!==e&&(this._minWidth=e,this._layoutDirty=!0)}get minHeight(){return this._minHeight}set minHeight(e){this._minHeight!==e&&(this._minHeight=e,this._layoutDirty=!0)}handleEvent(e,t){if(e.target===null&&!(e instanceof b))return null;let[i,r]=this.child.dimensions,n=this.offset[0],o=n+i,a=this.offset[1],u=a+r;if(e instanceof b){if(e.target===null&&(e.x<n||e.x>=o||e.y<a||e.y>=u))return null;e=e.correctOffset(n,a)}return this.child.dispatchEvent(e,t)}handlePreLayoutUpdate(e){let t=this.child;t.preLayoutUpdate(e),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(e){let t=this.child;t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0);let i=this._widthTied||this._heightTied;t.layoutDirty&&i?this._layoutDirty=!0:i||this.viewport.resolveChildsLayout(t)}handleResolveDimensions(e,t,i,r){let n=!0,o=!0,a=Math.min(Math.max(e,this._minWidth),t),u=Math.min(Math.max(i,this._minHeight),r);if(this._widthTied||this._heightTied){let d=this.viewport.constraints;this._widthTied&&(d[0]=e,d[1]=t),this._heightTied&&(d[2]=i,d[3]=r);let c=this.child;this.viewport.constraints=d,this.viewport.resolveChildsLayout(c),this._widthTied&&(this.width=c.dimensions[0],n=!1),this._heightTied&&(this.height=c.dimensions[1],o=!1)}n&&(this.width=t!==1/0?t:a),o&&(this.height=r!==1/0?r:u)}handlePainting(e){this.viewport.paintToCanvas(this.child),e.save();let t=new Path2D;t.rect(Math.trunc(this.x),Math.trunc(this.y),Math.ceil(this.width),Math.ceil(this.height)),e.clip(t),e.globalCompositeOperation="copy",e.fillStyle=this.theme.getFill(s.CanvasFill),e.fill(t);let[i,r]=this.child.dimensions,[n,o]=this.offset,a=this.x+n,u=this.y+o,d=new Path2D;d.rect(Math.trunc(a),Math.trunc(u),Math.ceil(i),Math.ceil(r)),e.clip(d),e.drawImage(this.viewport.canvas,0,0,i,r,a,u,i,r),e.restore()}};var $e=class extends De{};var ze=class extends C{constructor(e=null,t=0,i=1,r=0,n=0,o=!1,a=null){super(a,!0,!1);this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.clickHelper=new F(this),this.variable=new M(n,e),this.minValue=t,this.maxValue=i,this.snapIncrement=r,this.vertical=o}set value(e){this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),this.variable.value=e}get value(){return this.variable.value}handleEvent(e,t){let i=this.x+this.offsetX,r=this.y+this.offsetY;if(this.clickHelper.handleClickEvent(e,t,[i,i+this.actualWidth,r,r+this.actualHeight]),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState==y.Hold)&&this.clickHelper.pointerPos!==null){let n=this.clickHelper.pointerPos[0];this.value=this.minValue+n*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handleResolveDimensions(e,t,i,r){let n=this.theme.getNumber(s.SliderThickness),o=this.theme.getNumber(s.SliderMinLength);this.vertical?(r!=1/0?this.height=r:this.height=Math.max(o,i),this.actualHeight=this.height,this.offsetY=0,this.width=Math.min(Math.max(n,e),t),this.actualWidth=Math.min(this.width,n),this.offsetX=(this.width-this.actualWidth)/2):(t!=1/0?this.width=t:this.width=Math.max(o,e),this.actualWidth=this.width,this.offsetY=0,this.height=Math.min(Math.max(n,i),r),this.actualHeight=Math.min(this.height,n),this.offsetX=(this.height-this.actualHeight)/2)}handlePainting(e){let t=this.x+this.offsetX,i=this.y+this.offsetY;this.clickHelper.clickState===y.Hover||this.clickHelper.clickState===y.Hold?e.fillStyle=this.theme.getFill(s.AccentFill):e.fillStyle=this.theme.getFill(s.PrimaryFill);let r=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);e.fillRect(t,i,r,this.actualHeight),e.fillStyle=this.theme.getFill(s.BackgroundFill);let n=this.actualWidth-r;e.fillRect(t+r,i,n,this.actualHeight)}};var qe=class extends S{constructor(e){let t=new v(new Map([[s.ContainerAlignment,{horizontal:g.Center,vertical:g.Stretch}]]));super(e,t)}};var je=class extends Q{constructor(e,t){super(e,null);this.scopeTheme=t}setThemeOverride(e){this.scopeTheme=e,super.inheritTheme(this.scopeTheme)}inheritTheme(e){super.inheritTheme(this.scopeTheme)}};export{g as Alignment,X as ArtificialConstraint,fe as BackspaceKey,Y as BaseContainer,Ge as BasicTextInput,V as BasicVirtualKey,$ as Button,Qe as Center,Ce as Checkbox,F as ClickHelper,y as ClickState,xe as Column,S as Container,Le as DOMKeyboardDriver,Ie as DOMPointerDriver,ue as DOMRoot,Ke as DOMVirtualKeyboardRoot,Be as DebugTheme,Tt as DefaultTextInputHandler,Oe as DefaultTextValidator,ve as EnterKey,ge as EscapeKey,H as Event,de as FilledButton,ln as FloatValidator,m as FocusType,me as GlyphVirtualKey,_e as Icon,Xe as IconButton,hn as IntValidator,ie as KeyEvent,I as KeyPress,re as KeyRelease,Te as KeyboardDriver,z as Label,Ye as LabelledCheckbox,P as Leave,nn as MakeCompositeValidator,ke as MakeDefaultTextValidatorWithCallback,dn as MakeRangeValidator,L as Margin,j as MultiContainer,pe as MultiParent,G as Parent,Q as PassthroughWidget,ne as PointerDriver,b as PointerEvent,W as PointerHint,B as PointerMove,R as PointerPress,E as PointerRelease,Ae as RayPointerDriver,N as Root,J as Row,$e as ScrollableViewportWidget,ye as ShiftKey,K as SingleParent,ze as Slider,be as SpaceKey,Pe as Spacing,q as TextButton,O as TextHelper,we as TextInput,qe as TextMargin,v as Theme,s as ThemeProperty,je as ThemeScope,M as Variable,U as Viewport,De as ViewportWidget,Z as VirtualKey,ce as VirtualKeyRow,te as VirtualKeyboard,Se as VirtualKeyboardRoot,C as Widget,ee as defaultVirtualKeyboardTemplate,se as getPointerEventNormPos,oe as measureTextDims,he as roundToPower2};
//# sourceMappingURL=index.esm.js.map
