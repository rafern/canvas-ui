var wt=Object.defineProperty;var ui=Object.getOwnPropertyDescriptor;var Xt=Object.getOwnPropertySymbols;var fi=Object.prototype.hasOwnProperty,pi=Object.prototype.propertyIsEnumerable;var Kt=(l,i,e)=>i in l?wt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[i]=e,A=(l,i)=>{for(var e in i||(i={}))fi.call(i,e)&&Kt(l,e,i[e]);if(Xt)for(var e of Xt(i))pi.call(i,e)&&Kt(l,e,i[e]);return l};var a=(l,i)=>wt(l,"name",{value:i,configurable:!0});var x=(l,i,e,t)=>{for(var r=t>1?void 0:t?ui(i,e):i,n=l.length-1,s;n>=0;n--)(s=l[n])&&(r=(t?s(i,e,r):s(r))||r);return t&&r&&wt(i,e,r),r};var Yt=(l,i,e)=>new Promise((t,r)=>{var n=h=>{try{o(e.next(h))}catch(d){r(d)}},s=h=>{try{o(e.throw(h))}catch(d){r(d)}},o=h=>h.done?t(h.value):Promise.resolve(h.value).then(n,s);o((e=e.apply(l,i)).next())});var $t="Failed to get DOM canvas context. Make sure the 2D canvas context is supported",_t="Text render group generation is incorrectly implemented. Please report this bug if you are not responsible for text rendering for this Widget.",S={CANVAS_CONTEXT:`${$t}.`,REUSABLE_CANVAS_CONTEXT:`${$t} and the canvas is not being reused with a different rendering context.`,NEGATIVE_TEXT_GROUP:`Unexpected text render group with negative width detected. ${_t}`,EMPTY_LINE_RANGE:`Unexpected line range without any text render groups. Empty lines must contain a zero-width text render group. ${_t}`,ROGUE_NEWLINE:`Unexpected line range with newline character in the middle of the range instead of at the end. Text after newline character was ignored. ${_t}`,VIDEO_API_AVAILABLE:"HTMLVideoElement.requestVideoFrameCallback is available and will be used; if video playback is choppy or broken, please report it on Github",DIMENSIONLESS_CANVAS:"Canvas has 0 width or height. Are you using an empty Root? If not, make sure to not over-constrain the Widgets.",NON_POW2_CANVAS:"Canvas has a width or height that is not a power of 2, which may create mipmapping issues for 3D engines. Make sure to use power of 2 starting and maximum canvas dimensions.",DOM_DRIVER_REBIND:"Re-binding DOM driver. Are you calling bindDOMElem with the same HTML element multiple times?",PARENTLESS_CLIPVP:"Attempt to use ClippedViewport without a parent. If you are implementing a custom Root subclass, keep in mind that a Viewport with a rendering context must be used; ClippedViewport can't be used because it inherits a parent Viewport's rendering context."};function de(l){return typeof l=="string"?l:"<Symbol()>"}a(de,"propStr");function Oe(l){return typeof l=="string"?`"${l}"`:String(l)}a(Oe,"valueStr");var Gt="This may be caused by floating pointer precision errors.",b={INVALID_BACKGROUND_FILL:l=>`Unknown theme property: ${de(l)}. Valid background fill theme properties: "primaryFill", "accentFill", "backgroundGlowFill" and "backgroundFill".`,SWAPPED_MIN_MAX_NAMED:(l,i,e,t)=>`${de(t)} value (${Oe(i)}) can't be smaller than ${de(e)} value (${Oe(l)}).`,SWAPPED_MIN_MAX:(l,i)=>b.SWAPPED_MIN_MAX_NAMED(l,i,"Minimum","Maximum"),INVALID_VALUE:(l,i,e=!1)=>`${de(l)} value (${Oe(i)}) must be a valid${e?" non-negative":""} finite number. Make sure that it's not infinite and not NaN.`,NEGATIVE_VALUE:(l,i)=>`${de(l)} value (${Oe(i)}) must be greater or equal to zero.`,NON_ARRAY_VALUE:(l,i)=>`${de(l)} value (${Oe(i)}) must be an array.`,INVALID_MIN:l=>b.INVALID_VALUE("Minimum",l),INVALID_MAX:l=>b.INVALID_VALUE("Maximum",l),INVALID_INC:l=>b.INVALID_VALUE("Increment",l),NEGATIVE_INC:l=>b.NEGATIVE_VALUE("Increment",l),SWAPPED_MIN_MAX_DIMS:(l,i,e,t)=>`${b.SWAPPED_MIN_MAX_NAMED(l,i,e,t)} Set ${de(e)} to ${de(t)}. ${Gt}`,NEGATIVE_DIMS:(l,i)=>`${b.NEGATIVE_VALUE(i,l)} Set ${de(i)} to 0. ${Gt}`,BROKEN_CONSTRAINTS:(l,i,e,t)=>`${e?"Horizont":"Vertic"}al ${t?"ov":"und"}erflow in Widget; Limit: ${i}, actual value: ${l}.`,INVALID_DIMS:(l,i)=>b.INVALID_VALUE(l?"Width":"Height",i,!0),INACTIVE_WIDGET:l=>`Cannot get ${l} property; Widget is not active. Make sure the Widget is in a UI tree and to never directly call Widget update, layout resolution or painting methods.`,INVALID_ACTIVATION:l=>`Attempt to ${l?"":"de"}activate ${l?"":"in"}active Widget. Make sure the Widget is not being reused in another Root without first removing it from the first Root.`,INVALID_KB_ROW_TEMPLATE:l=>`Unknown virtual key row template format for entry: ${l}. A key row template must either be a function that returns a VirtualKey instance, or a pair of symbols.`,INVALID_ENUM:(l,i,e)=>`Unknown ${i} value: ${l}. Make sure ${e} is being passed as an enum value instead of its corresponding hardcoded value; this value may have become invalid due to an update.`,OVERCAPTURING_WIDGET:l=>`TabSelect event captured by widget (${l.constructor.name}), but reachedRelative was false; a widget type is probably capturing events by default. Make sure to only capture events that you need so that other Widgets aren't broken.`,MAYBE_DIMENSIONLESS:l=>`ViewportWidget has no minimum ${l} and ${l} isn't bi-directionally coupled, therefore, it may be dimensionless. Set a minimum ${l} and/or bi-directionally couple the ${l}.`,UNTARGETABLE_EVENT:l=>`${l} events cannot be targetted to a specific widget. Target ignored`};function zt(){console.groupCollapsed("Stack trace"),console.trace(),console.groupEnd()}a(zt,"groupedStackTrace");function ct(l){return function(i,e){let t=new WeakMap;Object.defineProperty(i,e,{set:function(r){let n=t.get(this);r!==n&&(t.set(this,r),l.call(this,n))},get:function(){return t.get(this)},enumerable:!0,configurable:!0})}}a(ct,"watchField");function ut(l){return ct(function(i){this[l]=!0})}a(ut,"flagField");var we=ut("_dirty"),ie=ut("_layoutDirty");function Q(l){return ct(function(i){for(let e of l)this[e]=!0})}a(Q,"multiFlagField");var Ri=Q(["_dirty","_layoutDirty"]);function Ae(l,i=!1){return function(e,t){let r=new WeakMap;Object.defineProperty(e,t,{set:function(n){if(Array.isArray(n)){let s=r.get(this);if(Array.isArray(s)){if(n.length!==s.length){s.length=n.length;for(let o=0;o<n.length;o++)s[o]=n[o];l.call(this)}else for(let o=0;o<n.length;o++)if(s[o]!==n[o]){for(let h=0;h<n.length;h++)s[h]=n[h];l.call(this);return}}else r.set(this,[...n]),l.call(this)}else if(i)r.set(this,n),l.call(this);else throw new Error(b.NON_ARRAY_VALUE(t,n))},get:function(){let n=r.get(this);return Array.isArray(n)?[...n]:n},enumerable:!0,configurable:!0})}}a(Ae,"watchArrayField");function Qt(l,i=!1){return Ae(function(){this[l]=!0},i)}a(Qt,"flagArrayField");function jt(l=!1){return Qt("_dirty",l)}a(jt,"paintArrayField");function Zt(l=!1){return Qt("_layoutDirty",l)}a(Zt,"layoutArrayField");function mi(l,i=!1){return Ae(function(){for(let e of l)this[e]=!0},i)}a(mi,"multiFlagArrayField");function qt(l=!1){return mi(["_dirty","_layoutDirty"],l)}a(qt,"paintLayoutArrayField");var K=class{constructor(i,e,t,r=!1){this.target=i,this.focusType=e,this.needsFocus=t,this.reversed=r}};a(K,"Event");var Pe=class extends K{constructor(e,t,r,n,s,o){super(n,s,o);this.shift=e,this.ctrl=t,this.alt=r}};a(Pe,"ModifierEvent");var W=class extends Pe{constructor(e,t,r,n,s,o=null,h=null){super(r,n,s,o,h,!1);this.x=e,this.y=t}};a(W,"PointerEvent");var F=class{constructor(i,e){this.parent=null;this.child=i,this.relativeCoordinates=e,this.constraints=[0,1/0,0,1/0],this.rect=[0,0,0,0],this.offset=[0,0]}updateEverything(){this.child.forceDirty(),this.updateChildPos()}forceLayoutDirty(){this.child.forceDirty()}updateChildPos(){if(!this.relativeCoordinates&&this.child.active){let[i,e,t,r]=this.rect,[n,s]=this.offset,o=i+n,h=e+s,[d,c]=this.child.position;(o!==d||h!==c)&&(this.child.resolvePosition(o,h),this.child.finalizeBounds())}}resolveLayout(){if(!this.child.layoutDirty)return!1;let[i,e]=this.child.dimensions;this.child.resolveDimensionsAsTop(...this.constraints),this.relativeCoordinates?this.child.resolvePosition(0,0):this.child.resolvePosition(...this.child.idealPosition),this.child.finalizeBounds();let[t,r]=this.child.dimensions;return t!==i||r!==e}dispatchEvent(i){if(i instanceof W){let[e,t,r,n]=this.rect,s=e+r,o=t+n;if(i.target===null&&(i.x<e||i.x>=s||i.y<t||i.y>=o))return null;if(this.relativeCoordinates){let[h,d]=this.offset,c=e+h,u=t+d;(c!==0||u!==0)&&(i=i.correctOffset(c,u))}}return this.child.dispatchEvent(i)}getClippedViewport(){let[i,e,t,r]=this.rect,[n,s]=this.child.dimensions,[o,h]=this.offset,d=i+t,c=e+r,u=i+o,p=e+h,f=Math.min(Math.max(u,i),d),m=Math.min(Math.max(p,e),c),g=Math.min(Math.max(u+n,i),d)-f,k=Math.min(Math.max(p+s,e),c)-m;return[i,e,t,r,u,p,f,m,g,k]}};a(F,"BaseViewport"),F.dimensionlessWarned=!1,F.powerOf2Warned=!1,F.maxRelayout=4,x([Ae(F.prototype.forceLayoutDirty)],F.prototype,"constraints",2),x([Ae(F.prototype.updateEverything)],F.prototype,"rect",2),x([Ae(F.prototype.updateChildPos)],F.prototype,"offset",2);function kt(l,i=!0){return Math.pow(2,(i?Math.ceil:Math.floor)(Math.log2(l)))}a(kt,"roundToPower2");function Pt(l){return(l&l-1)===0}a(Pt,"isPower2");var re=class extends F{constructor(e,t=1,r=64,n=64){super(e,!0);this.maxCanvasWidth=16384;this.maxCanvasHeight=16384;this._forceResize=!0;this._prevESX=1;this._prevESY=1;this.resolution=t,this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=n;let s=this.canvas.getContext("2d",{alpha:!0});if(s===null)throw new Error(S.CANVAS_CONTEXT);this.context=s,this.child.forceDirty()}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}resolveLayout(){let e=super.resolveLayout();if(e||this._forceResize){this._forceResize=!1;let[t,r]=this.child.dimensions,n=t*this.resolution,s=r*this.resolution,o=Math.min(Math.max(kt(n),this.canvas.width),this.maxCanvasWidth),h=Math.min(Math.max(kt(s),this.canvas.height),this.maxCanvasHeight);o===0||h===0?F.dimensionlessWarned||(F.dimensionlessWarned=!0,console.warn(S.DIMENSIONLESS_CANVAS)):(!Pt(o)||!Pt(h))&&(F.powerOf2Warned||(F.powerOf2Warned=!0,console.warn(S.NON_POW2_CANVAS)));let d=this.canvas.width,c=this.canvas.height,[u,p]=this.effectiveScale,f=d!==0&&c!==0;if((u!==this._prevESX||p!==this._prevESY)&&(this._prevESX=u,this._prevESY=p,f=!1,e=!0,this.child.forceDirty(!1),this.child.finalizeBounds()),o!==d||h!==c){e=!0;let m=null;if(f){m=document.createElement("canvas"),m.width=d,m.height=c;let g=m.getContext("2d");if(g===null)throw new Error(S.CANVAS_CONTEXT);g.globalCompositeOperation="copy",g.drawImage(this.canvas,0,0,d,c,0,0,d,c)}this.canvas.width=o,this.canvas.height=h,m!==null&&(this.context.globalCompositeOperation="copy",this.context.drawImage(m,0,0,m.width,m.height,0,0,Math.min(m.width,this.maxCanvasWidth),Math.min(m.height,this.maxCanvasHeight)),this.context.globalCompositeOperation="source-over")}}return e}get effectiveScale(){let[e,t]=this.child.dimensions;return[Math.min(this.maxCanvasWidth/e,this.resolution),Math.min(this.maxCanvasHeight/t,this.resolution)]}paintToInternal(e){let t=this.child.dirty,[r,n]=this.effectiveScale,s=r!==1||n!==1;return s&&(this.context.save(),this.context.scale(r,n)),this.child.paint(e),s&&this.context.restore(),t}paint(e,t){let r=this.paintToInternal(e);if(this.parent!==null){let[n,s,o,h,d,c,u,p,f,m]=this.getClippedViewport(),g=this.parent.context;if(g.save(),g.globalCompositeOperation="copy",g.fillStyle=t,g.beginPath(),g.rect(n,s,o,h),g.clip(),f!==0&&m!==0){let[k,v]=this.effectiveScale;g.drawImage(this.canvas,(u-d)*k,(p-c)*v,f*k,m*v,u,p,f,m)}g.rect(u,p,f,m),g.clip("evenodd"),g.fill(),g.restore()}return r}};a(re,"CanvasViewport"),x([we],re.prototype,"maxCanvasWidth",2),x([we],re.prototype,"maxCanvasHeight",2),x([ut("_forceResize")],re.prototype,"resolution",2);var Ne=class extends F{get context(){if(this.parent===null)throw S.PARENTLESS_CLIPVP;return this.parent.context}get effectiveScale(){if(this.parent===null)throw S.PARENTLESS_CLIPVP;return this.parent.effectiveScale}constructor(i){super(i,!1)}paint(i,e){let t=this.child.dirty,[r,n,s,o,h,d,c,u,p,f]=this.getClippedViewport(),m=this.context;return m.save(),m.globalCompositeOperation="copy",m.fillStyle=e,m.beginPath(),m.rect(r,n,s,o),m.clip(),m.rect(c,u,p,f),m.clip("evenodd"),m.fill(),m.restore(),p===0||f===0?(this.child.dryPaint(),t):(m.save(),m.beginPath(),m.rect(r,n,s,o),m.clip(),this.child.paint(i),m.restore(),t)}};a(Ne,"ClippedViewport");var ft=(n=>(n.SpaceBetween="between",n.SpaceAround="around",n[n.Start=0]="Start",n[n.Center=.5]="Center",n[n.End=1]="End",n))(ft||{});var ce=(r=>(r.Stretch="stretch",r[r.Start=0]="Start",r[r.Center=.5]="Center",r[r.End=1]="End",r))(ce||{});var Ue=class extends K{constructor(e,t){super(null,null,!1);this.originallyRelativeTo=e,this.bounds=[...t]}cloneWithTarget(e){return e!==null&&!Ue.targetWarned&&(Ue.targetWarned=!0,console.warn(b.UNTARGETABLE_EVENT("AutoScroll"))),new Ue(this.originallyRelativeTo,this.bounds)}},q=Ue;a(q,"AutoScroll"),q.targetWarned=!1;var Xe=class extends K{constructor(e,t){super(null,null,!1,t);this.relativeTo=e,this.reachedRelative=e===null}cloneWithTarget(e){e!==null&&!Xe.targetWarned&&(Xe.targetWarned=!0,console.warn(b.UNTARGETABLE_EVENT("TabSelect")));let t=new Xe(this.relativeTo,this.reversed);return t.reachedRelative=this.reachedRelative,t}},X=Xe;a(X,"TabSelect"),X.targetWarned=!1;var Ke=null,J=[],Jt=64,gi=1e4;function pt(l,i){let e=new Date().getTime(),t=null,r=-1,n=J.length-1;for(let o=0;o<J.length;o++){let h=J[o];if(h[0]===i&&h[1]===l){t=h,r=o;break}e-h[4]>gi&&(n=o)}if(t){let o=++t[3];if(t[4]=e,r>0){let h=0;for(;h<r&&!(J[h][3]<=o);h++);h!==r&&(J.splice(r,1),J.splice(h,0,t))}return t[2]}if(Ke===null&&(Ke=document.createElement("canvas").getContext("2d"),Ke===null))throw new Error(S.CANVAS_CONTEXT);Ke.font=i;let s=Ke.measureText(l);if(Jt>0){J.length===Jt&&J.splice(n,1);let o=0;for(;o<J.length&&!(J[o][3]<=1);o++);J.splice(o,0,[i,l,s,1,e])}return s}a(pt,"measureTextDims");var bi=new Set([`
`,"	"]),ei=(e=>(e[e.Normal=0]="Normal",e[e.Shrink=1]="Shrink",e))(ei||{}),Wt=(t=>(t[t.Start=0]="Start",t[t.Center=.5]="Center",t[t.End=1]="End",t))(Wt||{}),yi="~!@#$%^&*()_+`1234567890-=qwertyuiop[]\\QWERTYUIOP{}|asdfghjkl;'ASDFGHJKL:\"zxcvbnm,./ZXCVBNM<>?",D=class{constructor(){this.text="";this.font="";this.maxWidth=1/0;this.lineHeight=null;this.lineSpacing=null;this.tabWidth=4;this.wrapMode=0;this.alignMode=0;this._width=0;this._height=0;this._lineHeight=0;this._lineSpacing=0;this._tabWidth=0;this.measureDirty=!0;this.maxWidthDirty=!1;this.lineHeightSpacingDirty=!0;this.tabWidthDirty=!0;this._dirty=!1;this._lineRanges=[];this.hasWrappedLines=!1}get dirty(){let i=this._dirty;return this._dirty=!1,i}measureTextSlice(i,e,t){let r=pt(this.text.slice(e,t),this.font);return i===0?r.width+Math.max(0,r.actualBoundingBoxLeft):i+r.width}getLineRangeWidthUntil(i,e){if(e<=i[0][0])return 0;let t=0;for(;t<i.length;t++){let s=i[t],o=s[1];if(e==o)return s[2];if(e>=s[0]&&e<o)break}if(t===i.length)return i[t-1][2];let r=0;t>0&&(r=i[t-1][2]);let n=i[t];return n[3]?r+n[2]*(e-n[0])/(n[1]-n[0]):this.measureTextSlice(r,n[0],e)}measureText(i,e,t,r){var u,p;let n=0;for(;n<r.length;n++){let f=r[n];if(i>=f[0]&&i<f[1]){i=f[0];break}}if(n>0){let f=r[n-1];f[1]!==i&&(i=f[1],--n>0?f=r[n]:f=null),f!==null&&!f[3]&&!bi.has(this.text[i])&&(i=f[0],n--)}let s=0;n>0&&(s=r[n-1][2]);let o=i,h=[];for(;o<e;)if(this.text[o]==="	"){let f=this.actualTabWidth;s=(Math.floor(s/f)+1)*f,h.push([o,++o,s,!0])}else if(this.text[o]===`
`){h.push([o,++o,s,!0]),o<e&&console.warn(S.ROGUE_NEWLINE);break}else{let f=this.text.indexOf(`
`,o+1);f===-1&&(f=1/0);let m=this.text.indexOf("	",o+1);m===-1&&(m=1/0);let g=Math.min(f,m,e);s=this.measureTextSlice(s,o,g),h.push([o,g,s,!1]),o=g}let d=n+h.length,c=(p=(u=h[h.length-1])!=null?u:r[n-1])!=null?p:null;return c===null?(r.length=0,r.push([i,i,0,!1]),!0):d===1&&c[1]-c[0]<=1||c[2]<=t?(r.length=n,r.push(...h),!0):!1}updateTextDims(){if(this.lineHeightSpacingDirty){this.lineHeightSpacingDirty=!1;let e=this._lineHeight,t=this._lineSpacing;if(this.lineHeight===null||this.lineSpacing===null){let r=pt(yi,this.font);this.lineHeight===null?this._lineHeight=r.actualBoundingBoxAscent:this._lineHeight=this.lineHeight,this.lineSpacing===null?this._lineSpacing=r.actualBoundingBoxDescent:this._lineSpacing=this.lineSpacing}else this._lineHeight=this.lineHeight,this._lineSpacing=this.lineSpacing;(e!==this._lineHeight||t!==this._lineSpacing)&&(this.measureDirty=!0)}if(this.maxWidthDirty&&(this.maxWidthDirty=!1,this.maxWidth===1/0?this.hasWrappedLines&&(this.measureDirty=!0):(this.hasWrappedLines||this._width>this.maxWidth)&&(this.measureDirty=!0)),this.tabWidthDirty&&(this.tabWidthDirty=!1,this._tabWidth=pt(" ",this.font).width*this.tabWidth),!this.measureDirty)return;this.measureDirty=!1,this.hasWrappedLines=!1;let i=this._lineHeight+this._lineSpacing;if(this.text.length===0)this._height=i,this._width=this.maxWidth===1/0?0:this.maxWidth,this._lineRanges.length=1,this._lineRanges[0]=[[0,0,0,!1]];else if(this.maxWidth===1/0){this._lineRanges.length=0;let e=0;this._height=0,this._width=0;let t=this.text;for(;;){let r=this.text.indexOf(`
`,e),n=r===-1,s=n?t.length:r+1,o=[];this.measureText(e,s,1/0,o),this._lineRanges.push(o),this._height+=i;let h=o[o.length-1][2];if(h>this._width&&(this._width=h),n)break;e=s}}else{this._lineRanges.length=0;let e=[],t=this.text,r=/\s/,n=-1;for(let s=0;s<=t.length;){let o=r.test(t[s]),h=s===t.length;if(o||h){if(n>=0&&!this.measureText(n,s,this.maxWidth,e)){this.hasWrappedLines=!0;let d=[];if(this.measureText(n,s,this.maxWidth,d)){if(e.length===0)throw new Error(S.EMPTY_LINE_RANGE);this._lineRanges.push(e),e=d}else{let c=n;for(;c<s-1&&this.measureText(c,c+1,this.maxWidth,e);c++);this._lineRanges.push(e),e=d,s=c,n=c;continue}}if(n=-1,h){if(e.length===0){let d=this._lineRanges[this._lineRanges.length-1];if(d===void 0)e.push([0,0,0,!1]);else{let c=d[d.length-1];c===void 0?e.push([0,0,0,!1]):e.push([c[1],c[1],0,!1])}}this._lineRanges.push(e);break}if(t[s]===`
`)this.measureText(s,s+1,1/0,e),this._lineRanges.push(e),e=[];else if(!this.measureText(s,s+1,this.maxWidth,e))if(this.wrapMode===1){let d=s;do s++;while(t[s]!==`
`&&r.test(t[s]));let c=e[e.length-1];e.push([d,s,c!==void 0?c[2]:0,!0]),this._lineRanges.push(e),e=[];continue}else this.hasWrappedLines=!0,this._lineRanges.push(e),e=[],this.measureText(s,s+1,1/0,e)}else n===-1&&(n=s);s++}this._width=this.maxWidth,this._height=i*this._lineRanges.length}}paintGroup(i,e,t,r,n){!e[3]&&e[2]>t&&i.fillText(this.text.slice(e[0],e[1]),r,n)}paint(i,e,t,r){i.save(),i.beginPath(),i.rect(t,r,this.width,this.height),i.clip(),i.font=this.font,i.fillStyle=e,i.textBaseline="alphabetic",this.updateTextDims();let n=this.fullLineHeight,s=r+this._lineHeight;for(let o=0;o<this._lineRanges.length;o++){let h=0,d=this.getLineShift(o);for(let c of this._lineRanges[o])this.paintGroup(i,c,h,t+h+d,s),h=c[2];s+=n}i.restore()}findOffsetFromIndex(i){if(this.updateTextDims(),i<=0||this._lineRanges.length===0)return[this.getLineShift(0),0];let e=0;for(let t of this._lineRanges){if(i<t[t.length-1][1])break;e++}return e>=this._lineRanges.length&&(e=this._lineRanges.length-1,i=this.text.length),[this.getLineRangeWidthUntil(this._lineRanges[e],i)+this.getLineShift(e),e*this.fullLineHeight]}findIndexOffsetFromOffset(i){let e=this.fullLineHeight,t=this.getLineShift(0);if(this.text===""||i[0]<=t&&i[1]<e||i[1]<0)return[0,[t,0]];let r=Math.floor(i[1]/e);if(this.updateTextDims(),r>=this._lineRanges.length){let v=this.text.length;return[v,this.findOffsetFromIndex(v)]}let n=r*e,s=this._lineRanges[r],o=this.getLineShift(r);if(s.length===1&&s[0][0]===s[0][1])return[s[0][0],[s[0][2]+o,n]];let h=s[0][0],d=s[s.length-1][1];this.text[d-1]===`
`&&d--;let c=-1,u=0,p=i[0]-o,f=h,m=d+1,g=0,k=0;do{let v=f+Math.floor((m-f)/2),P=this.getLineRangeWidthUntil(s,v);P>=p?(m=v,c=v,u=P):(f=v+1,g=v,k=P)}while(f!==m);if(g<d){let v=g+1,P=u;c!==v&&(P=this.getLineRangeWidthUntil(s,v));let w=k+(P-k)/2;if(p>=w)return[v,[P+o,n]]}return[g,[k+o,n]]}getLine(i){if(i<=0)return 0;this.updateTextDims();for(let e=0;e<this._lineRanges.length;e++){let t=this._lineRanges[e],r=t[t.length-1];if(i<r[1])return e}return this._lineRanges.length-1}getLineStart(i){if(i<=0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let e=this._lineRanges[this._lineRanges.length-1];return e[e.length-1][1]}return this._lineRanges[i][0][0]}getLineEnd(i,e=!0){if(i<0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let s=this._lineRanges[this._lineRanges.length-1];return s[s.length-1][1]}let t=this._lineRanges[i],r=t[t.length-1],n=r[1];return!e&&n>0&&this.text[n-1]===`
`&&r[0]!==r[1]?n-1:n}getLineShift(i){let e=this.alignMode;if(e===0)return 0;if(this.updateTextDims(),i<0)i=0;else if(i>=this._lineRanges.length)return this.width*e;let t=this._lineRanges[i];return(this.width-t[t.length-1][2])*e}get width(){return this.updateTextDims(),this._width}get height(){return this.updateTextDims(),this._height}get lineRanges(){return this.updateTextDims(),[...this._lineRanges]}get actualLineHeight(){return this.updateTextDims(),this._lineHeight}get actualLineSpacing(){return this.updateTextDims(),this._lineSpacing}get actualTabWidth(){return this.updateTextDims(),this._tabWidth}get fullLineHeight(){return this.updateTextDims(),this._lineHeight+this._lineSpacing}};a(D,"TextHelper"),x([Q(["_dirty","measureDirty"])],D.prototype,"text",2),x([Q(["_dirty","measureDirty","lineHeightSpacingDirty","tabWidthDirty"])],D.prototype,"font",2),x([Q(["_dirty","maxWidthDirty"])],D.prototype,"maxWidth",2),x([Q(["_dirty","measureDirty","lineHeightSpacingDirty"])],D.prototype,"lineHeight",2),x([Q(["_dirty","measureDirty","lineHeightSpacingDirty"])],D.prototype,"lineSpacing",2),x([Q(["_dirty","measureDirty","tabWidthDirty"])],D.prototype,"tabWidth",2),x([Q(["_dirty","measureDirty"])],D.prototype,"wrapMode",2),x([Q(["_dirty"])],D.prototype,"alignMode",2);var L=class{constructor(i,e){this.listener=null;this._fallbackTheme=e,typeof i!="undefined"&&(this._canvasFill=i.canvasFill,this._containerPadding=i.containerPadding,this._containerAlignment=i.containerAlignment,this._multiContainerSpacing=i.multiContainerSpacing,this._multiContainerAlignment=i.multiContainerAlignment,this._primaryFill=i.primaryFill,this._accentFill=i.accentFill,this._backgroundFill=i.backgroundFill,this._backgroundGlowFill=i.backgroundGlowFill,this._sliderMinLength=i.sliderMinLength,this._sliderThickness=i.sliderThickness,this._bodyTextFont=i.bodyTextFont,this._bodyTextFill=i.bodyTextFill,this._bodyTextHeight=i.bodyTextHeight,this._bodyTextSpacing=i.bodyTextSpacing,this._bodyTextAlign=i.bodyTextAlign,this._checkboxLength=i.checkboxLength,this._checkboxInnerPadding=i.checkboxInnerPadding,this._inputBackgroundFill=i.inputBackgroundFill,this._inputSelectBackgroundFill=i.inputSelectBackgroundFill,this._inputTextFont=i.inputTextFont,this._inputTextFill=i.inputTextFill,this._inputTextFillDisabled=i.inputTextFillDisabled,this._inputTextFillInvalid=i.inputTextFillInvalid,this._inputTextHeight=i.inputTextHeight,this._inputTextSpacing=i.inputTextSpacing,this._inputTextInnerPadding=i.inputTextInnerPadding,this._inputTextMinWidth=i.inputTextMinWidth,this._inputTextAlign=i.inputTextAlign,this._blinkRate=i.blinkRate,this._cursorThickness=i.cursorThickness,this._scrollBarThickness=i.scrollBarThickness,this._scrollBarMinPercent=i.scrollBarMinPercent,this._scrollBarMinPixels=i.scrollBarMinPixels,this._radioButtonLength=i.radioButtonLength,this._radioButtonInnerPadding=i.radioButtonInnerPadding)}get fallbackTheme(){return this._fallbackTheme}set fallbackTheme(i){if(this._fallbackTheme===i)return;let e=this._fallbackTheme;typeof e!="undefined"&&this.listener!==null&&e.unsubscribe(this.listener),typeof i!="undefined"&&(this.listener=t=>this.onThemeUpdated(t),i.subscribe(this.listener)),this._fallbackTheme=i,this.onThemeUpdated()}onThemeUpdated(i=null){}get canvasFill(){var i,e,t;return(t=(e=this._canvasFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.canvasFill)!=null?t:"rgba(0,0,0,0.5)"}set canvasFill(i){this._canvasFill!==i&&(this._canvasFill=i,this.onThemeUpdated("canvasFill"))}get containerPadding(){var i,e,t;return(t=(e=this._containerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerPadding)!=null?t:{left:4,right:4,top:4,bottom:4}}set containerPadding(i){this._containerPadding!==i&&(this._containerPadding=i,this.onThemeUpdated("containerPadding"))}get containerAlignment(){var i,e,t;return(t=(e=this._containerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerAlignment)!=null?t:{horizontal:0,vertical:0}}set containerAlignment(i){this._containerAlignment!==i&&(this._containerAlignment=i,this.onThemeUpdated("containerAlignment"))}get multiContainerSpacing(){var i,e,t;return(t=(e=this._multiContainerSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerSpacing)!=null?t:4}set multiContainerSpacing(i){this._multiContainerSpacing!==i&&(this._multiContainerSpacing=i,this.onThemeUpdated("multiContainerSpacing"))}get multiContainerAlignment(){var i,e,t;return(t=(e=this._multiContainerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerAlignment)!=null?t:{main:"between",cross:"stretch"}}set multiContainerAlignment(i){this._multiContainerAlignment!==i&&(this._multiContainerAlignment=i,this.onThemeUpdated("multiContainerAlignment"))}get primaryFill(){var i,e,t;return(t=(e=this._primaryFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.primaryFill)!=null?t:"rgb(0,127,255)"}set primaryFill(i){this._primaryFill!==i&&(this._primaryFill=i,this.onThemeUpdated("primaryFill"))}get accentFill(){var i,e,t;return(t=(e=this._accentFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.accentFill)!=null?t:"rgb(0,195,255)"}set accentFill(i){this._accentFill!==i&&(this._accentFill=i,this.onThemeUpdated("accentFill"))}get backgroundFill(){var i,e,t;return(t=(e=this._backgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundFill)!=null?t:"rgb(32,32,32)"}set backgroundFill(i){this._backgroundFill!==i&&(this._backgroundFill=i,this.onThemeUpdated("backgroundFill"))}get backgroundGlowFill(){var i,e,t;return(t=(e=this._backgroundGlowFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundGlowFill)!=null?t:"rgb(48,48,48)"}set backgroundGlowFill(i){this._backgroundGlowFill!==i&&(this._backgroundGlowFill=i,this.onThemeUpdated("backgroundGlowFill"))}get sliderMinLength(){var i,e,t;return(t=(e=this._sliderMinLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderMinLength)!=null?t:100}set sliderMinLength(i){this._sliderMinLength!==i&&(this._sliderMinLength=i,this.onThemeUpdated("sliderMinLength"))}get sliderThickness(){var i,e,t;return(t=(e=this._sliderThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderThickness)!=null?t:10}set sliderThickness(i){this._sliderThickness!==i&&(this._sliderThickness=i,this.onThemeUpdated("sliderThickness"))}get bodyTextFont(){var i,e,t;return(t=(e=this._bodyTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFont)!=null?t:"1rem sans-serif"}set bodyTextFont(i){this._bodyTextFont!==i&&(this._bodyTextFont=i,this.onThemeUpdated("bodyTextFont"))}get bodyTextFill(){var i,e,t;return(t=(e=this._bodyTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFill)!=null?t:"white"}set bodyTextFill(i){this._bodyTextFill!==i&&(this._bodyTextFill=i,this.onThemeUpdated("bodyTextFill"))}get bodyTextHeight(){var i,e,t;return(t=(e=this._bodyTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextHeight)!=null?t:null}set bodyTextHeight(i){this._bodyTextHeight!==i&&(this._bodyTextHeight=i,this.onThemeUpdated("bodyTextHeight"))}get bodyTextSpacing(){var i,e,t;return(t=(e=this._bodyTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextSpacing)!=null?t:null}set bodyTextSpacing(i){this._bodyTextSpacing!==i&&(this._bodyTextSpacing=i,this.onThemeUpdated("bodyTextSpacing"))}get bodyTextAlign(){var i,e,t;return(t=(e=this._bodyTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextAlign)!=null?t:0}set bodyTextAlign(i){this._bodyTextAlign!==i&&(this._bodyTextAlign=i,this.onThemeUpdated("bodyTextAlign"))}get checkboxLength(){var i,e,t;return(t=(e=this._checkboxLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxLength)!=null?t:12}set checkboxLength(i){this._checkboxLength!==i&&(this._checkboxLength=i,this.onThemeUpdated("checkboxLength"))}get checkboxInnerPadding(){var i,e,t;return(t=(e=this._checkboxInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxInnerPadding)!=null?t:2}set checkboxInnerPadding(i){this._checkboxInnerPadding!==i&&(this._checkboxInnerPadding=i,this.onThemeUpdated("checkboxInnerPadding"))}get inputBackgroundFill(){var i,e,t;return(t=(e=this._inputBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputBackgroundFill)!=null?t:"white"}set inputBackgroundFill(i){this._inputBackgroundFill!==i&&(this._inputBackgroundFill=i,this.onThemeUpdated("inputBackgroundFill"))}get inputSelectBackgroundFill(){var i,e,t;return(t=(e=this._inputSelectBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputSelectBackgroundFill)!=null?t:"rgb(0,195,255)"}set inputSelectBackgroundFill(i){this._inputSelectBackgroundFill!==i&&(this._inputSelectBackgroundFill=i,this.onThemeUpdated("inputSelectBackgroundFill"))}get inputTextFont(){var i,e,t;return(t=(e=this._inputTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFont)!=null?t:"1rem monospace"}set inputTextFont(i){this._inputTextFont!==i&&(this._inputTextFont=i,this.onThemeUpdated("inputTextFont"))}get inputTextFill(){var i,e,t;return(t=(e=this._inputTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFill)!=null?t:"black"}set inputTextFill(i){this._inputTextFill!==i&&(this._inputTextFill=i,this.onThemeUpdated("inputTextFill"))}get inputTextFillDisabled(){var i,e,t;return(t=(e=this._inputTextFillDisabled)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillDisabled)!=null?t:"grey"}set inputTextFillDisabled(i){this._inputTextFillDisabled!==i&&(this._inputTextFillDisabled=i,this.onThemeUpdated("inputTextFillDisabled"))}get inputTextFillInvalid(){var i,e,t;return(t=(e=this._inputTextFillInvalid)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillInvalid)!=null?t:"red"}set inputTextFillInvalid(i){this._inputTextFillInvalid!==i&&(this._inputTextFillInvalid=i,this.onThemeUpdated("inputTextFillInvalid"))}get inputTextHeight(){var i,e,t;return(t=(e=this._inputTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextHeight)!=null?t:null}set inputTextHeight(i){this._inputTextHeight!==i&&(this._inputTextHeight=i,this.onThemeUpdated("inputTextHeight"))}get inputTextSpacing(){var i,e,t;return(t=(e=this._inputTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextSpacing)!=null?t:null}set inputTextSpacing(i){this._inputTextSpacing!==i&&(this._inputTextSpacing=i,this.onThemeUpdated("inputTextSpacing"))}get inputTextInnerPadding(){var i,e,t;return(t=(e=this._inputTextInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextInnerPadding)!=null?t:2}set inputTextInnerPadding(i){this._inputTextInnerPadding!==i&&(this._inputTextInnerPadding=i,this.onThemeUpdated("inputTextInnerPadding"))}get inputTextMinWidth(){var i,e,t;return(t=(e=this._inputTextMinWidth)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextMinWidth)!=null?t:100}set inputTextMinWidth(i){this._inputTextMinWidth!==i&&(this._inputTextMinWidth=i,this.onThemeUpdated("inputTextMinWidth"))}get inputTextAlign(){var i,e,t;return(t=(e=this._inputTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextAlign)!=null?t:0}set inputTextAlign(i){this._inputTextAlign!==i&&(this._inputTextAlign=i,this.onThemeUpdated("inputTextAlign"))}get blinkRate(){var i,e,t;return(t=(e=this._blinkRate)!=null?e:(i=this._fallbackTheme)==null?void 0:i.blinkRate)!=null?t:.8}set blinkRate(i){this._blinkRate!==i&&(this._blinkRate=i,this.onThemeUpdated("blinkRate"))}get cursorThickness(){var i,e,t;return(t=(e=this._cursorThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.cursorThickness)!=null?t:1}set cursorThickness(i){this._cursorThickness!==i&&(this._cursorThickness=i,this.onThemeUpdated("cursorThickness"))}get scrollBarThickness(){var i,e,t;return(t=(e=this._scrollBarThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarThickness)!=null?t:8}set scrollBarThickness(i){this._scrollBarThickness!==i&&(this._scrollBarThickness=i,this.onThemeUpdated("scrollBarThickness"))}get scrollBarMinPercent(){var i,e,t;return(t=(e=this._scrollBarMinPercent)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPercent)!=null?t:.1}set scrollBarMinPercent(i){this._scrollBarMinPercent!==i&&(this._scrollBarMinPercent=i,this.onThemeUpdated("scrollBarMinPercent"))}get scrollBarMinPixels(){var i,e,t;return(t=(e=this._scrollBarMinPixels)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPixels)!=null?t:20}set scrollBarMinPixels(i){this._scrollBarMinPixels!==i&&(this._scrollBarMinPixels=i,this.onThemeUpdated("scrollBarMinPixels"))}get radioButtonLength(){var i,e,t;return(t=(e=this._radioButtonLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.radioButtonLength)!=null?t:12}set radioButtonLength(i){this._radioButtonLength!==i&&(this._radioButtonLength=i,this.onThemeUpdated("radioButtonLength"))}get radioButtonInnerPadding(){var i,e,t;return(t=(e=this._radioButtonInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.radioButtonInnerPadding)!=null?t:2}set radioButtonInnerPadding(i){this._radioButtonInnerPadding!==i&&(this._radioButtonInnerPadding=i,this.onThemeUpdated("radioButtonInnerPadding"))}};a(L,"BaseTheme");var vi=Math.PI*2,y=class extends L{constructor(e,t,r){var n,s;super(r);this._dirty=!0;this._layoutDirty=!0;this.width=0;this.height=0;this.x=0;this.y=0;this.idealWidth=0;this.idealHeight=0;this.idealX=0;this.idealY=0;this._root=null;this._viewport=null;this._parent=null;this.tabFocusable=!1;this.needsClear=e,this.propagatesEvents=t,this._enabled=(n=r==null?void 0:r.enabled)!=null?n:!0,this._flex=(s=r==null?void 0:r.flex)!=null?s:0}get flex(){return this._flex}set flex(e){e!==this._flex&&(this._flex=e,this._layoutDirty=!0)}set enabled(e){e!==this._enabled&&(this._enabled=e,this.forceDirty())}get enabled(){return this._enabled}set inheritedTheme(e){this.fallbackTheme=e}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){super.onThemeUpdated(e),this.needsClear&&(e===null||e==="canvasFill")&&(this._dirty=!0)}get dimensions(){return[this.width,this.height]}get idealDimensions(){return[this.idealWidth,this.idealHeight]}get position(){return[this.x,this.y]}get idealPosition(){return[this.idealX,this.idealY]}get bounds(){let e=this.x,t=this.y;return[e,e+this.width,t,t+this.height]}get idealBounds(){let e=this.idealX,t=this.idealY;return[e,e+this.idealWidth,t,t+this.idealHeight]}get rect(){return[this.x,this.y,this.width,this.height]}get idealRect(){return[this.idealX,this.idealY,this.idealWidth,this.idealHeight]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return this.width==0||this.height==0}onFocusGrabbed(e){}onFocusDropped(e){}handleEvent(e){return e.target===this?this:null}dispatchEvent(e){if(!this._enabled)return null;if(e.target===null){if(e instanceof W){if(e.x<this.x||e.y<this.y||e.x>=this.x+this.width||e.y>=this.y+this.height)return null}else if(e instanceof q){if(e.originallyRelativeTo===this)return this;if(!this.propagatesEvents)return null}}else if(e.target!==this&&!this.propagatesEvents)return null;let t=null;if(e.reversed&&(t=this.handleEvent(e)),e instanceof X)if(e.reachedRelative){if(this.tabFocusable&&(t===this||t===null))return this}else e.relativeTo===this&&(e.reachedRelative=!0);return e.reversed||(t=this.handleEvent(e)),t}handlePreLayoutUpdate(){}preLayoutUpdate(){this._enabled&&this.handlePreLayoutUpdate()}resolveDimensions(e,t,r,n){if(!this._enabled){this.width=0,this.height=0,this.idealWidth=0,this.idealHeight=0,this._layoutDirty=!1;return}if(e==1/0)throw new Error(b.INVALID_VALUE("minWidth",e));if(e>t&&(console.warn(b.SWAPPED_MIN_MAX_DIMS(e,t,"minWidth","maxWidth")),e=t),e<0&&(console.warn(b.NEGATIVE_DIMS(e,"minWidth")),e=0),r==1/0)throw new Error(b.INVALID_VALUE("minHeight",r));r>n&&(console.warn(b.SWAPPED_MIN_MAX_DIMS(r,n,"minHeight","maxHeight")),r=n),r<0&&(console.warn(b.NEGATIVE_DIMS(r,"minHeight")),r=0);let s=this.idealWidth,o=this.idealHeight;if(this.handleResolveDimensions(e,t,r,n),this.idealWidth<e?(this.idealWidth=e,console.error(b.BROKEN_CONSTRAINTS(this.idealWidth,e,!0,!1))):this.idealWidth>t&&(this.idealWidth=t,console.error(b.BROKEN_CONSTRAINTS(this.idealWidth,t,!0,!0))),this.idealWidth<0||!isFinite(this.idealWidth)||isNaN(this.idealWidth))throw new Error(b.INVALID_DIMS(!0,this.idealWidth));if(this.idealHeight<r?(this.idealHeight=r,console.error(b.BROKEN_CONSTRAINTS(this.idealHeight,r,!1,!1))):this.idealHeight>n&&(this.idealHeight=n,console.error(b.BROKEN_CONSTRAINTS(this.idealHeight,n,!1,!0))),this.idealHeight<0||!isFinite(this.idealHeight)||isNaN(this.idealHeight))throw new Error(b.INVALID_DIMS(!1,this.idealHeight));this._layoutDirty=!1,(s!==this.idealWidth||o!==this.idealHeight)&&(this._dirty=!0)}resolveDimensionsAsTop(e,t,r,n){this.resolveDimensions(e,t,r,n),(t===1/0||n===1/0)&&this.resolveDimensions(e,t===1/0?this.idealWidth:t,r,n===1/0?this.idealHeight:n)}resolvePosition(e,t){this.idealX=e,this.idealY=t}finalizeBounds(){let[e,t]=this.viewport.effectiveScale,r=Math.floor(this.idealX*e)/e,n=Math.floor(this.idealY*t)/t,s=Math.ceil((this.idealX+this.idealWidth)*e)/e-r,o=Math.ceil((this.idealY+this.idealHeight)*t)/t-n;(r!==this.x||n!==this.y||s!==this.width||o!==this.height)&&(this._dirty=!0),this.x=r,this.y=n,this.width=s,this.height=o}handlePostLayoutUpdate(){}postLayoutUpdate(){this._enabled&&this.handlePostLayoutUpdate()}clear(e,t,r,n,s=null){let o=this.viewport.context;o.save(),o.globalCompositeOperation="copy",o.fillStyle=s!=null?s:this.canvasFill,o.beginPath(),o.rect(e,t,r,n),o.clip(),o.fill(),o.restore()}clearStart(e=null){let t=this.viewport.context;t.save(),t.globalCompositeOperation="copy",t.fillStyle=e!=null?e:this.canvasFill,t.beginPath()}clearEnd(e="nonzero"){let t=this.viewport.context;t.clip(e),t.fill(),t.restore()}paintCircle(e,t,r){let n=this.viewport.context;n.beginPath(),n.arc(e,t,r,0,vi),n.fill()}handlePainting(e){}paint(e=!1){if(this.dimensionless)return this.dryPaint();if(!(!this._dirty&&!e)){if(this._enabled){this.needsClear&&this.clear(this.x,this.y,this.width,this.height);let t=this.viewport.context;t.save(),this.handlePainting(e),t.restore()}this._dirty=!1}}dryPaint(){this._dirty=!1}forceDirty(e=!0){this._dirty=!0,e&&(this._layoutDirty=!0)}get active(){return this._root!==null}get root(){if(!this.active)throw new Error(b.INACTIVE_WIDGET("root"));return this._root}get viewport(){if(!this.active)throw new Error(b.INACTIVE_WIDGET("viewport"));return this._viewport}get parent(){if(!this.active)throw new Error(b.INACTIVE_WIDGET("parent"));return this._parent}activate(e,t,r){if(this.active)throw new Error(b.INVALID_ACTIVATION(!0));this._root=e,this._viewport=t,this._parent=r,this.forceDirty()}deactivate(){if(!this.active)throw new Error(b.INVALID_ACTIVATION(!1));this._root=null,this._viewport=null,this._parent=null}autoScroll(){this.root.dispatchEvent(new q(this,[0,this.idealWidth,0,this.idealHeight]))}};a(y,"Widget");var We=class extends y{constructor(e,t,r,n){super(t,r,n);this._children=[...e]}set inheritedTheme(e){super.inheritedTheme=e;for(let t of this.children)t.inheritedTheme=e}get inheritedTheme(){return super.inheritedTheme}dryPaint(){super.dryPaint();for(let e of this.children)e.dryPaint()}forceDirty(e=!0){super.forceDirty(e);for(let t of this.children)t.forceDirty(e)}get childCount(){return this._children.length}get children(){return this._children.values()}activate(e,t,r){super.activate(e,t,r);for(let n of this.children)n.activate(e,t,this)}deactivate(){super.deactivate();for(let e of this.children)e.deactivate()}finalizeBounds(){super.finalizeBounds();for(let e of this.children)e.finalizeBounds()}};a(We,"Parent");var Ye=class extends We{add(i){if(Array.isArray(i)){let e=this.active;for(let t of i)this._children.push(t),t.inheritedTheme=this.inheritedTheme,e&&t.activate(this.root,this.viewport,this)}else this._children.push(i),i.inheritedTheme=this.inheritedTheme,this.active&&i.activate(this.root,this.viewport,this);return this.forceDirty(),this}remove(i){if(Array.isArray(i)){let e=this.active;for(let t of i){let r=this._children.indexOf(t);r!==-1&&this._children.splice(r,1),e&&t.deactivate()}}else{let e=this._children.indexOf(i);e!==-1&&this._children.splice(e,1),this.active&&i.deactivate()}return this.forceDirty(),this}clearChildren(){if(this.active)for(let i of this._children)i.deactivate();return this._children.length=0,this.forceDirty(),this}};a(Ye,"MultiParent");var ue=class extends Ye{constructor(e,t){super([],!1,!0,t);this.backgroundDirty=!0;this.unusedSpace=0;this.enabledChildCount=0;this.vertical=e}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="multiContainerAlignment"?this._layoutDirty=!0:e==="multiContainerSpacing"&&(this._layoutDirty=!0)}handleEvent(e){let t=this.children;e.reversed&&(t=Array.from(t).reverse());for(let r of t){if(!r.enabled)continue;let n=r.dispatchEvent(e);if(n!==null)return n}return null}handlePreLayoutUpdate(){for(let e of this.children)e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){for(let e of this.children)e.postLayoutUpdate(),e.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=0,o=0,h=0,d=this.vertical?n:t;this.multiContainerAlignment.cross==="stretch"&&(h=this.vertical?t:n,h==1/0&&(h=this.vertical?e:r)),this.enabledChildCount=0;for(let _ of this.children){if(!_.enabled){_.resolveDimensions(0,0,0,0);continue}this.enabledChildCount++;let[I,H]=_.idealDimensions;this.vertical?_.resolveDimensions(h,t,0,1/0):_.resolveDimensions(0,1/0,h,n);let[U,G]=_.idealDimensions;s+=_.flex,o=Math.max(this.vertical?U:G,o),(U!==I||G!==H)&&(this.backgroundDirty=!0)}let u=this.vertical?e:r;o<u&&(o=u);let p=this.multiContainerSpacing,f=Math.max(this.enabledChildCount-1,0)*p;for(let _ of this.children)!_.enabled||(f+=this.vertical?_.idealDimensions[1]:_.idealDimensions[0]);let m=d-f;if(m==1/0||m<=0){let _=this.idealWidth,I=this.idealHeight;this.vertical?(this.idealWidth=o,this.idealHeight=Math.min(f,n)):(this.idealWidth=Math.min(f,t),this.idealHeight=o),(this.idealWidth!==_||this.idealHeight!==I)&&(this.backgroundDirty=!0),this.unusedSpace=0;let H=d;for(let U of this.children){if(!U.enabled)continue;let[G,Te]=U.idealDimensions;if(this.vertical){let z=Math.min(H,Te);U.resolveDimensions(h,t,z,z)}else{let z=Math.min(H,G);U.resolveDimensions(z,z,h,n)}let[he,ht]=U.idealDimensions;(he!==G||ht!==Te)&&(this.backgroundDirty=!0);let dt=this.vertical?Te:G;H=Math.max(0,H-dt-p)}return}let g=0,k=0;s>0&&(k=m/s);for(let _ of this.children){if(!_.enabled)continue;g!==0&&(g+=p);let I=k*_.flex,[H,U]=_.idealDimensions;if(this.vertical){let he=I+U;_.resolveDimensions(h,t,he,he)}else{let he=I+H;_.resolveDimensions(he,he,h,n)}let[G,Te]=_.idealDimensions;g+=this.vertical?Te:G,(G!==H||Te!==U)&&(this.backgroundDirty=!0)}let v=this.idealWidth,P=this.idealHeight,w;this.vertical?(w=n,this.idealWidth=o,this.idealHeight=w):(w=t,this.idealWidth=w,this.idealHeight=o),(this.idealWidth!==v||this.idealHeight!==P)&&(this.backgroundDirty=!0),this.unusedSpace=Math.max(w-g,0)}resolvePosition(e,t){super.resolvePosition(e,t);let r=this.multiContainerAlignment,n=r.main==="around",s=r.main==="between"||n,o=s?0:r.main,h=r.cross==="stretch"?0:r.cross,d=this.enabledChildCount-1+(n?2:0),c;d<=0?c=0:c=this.unusedSpace/d;let u=this.multiContainerSpacing;s&&(u+=c);let p=(this.vertical?t:e)+o*this.unusedSpace;n&&(p+=c);for(let f of this.children){if(!f.enabled)continue;let[m,g]=f.idealPosition,[k,v]=f.idealDimensions;this.vertical?(f.resolvePosition(e+h*(this.idealWidth-k),p),p+=v+u):(f.resolvePosition(p,t+h*(this.idealHeight-v)),p+=k+u);let[P,w]=f.idealPosition;(P!==m||w!==g)&&(this.backgroundDirty=!0)}}handlePainting(e){let t=[];for(let r of this.children)r.paint(e),r.enabled&&(this.backgroundDirty||e)&&t.push(r.rect);if(this.backgroundDirty||e){this.clearStart();let r=this.viewport.context;r.rect(...this.rect);for(let n of t)r.rect(...n);this.clearEnd("evenodd")}this.backgroundDirty=!1}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(e=!0){super.forceDirty(e),this.backgroundDirty=!0}};a(ue,"MultiContainer");var fe=class extends We{constructor(i,e,t,r){super([i],e,t,r)}get child(){return this._children[0]}};a(fe,"SingleParent");var pe=class extends fe{constructor(e,t,r){super(e,!1,t,r);this.backgroundDirty=!0}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}handleEvent(e){return this.child.dispatchEvent(e)}handlePreLayoutUpdate(){let e=this.child;e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let e=this.child;e.postLayoutUpdate(),e.dirty&&(this._dirty=!0),this.backgroundDirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.containerPadding,o=s.left+s.right,h=s.top+s.bottom,d=t-o,c=n-h;d<0&&(d=0),c<0&&(c=0);let u=this.containerAlignment,p=0;u.horizontal==="stretch"&&(d!==1/0?p=d:p=Math.max(e-o,0));let f=0;u.vertical==="stretch"&&(c!==1/0?f=c:f=Math.max(r-h,0));let[m,g]=this.child.idealDimensions;this.child.resolveDimensions(p,d,f,c);let[k,v]=this.child.idealDimensions,[P,w]=[this.idealWidth,this.idealHeight];this.idealWidth=Math.max(e,k+o),this.idealHeight=Math.max(r,v+h),(this.idealWidth!==P||this.idealHeight!==w||k!==m||v!==g)&&(this.backgroundDirty=!0)}resolvePosition(e,t){super.resolvePosition(e,t);let r=this.containerPadding,n=this.containerAlignment,[s,o]=this.child.idealDimensions,h=s+r.left+r.right,d=o+r.top+r.bottom,c=e+r.left;if(n.horizontal!=="stretch"){let m=this.idealWidth-h;m>0&&(c+=m*n.horizontal)}let u=t+r.top;if(n.vertical!=="stretch"){let m=this.idealHeight-d;m>0&&(u+=m*n.vertical)}let[p,f]=this.child.idealPosition;this.child.resolvePosition(c,u),(p!==c||f!==u)&&(this.backgroundDirty=!0)}handleBaseContainerPainting(e,t=null){if(this.backgroundDirty||e){this.clearStart(t);let r=this.viewport.context;r.rect(...this.rect),r.rect(...this.child.rect),this.clearEnd("evenodd"),this.backgroundDirty=!1}this.child.paint(e)}handlePainting(e){this.handleBaseContainerPainting(e)}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(e=!0){super.forceDirty(e),this.backgroundDirty=!0}};a(pe,"BaseContainer");var V=(t=>(t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard",t[t.Tab=2]="Tab",t))(V||{});var ti=(t=>(t[t.Pixel=0]="Pixel",t[t.Line=1]="Line",t[t.Page=2]="Page",t))(ti||{});function ii(l){switch(l){case 0:return 0;case 1:return 1;case 2:return 2;default:return null}}a(ii,"parseDOMDeltaMode");var j=class extends W{constructor(e,t,r,n,s,o,h,d,c,u,p=null){super(e,t,d,c,u,p,0);this.deltaX=r,this.deltaY=n,this.deltaZ=s,this.deltaMode=o,this.fromDrag=h}correctOffset(e,t){return new j(this.x-e,this.y-t,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(e){return new j(this.x,this.y,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,e)}getDeltaPixels(e,t,r,n,s=0){let o=1/0,h=1/0,d=1/0;if(e||this.deltaMode!==2){let c=t*j.PageLinesError;o=r-Math.min(r*j.PagePercentError,c),h=n-Math.min(n*j.PagePercentError,c),d=s-Math.min(s*j.PagePercentError,c)}switch(this.deltaMode){case 0:return[Math.min(o,Math.abs(this.deltaX))*Math.sign(this.deltaX),Math.min(h,Math.abs(this.deltaY))*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ))*Math.sign(this.deltaZ)];case 1:return[Math.min(o,Math.abs(this.deltaX)*t)*Math.sign(this.deltaX),Math.min(h,Math.abs(this.deltaY)*t)*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ)*t)*Math.sign(this.deltaZ)];case 2:{let c=t*j.PageLinesError;return[(Math.abs(this.deltaX)*r-Math.min(r*j.PagePercentError,c))*Math.sign(this.deltaX),(Math.abs(this.deltaY)*n-Math.min(n*j.PagePercentError,c))*Math.sign(this.deltaY),(Math.abs(this.deltaZ)*s-Math.min(s*j.PagePercentError,c))*Math.sign(this.deltaZ)]}default:throw new Error(b.INVALID_ENUM(this.deltaMode,"PointerWheelMode","deltaMode"))}}},M=j;a(M,"PointerWheel"),M.PageLinesError=3,M.PagePercentError=.1;var Z=class extends Pe{constructor(e,t,r,n,s){super(t,r,n,s,1,!0);this.key=e}};a(Z,"KeyEvent");var R=class extends Z{cloneWithTarget(i){return new R(this.key,this.shift,this.ctrl,this.alt,i)}};a(R,"KeyPress");var E=class extends K{constructor(i=null){super(i,0,!0)}cloneWithTarget(i){return new E(i)}};a(E,"Leave");var B=class extends L{constructor(e,t){super(e,t);this.subscribers=new Set}get fallbackTheme(){return super.fallbackTheme}set fallbackTheme(e){super.fallbackTheme=e}onThemeUpdated(e=null){for(let t of this.subscribers)t(e)}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}};a(B,"Theme");var mt=class{constructor(i,e=null,t=new B){this.drivers=new Set;this._enabled=!0;this.pointerStyle="default";this._currentPointerStyle="default";this._foci=new Map([[1,null],[0,null],[2,null]]);this._fociCapturers=new Map([[1,null],[0,null],[2,null]]);this.textInputHandler=null;this._mobileTextInUse=!1;this.viewport=new re(i),this.pointerStyleHandler=e,this.child.inheritedTheme=t,this.child.activate(this,this.viewport,null)}get constraints(){return this.viewport.constraints}set constraints(i){this.viewport.constraints=i}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(i){if(this._enabled!==i)if(this._enabled=i,i)for(let t of this.drivers)t.onEnable(this);else{for(let t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(let t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){return this.enabled?this.viewport.resolveLayout():!1}paint(){return this.enabled?this.viewport.paintToInternal(!1):!1}dispatchEvent(i){if(!this.enabled)return!1;if(i.focusType!==null&&i.target===null){let r=this._foci.get(i.focusType);if(typeof r=="undefined"&&(r=null),i.needsFocus&&r===null)return i instanceof R&&i.key==="Tab"&&this.dispatchEvent(new X(this.getFocus(2),i.shift)),!1;i=i.cloneWithTarget(r)}(i instanceof W&&!(i instanceof M)||i instanceof E)&&(this.pointerStyle="default");let e=this.child.dispatchEvent(i);if(e===null&&(i instanceof R&&(i.key==="Tab"?this.dispatchEvent(new X(this.getFocus(2),i.shift)):i.key==="Escape"&&this.clearFocus(1)),i instanceof X&&i.relativeTo!==null&&(i=new X(null,i.reversed),e=this.child.dispatchEvent(i))),i instanceof X&&(i.reachedRelative&&e===null&&(e=this.child.dispatchEvent(i)),e&&(!i.reachedRelative&&!mt.badTabCaptureWarned&&(mt.badTabCaptureWarned=!0,console.warn(b.OVERCAPTURING_WIDGET(e)),zt()),this.requestFocus(2,e))),i.focusType===null)return e!==null;let t=this.getFocusCapturer(i.focusType);if(t===e)return e!==null;i.focusType===0&&t!==null&&this.child.dispatchEvent(new E(t)),this._fociCapturers.set(i.focusType,e);for(let r of this.drivers)r.onFocusCapturerChanged(this,i.focusType,t,e);return e!==null}preLayoutUpdate(){if(!!this.enabled){for(let i of this.drivers)i.update(this);this.child.preLayoutUpdate()}}postLayoutUpdate(){!this.enabled||(this.child.postLayoutUpdate(),this.updatePointerStyle())}updatePointerStyle(i=null){i!==null&&(this.pointerStyle=i),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,this.pointerStyleHandler!==null&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(i,e){if(e!==null){let t=this._foci.get(i);if(e!==t){this.clearFocus(i),this._foci.set(i,e),e.onFocusGrabbed(i);for(let n of this.drivers)n.onFocusChanged(this,i,e)}let r=null;if(i===1&&(r=2),i===2&&(r=1),r!==null&&e!==this._foci.get(r)){this.clearFocus(r),this._foci.set(r,e),e.onFocusGrabbed(r);for(let n of this.drivers)n.onFocusChanged(this,r,e)}}}dropFocus(i,e){let t=this._foci.get(i);e===t&&this.clearFocus(i)}clearFocus(i){let e=this._foci.get(i);if(e){e.onFocusDropped(i),this._foci.set(i,null);for(let t of this.drivers)t.onFocusChanged(this,i,null)}}getFocus(i){var e;return(e=this._foci.get(i))!=null?e:null}getFocusCapturer(i){var e;return(e=this._fociCapturers.get(i))!=null?e:null}registerDriver(i){this.drivers.has(i)||(this.drivers.add(i),this._enabled&&i.onEnable&&i.onEnable(this))}unregisterDriver(i){!this.drivers.delete(i)||this._enabled&&i.onDisable&&i.onDisable(this)}clearDrivers(){for(let i of this.drivers)this.unregisterDriver(i)}get hasMobileTextInput(){return this.textInputHandler!==null&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(i=""){return Yt(this,null,function*(){if(this.textInputHandler!==null&&!this._mobileTextInUse){this._mobileTextInUse=!0;let e=yield this.textInputHandler(i);return this._mobileTextInUse=!1,e}return null})}get resolution(){return this.viewport.resolution}set resolution(i){this.viewport.resolution=i}get maxCanvasWidth(){return this.viewport.maxCanvasWidth}set maxCanvasWidth(i){this.viewport.maxCanvasWidth=i}get maxCanvasHeight(){return this.viewport.maxCanvasHeight}set maxCanvasHeight(i){this.viewport.maxCanvasHeight=i}get effectiveScale(){return this.viewport.effectiveScale}get child(){return this.viewport.child}},C=mt;a(C,"Root"),C.badTabCaptureWarned=!1;var N=new Map;function _e(l){let i=N.get(l);return i===void 0?(console.warn(`Unknown debug feature "${l}"; defaulting to not enabled`),!1):i[0]}a(_e,"isDebugFeatureEnabled");function xi(l,i){let e=N.get(l);if(e===void 0){console.warn(`Unknown debug feature "${l}"; ignored`);return}let[t,r]=e;i===void 0&&(i=!t),t!==i&&(e[0]=i,console.info(`[canvas-ui] ${i?"En":"Dis"}abled "${l}" debug feature`))}a(xi,"toggleDebugFeature");function Ti(){for(let[l,i]of N)console.info(`[canvas-ui] "${l}" (${i[0]?"en":"dis"}abled): ${i[1]}`)}a(Ti,"listDebugFeatures");function gt(l,i){let e=`${l.name}.${i}`,t=`watchflag.${e}`;if(N.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=`watchflag.${e}.strace`;if(N.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=new WeakMap;Object.defineProperty(l.prototype,i,{get(){return n.get(this)},set(s){if(_e(t)&&!n.get(this)&&s){let h=`[canvas-ui ${t}] ${this.constructor.name}.${i} set to true`;_e(r)?(console.groupCollapsed(h),console.trace(),console.groupEnd()):console.debug(h)}n.set(this,s)}}),N.set(t,[!1,`Show when ${e} is set to true`]),N.set(r,[!1,`Print stack trace when ${t} shows that a flag has been set`])}a(gt,"injectWatchflagFeature");function bt(l,i,e=null){let t=`${l.name}.${i}`,r=`trace.${t}`;if(N.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=[],s=new Map,o=l.prototype[i],h=0;function d(){h===0&&(_e(r)&&console.debug(`[canvas-ui ${r}] Trace:
${n.join(`
`)}`),h=0,n.length=0,s.clear())}a(d,"logMsgStack"),l.prototype[i]=function(...c){h++;let u=s.get(this);if(u===void 0){u=n.length,s.set(this,u);let f;h>1?f="  ".repeat(h-2)+"> ":f="",n.push(`${f}${this.constructor.name}`)}else n[u]+=", recall";e!==null&&(n[u]+=e.apply(this,c));let p=new Date().getTime();try{let f=o.apply(this,c);return n[u]+=` <${new Date().getTime()-p} ms>`,f}catch(f){throw n[u]+=" <exception thrown>",f}finally{h--,d()}},N.set(r,[!1,`Trace ${t} method calls`])}a(bt,"injectTraceFeature");function ee(l,i){let e=`${l.name}.${i}`,t=`randomfill.${e}`;if(N.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=Object.getOwnPropertyDescriptor(l.prototype,i);Object.defineProperty(l.prototype,i,{get(){if(_e(t))return"#"+Math.floor(Math.random()*16777215).toString(16);if((r==null?void 0:r.get)!==void 0)return r.get.apply(this)},set(n){(r==null?void 0:r.set)!==void 0&&r.set.apply(this,[n])}}),N.set(t,[!1,`(EPILEPSY WARNING) Override the ${e} theme property with a new random colour every time the theme property's value is fetched. Useful for visualising widget painting`])}a(ee,"injectRandomFillFeature");function T(l,i){let e=`${l.name}.${i}`,t=`stacktrace.${e}`;if(N.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=l.prototype[i];l.prototype[i]=function(...n){return _e(t)&&(console.groupCollapsed(`[canvas-ui ${t}] ${l.name}.${i} called`),console.trace(),console.groupEnd()),r.apply(this,n)},N.set(t,[!1,`Print stack trace when ${e} is called`])}a(T,"injectStackTraceFeature");function yt(l,i){let e=Math.abs(l)%1;return e<i?!0:e>1-i}a(yt,"isWhole");var ri=!1;function vn(){if(ri){console.warn("[canvas-ui] Already injected debug code; ignored");return}ri=!0,bt(y,"paint",u=>u?" (forced)":""),bt(y,"resolveDimensions",(u,p,f,m)=>` (${u}, ${p}, ${f}, ${m})`),bt(y,"resolvePosition",(u,p)=>` (${u}, ${p})`),bt(y,"dispatchEvent",u=>` (${u.constructor.name})`),T(C,"resolveLayout"),T(C,"paint"),T(C,"dispatchEvent"),T(C,"preLayoutUpdate"),T(C,"postLayoutUpdate"),T(C,"updatePointerStyle"),T(C,"requestFocus"),T(C,"dropFocus"),T(C,"clearFocus"),T(C,"getFocus"),T(C,"getFocusCapturer"),T(C,"registerDriver"),T(C,"unregisterDriver"),T(C,"clearDrivers"),T(C,"getTextInput"),T(y,"onThemeUpdated"),T(y,"onFocusDropped"),T(y,"handleEvent"),T(y,"dispatchEvent"),T(y,"handlePreLayoutUpdate"),T(y,"preLayoutUpdate"),T(y,"handleResolveDimensions"),T(y,"resolveDimensions"),T(y,"resolveDimensionsAsTop"),T(y,"resolvePosition"),T(y,"handlePostLayoutUpdate"),T(y,"postLayoutUpdate"),T(y,"clear"),T(y,"clearStart"),T(y,"clearEnd"),T(y,"roundRect"),T(y,"handlePainting"),T(y,"paint"),T(y,"dryPaint"),T(y,"forceDirty"),T(y,"scaleFont"),gt(y,"_dirty"),gt(y,"_layoutDirty"),gt(pe,"backgroundDirty"),gt(ue,"backgroundDirty"),ee(L,"canvasFill"),ee(L,"primaryFill"),ee(L,"accentFill"),ee(L,"backgroundFill"),ee(L,"backgroundGlowFill"),ee(L,"bodyTextFill"),ee(L,"inputBackgroundFill"),ee(L,"inputSelectBackgroundFill"),ee(L,"inputTextFill"),ee(L,"inputTextFillDisabled"),ee(L,"inputTextFillInvalid"),N.set("textrendergroups",[!1,"Draw text render groups in a TextHelper with alternating background colours (green and red). Width overriding groups have a blue background and zero-width groups have a black background. Throws an exception on negative width groups"]);let l=new Map,i=D.prototype.paint;D.prototype.paint=function(u,p,f,m){l.set(this,!1),i.apply(this,[u,p,f,m])};let e=D.prototype.paintGroup;D.prototype.paintGroup=function(u,p,f,m,g){if(_e("textrendergroups")){let k=u.fillStyle,v=this.actualLineHeight,P=this.fullLineHeight;if(!p[3]&&p[2]>f){let w=l.get(this);u.fillStyle=w?"rgba(255, 0, 0, 0.5)":"rgba(0, 255, 0, 0.5)",u.fillRect(m,g-v,p[2]-f,P),l.set(this,!w),u.fillStyle=k}else{let w=p[2]-f;if(u.fillStyle=w>0?"rgba(0, 0, 255, 0.5)":"rgba(0, 0, 0, 0.5)",w==0)w=4;else if(w<0)throw new Error(S.NEGATIVE_TEXT_GROUP);u.fillRect(m,g-v,w,P)}}e.apply(this,[u,p,f,m,g])},N.set("warnsubpixels",[!1,"Print a console warning whenever a Widget is detected to have non-integer width, height, x or y. Only warned once per Widget type"]);let t=new Set,r=new Set,n=new Set,s=new Set,o='[canvas-ui warnsubpixels] Widget type "',h='" has a non-integer ',d=", which will create clipping issues due to subpixels. This message won't be shown again for this widget type",c=y.prototype.finalizeBounds;y.prototype.finalizeBounds=function(){c.apply(this);let u=this.constructor.name;if(_e("warnsubpixels")){let[p,f]=this.root.effectiveScale,[m,g]=this.position;!yt(m*p,1e-10)&&!t.has(u)&&(t.add(u),console.warn(`${o}${u}${h}X coordinate (${m})${d}`)),!yt(g*f,1e-10)&&!r.has(u)&&(r.add(u),console.warn(`${o}${u}${h}Y coordinate (${g})${d}`));let[k,v]=this.dimensions;!yt(k*p,1e-10)&&!n.has(u)&&(n.add(u),console.warn(`${o}${u}${h}width (${k})${d}`)),!yt(v*f,1e-10)&&!s.has(u)&&(s.add(u),console.warn(`${o}${u}${h}height (${v})${d}`))}},window.canvasDebug={enabled:_e,toggle:xi,list:Ti},console.info("[canvas-ui] Injected debug code; the library will be slower"),console.info("[canvas-ui] Check if a debug feature is enabled in the console with canvasDebug.enabled(debugFeature: string)"),console.info("[canvas-ui] Enable a debug feature in the console with canvasDebug.toggle(debugFeature: string, enabled?: boolean)"),console.info("[canvas-ui] List debug features in the console with canvasDebug.list()")}a(vn,"injectDebugCode");function Tn(l){return new Promise((i,e)=>{function t(){document.body.removeChild(s)}a(t,"closePopup");function r(){t(),i(l)}a(r,"cancelHandler");function n(){t(),i(d.value)}a(n,"okHandler");let s=document.createElement("div");s.id="textInputHandlerOverlay";let o=document.createElement("div");o.id="textInputHandler";let h=document.createElement("p");h.textContent="Change text:";let d=document.createElement("textarea");d.value=l;let c=document.createElement("div"),u=document.createElement("button");u.addEventListener("click",r),u.textContent="Cancel";let p=document.createElement("button");p.addEventListener("click",n),p.textContent="OK",c.appendChild(u),c.appendChild(p),o.appendChild(h),o.appendChild(d),o.appendChild(c),s.appendChild(o),document.body.appendChild(s),d.focus({preventScroll:!1})})}a(Tn,"DefaultTextInputHandler");var me=class extends K{constructor(e,t=null){super(t,1,!1);this.text=e}cloneWithTarget(e){return new me(this.text,e)}};a(me,"TextPasteEvent");var $e=class extends C{constructor(e,t=new B){super(e,null,t);this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,this.updateDOMDims();let r=this.domElem.getContext("2d",{alpha:!0});if(r===null)throw new Error(S.REUSABLE_CANVAS_CONTEXT);this.domCanvasContext=r,this.pointerStyleHandler=n=>{this.domElem.style.cursor=n},this.domElem.addEventListener("paste",n=>{n.preventDefault(),n.clipboardData!==null&&this.dispatchEvent(new me(n.clipboardData.getData("text")))}),this.domElem.contentEditable="true",this.domElem.style.outline="0px solid transparent",this.domElem.style.caretColor="transparent",this.domElem.style.cursor="default"}update(){if(this.enabled)this.domElem.style.removeProperty("display");else{this.domElem.style.display="none";return}this.preLayoutUpdate(),this.resolveLayout()&&(this.updateDOMDims(),this.autoScale()),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))}updateDOMDims(){let[e,t]=this.effectiveScale,[r,n]=this.dimensions;this.domElem.width=Math.round(r*e),this.domElem.height=Math.round(n*t)}autoScale(){let[e,t]=this.effectiveScale;this.domElem.style.width=(this.domElem.width/e).toString()+"px",this.domElem.style.height=(this.domElem.height/t).toString()+"px"}};a($e,"DOMRoot");var Ce=class extends fe{constructor(i,e){super(i,!1,!0,e)}handleEvent(i){return this.child.dispatchEvent(i)}handlePreLayoutUpdate(){let i=this.child;i.preLayoutUpdate(),i.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let i=this.child;i.postLayoutUpdate(),i.dirty&&(this._dirty=!0)}handleResolveDimensions(i,e,t,r){let n=this.child;n.resolveDimensions(i,e,t,r),[this.idealWidth,this.idealHeight]=n.idealDimensions}resolvePosition(i,e){super.resolvePosition(i,e),this.child.resolvePosition(i,e)}handlePainting(i){this.child.paint(i)}};a(Ce,"PassthroughWidget");var Ve=class extends Ce{constructor(e,t,r){super(e,r);this.constraints=[...t]}handleResolveDimensions(e,t,r,n){let s=Math.min(Math.max(this.constraints[0],e),t),o=Math.min(Math.max(this.constraints[2],r),n),h=Math.min(Math.max(this.constraints[1],e),t),d=Math.min(Math.max(this.constraints[3],r),n);s>h&&(s=h),o>d&&(o=d),super.handleResolveDimensions(s,h,o,d)}};a(Ve,"ArtificialConstraint"),x([Zt()],Ve.prototype,"constraints",2);var ne=class extends y{constructor(e="",t){var r;super(!0,!1,t);this.wrapText=!0;this.textHelper=new D,this.textHelper.wrapMode=1,this.text=e,this.wrapText=(r=t==null?void 0:t.wrapText)!=null?r:!0}set text(e){this.textHelper.text=e}get text(){return this.textHelper.text}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="labelMinWidth"||e==="labelMinAscent"||e==="labelMinDescent"?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFill"&&(this._dirty=!0)}handlePreLayoutUpdate(){this.textHelper.font=this.bodyTextFont,this.textHelper.lineHeight=this.bodyTextHeight,this.textHelper.lineSpacing=this.bodyTextSpacing,this.textHelper.alignMode=this.bodyTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,r,n){this.textHelper.maxWidth=this.wrapText?t:1/0,this.textHelper.dirty&&(this._dirty=!0),this.idealWidth=Math.max(Math.min(this.textHelper.width,t),e),this.idealHeight=Math.max(Math.min(this.textHelper.height,n),r)}handlePainting(e){let t=this.viewport.context;this.wrapText||(t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip()),this.textHelper.paint(t,this.bodyTextFill,this.idealX,this.idealY),this.wrapText||t.restore()}};a(ne,"Label"),x([ie],ne.prototype,"wrapText",2);var se=(t=>(t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold",t))(se||{});var Ge=class{constructor(i){this.clickHelpers=i}get lastClickState(){let i=0;for(let e of this.clickHelpers)e.lastClickState>i&&(i=e.lastClickState);return i}get clickState(){let i=0;for(let e of this.clickHelpers)e.clickState>i&&(i=e.clickState);return i}get clickStateChanged(){for(let i of this.clickHelpers)if(i.clickStateChanged)return!0;return!1}get wasClick(){for(let i of this.clickHelpers)if(i.wasClick&&i.clickStateChanged)return!0;return!1}};a(Ge,"CompoundClickHelper");var Se=class{constructor(i){this.lastClickState=0;this.clickState=0;this.clickStateChanged=!1;this.wasClick=!1;this.widget=i}setClickState(i,e){this.clickState!==i?(this.lastClickState=this.clickState,this.clickState=i,this.wasClick=e&&this.lastClickState===2,this.clickStateChanged=!0):this.clickStateChanged=!1}};a(Se,"GenericClickHelper");var ge=class extends Z{cloneWithTarget(i){return new ge(this.key,this.shift,this.ctrl,this.alt,i)}};a(ge,"KeyRelease");var De=class extends W{constructor(e,t,r,n,s,o,h=null,d=null){super(e,t,n,s,o,h,d);this.button=r}get isLeft(){return this.button===0}get isPrimary(){return this.isLeft}get isRight(){return this.button===1}get isSecondary(){return this.isRight}get isMiddle(){return this.button===2}get isTertiary(){return this.isMiddle}};a(De,"PointerButtonEvent");var Y=class extends De{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o,0)}correctOffset(i,e){return new Y(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new Y(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(Y,"PointerRelease");var O=class extends De{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o)}correctOffset(i,e){return new O(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new O(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(O,"PointerPress");var oe=class extends Se{constructor(){super(...arguments);this.pointerPos=null;this.startingPointerPos=null;this.pointerButton=0}getNormalInRect(e,t,r,n,s,o){return[(e-r)/(n-r),(t-s)/(o-s)]}isPointInRect(e,t,r,n,s,o){return e>=r&&e<n&&t>=s&&t<o}isNormalInRect(e,t){return e>=0&&e<1&&t>=0&&t<1}handleClickEvent(e,t,r){if(e instanceof E)return t.dropFocus(0,this.widget),this.pointerPos=null,this.setClickState(0,!1);if(e instanceof W){this.pointerPos=this.getNormalInRect(e.x,e.y,...r);let n=this.isNormalInRect(...this.pointerPos);if(n)t.pointerStyle="pointer";else if(e.target===null)return t.dropFocus(0,this.widget),this.setClickState(0,!1);return e instanceof O&&e.button===this.pointerButton?(this.startingPointerPos=this.pointerPos,t.requestFocus(0,this.widget),this.setClickState(2,n)):e instanceof Y&&e.button===this.pointerButton?(t.dropFocus(0,this.widget),n?this.setClickState(1,n):this.setClickState(0,n)):e.target===null?this.setClickState(1,n):this.setClickState(2,n)}else this.clickStateChanged=!1}};a(oe,"ClickHelper");var be=class extends Ge{constructor(e){let t=new oe(e),r=new Se(e);super([t,r]);this.pointerClickHelper=t,this.keyboardClickHelper=r,this.widget=e}onFocusGrabbed(e){return e===1?(this.keyboardClickHelper.setClickState(1,!0),this.widget.autoScroll(),!0):!1}onFocusDropped(e){return e===1?(this.keyboardClickHelper.setClickState(0,!1),!0):!1}handleEvent(e,t,r,n){if(e instanceof M)return[!1,!1];if(e instanceof Z){if(e.key!=="Enter")return[!1,!1]}else if(!(e instanceof W||e instanceof E))return[!1,!1];return r?(e instanceof R?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(2,!0),this.widget.autoScroll()):e instanceof ge?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(1,!0)):(this.keyboardClickHelper.clickStateChanged=!1,this.pointerClickHelper.handleClickEvent(e,t,n)),[this.clickStateChanged&&this.wasClick,!0]):(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.clickStateChanged=!1,[!1,!0])}};a(be,"ButtonClickHelper");var Ee=class extends pe{constructor(e,t,r){super(e,!1,r);this.clickHelper=new be(this),this.callback=t,this.tabFocusable=!0}click(){if(this.callback!==null)try{this.callback()}catch(e){console.error("Exception in Icon callback:",e)}}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)}handleEvent(e){let[t,r]=this.clickHelper.handleEvent(e,this.root,this.callback!==null,this.bounds);return t&&this.click(),r?this:null}};a(Ee,"Button");var Fe=class extends Ee{constructor(e,t=null,r){var n;super(e,t,r);this.backgroundProperty="backgroundFill";this.forced=(n=r==null?void 0:r.forced)!=null?n:!1,this.childTheme=new B({canvasFill:this.getBackgroundFill()}),this.child.inheritedTheme=this.childTheme}updateBackground(){let e=this.backgroundProperty;if(this.forced)this.backgroundProperty="primaryFill";else switch(this.clickHelper.clickState){case 2:this.backgroundProperty="accentFill";break;case 1:this.backgroundProperty="backgroundGlowFill";break;default:this.backgroundProperty="backgroundFill";break}e!==this.backgroundProperty&&(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill())}getBackgroundFill(){switch(this.backgroundProperty){case"primaryFill":return this.primaryFill;case"accentFill":return this.accentFill;case"backgroundGlowFill":return this.backgroundGlowFill;case"backgroundFill":return this.backgroundFill;default:throw new Error(b.INVALID_BACKGROUND_FILL(this.backgroundProperty))}}set inheritedTheme(e){e!==this.fallbackTheme&&(this.fallbackTheme=e,this.childTheme.fallbackTheme=e)}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){e===null?(this._layoutDirty=!0,this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e===this.backgroundProperty?(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}onFocusGrabbed(e){super.onFocusGrabbed(e),e===1&&this.updateBackground()}onFocusDropped(e){super.onFocusDropped(e),e===1&&this.updateBackground()}handleEvent(e){let t=super.handleEvent(e);return this.clickHelper.clickStateChanged&&this.updateBackground(),t}handlePainting(e){this.handleBaseContainerPainting(e,this.getBackgroundFill())}};a(Fe,"FilledButton"),x([ct(Fe.prototype.updateBackground)],Fe.prototype,"forced",2);var ze=class extends Fe{constructor(i,e=null,t){t=A({containerAlignment:{horizontal:.5,vertical:"stretch"},bodyTextAlign:.5,wrapText:!1},t),super(new ne(i,t),e,t)}};a(ze,"TextButton");var $=class extends Ve{constructor(i,e,t=24,r=24,n){super(new ze(i,e,n),[t,1/0,r,1/0],n)}};a($,"VirtualKey");var Qe=class extends ${constructor(e,t,r,n=24,s=24,o){super("",()=>r.callback(this.currentGlyph),n,s,o);this.glyph=e,this.altGlyph=t===null?e:t,this.keyContext=r,this.child.child.text=this.currentGlyph}handlePreLayoutUpdate(){this.child.child.text=this.currentGlyph,super.handlePreLayoutUpdate()}get currentGlyph(){return this.keyContext.shift?this.altGlyph:this.glyph}};a(Qe,"GlyphVirtualKey");var ye=class extends ue{constructor(i){super(!1,i)}};a(ye,"Row");var je=class extends ye{constructor(i,e,t=24,r=24,n){super(n);for(let s of i)if(typeof s=="function"){let o=s;this.add(o(e,n))}else if(typeof s[0]=="string"&&typeof s[1]=="string"){let o=s[0],h=s[1];for(let d=0;d<o.length;d++){let c=null;d<h.length&&(c=h[d]),this.add(new Qe(o[d],c,e,t,r,n))}}else throw new Error(b.INVALID_KB_ROW_TEMPLATE(s))}};a(je,"VirtualKeyRow");var te=class extends ${constructor(i,e,t,r=24,n=24,s){super(i,()=>t.callback(e),r,n,s)}};a(te,"BasicVirtualKey");var Ze=class extends te{constructor(i,e=60,t=24,r){super("Backspace","Backspace",i,e,t,r)}};a(Ze,"BackspaceKey");var qe=class extends te{constructor(i,e=24,t=24,r){super("Esc","Escape",i,e,t,r)}};a(qe,"EscapeKey");var Je=class extends te{constructor(i,e=72,t=24,r){super("Enter","Enter",i,e,t,r)}};a(Je,"EnterKey");var et=class extends ${constructor(i,e=84,t=24,r){super("Shift",()=>{i.shift=!i.shift,this.child.forced=i.shift,i.callback("Shift")},e,t,r),this.child.forced=i.shift}};a(et,"ShiftKey");var tt=class extends te{constructor(i,e=84,t=24,r){r=A({flex:1},r),super("Space"," ",i,e,t,r)}};a(tt,"SpaceKey");var it=class extends ue{constructor(i){super(!0,i)}};a(it,"Column");function wi(l,i){return new Je(l,void 0,void 0,i)}a(wi,"EnterKeyTemplate");function _i(l,i){return new et(l,void 0,void 0,i)}a(_i,"ShiftKeyTemplate");function ki(l,i){return new Ze(l,void 0,void 0,i)}a(ki,"BackspaceKeyTemplate");function Pi(l,i){return new tt(l,void 0,void 0,i)}a(Pi,"SpaceKeyTemplate");function Wi(l,i){return new qe(l,void 0,void 0,i)}a(Wi,"EscapeKeyTemplate");var rt=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],wi],[_i,["zxcvbnm,./","ZXCVBNM<>?"]],[ki,Pi,Wi]],Le=class extends it{constructor(i,e=rt,t=24,r=24,n){n=A({multiContainerAlignment:{main:"between",cross:"stretch"}},n),super(n);let s={callback:o=>{i.keyPress(o,s.shift,s.ctrl,s.alt)},shift:!1,ctrl:!1,alt:!1};for(let o of e)this.add(new je(o,s,t,r,n))}};a(Le,"VirtualKeyboard");var ve=class extends pe{constructor(i,e){super(i,!0,e)}};a(ve,"Container");var Me=class extends ve{constructor(i,e){e=A({containerAlignment:{horizontal:.5,vertical:.5}},e),super(i,e)}};a(Me,"Margin");var Ct=class extends $e{constructor(e,t=rt,r=new B){super(new Me(new Le(e,t)),r);this.keyboardDriver=e}update(){this.enabled=this.keyboardDriver.needsInput,super.update()}};a(Ct,"DOMVirtualKeyboardRoot");var St=class extends C{constructor(e,t=rt,r=null,n=new B){super(new Me(new Le(e,t)),r,n);this.keyboardDriver=e}updateVisibility(){this.enabled=this.keyboardDriver.needsInput}};a(St,"VirtualKeyboardRoot");var nt=class{constructor(){this.eventQueues=new Map;this.keysDown=new Set;this.focus=null;this.lastActivity=null}getEventQueue(i){if(i===null)return null;let e=this.eventQueues.get(i);return typeof e=="undefined"?null:e}changeFocusedRoot(i){this.focus!==i&&(this.focus!==null&&this.focus.clearFocus(1),this.focus=i,this.keysDown.clear())}getFocusedRoot(){return this.focus}getEffectiveFocusedRoot(){return this.focus?this.focus:this.lastActivity?this.lastActivity:this.eventQueues.size>0?this.eventQueues.keys().next().value:null}clearFocus(){this.changeFocusedRoot(null)}keyDown(i,e,t,r){this.keysDown.add(i);let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new R(i,e,t,r,null))}keyUp(i,e,t,r){if(this.keysDown.delete(i)){let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new ge(i,e,t,r,null))}}keyPress(i,e,t,r){let n=this.isKeyDown(i);this.keyDown(i,e,t,r),n||this.keyUp(i,e,t,r)}isKeyDown(i){return this.keysDown.has(i)}onEnable(i){this.eventQueues.has(i)||this.eventQueues.set(i,[])}onDisable(i){this.eventQueues.has(i)&&(this.eventQueues.delete(i),i===this.focus&&this.clearFocus())}update(i){let e=this.getEventQueue(i);if(e!==null){for(let t of e)i.dispatchEvent(t);e.length=0}}onFocusChanged(i,e,t){t!==null&&(this.lastActivity=i),e===1&&i!==this.focus&&t!==null&&this.changeFocusedRoot(i)}onFocusCapturerChanged(i,e,t,r){}get needsInput(){return this.focus!==null&&this.focus.getFocus(1)!==null}};a(nt,"KeyboardDriver");var Ci=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp","Tab"," "]),Si=new Set(["a","A"]),Di=new Set(["Tab"]);function ni(l){return[l.key,l.shiftKey,l.ctrlKey,l.altKey]}a(ni,"unpackKeyboardEvent");var Dt=class extends nt{constructor(){super(...arguments);this.domElems=new Map}maybePreventDefault(e){var t,r;(Ci.has(e.key)||Si.has(e.key)&&e.ctrlKey)&&(Di.has(e.key)||((r=(t=this.getFocusedRoot())==null?void 0:t.getFocus(1))!=null?r:null)!==null)&&e.preventDefault()}bindDOMElem(e,t=!0){let r=this.domElems.get(e);r!==void 0?(console.warn(S.DOM_DRIVER_REBIND),this.removeListeners(e,r)):(r={blurListen:null,keydownListen:null,keyupListen:null},this.domElems.set(e,r)),this.addListeners(e,r,t)}unbindDOMElem(e){let t=this.domElems.get(e);t!==void 0&&(this.removeListeners(e,t),this.domElems.delete(e))}addListeners(e,t,r=!0){t.blurListen=n=>{this.shouldClearFocus(n.relatedTarget)&&this.clearFocus()},e.addEventListener("blur",t.blurListen),r&&(t.keydownListen=n=>{this.maybePreventDefault(n),this.keyDown(...ni(n))},t.keyupListen=n=>{this.maybePreventDefault(n),this.keyUp(...ni(n))},e.addEventListener("keydown",t.keydownListen),e.addEventListener("keyup",t.keyupListen))}removeListeners(e,t){t.blurListen&&(e.removeEventListener("blur",t.blurListen),t.blurListen=null),t.keydownListen&&(e.removeEventListener("keydown",t.keydownListen),t.keydownListen=null),t.keyupListen&&(e.removeEventListener("keyup",t.keyupListen),t.keyupListen=null)}shouldClearFocus(e){return e===null||!this.domElems.has(e)}};a(Dt,"DOMKeyboardDriver");function Et(l,i){let e=i.getBoundingClientRect();return[(l.clientX-e.left)/e.width,(l.clientY-e.top)/e.height]}a(Et,"getPointerEventNormPos");var le=class extends W{constructor(i,e,t,r,n,s=null){super(i,e,t,r,n,s,0)}correctOffset(i,e){return new le(this.x-i,this.y-e,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new le(this.x,this.y,this.shift,this.ctrl,this.alt,i)}};a(le,"PointerMove");var si=(t=>(t[t.None=0]="None",t[t.Hovering=1]="Hovering",t[t.Pressing=2]="Pressing",t))(si||{});var He=class{constructor(){this.states=new Map;this.nextPointerID=0;this.hints=new Map;this.dragToScroll=new Map}unassignPointer(i,e){e.pointer!==null&&this.setPointerHint(e.pointer,0),e.pointer=null,e.hovering&&e.eventQueue.push(new E(i.getFocusCapturer(0))),e.hovering=!1,e.pressing=0,e.dragLast=null}registerPointer(i=!1){let e=this.nextPointerID++;return this.setPointerHint(e,0),this.dragToScroll.set(e,i),e}unregisterPointer(i){for(let[e,t]of this.states)t.pointer===i&&this.unassignPointer(e,t);this.hints.delete(i),this.dragToScroll.delete(i)}canQueueEvent(i,e,t,r){let n=t.pointer===null;n&&(t.pointer=e);let s=t.pointer===e;if(!s||n)for(let[o,h]of this.states)o!==i&&h.pointer===e&&this.unassignPointer(o,h);return!s&&(!r||t.pressing>0)?!1:(r&&t.pointer!==e&&(this.unassignPointer(i,t),t.pointer=e),!0)}denormaliseCoords(i,e,t){let[r,n]=i.dimensions;return[e*r,t*n]}movePointer(i,e,t,r,n,s,o,h){let d=this.states.get(i);if(typeof d=="undefined"||(n===null&&(n=d.pressing),!this.canQueueEvent(i,e,d,n>0)))return;d.hovering=!0;let[c,u]=this.denormaliseCoords(i,t,r);if(n!==d.pressing){let p=Math.floor(Math.log2(Math.max(n,d.pressing)));for(let f=0;f<=p;f++){let m=(d.pressing>>f&1)===1,g=(n>>f&1)===1;m!==g&&(g?d.eventQueue.push(new O(c,u,f,s,o,h)):d.eventQueue.push(new Y(c,u,f,s,o,h)))}d.pressing=n}else d.eventQueue.push(new le(c,u,s,o,h));d.pressing>0?this.setPointerHint(e,2):this.setPointerHint(e,1)}leavePointer(i,e){let t=this.states.get(i);typeof t!="undefined"&&t.hovering&&t.pointer==e&&(t.hovering=!1,t.pressing=0,t.dragLast=null,t.eventQueue.push(new E(i.getFocusCapturer(0))),this.setPointerHint(e,0))}leaveAnyPointer(i){for(let e of this.states.keys())this.leavePointer(e,i)}wheelPointer(i,e,t,r,n,s,o,h,d,c,u){let p=this.states.get(i);if(typeof p=="undefined"||!this.canQueueEvent(i,e,p,!0))return;p.hovering=!0;let[f,m]=this.denormaliseCoords(i,t,r);p.eventQueue.push(new M(f,m,n,s,o,h,!1,d,c,u))}setPointerHint(i,e){return this.hints.get(i)!==e?(this.hints.set(i,e),!0):!1}getPointerHint(i){var e;return(e=this.hints.get(i))!=null?e:0}onEnable(i){this.states.set(i,{eventQueue:[],pointer:null,pressing:0,hovering:!1,dragLast:null,dragOrigin:[0,0]})}onDisable(i){i.dispatchEvent(new E);let e=this.states.get(i);typeof e!="undefined"&&e.pointer!==null&&(this.setPointerHint(e.pointer,0),e.dragLast=null),this.states.delete(i)}update(i){let e=this.states.get(i);if(typeof e=="undefined")return;let t=e.pointer===null?!1:this.dragToScroll.get(e.pointer);for(let r of e.eventQueue){if(r instanceof W&&e.dragLast!==null){let[n,s]=e.dragLast;i.dispatchEvent(new M(...e.dragOrigin,n-r.x,s-r.y,0,0,!1,!1,!1,!0)),r instanceof Y?e.dragLast=null:(e.dragLast[0]=r.x,e.dragLast[1]=r.y);continue}i.dispatchEvent(r)?e.dragLast=null:t&&r instanceof O&&(e.dragLast=[r.x,r.y],e.dragOrigin[0]=r.x,e.dragOrigin[1]=r.y)}e.eventQueue.length=0}onFocusChanged(i,e,t){}onFocusCapturerChanged(i,e,t,r){}};a(He,"PointerDriver");function oi(l){return[l.shiftKey,l.ctrlKey,l.altKey]}a(oi,"unpackModifiers");var Ft=class extends He{constructor(){super();this.domElems=new WeakMap;this.pointers=new Map;this.mousePointerID=this.registerPointer(!1)}bindDOMElem(e,t){let r=this.domElems.get(e);r!==void 0?(console.warn(S.DOM_DRIVER_REBIND),this.removeListeners(r)):(r={domElem:t,pointerListen:null,pointerleaveListen:null,wheelListen:null,contextMenuListen:null},this.domElems.set(e,r),t.style.touchAction="none"),e.enabled&&this.addListeners(e,r)}unbindDOMElem(e){let t=this.domElems.get(e);t!==void 0&&(this.removeListeners(t),this.domElems.delete(e))}getPointerID(e){let t=this.pointers.get(e.pointerId);return t===void 0&&(e.pointerType==="mouse"?t=this.mousePointerID:t=this.registerPointer(!0),this.pointers.set(e.pointerId,t)),t}addListeners(e,t){let r=t.domElem;t.pointerListen===null&&(t.pointerListen=n=>{this.movePointer(e,this.getPointerID(n),...Et(n,r),n.buttons,...oi(n))},r.addEventListener("pointermove",t.pointerListen),r.addEventListener("pointerdown",t.pointerListen),r.addEventListener("pointerup",t.pointerListen)),t.pointerleaveListen===null&&(t.pointerleaveListen=n=>{this.leavePointer(e,this.getPointerID(n))},r.addEventListener("pointerleave",t.pointerleaveListen)),t.wheelListen===null&&(t.wheelListen=n=>{let s=ii(n.deltaMode);s!==null&&(this.wheelPointer(e,this.mousePointerID,...Et(n,r),n.deltaX,n.deltaY,n.deltaZ,s,...oi(n)),n.preventDefault())},r.addEventListener("wheel",t.wheelListen,{passive:!1})),t.contextMenuListen===null&&(t.contextMenuListen=n=>{n.preventDefault()},r.addEventListener("contextmenu",t.contextMenuListen))}removeListeners(e){e.pointerListen!==null&&(e.domElem.removeEventListener("pointermove",e.pointerListen),e.domElem.removeEventListener("pointerdown",e.pointerListen),e.domElem.removeEventListener("pointerup",e.pointerListen),e.pointerListen=null),e.pointerleaveListen!==null&&(e.domElem.removeEventListener("pointerleave",e.pointerleaveListen),e.pointerleaveListen=null),e.wheelListen!==null&&(e.domElem.removeEventListener("wheel",e.wheelListen),e.wheelListen=null),e.contextMenuListen!==null&&(e.domElem.removeEventListener("contextmenu",e.contextMenuListen),e.contextMenuListen=null)}onEnable(e){super.onEnable(e);let t=this.domElems.get(e);t!==void 0&&this.addListeners(e,t)}onDisable(e){super.onDisable(e);let t=this.domElems.get(e);t!==void 0&&this.removeListeners(t)}};a(Ft,"DOMPointerDriver");var Lt=class extends He{constructor(){super(...arguments);this.sources=new Set}handlePointerRay(e,t,r,n,s,o,h){let[d,c,u]=this.castRay(r,n);d===null?this.leaveAnyPointer(e):this.movePointer(d,e,c,u,t,s,o,h)}addSource(e){this.sources.has(e)||(e.setRayPointerDriver(this),this.sources.add(e))}setPointerHint(e,t){let r=super.setPointerHint(e,t);for(let n of this.sources)n.onPointerHintChanged(e,t);return r}};a(Lt,"RayPointerDriver");var xe=class{constructor(i,e,t=!0){this.callbacks=new Set;this._value=i,e&&this.watch(e,t)}get value(){return this._value}set value(i){this.setValue(i)}hasCallback(i){return this.callbacks.has(i)}watch(i,e=!0){return this.hasCallback(i)?!1:(this.callbacks.add(i),e&&this.doCallback(i),!0)}unwatch(i){return this.callbacks.delete(i)}setValue(i,e=!0){if(this._value===i)return!1;if(this._value=i,e)for(let t of this.callbacks)this.doCallback(t);return!0}doCallback(i){try{i(this._value,this)}catch(e){console.error("Exception in Variable callback:",e)}}};a(xe,"Variable");var st=class extends xe{constructor(e,t=null,r,n=!0){super(e,r,!1);this._valid=!0;this.validator=t,this.validate(e),r&&n&&this.doCallback(r)}get valid(){return this._valid}get validValue(){return this._validValue}setValue(e,t=!0){return this.value===e?!1:(this.validate(e),super.setValue(e,t))}validate(e){if(this.validator){let[t,r]=this.validator(e);this._valid=t,t&&(this._validValue=r)}}};a(st,"ValidatedVariable");var Mt=class extends B{constructor(i=new B){super(void 0,i)}get canvasFill(){return"#"+Math.floor(Math.random()*16777215).toString(16)}set canvasFill(i){super.canvasFill=i}};a(Mt,"DebugTheme");var Ht=class extends ${constructor(i,e=42,t=24,r){super("Alt",()=>{i.alt=!i.alt,this.child.forced=i.alt,i.callback("Alt")},e,t,r),this.child.forced=i.alt}};a(Ht,"AltKey");var Rt=class extends ${constructor(i,e=42,t=24,r){super("Ctrl",()=>{i.ctrl=!i.ctrl,this.child.forced=i.ctrl,i.callback("Control")},e,t,r),this.child.forced=i.ctrl}};a(Rt,"ControlKey");var vt=(t=>(t[t.None=0]="None",t[t.Bi=1]="Bi",t[t.Uni=2]="Uni",t))(vt||{});var It=class extends ve{constructor(i,e){e=A({containerAlignment:{horizontal:.5,vertical:.5},containerPadding:{left:0,right:0,top:0,bottom:0}},e),super(i,e)}};a(It,"Center");var ot=class extends y{constructor(e=new xe(!1),t){super(!0,!1,t);this.offsetX=0;this.offsetY=0;this.actualLength=0;this.tabFocusable=!0,this.variable=e,this.callback=this.handleChange.bind(this),this.clickHelper=new be(this)}handleChange(){this._dirty=!0}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="checkboxLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="checkboxInnerPadding")&&(this._dirty=!0)}set checked(e){this.variable.value=e}get checked(){return this.variable.value}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(e,this.root,!0,[t,t+this.actualLength,r,r+this.actualLength]);return n&&(this.checked=!this.checked),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(e,t,r,n){let s=Math.min(this.checkboxLength,t,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<e&&(this.idealWidth=e),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.checkboxLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){let t=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;t?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.offsetX+this.x,s=this.offsetY+this.y;if(r.fillRect(n,s,this.actualLength,this.actualLength),this.checked){t?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let o=this.checkboxInnerPadding,h=this.actualLength-o*2;h<=0?r.fillRect(n,s,this.actualLength,this.actualLength):r.fillRect(n+o,s+o,h,h)}}};a(ot,"Checkbox");var Ei=/^.*\.(webm|og[gv]|m(p4|4v|ov)|avi|qt)$/i,Fi=(t=>(t[t.Contain=0]="Contain",t[t.Cover=1]="Cover",t[t.Fill=2]="Fill",t))(Fi||{}),ae=class extends y{constructor(e,t){var r,n,s,o,h;super(!0,!1,t);this.lastSrc=null;this.rotation=0;this.imageWidth=null;this.imageHeight=null;this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.loadedmetadataListener=null;this.canplayListener=null;this.frameCallback=null;if(typeof e=="string")if(Ei.test(e)){let d=document.createElement("video");d.src=e,d.preload="auto",e=d}else{let d=document.createElement("img");d.src=e,e=d}this._image=e,this.rotation=(r=t==null?void 0:t.rotation)!=null?r:0,this.viewBox=(n=t==null?void 0:t.viewBox)!=null?n:null,this.imageWidth=(s=t==null?void 0:t.width)!=null?s:null,this.imageHeight=(o=t==null?void 0:t.height)!=null?o:null,this.fit=(h=t==null?void 0:t.fit)!=null?h:0,this.setupVideoEvents()}setupVideoEvents(){if(this.image instanceof HTMLVideoElement&&(this.loadedmetadataListener=e=>this._layoutDirty=!0,this.image.addEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener=e=>this._dirty=!0,this.image.addEventListener("canplay",this.canplayListener),"requestVideoFrameCallback"in this.image)){console.warn(S.VIDEO_API_AVAILABLE);let e=this.image;this.frameCallback=(t,r)=>{this._dirty=!0,this.image===e&&this.frameCallback!==null&&this.image.requestVideoFrameCallback(this.frameCallback)},this.image.requestVideoFrameCallback(this.frameCallback)}}set image(e){e!==this._image&&(this._image instanceof HTMLVideoElement&&(this.loadedmetadataListener!==null&&this._image.removeEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener!==null&&this._image.removeEventListener("canplay",this.canplayListener)),this._image=e,this.lastSrc=null,this.loadedmetadataListener=null,this.canplayListener=null,this.frameCallback=null,this.setupVideoEvents())}get image(){return this._image}handlePreLayoutUpdate(){var e,t;this._image instanceof HTMLVideoElement?!this._image.paused&&this.frameCallback===null&&(this._dirty=!0):((e=this._image)==null?void 0:e.src)!==this.lastSrc&&((t=this._image)==null?void 0:t.complete)&&(this._layoutDirty=!0,this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.imageWidth;s===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?s=this._image.videoWidth:s=this._image.naturalWidth:s=this.viewBox[2]),this.idealWidth=Math.max(Math.min(s,t),e);let o=this.imageHeight;switch(o===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?o=this._image.videoHeight:o=this._image.naturalHeight:o=this.viewBox[3]),this.idealHeight=Math.max(Math.min(o,n),r),this.fit){case 0:case 1:{let h=this.idealWidth/s,d=this.idealHeight/o,c;this.fit===0?c=Math.min(h,d):c=Math.max(h,d),this.actualWidth=s*c,this.actualHeight=o*c,this.offsetX=(this.idealWidth-this.actualWidth)/2,this.offsetY=(this.idealHeight-this.actualHeight)/2;break}case 2:this.actualWidth=this.idealWidth,this.actualHeight=this.idealHeight,this.offsetX=0,this.offsetY=0;break;default:throw new Error(b.INVALID_ENUM(this.fit,"IconFit","fit"))}}handlePainting(e){var h;if(this._image instanceof HTMLImageElement&&!((h=this._image)!=null&&h.complete)){this.lastSrc=null;return}this.lastSrc=this._image.src;let t=this.x+this.offsetX,r=this.y+this.offsetY,n=this.rotation!==0,s=n||this.fit===1,o=this.viewport.context;s&&(o.save(),o.beginPath(),o.rect(this.x,this.y,this.width,this.height),o.clip(),n&&(o.translate(this.x+this.offsetX+this.actualWidth/2,this.y+this.offsetY+this.actualHeight/2),t=-this.actualWidth/2,r=-this.actualHeight/2,o.rotate(this.rotation))),this.viewBox===null?o.drawImage(this._image,t,r,this.actualWidth,this.actualHeight):o.drawImage(this._image,...this.viewBox,t,r,this.actualWidth,this.actualHeight),s&&o.restore()}dryPaint(){var e;this._image instanceof HTMLImageElement&&((e=this._image)==null?void 0:e.complete)?this.lastSrc=this._image.src:this.lastSrc=null,super.dryPaint()}};a(ae,"Icon"),x([we],ae.prototype,"rotation",2),x([qt(!0)],ae.prototype,"viewBox",2),x([ie],ae.prototype,"imageWidth",2),x([ie],ae.prototype,"imageHeight",2),x([we],ae.prototype,"fit",2);var At=class extends Ee{constructor(i,e,t){super(new ae(i,t),e,t)}};a(At,"IconButton");var Re=class extends y{constructor(e){var t,r;e=A({flex:1},e);super(!0,!1,e);this.minWidth=(t=e==null?void 0:e.minWidth)!=null?t:0,this.minHeight=(r=e==null?void 0:e.minHeight)!=null?r:0}handleResolveDimensions(e,t,r,n){t!==1/0?this.idealWidth=t:this.idealWidth=Math.max(e,this.minWidth),n!==1/0?this.idealHeight=n:this.idealHeight=Math.max(r,this.minHeight)}};a(Re,"Spacing");var Vt=class extends ye{constructor(i,e,t){super(t),this.add([new ne(i,t),new Re(t),new ot(e,t)])}};a(Vt,"LabelledCheckbox");var lt=class extends y{constructor(e,t,r){super(!0,!1,r);this.offsetX=0;this.offsetY=0;this.actualLength=0;this._wasSelected=!1;this.tabFocusable=!0,this.variable=e,this.value=t,this.clickHelper=new be(this),this.callback=this.handleChange.bind(this),this._wasSelected=this.selected}handleChange(){this.selected!==this._wasSelected&&(this._dirty=!0)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="radioButtonLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="radioButtonInnerPadding")&&(this._dirty=!0)}select(){this.variable.value=this.value}get selected(){return this.variable.value===this.value}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(e,this.root,!0,[t,t+this.actualLength,r,r+this.actualLength]);return n&&this.select(),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(e,t,r,n){let s=Math.min(this.radioButtonLength,t,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<e&&(this.idealWidth=e),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.radioButtonLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){this._wasSelected=this.selected;let t=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;t?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.actualLength/2,s=this.offsetX+this.x+n,o=this.offsetY+this.y+n;if(this.paintCircle(s,o,n),this.selected){t?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let h=this.actualLength-this.radioButtonInnerPadding*2;if(h<=0)this.paintCircle(s,o,n);else{let d=h/2;this.paintCircle(s,o,d)}}}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}};a(lt,"RadioButton");var Bt=class extends ye{constructor(i,e,t,r){super(r),this.add([new ne(i,r),new Re(r),new lt(e,t,r)])}};a(Bt,"LabelledRadioButton");var Ie=class extends fe{constructor(e,t){var r,n,s,o,h,d;super(e,!1,!0,t);this._constraints=[0,1/0,0,1/0];this.forceRePaint=!0;this.reservedX=0;this.reservedY=0;this.useCanvas=(r=t==null?void 0:t.useCanvas)!=null?r:!1,this.useCanvas?this.internalViewport=new re(e):this.internalViewport=new Ne(e),this.minWidth=(n=t==null?void 0:t.minWidth)!=null?n:0,this.minHeight=(s=t==null?void 0:t.minHeight)!=null?s:0,this._widthCoupling=(o=t==null?void 0:t.widthCoupling)!=null?o:0,this._heightCoupling=(h=t==null?void 0:t.heightCoupling)!=null?h:0,this._constraints=(d=t==null?void 0:t.constraints)!=null?d:[0,1/0,0,1/0]}get offset(){return[...this.internalViewport.offset]}set offset(e){(this.internalViewport.offset[0]!==e[0]||this.internalViewport.offset[1]!==e[1])&&(this.internalViewport.offset=[e[0],e[1]],this._dirty=!0)}set constraints(e){(e[0]!==this._constraints[0]||e[1]!==this._constraints[1]||e[2]!==this._constraints[2]||e[3]!==this._constraints[3])&&(this._constraints[0]=e[0],this._constraints[1]=e[1],this._constraints[2]=e[2],this._constraints[3]=e[3],this.internalViewport.constraints=e)}get constraints(){return[...this._constraints]}get widthCoupling(){return this._widthCoupling}set widthCoupling(e){this._widthCoupling!==e&&(this._widthCoupling=e,this._layoutDirty=!0)}get heightCoupling(){return this._heightCoupling}set heightCoupling(e){this._heightCoupling!==e&&(this._heightCoupling=e,this._layoutDirty=!0)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="canvasFill"&&(this._dirty=!0)}getBoundsOf(e){let[t,r]=e.idealDimensions,[n,s]=e.idealPosition,[o,h]=this.child.idealPosition,d=this.idealX+this.offset[0]+n-o,c=this.idealY+this.offset[1]+s-h;return[d,d+t,c,c+r]}handleEvent(e){return this.internalViewport.dispatchEvent(e)}handlePreLayoutUpdate(){let e=this.child;e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0),this.useCanvas&&(this.internalViewport.resolution=this.root.resolution)}handlePostLayoutUpdate(){this.internalViewport.rect=[this.x,this.y,this.width,this.height];let e=this.child;e.postLayoutUpdate(),e.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=Math.max(t-this.reservedX,0),o=Math.max(n-this.reservedY,0),h=Math.min(Math.max(e,this.minWidth)-this.reservedX,s),d=Math.min(Math.max(r,this.minHeight)-this.reservedY,o);this._widthCoupling!==1&&(this.idealWidth=h,this._widthCoupling===2&&(h=this.idealWidth)),this.idealWidth===0&&this.minWidth===0&&this._widthCoupling!==1&&console.warn(b.MAYBE_DIMENSIONLESS("width")),this._heightCoupling!==1&&(this.idealHeight=d,this._heightCoupling===2&&(d=this.idealHeight)),this.idealHeight===0&&this.minHeight===0&&this._heightCoupling!==1&&console.warn(b.MAYBE_DIMENSIONLESS("height"));let c=[...this._constraints];this._widthCoupling!==0&&(c[0]=h,this._widthCoupling===1&&(c[1]=s)),this._heightCoupling!==0&&(c[2]=d,this._heightCoupling===1&&(c[3]=o));let u=this.child;this.internalViewport.constraints=c,this.internalViewport.resolveLayout(),this._widthCoupling===1&&(this.idealWidth=Math.max(0,u.idealDimensions[0])),this._heightCoupling===1&&(this.idealHeight=Math.max(0,u.idealDimensions[1]))}activate(e,t,r){y.prototype.activate.call(this,e,t,r),this.internalViewport.parent=t,this.child.activate(e,this.internalViewport,r)}deactivate(){this.internalViewport.parent=null,super.deactivate()}handlePainting(e){this.internalViewport.paint(e||this.forceRePaint,this.canvasFill),this.forceRePaint=!1}};a(Ie,"ViewportWidget"),x([ie],Ie.prototype,"minWidth",2),x([ie],Ie.prototype,"minHeight",2);var li=(t=>(t[t.Overlay=0]="Overlay",t[t.Layout=1]="Layout",t[t.Hidden=2]="Hidden",t))(li||{}),at=class extends Ie{constructor(e,t){var r;super(e,t);this.effectiveWidth=0;this.effectiveHeight=0;this.verticalDragged=null;this.startingScroll=0;this.startingOffset=0;this.lastScroll=0;this.horizWasPainted=!1;this.vertWasPainted=!1;this._scrollLineHeight=0;this._scrollbarMode=(r=t==null?void 0:t.scrollbarMode)!=null?r:0,this.horizontalClickHelper=new oe(this),this.verticalClickHelper=new oe(this),this.updateScrollLineHeight()}get scrollbarMode(){return this._scrollbarMode}set scrollbarMode(e){if(this._scrollbarMode!==e){let t=this.scroll;this._scrollbarMode=e,this.scroll=t,this._layoutDirty=!0,this._dirty=!0}}get offset(){return super.offset}set offset(e){let[t,r]=this.child.idealDimensions;super.offset=[-Math.max(Math.min(-e[0],t-this.effectiveWidth),0),-Math.max(Math.min(-e[1],r-this.effectiveHeight),0)]}get widthCoupling(){return super.widthCoupling}set widthCoupling(e){let t=this.scroll;super.widthCoupling=e,this.scroll=t}get heightCoupling(){return super.heightCoupling}set heightCoupling(e){let t=this.scroll;super.heightCoupling=e,this.scroll=t}get scroll(){let[e,t]=this.offset,[r,n]=this.child.idealDimensions,s=r-this.effectiveWidth,o=n-this.effectiveHeight;return[s===0?0:Math.min(Math.max(-e/s,0),1),o===0?0:Math.min(Math.max(-t/o,0),1)]}set scroll(e){let[t,r]=this.child.idealDimensions;this.offset=[-e[0]*(t-this.effectiveWidth),-e[1]*(r-this.effectiveHeight)]}getClickHelper(e){return e?this.verticalClickHelper:this.horizontalClickHelper}handleEventScrollbar(e,t,r,n){if(this.verticalDragged!==null&&this.verticalDragged!==e)return!1;let[s,o]=this.getScrollbarRects(e,t),h=this._scrollbarMode===0,d=h?s:o,c=[d[0],d[0]+d[2],d[1],d[1]+d[3]],u=this.getClickHelper(e);u.handleClickEvent(r,n,c);let p=u.clickState,f=u.clickStateChanged;if(f&&(this._dirty=!0),p===2){if(u.pointerPos===null||!(r instanceof W))return!0;let m=e?1:0,g=this.scroll,k=h;k||(k=u.isPointInRect(r.x,r.y,s[0],s[0]+s[2],s[1],s[1]+s[3]));let v;if(h?v=u.getNormalInRect(r.x,r.y,o[0],o[0]+o[2],o[1],o[1]+o[3])[m]:v=u.pointerPos[m],f){if(!k){let P=e?this.effectiveHeight:this.effectiveWidth,w=this.child.idealDimensions[m],_=P/w;g[m]=(v-_/2)/(1-_),this.scroll=g}this.startingOffset=v,this.startingScroll=g[m],this.verticalDragged=e}else{let P=e?this.effectiveHeight:this.effectiveWidth,w=this.child.idealDimensions[m],_=P/w,I=v-this.startingOffset;g[m]=this.startingScroll+I/(1-_),this.scroll=g}return!0}else{if(p===1)return!0;if(f)return this.verticalDragged=null,!0}return!1}clampOffset(e){let[t,r]=this.child.idealDimensions,n=-(t-this.effectiveWidth);n>=0?e[0]=0:e[0]<n&&(e[0]=n);let s=-(r-this.effectiveHeight);s>=0?e[1]=0:e[1]<s&&(e[1]=s)}handleWheelEvent(e){let t=this.offset,[r,n]=t,[s,o]=e.getDeltaPixels(!0,this._scrollLineHeight,this.idealWidth,this.idealHeight);t[0]-=e.shift?o:s,t[1]-=e.shift?s:o,this.clampOffset(t),this.offset=t;let[h,d]=this.offset,c=h!==r||d!==n,u=this.lastScroll,p=new Date().getTime();return this.lastScroll=p,c?!0:e.fromDrag?!1:p-u<200}updateScrollLineHeight(){let e=new D;e.font=this.bodyTextFont,e.lineHeight=this.bodyTextHeight,e.lineSpacing=this.bodyTextSpacing,this._scrollLineHeight=e.fullLineHeight}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="bodyTextHeight"||e==="bodyTextSpacing"?this.updateScrollLineHeight():e==="scrollBarThickness"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundFill"||e==="scrollBarMinPercent"||e==="scrollBarMinPixels"||e==="primaryFill"||e==="accentFill"||e==="backgroundGlowFill")&&(this._dirty=!0)}handleEvent(e){let t=this.widthCoupling===1,r=this.heightCoupling===1;if(this._scrollbarMode!==2&&(e instanceof E||e instanceof W)&&(e.target===null||e.target===this)){let[s,o]=this.child.idealDimensions,h=this._scrollbarMode===0,d=!h&&!t&&!r,c=s>this.idealWidth,u=o>this.idealHeight,p=!1;if(!t&&(c||!h)&&this.handleEventScrollbar(!1,u||d,e,this.root)&&(p=!0),!r&&(u||!h)&&this.handleEventScrollbar(!0,c||d,e,this.root)&&(p=!0),p)return e instanceof M&&this.handleWheelEvent(e),this}let n=super.handleEvent(e);if(n!==null&&e instanceof q){let s=this._scrollbarMode===1,o=s&&!r,h=s&&!t,d=this.effectiveWidth,c=this.effectiveHeight;if(!o||!h){let z=this.scrollBarThickness,[Be,Tt]=this.child.idealDimensions,ai=Be>this.idealWidth,hi=Tt>this.idealHeight,di=this.scrollbarNeedsPaint(!1,ai),ci=this.scrollbarNeedsPaint(!0,hi);this._scrollbarMode!==2&&(!o&&ci&&(d=Math.max(0,d-z)),!h&&di&&(c=Math.max(0,c-z)))}let[u,p]=n.idealPosition,[f,m]=this.offset,g=f,k=m;this.internalViewport.relativeCoordinates&&(u+=this.idealX+f,p+=this.idealY+m);let[v,P,w,_]=e.bounds;v+=u,P+=u,w+=p,_+=p;let I=this.idealX+d,H=this.idealY+c,U=!t&&!(v>=this.idealX&&P<=I)&&!(this.idealX>=v&&I<=P);if(U){let z=P-v>d,Be=v<this.idealX;z!==Be?f+=this.idealX-v:f+=I-P}let G=!r&&!(w>=this.idealY&&_<=H)&&!(this.idealY>=w&&H<=_);if(G){let z=_-w>c,Be=w<this.idealY;z!==Be?m+=this.idealY-w:m+=H-_}(U||G)&&(this.offset=[f,m]);let[Te,he]=this.offset,ht=Te-g+u-this.idealX,dt=he-k+p-this.idealY;return e.bounds[0]+=ht,e.bounds[1]+=ht,e.bounds[2]+=dt,e.bounds[3]+=dt,this}return n===null&&e instanceof M&&this.handleWheelEvent(e)?this:n}handleResolveDimensions(e,t,r,n){let s=this.scrollBarThickness,o=this._scrollbarMode===1;this.reservedX=o&&this.heightCoupling!==1?s:0,this.reservedY=o&&this.widthCoupling!==1?s:0,super.handleResolveDimensions(e,t,r,n),this.effectiveWidth=this.idealWidth,this.effectiveHeight=this.idealHeight,this.idealWidth=Math.min(Math.max(this.idealWidth+this.reservedX,e),t),this.idealHeight=Math.min(Math.max(this.idealHeight+this.reservedY,r),n)}handlePostLayoutUpdate(){super.handlePostLayoutUpdate();let e=this.offset;this.clampOffset(e),this.offset=e}handlePainting(e){let[t,r]=this.child.idealDimensions,n=t>this.effectiveWidth,s=r>this.effectiveHeight,o=this.scrollbarNeedsPaint(!1,n),h=this.scrollbarNeedsPaint(!0,s);this.horizWasPainted!==o||this.vertWasPainted!==h?(this.horizWasPainted=o,this.vertWasPainted=h,this.forceRePaint=!0):this.scrollbarMode===0&&(this.forceRePaint=!0),super.handlePainting(e);let d=this._scrollbarMode===1&&this.widthCoupling!==1&&this.heightCoupling!==1;if(o&&this.paintScrollbar(!1,n,s||d),h&&this.paintScrollbar(!0,s,n||d),d){let c=this.scrollBarThickness,u=this.viewport.context;u.fillStyle=this.backgroundFill,u.fillRect(this.x+this.width-c,this.y+this.height-c,c,c)}}getScrollbarRects(e,t){let r=this._scrollbarMode===0,n=e?1:0,s=this.scroll[n],o=this.child.idealDimensions[n],h=e?this.effectiveHeight:this.effectiveWidth,d=Math.min(this.scrollBarThickness,this.width/2,this.height/2),c=this.scrollBarMinPercent,u=this.scrollBarMinPixels,p=h;r&&(p-=t?d:0);let f=Math.min(Math.max(u,Math.max(h/o,c)*p),h),m=(p-f)*s,g,k,v,P;e?(g=this.idealX+this.idealWidth-d,k=this.idealY+m,v=d,P=f):(g=this.idealX+m,k=this.idealY+this.idealHeight-d,v=f,P=d);let w,_,I,H;return e?(w=g,_=this.idealY,I=d,H=p):(w=this.idealX,_=k,I=p,H=d),[[g,k,v,P],[w,_,I,H]]}scrollbarNeedsPaint(e,t){return this._scrollbarMode===2||!t&&this._scrollbarMode===0?!1:e?this.heightCoupling!==1:this.widthCoupling!==1}paintScrollbar(e,t,r){let[n,s]=this.getScrollbarRects(e,r),o=this.viewport.context;if(this._scrollbarMode!==0&&(o.fillStyle=this.backgroundFill,o.fillRect(...s)),t)switch(this.getClickHelper(e).clickState){case 0:o.fillStyle=this.primaryFill;break;case 1:case 2:o.fillStyle=this.accentFill;break}else o.fillStyle=this.backgroundGlowFill;o.fillRect(...n)}};a(at,"ScrollableViewportWidget");var xt=class extends y{constructor(e=new xe(0),t=0,r=1,n){var o,h;super(!0,!1,n);this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.keyboardFocused=!1;this.dragBounds=[0,0,0,0];if(r<t)throw new Error(b.SWAPPED_MIN_MAX(t,r));if(!isFinite(t)||isNaN(t))throw new Error(b.INVALID_MIN(t));if(!isFinite(r)||isNaN(r))throw new Error(b.INVALID_MAX(r));let s=(o=n==null?void 0:n.snapIncrement)!=null?o:0;if(!isFinite(s)||isNaN(s))throw new Error(b.INVALID_INC(r));if(s<0)throw new Error(b.NEGATIVE_INC(r));this.clickHelper=new oe(this),this.minValue=t,this.maxValue=r,this.snapIncrement=s,this.vertical=(h=n==null?void 0:n.vertical)!=null?h:!1,this.tabFocusable=!0,this.variable=e,this.callback=this.handleChange.bind(this)}handleChange(){this._dirty=!0}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}set value(e){this.setValue(e)}get value(){return this.variable.value}clamp(e){return e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),e}setValue(e,t=!0){this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),this.variable.setValue(this.clamp(e),t)}stepValue(e,t){let r=this.snapIncrement;r===0&&(r=.01*(this.maxValue-this.minValue)),r*=t;let n=e?1:-1;this.value=this.clamp((Math.round(this.value/r)+n)*r)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="sliderThickness"||e==="sliderMinLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="accentFill"||e==="primaryFill"||e==="backgroundFill")&&(this._dirty=!0)}onFocusGrabbed(e){e===1&&(this.keyboardFocused=!0)}onFocusDropped(e){e===1&&(this.keyboardFocused=!1)}handleEvent(e){if(e instanceof M||!(e instanceof W||e instanceof Z||e instanceof E)||e instanceof R&&(e.key==="Tab"||e.key==="Escape"))return null;if(e instanceof Z){if(e instanceof R){let t=e.shift?10:1;e.key==="ArrowLeft"||e.key==="ArrowDown"?this.stepValue(!1,t):(e.key==="ArrowRight"||e.key==="ArrowUp")&&this.stepValue(!0,t)}return this}if(e instanceof O||this.clickHelper.clickState!==2){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY;this.dragBounds=[t,t+this.actualWidth,r,r+this.actualHeight]}if(this.clickHelper.handleClickEvent(e,this.root,this.dragBounds),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState===2)&&this.clickHelper.pointerPos!==null){let t=this.clickHelper.pointerPos[0];this.value=this.minValue+t*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handleResolveDimensions(e,t,r,n){let s=this.sliderThickness,o=this.sliderMinLength;this.vertical?(n!=1/0?this.idealHeight=n:this.idealHeight=Math.max(o,r),this.idealWidth=Math.min(Math.max(s,e),t)):(t!=1/0?this.idealWidth=t:this.idealWidth=Math.max(o,e),this.idealHeight=Math.min(Math.max(s,r),n))}finalizeBounds(){super.finalizeBounds(),this.vertical?(this.actualWidth=Math.min(this.width,this.sliderThickness),this.actualHeight=this.height,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=0):(this.actualWidth=this.width,this.actualHeight=Math.min(this.height,this.sliderThickness),this.offsetX=0,this.offsetY=(this.height-this.actualHeight)/2)}handlePainting(e){let t=this.x+this.offsetX,r=this.y+this.offsetY,n=this.viewport.context,s=this.keyboardFocused||this.clickHelper.clickState===1||this.clickHelper.clickState===2;s?n.fillStyle=this.accentFill:n.fillStyle=this.primaryFill;let o=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);n.fillRect(t,r,o,this.actualHeight),s?n.fillStyle=this.backgroundGlowFill:n.fillStyle=this.backgroundFill;let h=this.actualWidth-o;n.fillRect(t+o,r,h,this.actualHeight)}};a(xt,"Slider"),x([we],xt.prototype,"keyboardFocused",2);var ke=class extends y{constructor(e=new st(""),t){var r,n,s,o,h;super(!1,!1,t);this.blinkStart=0;this.blinkWasOn=null;this.cursorPos=0;this.cursorOffset=[0,0];this.selectPos=0;this.selectOffset=[0,0];this.cursorOffsetDirty=!1;this.offset=[0,0];this.dragging=!1;this.lastClick=0;this.dragStart=-1;this.successiveClickCount=0;this.needsAutoScroll=!1;this.tabFocusable=!0,this.textHelper=new D,this.variable=e,this.callback=this.handleChange.bind(this),this.hideText=(r=t==null?void 0:t.hideText)!=null?r:!1,this.wrapText=(n=t==null?void 0:t.wrapText)!=null?n:!0,this.inputFilter=(s=t==null?void 0:t.inputFilter)!=null?s:null,this.typeableTab=(o=t==null?void 0:t.typeableTab)!=null?o:!1,this._editingEnabled=(h=t==null?void 0:t.editingEnabled)!=null?h:!0}handleChange(){this._dirty=!0}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0,this.cursorOffsetDirty=!0):e==="inputTextInnerPadding"||e==="inputTextFont"||e==="inputTextHeight"||e==="inputTextSpacing"?(this._layoutDirty=!0,this._dirty=!0):e==="inputBackgroundFill"||e==="inputTextFill"||e==="inputTextFillInvalid"||e==="inputTextFillDisabled"||e==="cursorThickness"?this._dirty=!0:e==="inputTextAlign"&&(this.cursorOffsetDirty=!0)}get blinkOn(){if(this.blinkStart===0)return null;let e=this.blinkRate;return Math.trunc((Date.now()-this.blinkStart)/(500*e)%2)===0}get editingEnabled(){return this._editingEnabled}set editingEnabled(e){this._editingEnabled!==e&&(this._editingEnabled=e,e||(this.blinkStart=0,this.moveCursorTo(0,!1)),this._dirty=!0)}set text(e){this.variable.value=e;let t=this.variable.value.length;this.cursorPos>t&&(this.cursorPos=t,this.cursorOffsetDirty=!0),this.selectPos>t&&(this.selectPos=t,this.cursorOffsetDirty=!0)}get text(){return this.variable.value}get displayedText(){return this.hideText?"\u25CF".repeat(this.variable.value.length):this.variable.value}get line(){return this.textHelper.getLine(this.cursorPos)}autoScrollCaret(){this.blinkStart!==0&&(this.needsAutoScroll=!0)}moveCursorTo(e,t){this.cursorPos=Math.min(Math.max(e,0),this.text.length),t||(this.selectPos=this.cursorPos),this.cursorOffsetDirty=!0,this._dirty=!0,this.autoScrollCaret()}moveCursor(e,t){this.moveCursorTo(this.cursorPos+e,t)}moveCursorFromOffset(e,t,r){[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset([e,t]),r||(this.selectPos=this.cursorPos,this.selectOffset=this.cursorOffset),this.blinkStart=Date.now(),this._dirty=!0,this.autoScrollCaret()}moveCursorLine(e,t){this.moveCursorFromOffset(this.cursorOffset[0],this.cursorOffset[1]+(.5+e)*this.textHelper.fullLineHeight,t)}moveCursorStart(e){this.moveCursorTo(this.textHelper.getLineStart(this.line),e)}moveCursorEnd(e){this.moveCursorTo(this.textHelper.getLineEnd(this.line,!1),e)}moveCursorWord(e,t){if(e==0)return;let r=/\w/,n=this.text,s=this.cursorPos;if(e>0)for(;e>0;){let o=!1;for(;s<=n.length;s++)if(s<n.length&&r.test(n[s]))o=!0;else if(o)break;e--}else for(;e<0;){s--;let o=!1;for(;s>=0;s--)if(s>=0&&r.test(n[s]))o=!0;else if(o)break;s++,e++}this.moveCursorTo(s,t)}deleteRange(e,t){e!==t&&(this.variable.value=this.text.substring(0,e)+this.text.substring(t),this.cursorPos=this.selectPos=e,this.cursorOffsetDirty=!0,this.autoScrollCaret())}deleteWord(e){if(e===0)return;if(this.cursorPos!==this.selectPos){this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));return}let t=this.cursorPos;this.moveCursorWord(e,!1),t!==this.cursorPos&&this.deleteRange(Math.min(t,this.cursorPos),Math.max(t,this.cursorPos))}insertText(e){if(!(this.inputFilter!==null&&!this.inputFilter(e)))if(this.selectPos===this.cursorPos)this.variable.value=this.text.substring(0,this.cursorPos)+e+this.text.substring(this.cursorPos),this.moveCursor(e.length,!1);else{let t=Math.min(this.cursorPos,this.selectPos),r=Math.max(this.cursorPos,this.selectPos);this.variable.value=this.text.substring(0,t)+e+this.text.substring(r),this.moveCursorTo(t+e.length,!1)}}deleteText(e){e!==0&&(this.cursorPos!==this.selectPos?this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos)):e>0?(this.variable.value=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+e),this.cursorOffsetDirty=!0,this.autoScrollCaret()):(this.variable.value=this.text.substring(0,this.cursorPos+e)+this.text.substring(this.cursorPos),this.moveCursor(e,!1)))}selectRangeAt(e){let t=this.text,r=/\w/,n=r.test(t[e]),s=e;for(;e>=0&&r.test(t[e])===n;e--);let o=e+1;for(e=s;e<t.length&&r.test(t[e])===n;e++);return this.autoScrollCaret(),[o,e]}onFocusGrabbed(e){e===1&&this.blinkStart===0&&(this.blinkStart=Date.now(),this.selectPos=this.variable.value.length,this.cursorPos=this.selectPos,this.cursorOffsetDirty=!0,this.autoScrollCaret())}onFocusDropped(e){e===1&&(this.blinkStart=0)}handleEvent(e){if(!this._editingEnabled)return null;let t=this.root;if(e instanceof E)return this.dragging=!1,this.lastClick=0,this;if(e instanceof M)return null;if(e instanceof W){if(t.pointerStyle="text",e instanceof O||e instanceof le){let r=e instanceof O&&e.isPrimary;if(r){this.dragging=!0;let s=new Date().getTime();s-this.lastClick<500?(this.successiveClickCount++,this.successiveClickCount>2&&(this.successiveClickCount=0)):this.successiveClickCount=0,this.lastClick=s}else if(!this.dragging)return this;let n=this.inputTextInnerPadding;if(this.moveCursorFromOffset(e.x-this.idealX-n+this.offset[0],e.y-this.idealY-n+this.offset[1],!r&&this.dragging||r&&e.shift),r&&(this.cursorPos!==this.dragStart&&(this.successiveClickCount=0),this.dragStart=this.cursorPos),this.successiveClickCount>0){let s,o;if(this.successiveClickCount===1){let[h,d]=this.selectRangeAt(this.dragStart),[c,u]=this.selectRangeAt(this.cursorPos);s=Math.min(h,c),o=Math.max(d,u)}else{let h=Math.min(this.cursorPos,this.dragStart),d=this.textHelper.getLine(h);s=this.textHelper.getLineStart(d);let c=Math.max(this.cursorPos,this.dragStart),u=this.textHelper.getLine(c);o=this.textHelper.getLineEnd(u)}this.cursorPos>=this.dragStart?(this.selectPos=s,this.cursorPos=o):(this.selectPos=o,this.cursorPos=s),this.cursorOffsetDirty=!0}t.requestFocus(1,this)}else e instanceof Y&&e.isPrimary&&(this.dragging=!1,t.hasMobileTextInput&&t.getTextInput(this.text).then(r=>{r===null||this.inputFilter!==null&&!this.inputFilter(r)||this.text!==r&&(this.text=r,this.moveCursorTo(r.length,!1))}));return this}else if(e instanceof R){if(this.dragging=!1,this.lastClick=0,e.alt)return this;if(e.ctrl){if(e.key==="Backspace")this.deleteWord(-1);else if(e.key==="Delete")this.deleteWord(1);else if(e.key==="ArrowLeft")this.moveCursorWord(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursorWord(1,e.shift);else if(e.key==="c"||e.key==="C"){if(this.cursorPos===this.selectPos)return this;let r=this.text.slice(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));if(navigator.clipboard)navigator.clipboard.writeText(r);else return this}else if(e.key==="a"||e.key==="A")this.cursorPos=this.text.length,this.selectPos=0,this.cursorOffsetDirty=!0,this._dirty=!0;else return this;return this.blinkStart=Date.now(),this}if(e.key.length===1)this.insertText(e.key);else if(e.key==="Backspace")this.deleteText(-1);else if(e.key==="Delete")this.deleteText(1);else if(e.key==="ArrowLeft")this.moveCursor(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursor(1,e.shift);else if(e.key==="ArrowUp")this.moveCursorLine(-1,e.shift);else if(e.key==="ArrowDown")this.moveCursorLine(1,e.shift);else if(e.key==="PageUp"||e.key==="PageDown"){let r=e.key==="PageUp"?-1:1,[n,s,o,h]=this.viewport.rect,d=Math.max(Math.floor(h/this.textHelper.fullLineHeight),3);this.moveCursorLine(d*r,e.shift)}else if(e.key==="Home")this.moveCursorStart(e.shift);else if(e.key==="End")this.moveCursorEnd(e.shift);else{if(e.key==="Escape")return null;if(e.key==="Enter")this.insertText(`
`);else if(e.key==="Tab")if(this.typeableTab){if(e.shift)return t.dispatchEvent(new X(this,!1)),this;this.insertText("	")}else return null;else return this}this.blinkStart=Date.now()}else if(e instanceof me)e.target===this&&(this.insertText(e.text),this.blinkStart=Date.now());else if(e.target!==this)return null;return this}handlePreLayoutUpdate(){this.editingEnabled||this.root.dropFocus(1,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.inputTextFont,this.textHelper.lineHeight=this.inputTextHeight,this.textHelper.lineSpacing=this.inputTextSpacing,this.textHelper.alignMode=this.inputTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handlePostLayoutUpdate(){this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.selectPos===this.cursorPos?(this.selectOffset[0]=this.cursorOffset[0],this.selectOffset[1]=this.cursorOffset[1]):this.selectOffset=this.textHelper.findOffsetFromIndex(this.selectPos),this.cursorOffsetDirty=!1);let e=this.inputTextInnerPadding,t=this.textHelper.width,r=this.textHelper.height,n=this.idealWidth-e*2,s=this.idealHeight-e*2,o=this.offset,[h,d]=this.cursorOffset;if(t>n){let c=Math.min(20,n/2),u=o[0]+c,p=o[0]+n-c;h>p&&(o[0]+=h-p),h<u&&(o[0]-=u-h),o[0]+n>t&&(o[0]=t-n),o[0]<0&&(o[0]=0)}else o[0]=0;if(r>s){let c=this.textHelper.fullLineHeight;if(c>=s)o[1]=d+Math.max(this.textHelper.actualLineHeight-s,0);else{let u=s<2*c?0:c/2,p=o[1]+u,f=o[1]+s-u-c;d<p&&(o[1]-=p-d),d>f&&(o[1]+=d-f),o[1]+s>r&&(o[1]=r-s),o[1]<0&&(o[1]=0)}}else o[1]=0;this.offset=o,this.needsAutoScroll&&(this.needsAutoScroll=!1,this.root.dispatchEvent(new q(this,this.caretBounds)))}handleResolveDimensions(e,t,r,n){let s=2*this.inputTextInnerPadding;this.textHelper.maxWidth=this.wrapText?Math.max(t-s,0):1/0,this.textHelper.dirty&&(this._dirty=!0);let o=Math.min(Math.max(this.inputTextMinWidth,e),t);this.idealWidth=Math.min(Math.max(o,this.textHelper.width+s),t),this.idealHeight=Math.min(Math.max(r,this.textHelper.height+s),n)}get caretRect(){let e=this.inputTextInnerPadding;return[e+this.cursorOffset[0]-this.offset[0],e+this.cursorOffset[1]-this.offset[1],this.cursorThickness,this.textHelper.fullLineHeight]}get caretAbsoluteRect(){let[e,t,r,n]=this.caretRect;return[e+this.idealX,t+this.idealY,r,n]}get caretBounds(){let[e,t,r,n]=this.caretRect;return[e,e+r,t,t+n]}handlePainting(e){let t=this.viewport.context;t.fillStyle=this.inputBackgroundFill,t.fillRect(this.x,this.y,this.width,this.height),t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip();let r=this.inputTextInnerPadding;if(this.cursorPos!==this.selectPos)if(t.fillStyle=this.inputSelectBackgroundFill,this.cursorOffset[1]===this.selectOffset[1]){let o=Math.min(this.cursorOffset[0],this.selectOffset[0]),h=Math.max(this.cursorOffset[0],this.selectOffset[0]);t.fillRect(this.idealX+r+o-this.offset[0],this.idealY+r+this.cursorOffset[1]-this.offset[1],h-o,this.textHelper.fullLineHeight)}else{let o,h;this.cursorOffset[1]<this.selectOffset[1]?(o=this.cursorOffset,h=this.selectOffset):(h=this.cursorOffset,o=this.selectOffset);let d=this.textHelper.fullLineHeight,c=this.idealWidth+this.offset[0]-o[0]-r;c>0&&t.fillRect(this.idealX+r+o[0]-this.offset[0],this.idealY+r+o[1]-this.offset[1],c,d);let u=h[0]+r-this.offset[0];u>0&&t.fillRect(this.idealX,this.idealY+r+h[1]-this.offset[1],u,d);let p=o[1]+d,f=h[1]-p;f>0&&t.fillRect(this.idealX,this.idealY+r+p-this.offset[1],this.idealWidth,f)}let n;this._editingEnabled?this.variable.valid?n=this.inputTextFill:n=this.inputTextFillInvalid:n=this.inputTextFillDisabled,this.textHelper.paint(t,n,this.idealX+r-this.offset[0],this.idealY+r-this.offset[1]);let s=this.blinkOn;this.blinkWasOn=s,s&&(t.fillStyle=n,t.fillRect(...this.caretAbsoluteRect)),t.restore()}};a(ke,"TextInput"),x([Q(["cursorOffsetDirty","_dirty"])],ke.prototype,"hideText",2),x([jt()],ke.prototype,"offset",2),x([ie],ke.prototype,"wrapText",2);var Ot=class extends at{constructor(i,e){e=A({widthCoupling:2,heightCoupling:2,scrollbarMode:2,typeableTab:!0},e),super(new ke(i,e),e)}get textInput(){return this.child}};a(Ot,"TextArea");var Nt=class extends ve{constructor(i,e){e=A({containerAlignment:{horizontal:.5,vertical:"stretch"}},e),super(i,e)}};a(Nt,"TextMargin");var Ut=class extends Ce{constructor(e,t){super(e);this.scopeTheme=t}set inheritedTheme(e){super.inheritedTheme=this.scopeTheme}get inheritedTheme(){return this.scopeTheme}};a(Ut,"ThemeScope");export{ce as Alignment,Ht as AltKey,Ve as ArtificialConstraint,q as AutoScroll,vt as AxisCoupling,Ze as BackspaceKey,pe as BaseContainer,L as BaseTheme,F as BaseViewport,te as BasicVirtualKey,Ee as Button,be as ButtonClickHelper,re as CanvasViewport,It as Center,ot as Checkbox,oe as ClickHelper,se as ClickState,Ne as ClippedViewport,it as Column,Ge as CompoundClickHelper,ve as Container,Rt as ControlKey,Dt as DOMKeyboardDriver,Ft as DOMPointerDriver,$e as DOMRoot,Ct as DOMVirtualKeyboardRoot,Mt as DebugTheme,Tn as DefaultTextInputHandler,b as DynMsg,Je as EnterKey,qe as EscapeKey,K as Event,Fe as FilledButton,ft as FlexAlignment,V as FocusType,Se as GenericClickHelper,Qe as GlyphVirtualKey,ae as Icon,At as IconButton,Fi as IconFit,Z as KeyEvent,R as KeyPress,ge as KeyRelease,nt as KeyboardDriver,ne as Label,Vt as LabelledCheckbox,Bt as LabelledRadioButton,E as Leave,Me as Margin,Pe as ModifierEvent,S as Msg,ue as MultiContainer,Ye as MultiParent,We as Parent,Ce as PassthroughWidget,De as PointerButtonEvent,He as PointerDriver,W as PointerEvent,si as PointerHint,le as PointerMove,O as PointerPress,Y as PointerRelease,M as PointerWheel,ti as PointerWheelMode,lt as RadioButton,Lt as RayPointerDriver,C as Root,ye as Row,at as ScrollableViewportWidget,li as ScrollbarMode,et as ShiftKey,fe as SingleParent,xt as Slider,tt as SpaceKey,Re as Spacing,X as TabSelect,Wt as TextAlignMode,Ot as TextArea,ze as TextButton,D as TextHelper,ke as TextInput,Nt as TextMargin,me as TextPasteEvent,B as Theme,Ut as ThemeScope,st as ValidatedVariable,xe as Variable,Ie as ViewportWidget,$ as VirtualKey,je as VirtualKeyRow,Le as VirtualKeyboard,St as VirtualKeyboardRoot,y as Widget,ei as WrapMode,rt as defaultVirtualKeyboardTemplate,Qt as flagArrayField,ut as flagField,Et as getPointerEventNormPos,zt as groupedStackTrace,vn as injectDebugCode,ee as injectRandomFillFeature,T as injectStackTraceFeature,bt as injectTraceFeature,gt as injectWatchflagFeature,_e as isDebugFeatureEnabled,Pt as isPower2,Zt as layoutArrayField,ie as layoutField,Ti as listDebugFeatures,pt as measureTextDims,mi as multiFlagArrayField,Q as multiFlagField,jt as paintArrayField,we as paintField,qt as paintLayoutArrayField,Ri as paintLayoutField,ii as parseDOMDeltaMode,kt as roundToPower2,xi as toggleDebugFeature,Ae as watchArrayField,ct as watchField};
//# sourceMappingURL=index.esm.js.map
