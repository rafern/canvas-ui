var rt=Object.defineProperty;var Ot=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertySymbols;var Kt=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var _t=(h,i,e)=>i in h?rt(h,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[i]=e,Q=(h,i)=>{for(var e in i||(i={}))Kt.call(i,e)&&_t(h,e,i[e]);if(kt)for(var e of kt(i))Bt.call(i,e)&&_t(h,e,i[e]);return h};var a=(h,i)=>rt(h,"name",{value:i,configurable:!0});var y=(h,i,e,t)=>{for(var r=t>1?void 0:t?Ot(i,e):i,n=h.length-1,s;n>=0;n--)(s=h[n])&&(r=(t?s(i,e,r):s(r))||r);return t&&r&&rt(i,e,r),r};var Pt=(h,i,e)=>new Promise((t,r)=>{var n=l=>{try{o(e.next(l))}catch(d){r(d)}},s=l=>{try{o(e.throw(l))}catch(d){r(d)}},o=l=>l.done?t(l.value):Promise.resolve(l.value).then(n,s);o((e=e.apply(h,i)).next())});var ze=(n=>(n.SpaceBetween="between",n.SpaceAround="around",n[n.Start=0]="Start",n[n.Center=.5]="Center",n[n.End=1]="End",n))(ze||{});var J=(r=>(r.Stretch="stretch",r[r.Start=0]="Start",r[r.Center=.5]="Center",r[r.End=1]="End",r))(J||{});var $=class{constructor(i,e,t,r=!1){this.target=i,this.focusType=e,this.needsFocus=t,this.reversed=r}};a($,"Event");var me=class extends ${constructor(e,t,r,n,s,o){super(n,s,o);this.shift=e,this.ctrl=t,this.alt=r}};a(me,"ModifierEvent");var T=class extends me{constructor(e,t,r,n,s,o=null,l=null){super(r,n,s,o,l,!1);this.x=e,this.y=t}};a(T,"PointerEvent");var Ee=class extends ${constructor(e,t){super(null,null,!1,t);this.relativeTo=e,this.reachedRelative=e===null}cloneWithTarget(e){return e!==null&&!Ee.targetWarned&&(Ee.targetWarned=!0,console.warn("TabSelect events cannot be targetted to a specific widget. Target ignored")),new Ee(this.relativeTo,this.reversed)}},E=Ee;a(E,"TabSelect"),E.targetWarned=!1;var He=null;function je(h,i){if(He===null&&(He=document.createElement("canvas").getContext("2d"),He===null))throw new Error("Failed to get canvas context");return He.font=i,He.measureText(h)}a(je,"measureTextDims");function qe(h){return function(i,e){let t=new WeakMap;Object.defineProperty(i,e,{set:function(r){let n=t.get(this);r!==n&&(t.set(this,r),h.call(this,n))},get:function(){return t.get(this)},enumerable:!0,configurable:!0})}}a(qe,"watchField");function wt(h){return qe(function(i){this[h]=!0})}a(wt,"flagField");var pe=wt("_dirty"),z=wt("_layoutDirty");function K(h){return qe(function(i){for(let e of h)this[e]=!0})}a(K,"multiFlagField");var yi=K(["_dirty","_layoutDirty"]);function Ft(h,i=!1){return function(e,t){let r=new WeakMap;Object.defineProperty(e,t,{set:function(n){if(Array.isArray(n)){let s=r.get(this);if(Array.isArray(s)){if(n.length!==s.length){s.length=n.length;for(let o=0;o<n.length;o++)s[o]=n[o];h.call(this)}else for(let o=0;o<n.length;o++)if(s[o]!==n[o]){for(let l=0;l<n.length;l++)s[l]=n[l];h.call(this);return}}else r.set(this,[...n]),h.call(this)}else if(i)r.set(this,n),h.call(this);else throw new Error("Value must be an array")},get:function(){let n=r.get(this);return Array.isArray(n)?[...n]:n},enumerable:!0,configurable:!0})}}a(Ft,"watchArrayField");function Ct(h,i=!1){return Ft(function(){this[h]=!0},i)}a(Ct,"flagArrayField");function Ze(h=!1){return Ct("_dirty",h)}a(Ze,"paintArrayField");function St(h=!1){return Ct("_layoutDirty",h)}a(St,"layoutArrayField");function Gt(h,i=!1){return Ft(function(){for(let e of h)this[e]=!0},i)}a(Gt,"multiFlagArrayField");function Dt(h=!1){return Gt(["_dirty","_layoutDirty"],h)}a(Dt,"paintLayoutArrayField");var $t=new Set([`
`,"	"]),Wt=(e=>(e[e.Normal=0]="Normal",e[e.Shrink=1]="Shrink",e))(Wt||{}),Rt=(t=>(t[t.Start=0]="Start",t[t.Center=.5]="Center",t[t.End=1]="End",t))(Rt||{}),C=class{constructor(){this.text="";this.font="";this.maxWidth=1/0;this.lineHeight=null;this.lineSpacing=null;this.tabWidth=4;this.wrapMode=0;this.alignMode=0;this._width=0;this._height=0;this._lineHeight=0;this._lineSpacing=0;this._tabWidth=0;this.measureDirty=!0;this.lineHeightSpacingDirty=!0;this.tabWidthDirty=!0;this._dirty=!1;this._lineRanges=[]}get dirty(){let i=this._dirty;return this._dirty=!1,i}measureTextSlice(i,e,t){let r=je(this.text.slice(e,t),this.font);return i===0?r.width+Math.max(0,r.actualBoundingBoxLeft):i+r.width}getLineRangeWidthUntil(i,e){if(e<=i[0][0])return 0;let t=0;for(;t<i.length;t++){let s=i[t],o=s[1];if(e==o)return s[2];if(e>=s[0]&&e<o)break}if(t===i.length)return i[t-1][2];let r=0;t>0&&(r=i[t-1][2]);let n=i[t];return n[3]?r+n[2]*(e-n[0])/(n[1]-n[0]):this.measureTextSlice(r,n[0],e)}measureText(i,e,t,r){var c,m;let n=0;for(;n<r.length;n++){let p=r[n];if(i>=p[0]&&i<p[1]){i=p[0];break}}if(n>0){let p=r[n-1];p[1]!==i&&(i=p[1],--n>0?p=r[n]:p=null),p!==null&&!p[3]&&!$t.has(this.text[i])&&(i=p[0],n--)}let s=0;n>0&&(s=r[n-1][2]);let o=i,l=[];for(;o<e;)if(this.text[o]==="	"){let p=this.actualTabWidth;s=(Math.floor(s/p)+1)*p,l.push([o,++o,s,!0])}else if(this.text[o]===`
`){l.push([o,++o,s,!0]),o<e&&console.warn("measureText called with text range where newline was at the middle of the range instead of at the end. Some text was ignored");break}else{let p=this.text.indexOf(`
`,o+1);p===-1&&(p=1/0);let b=this.text.indexOf("	",o+1);b===-1&&(b=1/0);let v=Math.min(p,b,e);s=this.measureTextSlice(s,o,v),l.push([o,v,s,!1]),o=v}let d=n+l.length,u=(m=(c=l[l.length-1])!=null?c:r[n-1])!=null?m:null;return u===null?(r.length=0,r.push([i,i,0,!1]),!0):d===1&&u[1]-u[0]<=1||u[2]<=t?(r.length=n,r.push(...l),!0):!1}updateTextDims(){if(this.lineHeightSpacingDirty){this.lineHeightSpacingDirty=!1;let e=this._lineHeight,t=this._lineSpacing;if(this.lineHeight===null||this.lineSpacing===null){let r=je("~!@#$%^&*()_+`1234567890-=qwertyuiop[]\\QWERTYUIOP{}|asdfghjkl;'ASDFGHJKL:\"zxcvbnm,./ZXCVBNM<>?",this.font);this.lineHeight===null?this._lineHeight=r.actualBoundingBoxAscent:this._lineHeight=this.lineHeight,this.lineSpacing===null?this._lineSpacing=r.actualBoundingBoxDescent:this._lineSpacing=this.lineSpacing}else this._lineHeight=this.lineHeight,this._lineSpacing=this.lineSpacing;(e!==this._lineHeight||t!==this._lineSpacing)&&(this.measureDirty=!0)}if(this.tabWidthDirty&&(this.tabWidthDirty=!1,this._tabWidth=je(" ",this.font).width*this.tabWidth),!this.measureDirty)return;this.measureDirty=!1;let i=this._lineHeight+this._lineSpacing;if(this.text.length===0)this._height=i,this._width=this.maxWidth===1/0?0:this.maxWidth,this._lineRanges.length=1,this._lineRanges[0]=[[0,0,0,!1]];else if(this.maxWidth===1/0){this._lineRanges.length=0;let e=0;this._height=0,this._width=0;let t=this.text;for(;;){let r=this.text.indexOf(`
`,e),n=r===-1,s=n?t.length:r+1,o=[];this.measureText(e,s,1/0,o),this._lineRanges.push(o),this._height+=i;let l=o[o.length-1][2];if(l>this._width&&(this._width=l),n)break;e=s}}else{this._lineRanges.length=0;let e=[],t=this.text,r=/\s/,n=-1;for(let s=0;s<=t.length;){let o=r.test(t[s]),l=s===t.length;if(o||l){if(n>=0&&!this.measureText(n,s,this.maxWidth,e)){let d=[];if(this.measureText(n,s,this.maxWidth,d)){if(e.length===0)throw new Error("Unexpected line range without any render groups");this._lineRanges.push(e),e=d}else{let u=n;for(;u<s-1&&this.measureText(u,u+1,this.maxWidth,e);u++);this._lineRanges.push(e),e=d,s=u,n=u;continue}}if(n=-1,l){if(e.length===0){let d=this._lineRanges[this._lineRanges.length-1];if(d===void 0)e.push([0,0,0,!1]);else{let u=d[d.length-1];u===void 0?e.push([0,0,0,!1]):e.push([u[1],u[1],0,!1])}}this._lineRanges.push(e);break}if(t[s]===`
`)this.measureText(s,s+1,1/0,e),this._lineRanges.push(e),e=[];else if(!this.measureText(s,s+1,this.maxWidth,e))if(this.wrapMode===1){let d=s;do s++;while(t[s]!==`
`&&r.test(t[s]));let u=e[e.length-1];e.push([d,s,u!==void 0?u[2]:0,!0]),this._lineRanges.push(e),e=[];continue}else this._lineRanges.push(e),e=[],this.measureText(s,s+1,1/0,e)}else n===-1&&(n=s);s++}this._width=this.maxWidth,this._height=i*this._lineRanges.length}}paintGroup(i,e,t,r,n){!e[3]&&e[2]>t&&i.fillText(this.text.slice(e[0],e[1]),r,n)}paint(i,e,t,r){i.save(),i.beginPath(),i.rect(t,r,this.width,this.height),i.clip(),i.font=this.font,i.fillStyle=e,i.textBaseline="alphabetic",this.updateTextDims();let n=this.fullLineHeight,s=r+this._lineHeight;for(let o=0;o<this._lineRanges.length;o++){let l=0,d=this.getLineShift(o);for(let u of this._lineRanges[o])this.paintGroup(i,u,l,t+l+d,s),l=u[2];s+=n}i.restore()}findOffsetFromIndex(i){if(this.updateTextDims(),i<=0||this._lineRanges.length===0)return[this.getLineShift(0),0];let e=0;for(let t of this._lineRanges){if(i<t[t.length-1][1])break;e++}return e>=this._lineRanges.length&&(e=this._lineRanges.length-1,i=this.text.length),[this.getLineRangeWidthUntil(this._lineRanges[e],i)+this.getLineShift(e),e*this.fullLineHeight]}findIndexOffsetFromOffset(i){let e=this.fullLineHeight,t=this.getLineShift(0);if(this.text===""||i[0]<=t&&i[1]<e||i[1]<0)return[0,[t,0]];let r=Math.floor(i[1]/e);if(this.updateTextDims(),r>=this._lineRanges.length){let m=this.text.length;return[m,this.findOffsetFromIndex(m)]}let n=r*e,s=this._lineRanges[r],o=this.getLineShift(r);if(s.length===1&&s[0][0]===s[0][1])return[s[0][0],[s[0][2]+o,n]];let l=0,d=s[0][0],u=s[s.length-1][1];this.text[u-1]===`
`&&u--;let c=i[0]-o;for(let m=d;m<u;m++){let p=this.getLineRangeWidthUntil(s,m+1),b=(p+l)/2;if(c<b)return[m,[l+o,n]];l=p}return[u,[l+o,n]]}getLine(i){if(i<=0)return 0;this.updateTextDims();for(let e=0;e<this._lineRanges.length;e++){let t=this._lineRanges[e],r=t[t.length-1];if(i<r[1])return e}return this._lineRanges.length-1}getLineStart(i){if(i<=0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let e=this._lineRanges[this._lineRanges.length-1];return e[e.length-1][1]}return this._lineRanges[i][0][0]}getLineEnd(i,e=!0){if(i<0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let s=this._lineRanges[this._lineRanges.length-1];return s[s.length-1][1]}let t=this._lineRanges[i],r=t[t.length-1],n=r[1];return!e&&n>0&&this.text[n-1]===`
`&&r[0]!==r[1]?n-1:n}getLineShift(i){let e=this.alignMode;if(e===0)return 0;if(this.updateTextDims(),i<0)i=0;else if(i>=this._lineRanges.length)return this.width*e;let t=this._lineRanges[i];return(this.width-t[t.length-1][2])*e}get width(){return this.updateTextDims(),this._width}get height(){return this.updateTextDims(),this._height}get lineRanges(){return this.updateTextDims(),[...this._lineRanges]}get actualLineHeight(){return this.updateTextDims(),this._lineHeight}get actualLineSpacing(){return this.updateTextDims(),this._lineSpacing}get actualTabWidth(){return this.updateTextDims(),this._tabWidth}get fullLineHeight(){return this.updateTextDims(),this._lineHeight+this._lineSpacing}};a(C,"TextHelper"),y([K(["_dirty","measureDirty"])],C.prototype,"text",2),y([K(["_dirty","measureDirty","lineHeightSpacingDirty","tabWidthDirty"])],C.prototype,"font",2),y([K(["_dirty","measureDirty"])],C.prototype,"maxWidth",2),y([K(["_dirty","measureDirty","lineHeightSpacingDirty"])],C.prototype,"lineHeight",2),y([K(["_dirty","measureDirty","lineHeightSpacingDirty"])],C.prototype,"lineSpacing",2),y([K(["_dirty","measureDirty","tabWidthDirty"])],C.prototype,"tabWidth",2),y([K(["_dirty","measureDirty"])],C.prototype,"wrapMode",2),y([K(["_dirty"])],C.prototype,"alignMode",2);var D=class{constructor(i,e){this.listener=null;this._fallbackTheme=e,typeof i!="undefined"&&(this._canvasFill=i.canvasFill,this._containerPadding=i.containerPadding,this._containerAlignment=i.containerAlignment,this._multiContainerSpacing=i.multiContainerSpacing,this._multiContainerAlignment=i.multiContainerAlignment,this._primaryFill=i.primaryFill,this._accentFill=i.accentFill,this._backgroundFill=i.backgroundFill,this._backgroundGlowFill=i.backgroundGlowFill,this._sliderMinLength=i.sliderMinLength,this._sliderThickness=i.sliderThickness,this._bodyTextFont=i.bodyTextFont,this._bodyTextFill=i.bodyTextFill,this._bodyTextHeight=i.bodyTextHeight,this._bodyTextSpacing=i.bodyTextSpacing,this._bodyTextAlign=i.bodyTextAlign,this._checkboxLength=i.checkboxLength,this._checkboxInnerPadding=i.checkboxInnerPadding,this._inputBackgroundFill=i.inputBackgroundFill,this._inputSelectBackgroundFill=i.inputSelectBackgroundFill,this._inputTextFont=i.inputTextFont,this._inputTextFill=i.inputTextFill,this._inputTextFillDisabled=i.inputTextFillDisabled,this._inputTextFillInvalid=i.inputTextFillInvalid,this._inputTextHeight=i.inputTextHeight,this._inputTextSpacing=i.inputTextSpacing,this._inputTextInnerPadding=i.inputTextInnerPadding,this._inputTextMinWidth=i.inputTextMinWidth,this._inputTextAlign=i.inputTextAlign,this._blinkRate=i.blinkRate,this._cursorThickness=i.cursorThickness,this._scrollBarThickness=i.scrollBarThickness,this._scrollBarMinPercent=i.scrollBarMinPercent,this._scrollBarMinPixels=i.scrollBarMinPixels)}get fallbackTheme(){return this._fallbackTheme}set fallbackTheme(i){if(this._fallbackTheme===i)return;let e=this._fallbackTheme;typeof e!="undefined"&&this.listener!==null&&e.unsubscribe(this.listener),typeof i!="undefined"&&(this.listener=t=>this.onThemeUpdated(t),i.subscribe(this.listener)),this._fallbackTheme=i,this.onThemeUpdated()}onThemeUpdated(i=null){}get canvasFill(){var i,e,t;return(t=(e=this._canvasFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.canvasFill)!=null?t:"rgba(0,0,0,0.5)"}set canvasFill(i){this._canvasFill!==i&&(this._canvasFill=i,this.onThemeUpdated("canvasFill"))}get containerPadding(){var i,e,t;return(t=(e=this._containerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerPadding)!=null?t:{left:4,right:4,top:4,bottom:4}}set containerPadding(i){this._containerPadding!==i&&(this._containerPadding=i,this.onThemeUpdated("containerPadding"))}get containerAlignment(){var i,e,t;return(t=(e=this._containerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerAlignment)!=null?t:{horizontal:0,vertical:0}}set containerAlignment(i){this._containerAlignment!==i&&(this._containerAlignment=i,this.onThemeUpdated("containerAlignment"))}get multiContainerSpacing(){var i,e,t;return(t=(e=this._multiContainerSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerSpacing)!=null?t:4}set multiContainerSpacing(i){this._multiContainerSpacing!==i&&(this._multiContainerSpacing=i,this.onThemeUpdated("multiContainerSpacing"))}get multiContainerAlignment(){var i,e,t;return(t=(e=this._multiContainerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerAlignment)!=null?t:{main:"between",cross:"stretch"}}set multiContainerAlignment(i){this._multiContainerAlignment!==i&&(this._multiContainerAlignment=i,this.onThemeUpdated("multiContainerAlignment"))}get primaryFill(){var i,e,t;return(t=(e=this._primaryFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.primaryFill)!=null?t:"rgb(0,127,255)"}set primaryFill(i){this._primaryFill!==i&&(this._primaryFill=i,this.onThemeUpdated("primaryFill"))}get accentFill(){var i,e,t;return(t=(e=this._accentFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.accentFill)!=null?t:"rgb(0,195,255)"}set accentFill(i){this._accentFill!==i&&(this._accentFill=i,this.onThemeUpdated("accentFill"))}get backgroundFill(){var i,e,t;return(t=(e=this._backgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundFill)!=null?t:"rgb(32,32,32)"}set backgroundFill(i){this._backgroundFill!==i&&(this._backgroundFill=i,this.onThemeUpdated("backgroundFill"))}get backgroundGlowFill(){var i,e,t;return(t=(e=this._backgroundGlowFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundGlowFill)!=null?t:"rgb(48,48,48)"}set backgroundGlowFill(i){this._backgroundGlowFill!==i&&(this._backgroundGlowFill=i,this.onThemeUpdated("backgroundGlowFill"))}get sliderMinLength(){var i,e,t;return(t=(e=this._sliderMinLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderMinLength)!=null?t:100}set sliderMinLength(i){this._sliderMinLength!==i&&(this._sliderMinLength=i,this.onThemeUpdated("sliderMinLength"))}get sliderThickness(){var i,e,t;return(t=(e=this._sliderThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderThickness)!=null?t:10}set sliderThickness(i){this._sliderThickness!==i&&(this._sliderThickness=i,this.onThemeUpdated("sliderThickness"))}get bodyTextFont(){var i,e,t;return(t=(e=this._bodyTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFont)!=null?t:"1rem sans-serif"}set bodyTextFont(i){this._bodyTextFont!==i&&(this._bodyTextFont=i,this.onThemeUpdated("bodyTextFont"))}get bodyTextFill(){var i,e,t;return(t=(e=this._bodyTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFill)!=null?t:"white"}set bodyTextFill(i){this._bodyTextFill!==i&&(this._bodyTextFill=i,this.onThemeUpdated("bodyTextFill"))}get bodyTextHeight(){var i,e,t;return(t=(e=this._bodyTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextHeight)!=null?t:null}set bodyTextHeight(i){this._bodyTextHeight!==i&&(this._bodyTextHeight=i,this.onThemeUpdated("bodyTextHeight"))}get bodyTextSpacing(){var i,e,t;return(t=(e=this._bodyTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextSpacing)!=null?t:null}set bodyTextSpacing(i){this._bodyTextSpacing!==i&&(this._bodyTextSpacing=i,this.onThemeUpdated("bodyTextSpacing"))}get bodyTextAlign(){var i,e,t;return(t=(e=this._bodyTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextAlign)!=null?t:0}set bodyTextAlign(i){this._bodyTextAlign!==i&&(this._bodyTextAlign=i,this.onThemeUpdated("bodyTextAlign"))}get checkboxLength(){var i,e,t;return(t=(e=this._checkboxLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxLength)!=null?t:12}set checkboxLength(i){this._checkboxLength!==i&&(this._checkboxLength=i,this.onThemeUpdated("checkboxLength"))}get checkboxInnerPadding(){var i,e,t;return(t=(e=this._checkboxInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxInnerPadding)!=null?t:2}set checkboxInnerPadding(i){this._checkboxInnerPadding!==i&&(this._checkboxInnerPadding=i,this.onThemeUpdated("checkboxInnerPadding"))}get inputBackgroundFill(){var i,e,t;return(t=(e=this._inputBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputBackgroundFill)!=null?t:"white"}set inputBackgroundFill(i){this._inputBackgroundFill!==i&&(this._inputBackgroundFill=i,this.onThemeUpdated("inputBackgroundFill"))}get inputSelectBackgroundFill(){var i,e,t;return(t=(e=this._inputSelectBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputSelectBackgroundFill)!=null?t:"rgb(0,195,255)"}set inputSelectBackgroundFill(i){this._inputSelectBackgroundFill!==i&&(this._inputSelectBackgroundFill=i,this.onThemeUpdated("inputSelectBackgroundFill"))}get inputTextFont(){var i,e,t;return(t=(e=this._inputTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFont)!=null?t:"1rem monospace"}set inputTextFont(i){this._inputTextFont!==i&&(this._inputTextFont=i,this.onThemeUpdated("inputTextFont"))}get inputTextFill(){var i,e,t;return(t=(e=this._inputTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFill)!=null?t:"black"}set inputTextFill(i){this._inputTextFill!==i&&(this._inputTextFill=i,this.onThemeUpdated("inputTextFill"))}get inputTextFillDisabled(){var i,e,t;return(t=(e=this._inputTextFillDisabled)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillDisabled)!=null?t:"grey"}set inputTextFillDisabled(i){this._inputTextFillDisabled!==i&&(this._inputTextFillDisabled=i,this.onThemeUpdated("inputTextFillDisabled"))}get inputTextFillInvalid(){var i,e,t;return(t=(e=this._inputTextFillInvalid)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillInvalid)!=null?t:"red"}set inputTextFillInvalid(i){this._inputTextFillInvalid!==i&&(this._inputTextFillInvalid=i,this.onThemeUpdated("inputTextFillInvalid"))}get inputTextHeight(){var i,e,t;return(t=(e=this._inputTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextHeight)!=null?t:null}set inputTextHeight(i){this._inputTextHeight!==i&&(this._inputTextHeight=i,this.onThemeUpdated("inputTextHeight"))}get inputTextSpacing(){var i,e,t;return(t=(e=this._inputTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextSpacing)!=null?t:null}set inputTextSpacing(i){this._inputTextSpacing!==i&&(this._inputTextSpacing=i,this.onThemeUpdated("inputTextSpacing"))}get inputTextInnerPadding(){var i,e,t;return(t=(e=this._inputTextInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextInnerPadding)!=null?t:2}set inputTextInnerPadding(i){this._inputTextInnerPadding!==i&&(this._inputTextInnerPadding=i,this.onThemeUpdated("inputTextInnerPadding"))}get inputTextMinWidth(){var i,e,t;return(t=(e=this._inputTextMinWidth)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextMinWidth)!=null?t:100}set inputTextMinWidth(i){this._inputTextMinWidth!==i&&(this._inputTextMinWidth=i,this.onThemeUpdated("inputTextMinWidth"))}get inputTextAlign(){var i,e,t;return(t=(e=this._inputTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextAlign)!=null?t:0}set inputTextAlign(i){this._inputTextAlign!==i&&(this._inputTextAlign=i,this.onThemeUpdated("inputTextAlign"))}get blinkRate(){var i,e,t;return(t=(e=this._blinkRate)!=null?e:(i=this._fallbackTheme)==null?void 0:i.blinkRate)!=null?t:.8}set blinkRate(i){this._blinkRate!==i&&(this._blinkRate=i,this.onThemeUpdated("blinkRate"))}get cursorThickness(){var i,e,t;return(t=(e=this._cursorThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.cursorThickness)!=null?t:1}set cursorThickness(i){this._cursorThickness!==i&&(this._cursorThickness=i,this.onThemeUpdated("cursorThickness"))}get scrollBarThickness(){var i,e,t;return(t=(e=this._scrollBarThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarThickness)!=null?t:8}set scrollBarThickness(i){this._scrollBarThickness!==i&&(this._scrollBarThickness=i,this.onThemeUpdated("scrollBarThickness"))}get scrollBarMinPercent(){var i,e,t;return(t=(e=this._scrollBarMinPercent)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPercent)!=null?t:.1}set scrollBarMinPercent(i){this._scrollBarMinPercent!==i&&(this._scrollBarMinPercent=i,this.onThemeUpdated("scrollBarMinPercent"))}get scrollBarMinPixels(){var i,e,t;return(t=(e=this._scrollBarMinPixels)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPixels)!=null?t:20}set scrollBarMinPixels(i){this._scrollBarMinPixels!==i&&(this._scrollBarMinPixels=i,this.onThemeUpdated("scrollBarMinPixels"))}};a(D,"BaseTheme");var Nt=/[%a-zA-Z]+/,Et=/[0-9]+(\.[0-9]+)?(%|cap|ch|ex|vmin|vmax|Q|r?em|r?lh|i[cn]|[cm]m|p[xct]|v[hwib])/,f=class extends D{constructor(e,t,r){super(r);this._enabled=!0;this._dirty=!0;this._layoutDirty=!0;this.width=0;this.height=0;this.x=0;this.y=0;this._flex=0;this.root=null;this.tabFocusable=!1;this._cachedFont_bodyTextFont="";this._cachedLastFont_bodyTextFont="";this._cachedFont_inputTextFont="";this._cachedLastFont_inputTextFont="";this.needsClear=e,this.propagatesEvents=t}get flex(){return this._flex}set flex(e){e!==this._flex&&(this._flex=e,this._layoutDirty=!0)}set enabled(e){e!==this._enabled&&(this._enabled=e,this.forceDirty())}get enabled(){return this._enabled}set inheritedTheme(e){this.fallbackTheme=e}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){super.onThemeUpdated(e),this.needsClear&&(e===null||e==="canvasFill")&&(this._dirty=!0)}get dimensions(){return[this.width,this.height]}get position(){return[this.x,this.y]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return this.width==0||this.height==0}onFocusGrabbed(e,t){}onFocusDropped(e,t){}handleEvent(e,t){return e.target===this?this:null}dispatchEvent(e,t){if(!this._enabled)return null;if(e.target===null){if(e instanceof T&&(e.x<this.x||e.y<this.y||e.x>=this.x+this.width||e.y>=this.y+this.height))return null}else if(e.target!==this&&!this.propagatesEvents)return null;let r=null;if(e.reversed&&(r=this.handleEvent(e,t)),e instanceof E)if(e.reachedRelative){if(this.tabFocusable&&(r===this||r===null))return this}else e.relativeTo===this&&(e.reachedRelative=!0);return e.reversed||(r=this.handleEvent(e,t)),r}handlePreLayoutUpdate(e){}preLayoutUpdate(e){this.root=e,this._enabled&&this.handlePreLayoutUpdate(e)}resolveDimensions(e,t,r,n){if(!this._enabled){this.width=0,this.height=0,this._layoutDirty=!1;return}if(e==1/0)throw new Error("minWidth must not be infinite");if(e>t&&(console.warn(`minWidth (${e}) must not be greater than maxWidth (${t}). Set minWidth to maxWidth. This may be caused by floating pointer precision errors`),e=t),e<0&&(console.warn(`minWidth (${e}) must not be lesser than 0. Set minWidth to 0. This may be caused by floating pointer precision errors`),e=0),r==1/0)throw new Error("minHeight must not be infinite");r>n&&(console.warn(`minHeight (${r}) must not be greater than maxHeight (${n}). Set minHeight to maxHeight. This may be caused by floating pointer precision errors`),r=n),r<0&&(console.warn(`minHeight (${r}) must not be lesser than 0. Set minHeight to 0. This may be caused by floating pointer precision errors`),r=0);let s=this.width,o=this.height;if(this.handleResolveDimensions(e,t,r,n),this.width<e?(this.width=e,console.error("Horizontal underflow in widget")):this.width>t&&(this.width=t,console.error("Horizontal overflow in widget")),this.width<0||!isFinite(this.width)||isNaN(this.width))throw new Error(`Disallowed width (${this.width}) in widget`);if(this.height<r?(this.height=r,console.error("Vertical underflow in widget")):this.height>n&&(this.height=n,console.error("Vertical overflow in widget")),this.height<0||!isFinite(this.height)||isNaN(this.height))throw new Error(`Disallowed height (${this.height}) in widget`);this._layoutDirty=!1,(s!==this.width||o!==this.height)&&(this._dirty=!0)}resolveDimensionsAsTop(e,t,r,n){this.resolveDimensions(e,t,r,n),(t===1/0||n===1/0)&&this.resolveDimensions(e,t===1/0?this.width:t,r,n===1/0?this.height:n)}afterPositionResolved(){}resolvePosition(e,t){(e!==this.x||t!==this.y)&&(this._dirty=!0),this.x=e,this.y=t,this.afterPositionResolved()}handlePostLayoutUpdate(e){}postLayoutUpdate(e){this._enabled&&this.handlePostLayoutUpdate(e)}clear(e,t,r,n,s,o=null){s.save(),s.globalCompositeOperation="copy",s.fillStyle=o!=null?o:this.canvasFill,s.beginPath(),s.rect(...this.roundRect(e,t,r,n,!0)),s.clip(),s.fill(),s.restore()}clearStart(e,t=null){e.save(),e.globalCompositeOperation="copy",e.fillStyle=t!=null?t:this.canvasFill,e.beginPath()}clearEnd(e,t="nonzero"){e.clip(t),e.fill(),e.restore()}roundRect(e,t,r,n,s=!1){let o=s?Math.ceil:Math.floor,l=s?Math.floor:Math.ceil;return e=o(e),t=o(t),[e,t,l(e+r)-e,l(t+n)-t]}handlePainting(e,t){}paint(e,t=!1){if(this.dimensionless)return this.dryPaint();!this._dirty&&!t||(this._enabled&&(this.needsClear&&this.clear(this.x,this.y,this.width,this.height,e),e.save(),this.handlePainting(e,t),e.restore()),this._dirty=!1)}dryPaint(){this._dirty=!1}forceThemeUpdate(){this.onThemeUpdated()}forceDirty(){this._dirty=!0,this._layoutDirty=!0}scaleFont(e,t){let r=e.search(Et),n,s,o=0;if(r==-1)(r=e.search("xx-small"))!==-1?(s=.5625*t,o=8):(r=e.search("x-small"))!==-1?(s=.625*t,o=7):(r=e.search("small"))!==-1?(s=.8333*t,o=5):(r=e.search("medium"))!==-1?(s=t,o=6):(r=e.search("large"))!==-1?(s=1.125*t,o=5):(r=e.search("x-large"))!==-1?(s=1.5*t,o=7):(r=e.search("xx-large"))!==-1?(s=2*t,o=8):(r=e.search("smaller"))!==-1?(s=.8333*t,o=7):(r=e.search("larger"))!==-1?(s=1.125*t,o=6):s=t,n="rem";else{let l=e.match(Et);if(l===null)throw new Error("Unexpected null font-size match");let d=l[0];o=d.length;let u=d.match(Nt);if(u===null)throw new Error("Unexpected null font-size suffix match");n=u[0],s=parseFloat(d)*t}return e.substring(0,r)+s.toString()+n+e.substring(r+o,e.length)}get containerPadding(){var r,n;let e=super.containerPadding,t=(n=(r=this.root)==null?void 0:r.resolution)!=null?n:1;return{left:e.left*t,right:e.right*t,top:e.top*t,bottom:e.bottom*t}}set containerPadding(e){super.containerPadding=e}get multiContainerSpacing(){var e,t;return super.multiContainerSpacing*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set multiContainerSpacing(e){super.multiContainerSpacing=e}get sliderMinLength(){var e,t;return super.sliderMinLength*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set sliderMinLength(e){super.sliderMinLength=e}get sliderThickness(){var e,t;return super.sliderThickness*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set sliderThickness(e){super.sliderThickness=e}get bodyTextFont(){var t,r;let e=super.bodyTextFont;return e!==this._cachedLastFont_bodyTextFont&&(this._cachedLastFont_bodyTextFont=e,this._cachedFont_bodyTextFont=this.scaleFont(e,(r=(t=this.root)==null?void 0:t.resolution)!=null?r:1)),this._cachedFont_bodyTextFont}set bodyTextFont(e){super.bodyTextFont=e}get bodyTextHeight(){var t,r;let e=super.bodyTextHeight;return e===null?e:e*((r=(t=this.root)==null?void 0:t.resolution)!=null?r:1)}set bodyTextHeight(e){super.bodyTextHeight=e}get bodyTextSpacing(){var t,r;let e=super.bodyTextSpacing;return e===null?e:e*((r=(t=this.root)==null?void 0:t.resolution)!=null?r:1)}set bodyTextSpacing(e){super.bodyTextSpacing=e}get checkboxLength(){var e,t;return super.checkboxLength*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set checkboxLength(e){super.checkboxLength=e}get checkboxInnerPadding(){var e,t;return super.checkboxInnerPadding*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set checkboxInnerPadding(e){super.checkboxInnerPadding=e}get inputTextFont(){var t,r;let e=super.inputTextFont;return e!==this._cachedLastFont_inputTextFont&&(this._cachedLastFont_inputTextFont=e,this._cachedFont_inputTextFont=this.scaleFont(e,(r=(t=this.root)==null?void 0:t.resolution)!=null?r:1)),this._cachedFont_inputTextFont}set inputTextFont(e){super.inputTextFont=e}get inputTextHeight(){var t,r;let e=super.inputTextHeight;return e===null?e:e*((r=(t=this.root)==null?void 0:t.resolution)!=null?r:1)}set inputTextHeight(e){super.inputTextHeight=e}get inputTextSpacing(){var t,r;let e=super.inputTextSpacing;return e===null?e:e*((r=(t=this.root)==null?void 0:t.resolution)!=null?r:1)}set inputTextSpacing(e){super.inputTextSpacing=e}get inputTextInnerPadding(){var e,t;return super.inputTextInnerPadding*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set inputTextInnerPadding(e){super.inputTextInnerPadding=e}get inputTextMinWidth(){var e,t;return super.inputTextMinWidth*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set inputTextMinWidth(e){super.inputTextMinWidth=e}get cursorThickness(){var e,t;return super.cursorThickness*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set cursorThickness(e){super.cursorThickness=e}get scrollBarThickness(){var e,t;return super.scrollBarThickness*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set scrollBarThickness(e){super.scrollBarThickness=e}get scrollBarMinPixels(){var e,t;return super.scrollBarMinPixels*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}set scrollBarMinPixels(e){super.scrollBarMinPixels=e}};a(f,"Widget");var fe=class extends f{constructor(e,t,r,n){super(t,r,n);this._children=[...e],this.forceDirty()}set inheritedTheme(e){super.inheritedTheme=e;for(let t of this.children)t.inheritedTheme=e}get inheritedTheme(){return super.inheritedTheme}dryPaint(){super.dryPaint();for(let e of this.children)e.dryPaint()}forceDirty(){super.forceDirty();for(let e of this.children)e.forceDirty()}get childCount(){return this._children.length}get children(){return this._children.values()}};a(fe,"Parent");var Le=class extends fe{add(i){if(Array.isArray(i))for(let e of i)this._children.push(e),e.inheritedTheme=this.inheritedTheme;else this._children.push(i),i.inheritedTheme=this.inheritedTheme;return this.forceDirty(),this}remove(i){if(Array.isArray(i))for(let e of i){let t=this._children.indexOf(e);t!==-1&&this._children.splice(t,1)}else{let e=this._children.indexOf(i);e!==-1&&this._children.splice(e,1)}return this.forceDirty(),this}clearChildren(){return this._children.length=0,this.forceDirty(),this}};a(Le,"MultiParent");var ee=class extends Le{constructor(e,t){super([],!1,!0,t);this.backgroundDirty=!0;this.unusedSpace=0;this.enabledChildCount=0;this.vertical=e}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="multiContainerAlignment"?this._layoutDirty=!0:e==="multiContainerSpacing"&&(this._layoutDirty=!0)}handleEvent(e,t){let r=this.children;e.reversed&&(r=Array.from(r).reverse());for(let n of r){if(!n.enabled)continue;let s=n.dispatchEvent(e,t);if(s!==null)return s}return null}handlePreLayoutUpdate(e){for(let t of this.children)t.preLayoutUpdate(e),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(e){for(let t of this.children)t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=0,o=0,l=0,d=this.vertical?n:t;this.multiContainerAlignment.cross==="stretch"&&(l=this.vertical?t:n,l==1/0&&(l=this.vertical?e:r)),this.enabledChildCount=0;for(let x of this.children){if(!x.enabled){x.resolveDimensions(0,0,0,0);continue}this.enabledChildCount++;let[M,U]=x.dimensions;this.vertical?x.resolveDimensions(l,t,0,1/0):x.resolveDimensions(0,1/0,l,n);let[G,Z]=x.dimensions;s+=x.flex,o=Math.max(this.vertical?G:Z,o),(G!==M||Z!==U)&&(this.backgroundDirty=!0)}let c=this.vertical?e:r;o<c&&(o=c);let m=this.multiContainerSpacing,p=Math.max(this.enabledChildCount-1,0)*m;for(let x of this.children)!x.enabled||(p+=this.vertical?x.dimensions[1]:x.dimensions[0]);let b=d-p;if(b==1/0||b<=0){let x=this.width,M=this.height;this.vertical?(this.width=o,this.height=Math.min(p,n)):(this.width=Math.min(p,t),this.height=o),(this.width!==x||this.height!==M)&&(this.backgroundDirty=!0),this.unusedSpace=0;let U=d;for(let G of this.children){if(!G.enabled)continue;let[Z,De]=G.dimensions;if(this.vertical){let Re=Math.min(U,De);G.resolveDimensions(l,t,Re,Re)}else{let Re=Math.min(U,Z);G.resolveDimensions(Re,Re,l,n)}let[ce,Vt]=G.dimensions;(ce!==Z||Vt!==De)&&(this.backgroundDirty=!0);let Ut=this.vertical?De:Z;U=Math.max(0,U-Ut-m)}return}let v=0,k=0;s>0&&(k=b/s);for(let x of this.children){if(!x.enabled)continue;v!==0&&(v+=m);let M=k*x.flex,[U,G]=x.dimensions;if(this.vertical){let ce=M+G;x.resolveDimensions(l,t,ce,ce)}else{let ce=M+U;x.resolveDimensions(ce,ce,l,n)}let[Z,De]=x.dimensions;v+=this.vertical?De:Z,(Z!==U||De!==G)&&(this.backgroundDirty=!0)}let _=this.width,S=this.height,w;this.vertical?(w=n,this.width=o,this.height=w):(w=t,this.width=w,this.height=o),(this.width!==_||this.height!==S)&&(this.backgroundDirty=!0),this.unusedSpace=Math.max(w-v,0)}afterPositionResolved(){let e=this.multiContainerAlignment,t=e.main==="around",r=e.main==="between"||t,n=r?0:e.main,s=e.cross==="stretch"?0:e.cross,o=this.enabledChildCount-1+(t?2:0),l;o<=0?l=0:l=this.unusedSpace/o;let d=this.multiContainerSpacing;r&&(d+=l);let u=(this.vertical?this.y:this.x)+n*this.unusedSpace;t&&(u+=l);for(let c of this.children){if(!c.enabled)continue;let[m,p]=c.position,[b,v]=c.dimensions;this.vertical?(c.resolvePosition(this.x+s*(this.width-b),u),u+=v+d):(c.resolvePosition(u,this.y+s*(this.height-v)),u+=b+d);let[k,_]=c.position;(k!==m||_!==p)&&(this.backgroundDirty=!0)}}handlePainting(e,t){let r=[];for(let n of this.children)n.paint(e,t),n.enabled&&(this.backgroundDirty||t)&&r.push(this.roundRect(...n.position,...n.dimensions,!0));if(this.backgroundDirty||t){this.clearStart(e),e.rect(...this.roundRect(this.x,this.y,this.width,this.height,!0));for(let n of r)e.rect(...n);this.clearEnd(e,"evenodd")}this.backgroundDirty=!1}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(){super.forceDirty(),this.backgroundDirty=!0}};a(ee,"MultiContainer");var te=class extends fe{constructor(i,e,t,r){super([i],e,t,r)}get child(){return this._children[0]}};a(te,"SingleParent");var ie=class extends te{constructor(e,t,r){super(e,!1,t,r);this.backgroundDirty=!0}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}handleEvent(e,t){return this.child.dispatchEvent(e,t)}handlePreLayoutUpdate(e){let t=this.child;t.preLayoutUpdate(e),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(e){let t=this.child;t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0),this.backgroundDirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.containerPadding,o=s.left+s.right,l=s.top+s.bottom,d=t-o,u=n-l;d<0&&(d=0),u<0&&(u=0);let c=this.containerAlignment,m=0;c.horizontal==="stretch"&&(d!==1/0?m=d:m=Math.max(e-o,0));let p=0;c.vertical==="stretch"&&(u!==1/0?p=u:p=Math.max(r-l,0));let[b,v]=this.child.dimensions;this.child.resolveDimensions(m,d,p,u);let[k,_]=this.child.dimensions,[S,w]=[this.width,this.height];this.width=Math.max(e,k+o),this.height=Math.max(r,_+l),(this.width!==S||this.height!==w||k!==b||_!==v)&&(this.backgroundDirty=!0)}afterPositionResolved(){let e=this.containerPadding,t=this.containerAlignment,[r,n]=this.child.dimensions,s=r+e.left+e.right,o=n+e.top+e.bottom,l=this.x+e.left;if(t.horizontal!=="stretch"){let m=this.width-s;m>0&&(l+=m*t.horizontal)}let d=this.y+e.top;if(t.vertical!=="stretch"){let m=this.height-o;m>0&&(d+=m*t.vertical)}let[u,c]=this.child.position;this.child.resolvePosition(l,d),(u!==l||c!==d)&&(this.backgroundDirty=!0)}handleBaseContainerPainting(e,t,r=null){(this.backgroundDirty||t)&&(this.clearStart(e,r),e.rect(...this.roundRect(this.x,this.y,this.width,this.height,!0)),e.rect(...this.roundRect(...this.child.position,...this.child.dimensions,!0)),this.clearEnd(e,"evenodd"),this.backgroundDirty=!1),this.child.paint(e,t)}handlePainting(e,t){this.handleBaseContainerPainting(e,t)}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(){super.forceDirty(),this.backgroundDirty=!0}};a(ie,"BaseContainer");var H=(t=>(t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard",t[t.Tab=2]="Tab",t))(H||{});var A=class extends me{constructor(e,t,r,n,s){super(t,r,n,s,1,!0);this.key=e}};a(A,"KeyEvent");var W=class extends A{cloneWithTarget(i){return new W(this.key,this.shift,this.ctrl,this.alt,i)}};a(W,"KeyPress");var F=class extends ${constructor(i=null){super(i,0,!0)}cloneWithTarget(i){return new F(i)}};a(F,"Leave");var L=class extends D{constructor(e,t){super(e,t);this.subscribers=new Set}get fallbackTheme(){return super.fallbackTheme}set fallbackTheme(e){super.fallbackTheme=e}onThemeUpdated(e=null){for(let t of this.subscribers)t(e)}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}};a(L,"Theme");function nt(h,i=!0){return Math.pow(2,(i?Math.ceil:Math.floor)(Math.log2(h)))}a(nt,"roundToPower2");function st(h){return(h&h-1)===0}a(st,"isPower2");var We=class{constructor(i=64,e=64){this.constraints=[0,1/0,0,1/0];this.maxCanvasWidth=1/0;this.maxCanvasHeight=1/0;this._dirty=!0;this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=e;let t=this.canvas.getContext("2d",{alpha:!0});if(t===null)throw new Error("Failed to get canvas context");this.context=t}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}resolveChildsLayout(i){if(!i.layoutDirty&&!this._dirty)return!1;this._dirty=!1;let[e,t]=i.dimensions,[r,n,s,o]=this.constraints;i.resolveDimensionsAsTop(r,n,s,o),i.resolvePosition(0,0);let[l,d]=i.dimensions;if(l!==e||d!==t){let u=Math.min(Math.max(nt(l),this.canvas.width),this.maxCanvasWidth),c=Math.min(Math.max(nt(d),this.canvas.height),this.maxCanvasHeight);if(u===0||c===0?We.dimensionlessWarned||(We.dimensionlessWarned=!0,console.warn("Canvas has 0 width or height. Are you using an empty Root?")):(!st(u)||!st(c))&&(We.powerOf2Warned||(We.powerOf2Warned=!0,console.warn("Canvas has a width or height that is not a power of 2, which may create mipmapping issues. Make sure to use power of 2 starting and maximum canvas dimensions."))),u!==this.canvas.width||c!==this.canvas.height){let m=null;if(e!==0&&t!==0){m=document.createElement("canvas"),m.width=e,m.height=t;let p=m.getContext("2d");if(p===null)throw new Error("Failed to get context of temporary canvas for resizing original canvas");p.globalCompositeOperation="copy",p.drawImage(this.canvas,0,0,e,t,0,0,e,t)}this.canvas.width=u,this.canvas.height=c,m!==null&&(this.context.globalCompositeOperation="copy",this.context.drawImage(m,0,0,m.width,m.height,0,0,Math.min(m.width,this.maxCanvasWidth),Math.min(m.height,this.maxCanvasHeight)),this.context.globalCompositeOperation="source-over")}return!0}else return!1}getAppliedScale(i){let[e,t]=i.dimensions,r=1,n=1;return e>this.maxCanvasWidth&&(r=this.maxCanvasWidth/e),t>this.maxCanvasHeight&&(n=this.maxCanvasHeight/t),[r,n]}paintToCanvas(i,e){let t=i.dirty,[r,n]=this.getAppliedScale(i),s=r!==1||n!==1;return s&&(this.context.save(),this.context.scale(r,n)),i.paint(this.context,e),s&&this.context.restore(),t}},B=We;a(B,"Viewport"),B.dimensionlessWarned=!1,B.powerOf2Warned=!1,y([Ze()],B.prototype,"constraints",2),y([pe],B.prototype,"maxCanvasWidth",2),y([pe],B.prototype,"maxCanvasHeight",2);var Je=class{constructor(i,e=null,t=new L){this.drivers=new Set;this._enabled=!0;this.pointerStyle="default";this._currentPointerStyle="default";this._foci=new Map([[1,null],[0,null],[2,null]]);this._fociCapturers=new Map([[1,null],[0,null],[2,null]]);this.textInputHandler=null;this._mobileTextInUse=!1;this._resolution=1;this.viewport=new B,this.child=i,this.pointerStyleHandler=e,this.child.inheritedTheme=t}get constraints(){return this.viewport.constraints}set constraints(i){this.viewport.constraints=i}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(i){if(this._enabled!==i)if(this._enabled=i,i)for(let t of this.drivers)t.onEnable(this);else{for(let t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(let t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){return this.enabled?this.viewport.resolveChildsLayout(this.child):!1}paint(){return this.enabled?this.viewport.paintToCanvas(this.child,!1):!1}dispatchEvent(i){if(!this.enabled)return!1;if(i.focusType!==null&&i.target===null){let r=this._foci.get(i.focusType);if(typeof r=="undefined"&&(r=null),i.needsFocus&&r===null)return i instanceof W&&i.key==="Tab"&&this.dispatchEvent(new E(this.getFocus(2),i.shift)),!1;i=i.cloneWithTarget(r)}this.pointerStyle="default";let e=this.child.dispatchEvent(i,this);if(e===null&&(i.focusType!==null&&(this.clearFocus(i.focusType),i instanceof W&&i.key==="Tab"&&this.dispatchEvent(new E(this.getFocus(2),i.shift))),i instanceof E&&i.relativeTo!==null&&(i=new E(null,i.reversed),e=this.child.dispatchEvent(i,this))),i instanceof E&&(i.reachedRelative&&e===null&&(e=this.child.dispatchEvent(i,this)),e&&(!i.reachedRelative&&!Je.badTabCaptureWarned&&(Je.badTabCaptureWarned=!0,console.warn(`TabSelect event captured by widget (${e.constructor.name}), but reachedRelative was false; a widget type is probably capturing events by default`),console.groupCollapsed("Stack trace"),console.trace(),console.groupEnd()),this.requestFocus(2,e))),i.focusType===null)return e!==null;let t=this.getFocusCapturer(i.focusType);if(t===e)return e!==null;i.focusType===0&&t!==null&&this.child.dispatchEvent(new F(t),this),this._fociCapturers.set(i.focusType,e);for(let r of this.drivers)r.onFocusCapturerChanged(this,i.focusType,t,e);return e!==null}preLayoutUpdate(){if(!!this.enabled){for(let i of this.drivers)i.update(this);this.child.preLayoutUpdate(this)}}postLayoutUpdate(){!this.enabled||(this.child.postLayoutUpdate(this),this.updatePointerStyle())}updatePointerStyle(i=null){i!==null&&(this.pointerStyle=i),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,this.pointerStyleHandler!==null&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(i,e){if(e!==null){let t=this._foci.get(i);if(e!==t){this.clearFocus(i),this._foci.set(i,e),e.onFocusGrabbed(i,this);for(let n of this.drivers)n.onFocusChanged(this,i,e)}let r=null;if(i===1&&(r=2),i===2&&(r=1),r!==null&&e!==this._foci.get(r)){this.clearFocus(r),this._foci.set(r,e),e.onFocusGrabbed(r,this);for(let n of this.drivers)n.onFocusChanged(this,r,e)}}}dropFocus(i,e){let t=this._foci.get(i);e===t&&this.clearFocus(i)}clearFocus(i){let e=this._foci.get(i);if(e){e.onFocusDropped(i,this),this._foci.set(i,null);for(let t of this.drivers)t.onFocusChanged(this,i,null)}}getFocus(i){var e;return(e=this._foci.get(i))!=null?e:null}getFocusCapturer(i){var e;return(e=this._fociCapturers.get(i))!=null?e:null}registerDriver(i){this.drivers.has(i)||(this.drivers.add(i),this._enabled&&i.onEnable&&i.onEnable(this))}unregisterDriver(i){!this.drivers.delete(i)||this._enabled&&i.onDisable&&i.onDisable(this)}clearDrivers(){for(let i of this.drivers)this.unregisterDriver(i)}get hasMobileTextInput(){return this.textInputHandler!==null&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(i=""){return Pt(this,null,function*(){if(this.textInputHandler!==null&&!this._mobileTextInUse){this._mobileTextInUse=!0;let e=yield this.textInputHandler(i);return this._mobileTextInUse=!1,e}return null})}get resolution(){return this._resolution}set resolution(i){this._resolution!==i&&(this._resolution=i,this.child.forceThemeUpdate())}get maxCanvasWidth(){return this.viewport.maxCanvasWidth}set maxCanvasWidth(i){this.viewport.maxCanvasWidth=i}get maxCanvasHeight(){return this.viewport.maxCanvasHeight}set maxCanvasHeight(i){this.viewport.maxCanvasHeight=i}get effectiveScale(){return this.viewport.getAppliedScale(this.child)}},P=Je;a(P,"Root"),P.badTabCaptureWarned=!1;var I=new Map;function ge(h){let i=I.get(h);return i===void 0?(console.warn(`Unknown debug feature "${h}"; defaulting to not enabled`),!1):i[0]}a(ge,"isDebugFeatureEnabled");function Yt(h,i){let e=I.get(h);if(e===void 0){console.warn(`Unknown debug feature "${h}"; ignored`);return}let[t,r]=e;i===void 0&&(i=!t),t!==i&&(e[0]=i,console.info(`[canvas-ui] ${i?"En":"Dis"}abled "${h}" debug feature`))}a(Yt,"toggleDebugFeature");function Xt(){for(let[h,i]of I)console.info(`[canvas-ui] "${h}" (${i[0]?"en":"dis"}abled): ${i[1]}`)}a(Xt,"listDebugFeatures");function et(h,i){let e=`${h.name}.${i}`,t=`watchflag.${e}`;if(I.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=`watchflag.${e}.strace`;if(I.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=new WeakMap;Object.defineProperty(h.prototype,i,{get(){return n.get(this)},set(s){if(ge(t)&&!n.get(this)&&s){let l=`[canvas-ui ${t}] ${this.constructor.name}.${i} set to true`;ge(r)?(console.groupCollapsed(l),console.trace(),console.groupEnd()):console.debug(l)}n.set(this,s)}}),I.set(t,[!1,`Show when ${e} is set to true`]),I.set(r,[!1,`Print stack trace when ${t} shows that a flag has been set`])}a(et,"injectWatchflagFeature");function tt(h,i,e=null){let t=`${h.name}.${i}`,r=`trace.${t}`;if(I.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=[],s=new Map,o=h.prototype[i],l=0;function d(){l===0&&(ge(r)&&console.debug(`[canvas-ui ${r}] Trace:
${n.join(`
`)}`),l=0,n.length=0,s.clear())}a(d,"logMsgStack"),h.prototype[i]=function(...u){l++;let c=s.get(this);if(c===void 0){c=n.length,s.set(this,c);let p;l>1?p="  ".repeat(l-2)+"> ":p="",n.push(`${p}${this.constructor.name}`)}else n[c]+=", recall";e!==null&&(n[c]+=e.apply(this,u));let m=new Date().getTime();try{let p=o.apply(this,u);return n[c]+=` <${new Date().getTime()-m} ms>`,p}catch(p){throw n[c]+=" <exception thrown>",p}finally{l--,d()}},I.set(r,[!1,`Trace ${t} method calls`])}a(tt,"injectTraceFeature");function N(h,i){let e=`${h.name}.${i}`,t=`randomfill.${e}`;if(I.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=Object.getOwnPropertyDescriptor(h.prototype,i);Object.defineProperty(h.prototype,i,{get(){if(ge(t))return"#"+Math.floor(Math.random()*16777215).toString(16);if((r==null?void 0:r.get)!==void 0)return r.get.apply(this)},set(n){(r==null?void 0:r.set)!==void 0&&r.set.apply(this,[n])}}),I.set(t,[!1,`(EPILEPSY WARNING) Override the ${e} theme property with a new random colour every time the theme property's value is fetched. Useful for visualising widget painting`])}a(N,"injectRandomFillFeature");function g(h,i){let e=`${h.name}.${i}`,t=`stacktrace.${e}`;if(I.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=h.prototype[i];h.prototype[i]=function(...n){return ge(t)&&(console.groupCollapsed(`${h.name}.${i} called`),console.trace(),console.groupEnd()),r.apply(this,n)},I.set(t,[!1,`Print stack trace when ${e} is called`])}a(g,"injectStackTraceFeature");var Ht=!1;function xr(){if(Ht){console.warn("[canvas-ui] Already injected debug code; ignored");return}Ht=!0,tt(f,"paint",(t,r)=>r?" (forced)":""),tt(f,"resolveDimensions",(t,r,n,s)=>` (${t}, ${r}, ${n}, ${s})`),tt(f,"resolvePosition",(t,r)=>` (${t}, ${r})`),tt(f,"dispatchEvent",(t,r)=>` (${t.constructor.name})`),g(P,"resolveLayout"),g(P,"paint"),g(P,"dispatchEvent"),g(P,"preLayoutUpdate"),g(P,"postLayoutUpdate"),g(P,"updatePointerStyle"),g(P,"requestFocus"),g(P,"dropFocus"),g(P,"clearFocus"),g(P,"getFocus"),g(P,"getFocusCapturer"),g(P,"registerDriver"),g(P,"unregisterDriver"),g(P,"clearDrivers"),g(P,"getTextInput"),g(f,"onThemeUpdated"),g(f,"onFocusDropped"),g(f,"handleEvent"),g(f,"dispatchEvent"),g(f,"handlePreLayoutUpdate"),g(f,"preLayoutUpdate"),g(f,"handleResolveDimensions"),g(f,"resolveDimensions"),g(f,"resolveDimensionsAsTop"),g(f,"afterPositionResolved"),g(f,"resolvePosition"),g(f,"handlePostLayoutUpdate"),g(f,"postLayoutUpdate"),g(f,"clear"),g(f,"clearStart"),g(f,"clearEnd"),g(f,"roundRect"),g(f,"handlePainting"),g(f,"paint"),g(f,"dryPaint"),g(f,"forceThemeUpdate"),g(f,"forceDirty"),g(f,"scaleFont"),et(f,"_dirty"),et(f,"_layoutDirty"),et(ie,"backgroundDirty"),et(ee,"backgroundDirty"),N(D,"canvasFill"),N(D,"primaryFill"),N(D,"accentFill"),N(D,"backgroundFill"),N(D,"backgroundGlowFill"),N(D,"bodyTextFill"),N(D,"inputBackgroundFill"),N(D,"inputSelectBackgroundFill"),N(D,"inputTextFill"),N(D,"inputTextFillDisabled"),N(D,"inputTextFillInvalid"),I.set("textrendergroups",[!1,"Draw text render groups in a TextHelper with alternating background colours (green and red). Width overriding groups have a blue background and zero-width groups have a black background. Throws an exception on negative width groups"]);let h=new Map,i=C.prototype.paint;C.prototype.paint=function(t,r,n,s){h.set(this,!1),i.apply(this,[t,r,n,s])};let e=C.prototype.paintGroup;C.prototype.paintGroup=function(t,r,n,s,o){if(ge("textrendergroups")){let l=t.fillStyle,d=this.actualLineHeight,u=this.fullLineHeight;if(!r[3]&&r[2]>n){let c=h.get(this);t.fillStyle=c?"rgba(255, 0, 0, 0.5)":"rgba(0, 255, 0, 0.5)",t.fillRect(s,o-d,r[2]-n,u),h.set(this,!c),t.fillStyle=l}else{let c=r[2]-n;if(t.fillStyle=c>0?"rgba(0, 0, 255, 0.5)":"rgba(0, 0, 0, 0.5)",c==0)c=4;else if(c<0)throw new Error("Unexpected group with negative width");t.fillRect(s,o-d,c,u)}}e.apply(this,[t,r,n,s,o])},window.canvasDebug={enabled:ge,toggle:Yt,list:Xt},console.info("[canvas-ui] Injected debug code; the library will be slower"),console.info("[canvas-ui] Check if a debug feature is enabled in the console with canvasDebug.enabled(debugFeature: string)"),console.info("[canvas-ui] Enable a debug feature in the console with canvasDebug.toggle(debugFeature: string, enabled?: boolean)"),console.info("[canvas-ui] List debug features in the console with canvasDebug.list()")}a(xr,"injectDebugCode");function kr(h){return new Promise((i,e)=>{function t(){document.body.removeChild(l),document.body.removeChild(o)}a(t,"closePopup");function r(){t(),i(h)}a(r,"cancelHandler");function n(){t(),i(u.value)}a(n,"okHandler");function s(b){b.key=="Enter"&&(b.preventDefault(),n())}a(s,"enterChecker");let o=document.createElement("div");o.id="textInputHandlerOverlay";let l=document.createElement("div");l.id="textInputHandler";let d=document.createElement("p");d.textContent="Change text:";let u=document.createElement("input");u.addEventListener("keyup",s),u.value=h;let c=document.createElement("div"),m=document.createElement("button");m.addEventListener("click",r),m.textContent="Cancel";let p=document.createElement("button");p.addEventListener("click",n),p.textContent="OK",c.appendChild(m),c.appendChild(p),l.appendChild(d),l.appendChild(u),l.appendChild(c),document.body.appendChild(o),document.body.appendChild(l),u.focus({preventScroll:!1})})}a(kr,"DefaultTextInputHandler");var re=class extends ${constructor(e,t=null){super(t,1,!1);this.text=e}cloneWithTarget(e){return new re(this.text,e)}};a(re,"TextPasteEvent");var Me=class extends P{constructor(e,t=new L){super(e,null,t);this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,[this.domElem.width,this.domElem.height]=this.dimensions;let r=this.domElem.getContext("2d",{alpha:!0});if(r===null)throw new Error("Failed to get DOM canvas context");this.domCanvasContext=r,this.pointerStyleHandler=n=>{this.domElem.style.cursor=n},this.domElem.addEventListener("paste",n=>{n.preventDefault(),n.clipboardData!==null&&this.dispatchEvent(new re(n.clipboardData.getData("text")))}),this.domElem.contentEditable="true",this.domElem.style.outline="0px solid transparent",this.domElem.style.caretColor="transparent",this.domElem.style.cursor="default"}update(){if(this.enabled)this.domElem.style.removeProperty("display");else{this.domElem.style.display="none";return}this.preLayoutUpdate(),this.resolveLayout()&&([this.domElem.width,this.domElem.height]=this.dimensions,this.autoScale()),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))}get resolution(){return super.resolution}set resolution(e){super.resolution=e,this.autoScale()}autoScale(){let[e,t]=this.effectiveScale;this.domElem.style.width=(this.domElem.width/this.resolution/e).toString()+"px",this.domElem.style.height=(this.domElem.height/this.resolution/t).toString()+"px"}};a(Me,"DOMRoot");var be=class extends te{constructor(i,e){super(i,!1,!0,e)}handleEvent(i,e){return this.child.dispatchEvent(i,e)}handlePreLayoutUpdate(i){let e=this.child;e.preLayoutUpdate(i),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(i){let e=this.child;e.postLayoutUpdate(i),e.dirty&&(this._dirty=!0)}handleResolveDimensions(i,e,t,r){let n=this.child;n.resolveDimensions(i,e,t,r),[this.width,this.height]=n.dimensions}afterPositionResolved(){this.child.resolvePosition(this.x,this.y)}handlePainting(i,e){this.child.paint(i,e)}};a(be,"PassthroughWidget");var he=class extends be{constructor(e,t=[0,1/0,0,1/0],r){super(e,r);this._constraints=[0,1/0,0,1/0];this.constraints=[0,1/0,0,1/0];this._constraints=[...t]}handleResolveDimensions(e,t,r,n){var c,m;let s=(m=(c=this.root)==null?void 0:c.resolution)!=null?m:1,o=Math.min(Math.max(this._constraints[0]*s,e),t),l=Math.min(Math.max(this._constraints[2]*s,r),n),d=Math.min(Math.max(this._constraints[1]*s,e),t),u=Math.min(Math.max(this._constraints[3]*s,r),n);o>d&&(o=d),l>u&&(l=u),super.handleResolveDimensions(o,d,l,u)}};a(he,"ArtificialConstraint"),y([St()],he.prototype,"constraints",2);var ne=(t=>(t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold",t))(ne||{});var Ae=class{constructor(i){this.clickHelpers=i}get lastClickState(){let i=0;for(let e of this.clickHelpers)e.lastClickState>i&&(i=e.lastClickState);return i}get clickState(){let i=0;for(let e of this.clickHelpers)e.clickState>i&&(i=e.clickState);return i}get clickStateChanged(){for(let i of this.clickHelpers)if(i.clickStateChanged)return!0;return!1}get wasClick(){for(let i of this.clickHelpers)if(i.wasClick&&i.clickStateChanged)return!0;return!1}};a(Ae,"CompoundClickHelper");var ye=class{constructor(i){this.lastClickState=0;this.clickState=0;this.clickStateChanged=!1;this.wasClick=!1;this.widget=i}setClickState(i,e){this.clickState!==i?(this.lastClickState=this.clickState,this.clickState=i,this.wasClick=e&&this.lastClickState===2,this.clickStateChanged=!0):this.clickStateChanged=!1}};a(ye,"GenericClickHelper");var R=class extends T{constructor(e,t,r,n,s,o,l,d,u=null){super(e,t,o,l,d,u,0);this.deltaX=r,this.deltaY=n,this.fromDrag=s}correctOffset(e,t){return new R(this.x-e,this.y-t,this.deltaX,this.deltaY,this.fromDrag,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(e){return new R(this.x,this.y,this.deltaX,this.deltaY,this.fromDrag,this.shift,this.ctrl,this.alt,e)}};a(R,"PointerWheel");var se=class extends A{cloneWithTarget(i){return new se(this.key,this.shift,this.ctrl,this.alt,i)}};a(se,"KeyRelease");var ve=class extends T{constructor(e,t,r,n,s,o,l=null,d=null){super(e,t,n,s,o,l,d);this.button=r}get isLeft(){return this.button===0}get isPrimary(){return this.isLeft}get isRight(){return this.button===1}get isSecondary(){return this.isRight}get isMiddle(){return this.button===2}get isTertiary(){return this.isMiddle}};a(ve,"PointerButtonEvent");var O=class extends ve{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o,0)}correctOffset(i,e){return new O(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new O(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(O,"PointerRelease");var V=class extends ve{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o)}correctOffset(i,e){return new V(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new V(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(V,"PointerPress");var j=class extends ye{constructor(){super(...arguments);this.pointerPos=null;this.startingPointerPos=null;this.pointerButton=0}getNormalInRect(e,t,r,n,s,o){return[(e-r)/(n-r),(t-s)/(o-s)]}isPointInRect(e,t,r,n,s,o){return e>=r&&e<n&&t>=s&&t<o}isNormalInRect(e,t){return e>=0&&e<1&&t>=0&&t<1}handleClickEvent(e,t,r){if(e instanceof F)return t.dropFocus(0,this.widget),this.pointerPos=null,this.setClickState(0,!1);if(e instanceof T){this.pointerPos=this.getNormalInRect(e.x,e.y,...r);let n=this.isNormalInRect(...this.pointerPos);if(n)t.pointerStyle="pointer";else if(e.target===null)return t.dropFocus(0,this.widget),this.setClickState(0,!1);return e instanceof V&&e.button===this.pointerButton?(this.startingPointerPos=this.pointerPos,t.requestFocus(0,this.widget),this.setClickState(2,n)):e instanceof O&&e.button===this.pointerButton?(t.dropFocus(0,this.widget),n?this.setClickState(1,n):this.setClickState(0,n)):e.target===null?this.setClickState(1,n):this.setClickState(2,n)}else this.clickStateChanged=!1}};a(j,"ClickHelper");var xe=class extends Ae{constructor(e){let t=new j(e),r=new ye(e);super([t,r]);this.pointerClickHelper=t,this.keyboardClickHelper=r}onFocusGrabbed(e){return e===1?(this.keyboardClickHelper.setClickState(1,!0),!0):!1}onFocusDropped(e){return e===1?(this.keyboardClickHelper.setClickState(0,!1),!0):!1}handleEvent(e,t,r,n){if(e instanceof R)return[!1,!1];if(e instanceof A){if(e instanceof W&&e.key==="Tab")return[!1,!1];if(e.key!=="Enter")return[!1,!0]}else if(!(e instanceof T||e instanceof F))return[!1,!1];return r?(e instanceof W?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(2,!0)):e instanceof se?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(1,!0)):(this.keyboardClickHelper.clickStateChanged=!1,this.pointerClickHelper.handleClickEvent(e,t,n)),[this.clickStateChanged&&this.wasClick,!0]):(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.clickStateChanged=!1,[!1,!0])}};a(xe,"ButtonClickHelper");var Te=class extends ie{constructor(e,t=null,r){super(e,!1,r);this.clickHelper=new xe(this),this.callback=t,this.tabFocusable=!0}click(){if(this.callback!==null)try{this.callback()}catch(e){console.error("Exception in Icon callback",e)}}onFocusGrabbed(e,t){this.clickHelper.onFocusGrabbed(e)}onFocusDropped(e,t){this.clickHelper.onFocusDropped(e)}handleEvent(e,t){let[r,n]=this.clickHelper.handleEvent(e,t,this.callback!==null,[this.x,this.x+this.width,this.y,this.y+this.height]);return r&&this.click(),n?this:null}};a(Te,"Button");var ke=class extends Te{constructor(e,t=null,r){super(e,t,r);this.backgroundProperty="backgroundFill";this.forced=!1;this.childTheme=new L({canvasFill:this.getBackgroundFill()}),this.child.inheritedTheme=this.childTheme}updateBackground(){let e=this.backgroundProperty;if(this.forced)this.backgroundProperty="primaryFill";else switch(this.clickHelper.clickState){case 2:this.backgroundProperty="accentFill";break;case 1:this.backgroundProperty="backgroundGlowFill";break;default:this.backgroundProperty="backgroundFill";break}e!==this.backgroundProperty&&(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill())}getBackgroundFill(){switch(this.backgroundProperty){case"primaryFill":return this.primaryFill;case"accentFill":return this.accentFill;case"backgroundGlowFill":return this.backgroundGlowFill;case"backgroundFill":return this.backgroundFill;default:throw new Error(`Unknown theme property: ${this.backgroundProperty}`)}}set inheritedTheme(e){e!==this.fallbackTheme&&(this.fallbackTheme=e,this.childTheme.fallbackTheme=e)}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){e===null?(this._layoutDirty=!0,this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e===this.backgroundProperty?(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}onFocusGrabbed(e,t){super.onFocusGrabbed(e,t),e===1&&this.updateBackground()}onFocusDropped(e,t){super.onFocusDropped(e,t),e===1&&this.updateBackground()}handleEvent(e,t){let r=super.handleEvent(e,t);return this.clickHelper.clickStateChanged&&this.updateBackground(),r}handlePainting(e,t){this.handleBaseContainerPainting(e,t,this.getBackgroundFill())}};a(ke,"FilledButton"),y([qe(ke.prototype.updateBackground)],ke.prototype,"forced",2);var de=class extends f{constructor(e,t){super(!0,!1,t);this.textGetter=null;this.wrapText=!0;this.textHelper=new C,this.textHelper.wrapMode=1,this.source=e}set source(e){e instanceof Function?this.textGetter=e:(this.textGetter=null,this.textHelper.text=e)}get source(){return this.textGetter!==null?this.textGetter:this.textHelper.text}get text(){return this.textHelper.text}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="labelMinWidth"||e==="labelMinAscent"||e==="labelMinDescent"?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFill"&&(this._dirty=!0)}handlePreLayoutUpdate(e){this.textGetter!==null&&(this.textHelper.text=this.textGetter()),this.textHelper.font=this.bodyTextFont,this.textHelper.lineHeight=this.bodyTextHeight,this.textHelper.lineSpacing=this.bodyTextSpacing,this.textHelper.alignMode=this.bodyTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,r,n){this.textHelper.maxWidth=this.wrapText?t:1/0,this.textHelper.dirty&&(this._dirty=!0),this.width=Math.max(Math.min(this.textHelper.width,t),e),this.height=Math.max(Math.min(this.textHelper.height,n),r)}handlePainting(e,t){this.wrapText||(e.save(),e.beginPath(),e.rect(this.x,this.y,this.width,this.height),e.clip()),this.textHelper.paint(e,this.bodyTextFill,this.x,this.y),this.wrapText||e.restore()}};a(de,"Label"),y([z],de.prototype,"wrapText",2);var _e=class extends ke{constructor(i,e=null,t){let r=Q({},t);r.containerAlignment={horizontal:.5,vertical:"stretch"};let n=new de(i,t);n.wrapText=!1,super(n,e,r)}};a(_e,"TextButton");var Ie=class extends he{constructor(i,e=null,t,r=0,n=24,s=24,o){e===null&&(e=i);function l(){return t.shift?e===null?i:e:i}a(l,"getGlyph"),super(new _e(l,()=>t.callback(l()),o),[n,1/0,s,1/0],o),this.flex=r}};a(Ie,"GlyphVirtualKey");var Pe=class extends ee{constructor(i){super(!1,i)}};a(Pe,"Row");var Ve=class extends Pe{constructor(i,e,t=0,r=24,n=24,s){super(s);for(let o of i)if(typeof o=="function"){let l=o;this.add(l(e,s))}else if(typeof o[0]=="string"&&typeof o[1]=="string"){let l=o[0],d=o[1];for(let u=0;u<l.length;u++){let c=null;u<d.length&&(c=d[u]),this.add(new Ie(l[u],c,e,t,r,n,s))}}else throw new Error(`Unknown virtual key row template format for entry: ${o}`)}};a(Ve,"VirtualKeyRow");var Y=class extends he{constructor(i,e,t=0,r=24,n=24,s){super(new _e(i,e,s),[r,1/0,n,1/0],s),this.flex=t}};a(Y,"VirtualKey");var X=class extends Y{constructor(i,e,t,r=0,n=24,s=24,o){super(i,()=>t.callback(e),r,n,s,o)}};a(X,"BasicVirtualKey");var Ue=class extends X{constructor(i,e=0,t=60,r=24,n){super("Backspace","Backspace",i,e,t,r,n)}};a(Ue,"BackspaceKey");var Oe=class extends X{constructor(i,e=0,t=24,r=24,n){super("Esc","Escape",i,e,t,r,n)}};a(Oe,"EscapeKey");var Ke=class extends X{constructor(i,e=0,t=72,r=24,n){super("Enter","Enter",i,e,t,r,n)}};a(Ke,"EnterKey");var Be=class extends Y{constructor(i,e=0,t=84,r=24,n){super("Shift",()=>{i.shift=!i.shift,this.child.forced=i.shift,i.callback("Shift")},e,t,r,n),this.child.forced=i.shift}};a(Be,"ShiftKey");var Ge=class extends X{constructor(i,e=1,t=84,r=24,n){super("Space"," ",i,e,t,r,n)}};a(Ge,"SpaceKey");var $e=class extends ee{constructor(i){super(!0,i)}};a($e,"Column");function Qt(h,i){return new Ke(h,void 0,void 0,void 0,i)}a(Qt,"EnterKeyTemplate");function zt(h,i){return new Be(h,void 0,void 0,void 0,i)}a(zt,"ShiftKeyTemplate");function jt(h,i){return new Ue(h,void 0,void 0,void 0,i)}a(jt,"BackspaceKeyTemplate");function qt(h,i){return new Ge(h,void 0,void 0,void 0,i)}a(qt,"SpaceKeyTemplate");function Zt(h,i){return new Oe(h,void 0,void 0,void 0,i)}a(Zt,"EscapeKeyTemplate");var Ne=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],Qt],[zt,["zxcvbnm,./","ZXCVBNM<>?"]],[jt,qt,Zt]],we=class extends $e{constructor(i,e=Ne,t=0,r=24,n=24,s){let o=Q({},s);o.multiContainerAlignment={main:"between",cross:"stretch"},super(o);let l={callback:d=>{i.keyPress(d,l.shift,l.ctrl,l.alt)},shift:!1,ctrl:!1,alt:!1};for(let d of e)this.add(new Ve(d,l,t,r,n,o))}};a(we,"VirtualKeyboard");var oe=class extends ie{constructor(i,e){super(i,!0,e)}};a(oe,"Container");var Fe=class extends oe{constructor(i,e){let t=Q({},e);t.containerAlignment={horizontal:.5,vertical:.5},super(i,t)}};a(Fe,"Margin");var ot=class extends Me{constructor(e,t=Ne,r=new L){super(new Fe(new we(e,t)),r);this.keyboardDriver=e}update(){this.enabled=this.keyboardDriver.getFocusedRoot()!==null,super.update()}};a(ot,"DOMVirtualKeyboardRoot");var lt=class extends P{constructor(e,t=Ne,r=null,n=new L){super(new Fe(new we(e,t)),r,n);this.keyboardDriver=e}updateVisibility(){this.enabled=this.keyboardDriver.getFocusedRoot()!==null}};a(lt,"VirtualKeyboardRoot");var Ye=class{constructor(){this.eventQueues=new Map;this.keysDown=new Set;this.focus=null;this.lastActivity=null}getEventQueue(i){if(i===null)return null;let e=this.eventQueues.get(i);return typeof e=="undefined"?null:e}changeFocusedRoot(i){this.focus!==i&&(this.focus!==null&&this.focus.clearFocus(1),this.focus=i,this.keysDown.clear())}getFocusedRoot(){return this.focus}getEffectiveFocusedRoot(){return this.focus?this.focus:this.lastActivity?this.lastActivity:this.eventQueues.size>0?this.eventQueues.keys().next().value:null}clearFocus(){this.changeFocusedRoot(null)}keyDown(i,e,t,r){this.keysDown.add(i);let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new W(i,e,t,r,null))}keyUp(i,e,t,r){if(this.keysDown.delete(i)){let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new se(i,e,t,r,null))}}keyPress(i,e,t,r){let n=this.isKeyDown(i);this.keyDown(i,e,t,r),n||this.keyUp(i,e,t,r)}isKeyDown(i){return this.keysDown.has(i)}onEnable(i){this.eventQueues.has(i)||this.eventQueues.set(i,[])}onDisable(i){this.eventQueues.has(i)&&(this.eventQueues.delete(i),i===this.focus&&this.clearFocus())}update(i){let e=this.getEventQueue(i);if(e!==null){for(let t of e)i.dispatchEvent(t);e.length=0}}onFocusChanged(i,e,t){t!==null&&(this.lastActivity=i),e===1&&i!==this.focus&&t!==null&&this.changeFocusedRoot(i)}onFocusCapturerChanged(i,e,t,r){}};a(Ye,"KeyboardDriver");var Jt=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp","Tab"," "]),ei=new Set(["a","A"]),ti=new Set(["Tab"]);function Lt(h){return[h.key,h.shiftKey,h.ctrlKey,h.altKey]}a(Lt,"unpackKeyboardEvent");var at=class extends Ye{constructor(){super(...arguments);this.domElems=new Set}maybePreventDefault(e){var t,r;(Jt.has(e.key)||ei.has(e.key)&&e.ctrlKey)&&(ti.has(e.key)||((r=(t=this.getFocusedRoot())==null?void 0:t.getFocus(1))!=null?r:null)!==null)&&e.preventDefault()}bindDOMElem(e,t=!0){this.domElems.has(e)||(this.domElems.add(e),t&&(e.addEventListener("keydown",r=>{this.maybePreventDefault(r),this.keyDown(...Lt(r))}),e.addEventListener("keyup",r=>{this.maybePreventDefault(r),this.keyUp(...Lt(r))})),e.addEventListener("blur",r=>{this.shouldClearFocus(r.relatedTarget)&&this.clearFocus()}))}shouldClearFocus(e){return e===null||!this.domElems.has(e)}};a(at,"DOMKeyboardDriver");function ht(h,i){let e=i.getBoundingClientRect();return[(h.clientX-e.left)/e.width,(h.clientY-e.top)/e.height]}a(ht,"getPointerEventNormPos");var q=class extends T{constructor(i,e,t,r,n,s=null){super(i,e,t,r,n,s,0)}correctOffset(i,e){return new q(this.x-i,this.y-e,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new q(this.x,this.y,this.shift,this.ctrl,this.alt,i)}};a(q,"PointerMove");var Mt=(t=>(t[t.None=0]="None",t[t.Hovering=1]="Hovering",t[t.Pressing=2]="Pressing",t))(Mt||{});var Ce=class{constructor(){this.states=new Map;this.nextPointerID=0;this.hints=new Map;this.dragToScroll=new Map}unassignPointer(i,e){e.pointer!==null&&this.setPointerHint(e.pointer,0),e.pointer=null,e.hovering&&e.eventQueue.push(new F(i.getFocusCapturer(0))),e.hovering=!1,e.pressing=0,e.dragLast=null}registerPointer(i=!1){let e=this.nextPointerID++;return this.setPointerHint(e,0),this.dragToScroll.set(e,i),e}unregisterPointer(i){for(let[e,t]of this.states)t.pointer===i&&this.unassignPointer(e,t);this.hints.delete(i),this.dragToScroll.delete(i)}canQueueEvent(i,e,t,r){let n=t.pointer===null;n&&(t.pointer=e);let s=t.pointer===e;if(!s||n)for(let[o,l]of this.states)o!==i&&l.pointer===e&&this.unassignPointer(o,l);return!s&&(!r||t.pressing>0)?!1:(r&&t.pointer!==e&&(this.unassignPointer(i,t),t.pointer=e),!0)}denormaliseCoords(i,e,t){let[r,n]=i.dimensions;return[e*r,t*n]}movePointer(i,e,t,r,n,s,o,l){let d=this.states.get(i);if(typeof d=="undefined"||(n===null&&(n=d.pressing),!this.canQueueEvent(i,e,d,n>0)))return;d.hovering=!0;let[u,c]=this.denormaliseCoords(i,t,r);if(n!==d.pressing){let m=Math.floor(Math.log2(Math.max(n,d.pressing)));for(let p=0;p<=m;p++){let b=(d.pressing>>p&1)===1,v=(n>>p&1)===1;b!==v&&(v?d.eventQueue.push(new V(u,c,p,s,o,l)):d.eventQueue.push(new O(u,c,p,s,o,l)))}d.pressing=n}else d.eventQueue.push(new q(u,c,s,o,l));d.pressing>0?this.setPointerHint(e,2):this.setPointerHint(e,1)}leavePointer(i,e){let t=this.states.get(i);typeof t!="undefined"&&t.hovering&&t.pointer==e&&(t.hovering=!1,t.pressing=0,t.dragLast=null,t.eventQueue.push(new F(i.getFocusCapturer(0))),this.setPointerHint(e,0))}leaveAnyPointer(i){for(let e of this.states.keys())this.leavePointer(e,i)}wheelPointer(i,e,t,r,n,s,o,l,d){let u=this.states.get(i);if(typeof u=="undefined"||!this.canQueueEvent(i,e,u,!0))return;u.hovering=!0;let[c,m]=this.denormaliseCoords(i,t,r);u.eventQueue.push(new R(c,m,n,s,!1,o,l,d))}setPointerHint(i,e){return this.hints.get(i)!==e?(this.hints.set(i,e),!0):!1}getPointerHint(i){var e;return(e=this.hints.get(i))!=null?e:0}onEnable(i){this.states.set(i,{eventQueue:[],pointer:null,pressing:0,hovering:!1,dragLast:null,dragOrigin:[0,0]})}onDisable(i){i.dispatchEvent(new F);let e=this.states.get(i);typeof e!="undefined"&&e.pointer!==null&&(this.setPointerHint(e.pointer,0),e.dragLast=null),this.states.delete(i)}update(i){let e=this.states.get(i);if(typeof e=="undefined")return;let t=e.pointer===null?!1:this.dragToScroll.get(e.pointer);for(let r of e.eventQueue){if(r instanceof T&&e.dragLast!==null){let[n,s]=e.dragLast;i.dispatchEvent(new R(...e.dragOrigin,n-r.x,s-r.y,!1,!1,!1,!0)),r instanceof O?e.dragLast=null:(e.dragLast[0]=r.x,e.dragLast[1]=r.y);continue}i.dispatchEvent(r)?e.dragLast=null:t&&r instanceof V&&(e.dragLast=[r.x,r.y],e.dragOrigin[0]=r.x,e.dragOrigin[1]=r.y)}e.eventQueue.length=0}onFocusChanged(i,e,t){}onFocusCapturerChanged(i,e,t,r){}};a(Ce,"PointerDriver");function At(h){return[h.shiftKey,h.ctrlKey,h.altKey]}a(At,"unpackModifiers");var dt=class extends Ce{constructor(){super();this.domElems=new WeakMap;this.pointers=new Map;this.mousePointerID=this.registerPointer(!1)}bindDOMElem(e,t){let r=this.domElems.get(e);typeof r!="undefined"?this.removeListeners(r):(r={domElem:t,pointerListen:null,pointerleaveListen:null,wheelListen:null,contextMenuListen:null},this.domElems.set(e,r),t.style.touchAction="none"),e.enabled&&this.addListeners(e,r)}getPointerID(e){let t=this.pointers.get(e.pointerId);return typeof t=="undefined"&&(e.pointerType==="mouse"?t=this.mousePointerID:t=this.registerPointer(!0),this.pointers.set(e.pointerId,t)),t}addListeners(e,t){let r=t.domElem;t.pointerListen=n=>{this.movePointer(e,this.getPointerID(n),...ht(n,r),n.buttons,...At(n))},t.pointerleaveListen=n=>{this.leavePointer(e,this.getPointerID(n))},t.wheelListen=n=>{this.wheelPointer(e,this.mousePointerID,...ht(n,r),n.deltaX,n.deltaY,...At(n))},t.contextMenuListen=n=>{n.preventDefault()},r.addEventListener("pointermove",t.pointerListen),r.addEventListener("pointerdown",t.pointerListen),r.addEventListener("pointerup",t.pointerListen),r.addEventListener("pointerleave",t.pointerleaveListen),r.addEventListener("wheel",t.wheelListen),r.addEventListener("contextmenu",t.contextMenuListen)}removeListeners(e){e.pointerListen!==null&&(e.domElem.removeEventListener("pointermove",e.pointerListen),e.domElem.removeEventListener("pointerdown",e.pointerListen),e.domElem.removeEventListener("pointerup",e.pointerListen),e.pointerListen=null),e.pointerleaveListen!==null&&(e.domElem.removeEventListener("pointerleave",e.pointerleaveListen),e.pointerleaveListen=null),e.wheelListen!==null&&(e.domElem.removeEventListener("wheel",e.wheelListen),e.wheelListen=null),e.contextMenuListen!==null&&(e.domElem.removeEventListener("contextmenu",e.contextMenuListen),e.contextMenuListen=null)}onEnable(e){super.onEnable(e);let t=this.domElems.get(e);typeof t!="undefined"&&this.addListeners(e,t)}onDisable(e){super.onDisable(e);let t=this.domElems.get(e);typeof t!="undefined"&&this.removeListeners(t)}};a(dt,"DOMPointerDriver");var ut=class extends Ce{constructor(){super(...arguments);this.sources=new Set}handlePointerRay(e,t,r,n,s,o,l){let[d,u,c]=this.castRay(r,n);d===null?this.leaveAnyPointer(e):this.movePointer(d,e,u,c,t,s,o,l)}addSource(e){this.sources.has(e)||(e.setRayPointerDriver(this),this.sources.add(e))}setPointerHint(e,t){let r=super.setPointerHint(e,t);for(let n of this.sources)n.onPointerHintChanged(e,t);return r}};a(ut,"RayPointerDriver");var le=class{constructor(i,e=null){this._dirty=!1;this._value=i,this.callback=e}get value(){return this._value}set value(i){this.setValue(i)}get dirty(){let i=this._dirty;return this._dirty=!1,i}setValue(i,e=!0){if(this._value!==i&&(this._value=i,this._dirty=!0,e&&this.callback!==null))try{this.callback(i)}catch(t){console.error("Exception in Variable callback",t)}}};a(le,"Variable");var ct=class extends L{constructor(i=new L){super(void 0,i)}get canvasFill(){return"#"+Math.floor(Math.random()*16777215).toString(16)}set canvasFill(i){super.canvasFill=i}};a(ct,"DebugTheme");function ao(h,i,e=null){return t=>{let r=!0,n=t;for(let s of h)if([r,n]=s(n),!r)return[!1,i];if(e!==null)try{e(n)}catch(s){console.warn("Exception in CompositeValidator callback:",s)}return[!0,n]}}a(ao,"MakeCompositeValidator");function ii(h){return[!0,h]}a(ii,"DefaultTextValidator");function It(h=null){return h===null?ii:i=>(h(i),[!0,i])}a(It,"MakeDefaultTextValidatorWithCallback");var ri=/^-?(\.\d+|\d+(\.(\d+)?)?)(e\d+)?$/;function co(h){return ri.test(h)?[!0,parseFloat(h)]:[!1,NaN]}a(co,"FloatValidator");var ni=/^-?\d+$/;function po(h){return ni.test(h)?[!0,parseInt(h)]:[!1,NaN]}a(po,"IntValidator");function go(h,i){return e=>e<h?[!1,e]:e>i?[!1,e]:[!0,e]}a(go,"MakeRangeValidator");var mt=class extends Y{constructor(i,e=0,t=42,r=24,n){super("Alt",()=>{i.alt=!i.alt,this.child.forced=i.alt,i.callback("Alt")},e,t,r,n),this.child.forced=i.alt}};a(mt,"AltKey");var pt=class extends Y{constructor(i,e=0,t=42,r=24,n){super("Ctrl",()=>{i.ctrl=!i.ctrl,this.child.forced=i.ctrl,i.callback("Control")},e,t,r,n),this.child.forced=i.ctrl}};a(pt,"ControlKey");var ue=class extends f{constructor(e,t=null,r="",n){super(!1,!1,n);this.blinkStart=0;this.blinkWasOn=null;this.cursorPos=0;this.cursorOffset=[0,0];this.selectPos=0;this.selectOffset=[0,0];this.cursorOffsetDirty=!1;this._editingEnabled=!0;this.hideText=!1;this.offset=[0,0];this.wrapText=!0;this.inputFilter=null;this.dragging=!1;this.lastClick=0;this.dragStart=-1;this.successiveClickCount=0;this.typeableTab=!1;this.tabFocusable=!0,this.textHelper=new C,this.variable=new le(r,s=>{let[o,l]=e(s);o&&(this._validValue=l),o!==this._valid&&(this._valid=o,this._dirty=!0)}),[this._valid,this._validValue]=e(r),this.inputFilter=t}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0,this.cursorOffsetDirty=!0):e==="inputTextInnerPadding"||e==="inputTextFont"||e==="inputTextMinAscent"||e==="inputTextMinDescent"?(this._layoutDirty=!0,this._dirty=!0):e==="inputBackgroundFill"||e==="inputTextFill"||e==="inputTextFillInvalid"||e==="inputTextFillDisabled"||e==="cursorThickness"?this._dirty=!0:e==="inputTextAlign"&&(this.cursorOffsetDirty=!0)}get blinkOn(){if(this.blinkStart===0)return null;let e=this.blinkRate;return Math.trunc((Date.now()-this.blinkStart)/(500*e)%2)===0}get editingEnabled(){return this._editingEnabled}set editingEnabled(e){this._editingEnabled!==e&&(this._editingEnabled=e,e||(this.blinkStart=0,this.moveCursorTo(0,!1)),this._dirty=!0)}set text(e){this.variable.value=e;let t=this.variable.value.length;this.cursorPos>t&&(this.cursorPos=t,this.cursorOffsetDirty=!0),this.selectPos>t&&(this.selectPos=t,this.cursorOffsetDirty=!0)}get text(){return this.variable.value}get displayedText(){return this.hideText?"\u25CF".repeat(this.variable.value.length):this.variable.value}get valid(){return this._valid}get validValue(){return this._validValue}get line(){return this.textHelper.getLine(this.cursorPos)}moveCursorTo(e,t){this.cursorPos=Math.min(Math.max(e,0),this.text.length),t||(this.selectPos=this.cursorPos),this.cursorOffsetDirty=!0,this._dirty=!0}moveCursor(e,t){this.moveCursorTo(this.cursorPos+e,t)}moveCursorFromOffset(e,t,r){[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset([e,t]),r||(this.selectPos=this.cursorPos,this.selectOffset=this.cursorOffset),this.blinkStart=Date.now(),this._dirty=!0}moveCursorLine(e,t){this.moveCursorFromOffset(this.cursorOffset[0],this.cursorOffset[1]+(.5+e)*this.textHelper.fullLineHeight,t)}moveCursorStart(e){this.moveCursorTo(this.textHelper.getLineStart(this.line),e)}moveCursorEnd(e){this.moveCursorTo(this.textHelper.getLineEnd(this.line,!1),e)}moveCursorWord(e,t){if(e==0)return;let r=/\w/,n=this.text,s=this.cursorPos;if(e>0)for(;e>0;){let o=!1;for(;s<=n.length;s++)if(s<n.length&&r.test(n[s]))o=!0;else if(o)break;e--}else for(;e<0;){s--;let o=!1;for(;s>=0;s--)if(s>=0&&r.test(n[s]))o=!0;else if(o)break;s++,e++}this.moveCursorTo(s,t)}deleteRange(e,t){e!==t&&(this.variable.value=this.text.substring(0,e)+this.text.substring(t),this.cursorPos=this.selectPos=e,this.cursorOffsetDirty=!0)}deleteWord(e){if(e===0)return;if(this.cursorPos!==this.selectPos){this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));return}let t=this.cursorPos;this.moveCursorWord(e,!1),t!==this.cursorPos&&this.deleteRange(Math.min(t,this.cursorPos),Math.max(t,this.cursorPos))}insertText(e){if(!(this.inputFilter!==null&&!this.inputFilter(e)))if(this.selectPos===this.cursorPos)this.variable.value=this.text.substring(0,this.cursorPos)+e+this.text.substring(this.cursorPos),this.moveCursor(e.length,!1);else{let t=Math.min(this.cursorPos,this.selectPos),r=Math.max(this.cursorPos,this.selectPos);this.variable.value=this.text.substring(0,t)+e+this.text.substring(r),this.moveCursorTo(t+e.length,!1)}}deleteText(e){e!==0&&(this.cursorPos!==this.selectPos?this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos)):e>0?this.variable.value=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+e):(this.variable.value=this.text.substring(0,this.cursorPos+e)+this.text.substring(this.cursorPos),this.moveCursor(e,!1)))}selectRangeAt(e){let t=this.text,r=/\w/,n=r.test(t[e]),s=e;for(;e>=0&&r.test(t[e])===n;e--);let o=e+1;for(e=s;e<t.length&&r.test(t[e])===n;e++);return[o,e]}onFocusGrabbed(e,t){e===1&&this.blinkStart===0&&(this.blinkStart=Date.now(),this.selectPos=this.variable.value.length,this.cursorPos=this.selectPos,this.cursorOffsetDirty=!0)}onFocusDropped(e,t){e===1&&(this.blinkStart=0)}handleEvent(e,t){if(!this._editingEnabled)return null;if(e instanceof F)return this.dragging=!1,this.lastClick=0,this;if(e instanceof R)return null;if(e instanceof T){if(t.pointerStyle="text",e instanceof V||e instanceof q){let r=e instanceof V&&e.isPrimary;if(r){this.dragging=!0;let s=new Date().getTime();s-this.lastClick<500?(this.successiveClickCount++,this.successiveClickCount>2&&(this.successiveClickCount=0)):this.successiveClickCount=0,this.lastClick=s}else if(!this.dragging)return this;let n=this.inputTextInnerPadding;if(this.moveCursorFromOffset(e.x-this.x-n+this.offset[0],e.y-this.y-n+this.offset[1],!r&&this.dragging),r&&(this.cursorPos!==this.dragStart&&(this.successiveClickCount=0),this.dragStart=this.cursorPos),this.successiveClickCount>0){let s,o;if(this.successiveClickCount===1){let[l,d]=this.selectRangeAt(this.dragStart),[u,c]=this.selectRangeAt(this.cursorPos);s=Math.min(l,u),o=Math.max(d,c)}else{let l=Math.min(this.cursorPos,this.dragStart),d=this.textHelper.getLine(l);s=this.textHelper.getLineStart(d);let u=Math.max(this.cursorPos,this.dragStart),c=this.textHelper.getLine(u);o=this.textHelper.getLineEnd(c)}this.cursorPos>=this.dragStart?(this.selectPos=s,this.cursorPos=o):(this.selectPos=o,this.cursorPos=s),this.cursorOffsetDirty=!0}t.requestFocus(1,this)}else e instanceof O&&e.isPrimary&&(this.dragging=!1,t.hasMobileTextInput&&t.getTextInput(this.text).then(r=>{r!==null&&this.text!==r&&(this.text=r,this.moveCursorTo(r.length,!1))}));return this}else if(e instanceof W){if(this.dragging=!1,this.lastClick=0,e.alt)return this;if(e.ctrl){if(e.key==="Backspace")this.deleteWord(-1);else if(e.key==="Delete")this.deleteWord(1);else if(e.key==="ArrowLeft")this.moveCursorWord(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursorWord(1,e.shift);else if(e.key==="c"||e.key==="C"){if(this.cursorPos===this.selectPos)return this;let r=this.text.slice(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));if(navigator.clipboard)navigator.clipboard.writeText(r);else return this}else if(e.key==="a"||e.key==="A")this.cursorPos=this.text.length,this.selectPos=0,this.cursorOffsetDirty=!0,this._dirty=!0;else return this;return this.blinkStart=Date.now(),this}if(e.key.length===1)this.insertText(e.key);else if(e.key==="Backspace")this.deleteText(-1);else if(e.key==="Delete")this.deleteText(1);else if(e.key==="ArrowLeft")this.moveCursor(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursor(1,e.shift);else if(e.key==="ArrowUp")this.moveCursorLine(-1,e.shift);else if(e.key==="ArrowDown")this.moveCursorLine(1,e.shift);else if(e.key==="PageUp")this.moveCursorLine(-5,e.shift);else if(e.key==="PageDown")this.moveCursorLine(5,e.shift);else if(e.key==="Home")this.moveCursorStart(e.shift);else if(e.key==="End")this.moveCursorEnd(e.shift);else{if(e.key==="Escape")return t.dropFocus(1,this),this;if(e.key==="Enter")this.insertText(`
`);else if(e.key==="Tab")if(this.typeableTab){if(e.shift)return t.dispatchEvent(new E(this,!1)),this;this.insertText("	")}else return null;else return this}this.blinkStart=Date.now()}else if(e instanceof re)e.target===this&&(this.insertText(e.text),this.blinkStart=Date.now());else if(e.target!==this)return null;return this}handlePreLayoutUpdate(e){this.editingEnabled||e.dropFocus(1,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.inputTextFont,this.textHelper.lineHeight=this.inputTextHeight,this.textHelper.lineSpacing=this.inputTextSpacing,this.textHelper.alignMode=this.inputTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,r,n){let s=2*this.inputTextInnerPadding;this.textHelper.maxWidth=this.wrapText?Math.max(t-s,0):1/0,this.textHelper.dirty&&(this._dirty=!0);let o=Math.min(Math.max(this.inputTextMinWidth,e),t);this.width=Math.min(Math.max(o,this.textHelper.width+s),t),this.height=Math.min(Math.max(r,this.textHelper.height+s),n)}handlePostLayoutUpdate(e){this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.selectPos===this.cursorPos?(this.selectOffset[0]=this.cursorOffset[0],this.selectOffset[1]=this.cursorOffset[1]):this.selectOffset=this.textHelper.findOffsetFromIndex(this.selectPos),this.cursorOffsetDirty=!1);let t=this.inputTextInnerPadding,r=this.textHelper.width,n=this.textHelper.height,s=this.width-t*2,o=this.height-t*2,l=this.offset,[d,u]=this.cursorOffset;if(r>s){let c=Math.min(20,s/2),m=l[0]+c,p=l[0]+s-c;d>p&&(l[0]+=d-p),d<m&&(l[0]-=m-d),l[0]+s>r&&(l[0]=r-s),l[0]<0&&(l[0]=0)}else l[0]=0;if(n>o){let c=this.textHelper.fullLineHeight,m=o<2*c?0:c/2,p=l[1]+m,b=l[1]+o-m-c;u>b&&(l[1]+=u-b),u<p&&(l[1]-=p-u),l[1]+o>n&&(l[1]=n-o),l[1]<0&&(l[1]=0)}else l[1]=0;this.offset=l}handlePainting(e,t){e.fillStyle=this.inputBackgroundFill,e.fillRect(this.x,this.y,this.width,this.height),e.save(),e.beginPath(),e.rect(this.x,this.y,this.width,this.height),e.clip();let r=this.inputTextInnerPadding;if(this.cursorPos!==this.selectPos)if(e.fillStyle=this.inputSelectBackgroundFill,this.cursorOffset[1]===this.selectOffset[1]){let o=Math.min(this.cursorOffset[0],this.selectOffset[0]),l=Math.max(this.cursorOffset[0],this.selectOffset[0]);e.fillRect(this.x+r+o-this.offset[0],this.y+r+this.cursorOffset[1]-this.offset[1],l-o,this.textHelper.fullLineHeight)}else{let o,l;this.cursorOffset[1]<this.selectOffset[1]?(o=this.cursorOffset,l=this.selectOffset):(l=this.cursorOffset,o=this.selectOffset);let d=this.textHelper.fullLineHeight,u=this.width+this.offset[0]-o[0]-r;u>0&&e.fillRect(this.x+r+o[0]-this.offset[0],this.y+r+o[1]-this.offset[1],u,d);let c=l[0]+r-this.offset[0];c>0&&e.fillRect(this.x,this.y+r+l[1]-this.offset[1],c,d);let m=o[1]+d,p=l[1]-m;p>0&&e.fillRect(this.x,this.y+r+m-this.offset[1],this.width,p)}let n;this._editingEnabled?this._valid?n=this.inputTextFill:n=this.inputTextFillInvalid:n=this.inputTextFillDisabled,this.textHelper.paint(e,n,this.x+r-this.offset[0],this.y+r-this.offset[1]);let s=this.blinkOn;this.blinkWasOn=s,s&&(e.fillStyle=n,e.fillRect(this.x+r+this.cursorOffset[0]-this.offset[0],this.y+r+this.cursorOffset[1]-this.offset[1],this.cursorThickness,this.textHelper.fullLineHeight)),e.restore()}};a(ue,"TextInput"),y([K(["cursorOffsetDirty","_dirty"])],ue.prototype,"hideText",2),y([Ze()],ue.prototype,"offset",2),y([z],ue.prototype,"wrapText",2);var ft=class extends ue{constructor(i=null,e="",t){let r=It(i);super(r,null,e,t)}};a(ft,"BasicTextInput");var gt=class extends oe{constructor(i,e){let t=Q({},e);t.containerAlignment={horizontal:.5,vertical:.5},t.containerPadding={left:0,right:0,top:0,bottom:0},super(i,t)}};a(gt,"Center");var Xe=class extends f{constructor(e=null,t=!1,r){super(!0,!1,r);this.offsetX=0;this.offsetY=0;this.actualLength=0;this.tabFocusable=!0,this.variable=new le(t,e),this.clickHelper=new xe(this)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="checkboxLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="checkboxInnerPadding")&&(this._dirty=!0)}set checked(e){this.variable.value=e}get checked(){return this.variable.value}onFocusGrabbed(e,t){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e,t){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e,t){let r=this.x+this.offsetX,n=this.y+this.offsetY,[s,o]=this.clickHelper.handleEvent(e,t,!0,[r,r+this.actualLength,n,n+this.actualLength]);return s&&(this.checked=!this.checked),this.clickHelper.clickStateChanged&&(this._dirty=!0),o?this:null}handlePostLayoutUpdate(e){this.variable.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.checkboxLength;this.actualLength=Math.min(s,t,n),this.width=this.actualLength,this.height=this.actualLength,this.width<e&&(this.width=e),this.height<r&&(this.height=r),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e,t){let r=this.clickHelper.clickState===1||this.clickHelper.clickState===2;r?e.fillStyle=this.backgroundGlowFill:e.fillStyle=this.backgroundFill;let n=this.offsetX+this.x,s=this.offsetY+this.y;if(e.fillRect(n,s,this.actualLength,this.actualLength),this.checked){r?e.fillStyle=this.accentFill:e.fillStyle=this.primaryFill;let o=this.checkboxInnerPadding,l=this.actualLength-o*2;l<=0?e.fillRect(n,s,this.actualLength,this.actualLength):e.fillRect(n+o,s+o,l,l)}}};a(Xe,"Checkbox");var si=/^.*\.(webm|og[gv]|m(p4|4v|ov)|avi|qt)$/i,ae=class extends f{constructor(e,t=null,r=null,n=null,s){super(!0,!1,s);this.lastSrc=null;this.rotation=0;this.imageWidth=null;this.imageHeight=null;this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.loadedmetadataListener=null;this.canplayListener=null;this.frameCallback=null;if(typeof e=="string")if(si.test(e)){let o=document.createElement("video");o.src=e,o.preload="auto",e=o}else{let o=document.createElement("img");o.src=e,e=o}this._image=e,this.imageWidth=t,this.imageHeight=r,this.viewBox=n,this.setupVideoEvents()}setupVideoEvents(){if(this.image instanceof HTMLVideoElement)if(this.loadedmetadataListener=e=>this._layoutDirty=!0,this.image.addEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener=e=>this._dirty=!0,this.image.addEventListener("canplay",this.canplayListener),"requestVideoFrameCallback"in this.image){console.warn("requestVideoFrameCallback available; if video playback is choppy or broken, please report it on Github");let e=this.image;this.frameCallback=(t,r)=>{this._dirty=!0,console.log("set dirty"),this.image===e&&this.frameCallback!==null&&this.image.requestVideoFrameCallback(this.frameCallback)},this.image.requestVideoFrameCallback(this.frameCallback)}else console.warn("requestVideoFrameCallback not available; video will be played back on every frame when not paused")}set image(e){e!==this._image&&(this._image instanceof HTMLVideoElement&&(this.loadedmetadataListener!==null&&this._image.removeEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener!==null&&this._image.removeEventListener("canplay",this.canplayListener)),this._image=e,this.lastSrc=null,this.loadedmetadataListener=null,this.canplayListener=null,this.frameCallback=null,this.setupVideoEvents())}get image(){return this._image}handlePreLayoutUpdate(e){var t,r;this._image instanceof HTMLVideoElement?!this._image.paused&&this.frameCallback===null&&(this._dirty=!0):((t=this._image)==null?void 0:t.src)!==this.lastSrc&&((r=this._image)==null?void 0:r.complete)&&(this._layoutDirty=!0,this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.imageWidth;s===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?s=this._image.videoWidth:s=this._image.naturalWidth:s=this.viewBox[2]),this.width=Math.max(Math.min(s,t),e);let o=this.imageHeight;o===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?o=this._image.videoHeight:o=this._image.naturalHeight:o=this.viewBox[3]),this.height=Math.max(Math.min(o,n),r);let l=this.width/s,d=this.height/o,u=Math.min(l,d);this.actualWidth=s*u,this.actualHeight=o*u,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=(this.height-this.actualHeight)/2}handlePainting(e,t){var o;if(this._image instanceof HTMLImageElement&&!((o=this._image)!=null&&o.complete)){this.lastSrc=null;return}this.lastSrc=this._image.src;let r=this.x+this.offsetX,n=this.y+this.offsetY,s=this.rotation!==0;s&&(e.save(),e.beginPath(),e.rect(this.x,this.y,this.width,this.height),e.clip(),e.translate(this.x+this.offsetX+this.actualWidth/2,this.y+this.offsetY+this.actualHeight/2),r=-this.actualWidth/2,n=-this.actualHeight/2,e.rotate(this.rotation)),this.viewBox===null?e.drawImage(this._image,r,n,this.actualWidth,this.actualHeight):e.drawImage(this._image,...this.viewBox,r,n,this.actualWidth,this.actualHeight),s&&e.restore()}dryPaint(){var e;this._image instanceof HTMLImageElement&&((e=this._image)==null?void 0:e.complete)?this.lastSrc=this._image.src:this.lastSrc=null,super.dryPaint()}};a(ae,"Icon"),y([pe],ae.prototype,"rotation",2),y([Dt(!0)],ae.prototype,"viewBox",2),y([z],ae.prototype,"imageWidth",2),y([z],ae.prototype,"imageHeight",2);var bt=class extends Te{constructor(i,e=null,t=null,r=null,n=null,s){super(new ae(i,e,t,r,s),n,s)}};a(bt,"IconButton");var Qe=class extends f{constructor(e=1,t=0,r=0,n){super(!0,!1,n);this.flex=e,this.minWidth=t,this.minHeight=r}handleResolveDimensions(e,t,r,n){t!==1/0?this.width=t:this.width=Math.max(e,this.minWidth),n!==1/0?this.height=n:this.height=Math.max(r,this.minHeight)}};a(Qe,"Spacing");var yt=class extends Pe{constructor(i,e=null,t=!1,r){super(r),this.add([new de(i,r),new Qe(1,0,0,r),new Xe(e,t,r)])}};a(yt,"LabelledCheckbox");var Se=class extends te{constructor(e,t=0,r=0,n=!1,s=!1,o=!1,l){super(e,!1,!0,l);this._offset=[0,0];this._constraints=[0,1/0,0,1/0];this.forceReLayout=!0;this.forceRePaint=!0;this.autoScrollSelections=!0;this.viewport=o?new B:null,this.minWidth=t,this.minHeight=r,this._widthTied=n,this._heightTied=s,this._constraints=[0,1/0,0,1/0]}get offset(){return[...this._offset]}set offset(e){(this._offset[0]!==e[0]||this._offset[1]!==e[1])&&(this._offset[0]=e[0],this._offset[1]=e[1],this._dirty=!0,this.correctChildPosition())}set constraints(e){(e[0]!==this._constraints[0]||e[1]!==this._constraints[1]||e[2]!==this._constraints[2]||e[3]!==this._constraints[3])&&(this._constraints[0]=e[0],this._constraints[1]=e[1],this._constraints[2]=e[2],this._constraints[3]=e[3],this.viewport!==null?this.viewport.constraints=e:this.forceReLayout=!0)}get constraints(){return[...this._constraints]}get widthTied(){return this._widthTied}set widthTied(e){this._widthTied!==e&&(this._widthTied=e,this._layoutDirty=!0,this.forceReLayout=!0)}get heightTied(){return this._heightTied}set heightTied(e){this._heightTied!==e&&(this._heightTied=e,this._layoutDirty=!0,this.forceReLayout=!0)}get scaledMinWidth(){var e,t;return this.minWidth*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}get scaledMinHeight(){var e,t;return this.minHeight*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}get scaledConstraints(){var t,r;let e=(r=(t=this.root)==null?void 0:t.resolution)!=null?r:1;return[this._constraints[0]*e,this._constraints[1]*e,this._constraints[2]*e,this._constraints[3]*e]}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="canvasFill"&&(this._dirty=!0)}getClickAreaOf(e){let[t,r]=e.dimensions,[n,s]=e.position,o=this.x+this.offset[0]+n,l=this.y+this.offset[1]+s;return[o,o+t,l,l+r]}handleEvent(e,t){if(e instanceof T){let[n,s,o,l]=this.getClickAreaOf(this.child);if(e.target===null&&(e.x<n||e.x>=s||e.y<o||e.y>=l))return null;this.viewport!==null&&(e=e.correctOffset(n,o))}let r=this.child.dispatchEvent(e,t);if(this.autoScrollSelections&&r!==null&&!(this.widthTied&&this.heightTied)&&(e instanceof E||e instanceof A)){let[n,s,o,l]=this.getClickAreaOf(r),d=this.x+this.width,u=this.y+this.height,[c,m]=this.offset;!this.widthTied&&!(n>=this.x&&s<d)&&!(this.x>=n&&d<s)&&(n>this.x?c-=n-this.x:c+=d-s),!this.heightTied&&!(o>=this.y&&l<u)&&!(this.y>=o&&u<l)&&(o>this.y?m-=o-this.y:m+=u-l),this.offset=[c,m]}return r}handlePreLayoutUpdate(e){let t=this.child;t.preLayoutUpdate(e),this._widthTied||this._heightTied?t.layoutDirty&&(this._layoutDirty=!0):this.viewport!==null?(this.viewport.constraints=this.scaledConstraints,this.viewport.resolveChildsLayout(t)):(t.layoutDirty||this.forceReLayout)&&(t.resolveDimensionsAsTop(...this.scaledConstraints),this.correctChildPosition())}handlePostLayoutUpdate(e){let t=this.child;this.forceReLayout=!1,t.postLayoutUpdate(e),t.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=!0,o=!0,l=Math.min(Math.max(e,this.scaledMinWidth),t),d=Math.min(Math.max(r,this.scaledMinHeight),n);if(this._widthTied||this._heightTied){let u=this.scaledConstraints;this._widthTied&&(u[0]=l,u[1]=t),this._heightTied&&(u[2]=d,u[3]=n);let c=this.child;this.viewport===null?(c.resolveDimensionsAsTop(...u),this.correctChildPosition()):(this.viewport.constraints=u,this.viewport.resolveChildsLayout(c)),this._widthTied&&(this.width=c.dimensions[0],s=!1),this._heightTied&&(this.height=c.dimensions[1],o=!1)}s&&(this.width=Math.min(l,t)),o&&(this.height=Math.min(d,n)),this.width===0&&this.minWidth===0&&!this._widthTied&&console.warn("ViewportWidget has no minimum width and width isn't tied, therefore, it may be dimensionless. Set a minimum width and/or tie the width"),this.height===0&&this.minHeight===0&&!this._heightTied&&console.warn("ViewportWidget has no minimum height and height isn't tied, therefore, it may be dimensionless. Set a minimum height and/or tie the height")}afterPositionResolved(){this.correctChildPosition(),this.viewport===null&&(this.forceRePaint=!0)}correctChildPosition(){if(this.viewport!==null)return;let[e,t]=this.offset;this.child.resolvePosition(this.x+e,this.y+t)}handlePainting(e,t){this.viewport!==null&&this.viewport.paintToCanvas(this.child,t);let[r,n,s,o]=this.roundRect(this.x,this.y,this.width,this.height,!0),[l,d]=this.child.dimensions,[u,c]=this.offset,m=r+s,p=n+o,b=this.x+u,v=this.y+c,k=Math.min(Math.max(b,r),m),_=Math.min(Math.max(v,n),p),S=Math.min(Math.max(b+l,r),m)-k,w=Math.min(Math.max(v+d,n),p)-_;if([k,_,S,w]=this.roundRect(k,_,S,w,!0),S===0||w===0){this.viewport===null&&this.child.dryPaint(),this.forceRePaint=!1;return}let x=k-b,M=_-v;this.clearStart(e),e.rect(r,n,s,o),e.clip(),this.viewport!==null&&e.drawImage(this.viewport.canvas,x,M,S,w,k,_,S,w),e.rect(k,_,S,w),this.clearEnd(e,"evenodd"),this.viewport===null&&(e.save(),e.beginPath(),e.rect(k,_,S,w),e.clip(),this.child.paint(e,t||this.forceRePaint),e.restore()),this.forceRePaint=!1}};a(Se,"ViewportWidget"),y([z],Se.prototype,"minWidth",2),y([z],Se.prototype,"minHeight",2);var oi=(e=>(e[e.Overlay=0]="Overlay",e[e.Layout=1]="Layout",e))(oi||{}),vt=class extends Se{constructor(e,t=0,r=0,n=!1,s=!1,o=0,l=!1,d){super(e,t,r,n,s,l,d);this.effectiveWidth=0;this.effectiveHeight=0;this.verticalDragged=null;this.startingScroll=0;this.startingOffset=0;this.lastScroll=0;this.horizWasPainted=!1;this.vertWasPainted=!1;this._scrollbarMode=o,this.horizontalClickHelper=new j(this),this.verticalClickHelper=new j(this)}get scrollbarMode(){return this._scrollbarMode}set scrollbarMode(e){if(this._scrollbarMode!==e){let t=this.scroll;this._scrollbarMode=e,this.scroll=t,this._layoutDirty=!0,this._dirty=!0}}get offset(){return super.offset}set offset(e){let[t,r]=this.child.dimensions;super.offset=[-Math.max(Math.min(-e[0],t-this.effectiveWidth),0),-Math.max(Math.min(-e[1],r-this.effectiveHeight),0)]}get widthTied(){return super.widthTied}set widthTied(e){let t=this.scroll;super.widthTied=e,this.scroll=t}get heightTied(){return super.heightTied}set heightTied(e){let t=this.scroll;super.heightTied=e,this.scroll=t}get scroll(){let[e,t]=this.offset,[r,n]=this.child.dimensions,s=r-this.effectiveWidth,o=n-this.effectiveHeight;return[s===0?0:Math.min(Math.max(-e/s,0),1),o===0?0:Math.min(Math.max(-t/o,0),1)]}set scroll(e){let[t,r]=this.child.dimensions;this.offset=[-e[0]*(t-this.effectiveWidth),-e[1]*(r-this.effectiveHeight)]}getClickHelper(e){return e?this.verticalClickHelper:this.horizontalClickHelper}handleEventScrollbar(e,t,r,n){if(this.verticalDragged!==null&&this.verticalDragged!==e)return!1;let[s,o]=this.getScrollbarRects(e,t),l=this._scrollbarMode===0,d=l?s:o,u=[d[0],d[0]+d[2],d[1],d[1]+d[3]],c=this.getClickHelper(e);c.handleClickEvent(r,n,u);let m=c.clickState,p=c.clickStateChanged;if(p&&(this._dirty=!0),m===2){if(c.pointerPos===null||!(r instanceof T))return!0;let b=e?1:0,v=this.scroll,k=l;k||(k=c.isPointInRect(r.x,r.y,s[0],s[0]+s[2],s[1],s[1]+s[3]));let _;if(l?_=c.getNormalInRect(r.x,r.y,o[0],o[0]+o[2],o[1],o[1]+o[3])[b]:_=c.pointerPos[b],p){if(!k){let S=e?this.effectiveHeight:this.effectiveWidth,w=this.child.dimensions[b],x=S/w;v[b]=(_-x/2)/(1-x),this.scroll=v}this.startingOffset=_,this.startingScroll=v[b],this.verticalDragged=e}else{let S=e?this.effectiveHeight:this.effectiveWidth,w=this.child.dimensions[b],x=S/w,M=_-this.startingOffset;v[b]=this.startingScroll+M/(1-x),this.scroll=v}return!0}else{if(m===1)return!0;if(p)return this.verticalDragged=null,!0}return!1}clampOffset(e){let[t,r]=this.child.dimensions,n=-(t-this.effectiveWidth);n>=0?e[0]=0:e[0]<n&&(e[0]=n);let s=-(r-this.effectiveHeight);s>=0?e[1]=0:e[1]<s&&(e[1]=s)}handleWheelEvent(e){let t=this.offset,[r,n]=t;t[0]-=e.shift?e.deltaY:e.deltaX,t[1]-=e.shift?e.deltaX:e.deltaY,this.clampOffset(t),this.offset=t;let[s,o]=this.offset,l=s!==r||o!==n,d=this.lastScroll,u=new Date().getTime();return this.lastScroll=u,l?!0:e.fromDrag?!1:u-d<200}onThemeUpdated(e=null){super.onThemeUpdated(e),e==="scrollBarThickness"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundFill"||e==="scrollBarMinPercent"||e==="scrollBarMinPixels"||e==="primaryFill"||e==="accentFill"||e==="backgroundGlowFill")&&(this._dirty=!0)}handleEvent(e,t){if((e instanceof F||e instanceof T)&&(e.target===null||e.target===this)){let[n,s]=this.child.dimensions,o=this._scrollbarMode===0,l=!o&&!this.widthTied&&!this.heightTied,d=n>this.width,u=s>this.height,c=!1;if(!this.widthTied&&(d||!o)&&this.handleEventScrollbar(!1,u||l,e,t)&&(c=!0),!this.heightTied&&(u||!o)&&this.handleEventScrollbar(!0,d||l,e,t)&&(c=!0),c)return e instanceof R&&this.handleWheelEvent(e),this}let r=super.handleEvent(e,t);return r===null&&e instanceof R&&this.handleWheelEvent(e)?this:r}handleResolveDimensions(e,t,r,n){let s=this.scrollBarThickness,o=this._scrollbarMode===1,l=o&&!this.heightTied,d=o&&!this.widthTied,u,c,m,p;l?(c=Math.max(t-s,0),u=Math.min(e,c)):(c=t,u=e),d?(p=Math.max(n-s,0),m=Math.min(r,p)):(p=n,m=r),super.handleResolveDimensions(u,c,m,p),this.effectiveWidth=this.width,this.effectiveHeight=this.height,l&&(this.width=Math.min(Math.max(this.width+s,e),t)),d&&(this.height=Math.min(Math.max(this.height+s,r),n))}handlePostLayoutUpdate(e){super.handlePostLayoutUpdate(e);let t=this.offset;this.clampOffset(t),this.offset=t}handlePainting(e,t){let[r,n]=this.child.dimensions,s=r>this.width,o=n>this.height,l=this.scrollbarNeedsPaint(!1,s),d=this.scrollbarNeedsPaint(!0,o);(this.horizWasPainted!==l||this.vertWasPainted!==d)&&(this.horizWasPainted=l,this.vertWasPainted=d,this.forceRePaint=!0),super.handlePainting(e,t);let u=this._scrollbarMode===1&&!this.widthTied&&!this.heightTied;if(l&&this.paintScrollbar(!1,s,o||u,e),d&&this.paintScrollbar(!0,o,s||u,e),u){let c=this.scrollBarThickness;e.fillStyle=this.backgroundFill,e.fillRect(this.x+this.width-c,this.y+this.height-c,c,c)}}getScrollbarRects(e,t){let r=this._scrollbarMode===0,n=e?1:0,s=this.scroll[n],o=this.child.dimensions[n],l=e?this.effectiveHeight:this.effectiveWidth,d=this.scrollBarThickness,u=this.scrollBarMinPercent,c=this.scrollBarMinPixels,m=l;r&&(m-=t?d:0);let p=Math.min(Math.max(c,Math.max(l/o,u)*m),m),b=(m-p)*s,v,k,_,S;e?(v=this.x+this.width-d,k=this.y+b,_=d,S=p):(v=this.x+b,k=this.y+this.height-d,_=p,S=d);let w,x,M,U;return e?(w=v,x=this.y,M=d,U=m):(w=this.x,x=k,M=m,U=d),[[v,k,_,S],[w,x,M,U]]}scrollbarNeedsPaint(e,t){return!t&&this._scrollbarMode===0?!1:!(e?this.heightTied:this.widthTied)}paintScrollbar(e,t,r,n){let[s,o]=this.getScrollbarRects(e,r);if(this._scrollbarMode!==0&&(n.fillStyle=this.backgroundFill,n.fillRect(...o)),t)switch(this.getClickHelper(e).clickState){case 0:n.fillStyle=this.primaryFill;break;case 1:case 2:n.fillStyle=this.accentFill;break}else n.fillStyle=this.backgroundGlowFill;n.fillRect(...s)}};a(vt,"ScrollableViewportWidget");var it=class extends f{constructor(e=null,t=0,r=1,n=0,s=0,o=!1,l){super(!0,!1,l);this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.keyboardFocused=!1;if(r<t)throw new Error("Slider max value can't be smaller than minimum value");if(!isFinite(t)||isNaN(t))throw new Error("Slider min value must be a valid finite number");if(!isFinite(r)||isNaN(r))throw new Error("Slider max value must be a valid finite number");if(!isFinite(n)||isNaN(n))throw new Error("Slider increment value must be a valid finite number");if(n<0)throw new Error("Slider increment value must be greater or equal to zero");this.clickHelper=new j(this),this.variable=new le(this.clamp(s),e),this.minValue=t,this.maxValue=r,this.snapIncrement=n,this.vertical=o,this.tabFocusable=!0}set value(e){this.setValue(e)}get value(){return this.variable.value}clamp(e){return e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),e}setValue(e,t=!0){this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),this.variable.setValue(this.clamp(e),t)}stepValue(e,t){let r=this.snapIncrement;r===0&&(r=.01*(this.maxValue-this.minValue)),r*=t;let n=e?1:-1;this.value=this.clamp((Math.round(this.value/r)+n)*r)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="sliderThickness"||e==="sliderMinLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="accentFill"||e==="primaryFill"||e==="backgroundFill")&&(this._dirty=!0)}onFocusGrabbed(e,t){e===1&&(this.keyboardFocused=!0)}onFocusDropped(e,t){e===1&&(this.keyboardFocused=!1)}handleEvent(e,t){if(e instanceof R||!(e instanceof T||e instanceof A||e instanceof F)||e instanceof W&&e.key==="Tab")return null;if(e instanceof A){if(e instanceof W){let s=e.shift?10:1;e.key==="ArrowLeft"||e.key==="ArrowDown"?this.stepValue(!1,s):(e.key==="ArrowRight"||e.key==="ArrowUp")&&this.stepValue(!0,s)}return this}let r=this.x+this.offsetX,n=this.y+this.offsetY;if(this.clickHelper.handleClickEvent(e,t,[r,r+this.actualWidth,n,n+this.actualHeight]),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState==2)&&this.clickHelper.pointerPos!==null){let s=this.clickHelper.pointerPos[0];this.value=this.minValue+s*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handlePostLayoutUpdate(e){this.variable.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.sliderThickness,o=this.sliderMinLength;this.vertical?(n!=1/0?this.height=n:this.height=Math.max(o,r),this.actualHeight=this.height,this.offsetY=0,this.width=Math.min(Math.max(s,e),t),this.actualWidth=Math.min(this.width,s),this.offsetX=(this.width-this.actualWidth)/2):(t!=1/0?this.width=t:this.width=Math.max(o,e),this.actualWidth=this.width,this.offsetX=0,this.height=Math.min(Math.max(s,r),n),this.actualHeight=Math.min(this.height,s),this.offsetY=(this.height-this.actualHeight)/2)}handlePainting(e,t){let r=this.x+this.offsetX,n=this.y+this.offsetY,s=this.keyboardFocused||this.clickHelper.clickState===1||this.clickHelper.clickState===2;s?e.fillStyle=this.accentFill:e.fillStyle=this.primaryFill;let o=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);e.fillRect(r,n,o,this.actualHeight),s?e.fillStyle=this.backgroundGlowFill:e.fillStyle=this.backgroundFill;let l=this.actualWidth-o;e.fillRect(r+o,n,l,this.actualHeight)}};a(it,"Slider"),y([pe],it.prototype,"keyboardFocused",2);var xt=class extends oe{constructor(i,e){let t=Q({},e);t.containerAlignment={horizontal:.5,vertical:"stretch"},super(i,t)}};a(xt,"TextMargin");var Tt=class extends be{constructor(e,t){super(e);this.scopeTheme=t}set inheritedTheme(e){super.inheritedTheme=this.scopeTheme}get inheritedTheme(){return this.scopeTheme}};a(Tt,"ThemeScope");export{J as Alignment,mt as AltKey,he as ArtificialConstraint,Ue as BackspaceKey,ie as BaseContainer,D as BaseTheme,ft as BasicTextInput,X as BasicVirtualKey,Te as Button,xe as ButtonClickHelper,gt as Center,Xe as Checkbox,j as ClickHelper,ne as ClickState,$e as Column,Ae as CompoundClickHelper,oe as Container,pt as ControlKey,at as DOMKeyboardDriver,dt as DOMPointerDriver,Me as DOMRoot,ot as DOMVirtualKeyboardRoot,ct as DebugTheme,kr as DefaultTextInputHandler,ii as DefaultTextValidator,Ke as EnterKey,Oe as EscapeKey,$ as Event,ke as FilledButton,ze as FlexAlignment,co as FloatValidator,H as FocusType,ye as GenericClickHelper,Ie as GlyphVirtualKey,ae as Icon,bt as IconButton,po as IntValidator,A as KeyEvent,W as KeyPress,se as KeyRelease,Ye as KeyboardDriver,de as Label,yt as LabelledCheckbox,F as Leave,ao as MakeCompositeValidator,It as MakeDefaultTextValidatorWithCallback,go as MakeRangeValidator,Fe as Margin,me as ModifierEvent,ee as MultiContainer,Le as MultiParent,fe as Parent,be as PassthroughWidget,ve as PointerButtonEvent,Ce as PointerDriver,T as PointerEvent,Mt as PointerHint,q as PointerMove,V as PointerPress,O as PointerRelease,R as PointerWheel,ut as RayPointerDriver,P as Root,Pe as Row,vt as ScrollableViewportWidget,oi as ScrollbarMode,Be as ShiftKey,te as SingleParent,it as Slider,Ge as SpaceKey,Qe as Spacing,E as TabSelect,Rt as TextAlignMode,_e as TextButton,C as TextHelper,ue as TextInput,xt as TextMargin,re as TextPasteEvent,L as Theme,Tt as ThemeScope,le as Variable,B as Viewport,Se as ViewportWidget,Y as VirtualKey,Ve as VirtualKeyRow,we as VirtualKeyboard,lt as VirtualKeyboardRoot,f as Widget,Wt as WrapMode,Ne as defaultVirtualKeyboardTemplate,Ct as flagArrayField,wt as flagField,ht as getPointerEventNormPos,xr as injectDebugCode,N as injectRandomFillFeature,g as injectStackTraceFeature,tt as injectTraceFeature,et as injectWatchflagFeature,ge as isDebugFeatureEnabled,st as isPower2,St as layoutArrayField,z as layoutField,Xt as listDebugFeatures,je as measureTextDims,Gt as multiFlagArrayField,K as multiFlagField,Ze as paintArrayField,pe as paintField,Dt as paintLayoutArrayField,yi as paintLayoutField,nt as roundToPower2,Yt as toggleDebugFeature,Ft as watchArrayField,qe as watchField};
//# sourceMappingURL=index.esm.js.map
