var mt=Object.defineProperty;var ni=Object.getOwnPropertyDescriptor;var Vt=Object.getOwnPropertySymbols;var si=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable;var Bt=(h,i,e)=>i in h?mt(h,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[i]=e,q=(h,i)=>{for(var e in i||(i={}))si.call(i,e)&&Bt(h,e,i[e]);if(Vt)for(var e of Vt(i))oi.call(i,e)&&Bt(h,e,i[e]);return h};var l=(h,i)=>mt(h,"name",{value:i,configurable:!0});var k=(h,i,e,t)=>{for(var r=t>1?void 0:t?ni(i,e):i,n=h.length-1,s;n>=0;n--)(s=h[n])&&(r=(t?s(i,e,r):s(r))||r);return t&&r&&mt(i,e,r),r};var At=(h,i,e)=>new Promise((t,r)=>{var n=a=>{try{o(e.next(a))}catch(d){r(d)}},s=a=>{try{o(e.throw(a))}catch(d){r(d)}},o=a=>a.done?t(a.value):Promise.resolve(a.value).then(n,s);o((e=e.apply(h,i)).next())});var nt=(n=>(n.SpaceBetween="between",n.SpaceAround="around",n[n.Start=0]="Start",n[n.Center=.5]="Center",n[n.End=1]="End",n))(nt||{});var oe=(r=>(r.Stretch="stretch",r[r.Start=0]="Start",r[r.Center=.5]="Center",r[r.End=1]="End",r))(oe||{});var O=class{constructor(i,e,t,r=!1){this.target=i,this.focusType=e,this.needsFocus=t,this.reversed=r}};l(O,"Event");var xe=class extends O{constructor(e,t,r,n,s,o){super(n,s,o);this.shift=e,this.ctrl=t,this.alt=r}};l(xe,"ModifierEvent");var P=class extends xe{constructor(e,t,r,n,s,o=null,a=null){super(r,n,s,o,a,!1);this.x=e,this.y=t}};l(P,"PointerEvent");var Ve=class extends O{constructor(e,t){super(null,null,!1);this.originallyRelativeTo=e,this.bounds=[...t]}cloneWithTarget(e){return e!==null&&!Ve.targetWarned&&(Ve.targetWarned=!0,console.warn("AutoScroll events cannot be targetted to a specific widget. Target ignored")),new Ve(this.originallyRelativeTo,this.bounds)}},z=Ve;l(z,"AutoScroll"),z.targetWarned=!1;var Be=class extends O{constructor(e,t){super(null,null,!1,t);this.relativeTo=e,this.reachedRelative=e===null}cloneWithTarget(e){e!==null&&!Be.targetWarned&&(Be.targetWarned=!0,console.warn("TabSelect events cannot be targetted to a specific widget. Target ignored"));let t=new Be(this.relativeTo,this.reversed);return t.reachedRelative=this.reachedRelative,t}},A=Be;l(A,"TabSelect"),A.targetWarned=!1;var Ae=null;function st(h,i){if(Ae===null&&(Ae=document.createElement("canvas").getContext("2d"),Ae===null))throw new Error("Failed to get canvas context");return Ae.font=i,Ae.measureText(h)}l(st,"measureTextDims");function ot(h){return function(i,e){let t=new WeakMap;Object.defineProperty(i,e,{set:function(r){let n=t.get(this);r!==n&&(t.set(this,r),h.call(this,n))},get:function(){return t.get(this)},enumerable:!0,configurable:!0})}}l(ot,"watchField");function It(h){return ot(function(i){this[h]=!0})}l(It,"flagField");var Te=It("_dirty"),J=It("_layoutDirty");function G(h){return ot(function(i){for(let e of h)this[e]=!0})}l(G,"multiFlagField");var Ai=G(["_dirty","_layoutDirty"]);function Ot(h,i=!1){return function(e,t){let r=new WeakMap;Object.defineProperty(e,t,{set:function(n){if(Array.isArray(n)){let s=r.get(this);if(Array.isArray(s)){if(n.length!==s.length){s.length=n.length;for(let o=0;o<n.length;o++)s[o]=n[o];h.call(this)}else for(let o=0;o<n.length;o++)if(s[o]!==n[o]){for(let a=0;a<n.length;a++)s[a]=n[a];h.call(this);return}}else r.set(this,[...n]),h.call(this)}else if(i)r.set(this,n),h.call(this);else throw new Error("Value must be an array")},get:function(){let n=r.get(this);return Array.isArray(n)?[...n]:n},enumerable:!0,configurable:!0})}}l(Ot,"watchArrayField");function Ut(h,i=!1){return Ot(function(){this[h]=!0},i)}l(Ut,"flagArrayField");function lt(h=!1){return Ut("_dirty",h)}l(lt,"paintArrayField");function Kt(h=!1){return Ut("_layoutDirty",h)}l(Kt,"layoutArrayField");function li(h,i=!1){return Ot(function(){for(let e of h)this[e]=!0},i)}l(li,"multiFlagArrayField");function Yt(h=!1){return li(["_dirty","_layoutDirty"],h)}l(Yt,"paintLayoutArrayField");var ai=new Set([`
`,"	"]),Xt=(e=>(e[e.Normal=0]="Normal",e[e.Shrink=1]="Shrink",e))(Xt||{}),gt=(t=>(t[t.Start=0]="Start",t[t.Center=.5]="Center",t[t.End=1]="End",t))(gt||{}),C=class{constructor(){this.text="";this.font="";this.maxWidth=1/0;this.lineHeight=null;this.lineSpacing=null;this.tabWidth=4;this.wrapMode=0;this.alignMode=0;this._width=0;this._height=0;this._lineHeight=0;this._lineSpacing=0;this._tabWidth=0;this.measureDirty=!0;this.lineHeightSpacingDirty=!0;this.tabWidthDirty=!0;this._dirty=!1;this._lineRanges=[]}get dirty(){let i=this._dirty;return this._dirty=!1,i}measureTextSlice(i,e,t){let r=st(this.text.slice(e,t),this.font);return i===0?r.width+Math.max(0,r.actualBoundingBoxLeft):i+r.width}getLineRangeWidthUntil(i,e){if(e<=i[0][0])return 0;let t=0;for(;t<i.length;t++){let s=i[t],o=s[1];if(e==o)return s[2];if(e>=s[0]&&e<o)break}if(t===i.length)return i[t-1][2];let r=0;t>0&&(r=i[t-1][2]);let n=i[t];return n[3]?r+n[2]*(e-n[0])/(n[1]-n[0]):this.measureTextSlice(r,n[0],e)}measureText(i,e,t,r){var c,p;let n=0;for(;n<r.length;n++){let f=r[n];if(i>=f[0]&&i<f[1]){i=f[0];break}}if(n>0){let f=r[n-1];f[1]!==i&&(i=f[1],--n>0?f=r[n]:f=null),f!==null&&!f[3]&&!ai.has(this.text[i])&&(i=f[0],n--)}let s=0;n>0&&(s=r[n-1][2]);let o=i,a=[];for(;o<e;)if(this.text[o]==="	"){let f=this.actualTabWidth;s=(Math.floor(s/f)+1)*f,a.push([o,++o,s,!0])}else if(this.text[o]===`
`){a.push([o,++o,s,!0]),o<e&&console.warn("measureText called with text range where newline was at the middle of the range instead of at the end. Some text was ignored");break}else{let f=this.text.indexOf(`
`,o+1);f===-1&&(f=1/0);let g=this.text.indexOf("	",o+1);g===-1&&(g=1/0);let b=Math.min(f,g,e);s=this.measureTextSlice(s,o,b),a.push([o,b,s,!1]),o=b}let d=n+a.length,u=(p=(c=a[a.length-1])!=null?c:r[n-1])!=null?p:null;return u===null?(r.length=0,r.push([i,i,0,!1]),!0):d===1&&u[1]-u[0]<=1||u[2]<=t?(r.length=n,r.push(...a),!0):!1}updateTextDims(){if(this.lineHeightSpacingDirty){this.lineHeightSpacingDirty=!1;let e=this._lineHeight,t=this._lineSpacing;if(this.lineHeight===null||this.lineSpacing===null){let r=st("~!@#$%^&*()_+`1234567890-=qwertyuiop[]\\QWERTYUIOP{}|asdfghjkl;'ASDFGHJKL:\"zxcvbnm,./ZXCVBNM<>?",this.font);this.lineHeight===null?this._lineHeight=r.actualBoundingBoxAscent:this._lineHeight=this.lineHeight,this.lineSpacing===null?this._lineSpacing=r.actualBoundingBoxDescent:this._lineSpacing=this.lineSpacing}else this._lineHeight=this.lineHeight,this._lineSpacing=this.lineSpacing;(e!==this._lineHeight||t!==this._lineSpacing)&&(this.measureDirty=!0)}if(this.tabWidthDirty&&(this.tabWidthDirty=!1,this._tabWidth=st(" ",this.font).width*this.tabWidth),!this.measureDirty)return;this.measureDirty=!1;let i=this._lineHeight+this._lineSpacing;if(this.text.length===0)this._height=i,this._width=this.maxWidth===1/0?0:this.maxWidth,this._lineRanges.length=1,this._lineRanges[0]=[[0,0,0,!1]];else if(this.maxWidth===1/0){this._lineRanges.length=0;let e=0;this._height=0,this._width=0;let t=this.text;for(;;){let r=this.text.indexOf(`
`,e),n=r===-1,s=n?t.length:r+1,o=[];this.measureText(e,s,1/0,o),this._lineRanges.push(o),this._height+=i;let a=o[o.length-1][2];if(a>this._width&&(this._width=a),n)break;e=s}}else{this._lineRanges.length=0;let e=[],t=this.text,r=/\s/,n=-1;for(let s=0;s<=t.length;){let o=r.test(t[s]),a=s===t.length;if(o||a){if(n>=0&&!this.measureText(n,s,this.maxWidth,e)){let d=[];if(this.measureText(n,s,this.maxWidth,d)){if(e.length===0)throw new Error("Unexpected line range without any render groups");this._lineRanges.push(e),e=d}else{let u=n;for(;u<s-1&&this.measureText(u,u+1,this.maxWidth,e);u++);this._lineRanges.push(e),e=d,s=u,n=u;continue}}if(n=-1,a){if(e.length===0){let d=this._lineRanges[this._lineRanges.length-1];if(d===void 0)e.push([0,0,0,!1]);else{let u=d[d.length-1];u===void 0?e.push([0,0,0,!1]):e.push([u[1],u[1],0,!1])}}this._lineRanges.push(e);break}if(t[s]===`
`)this.measureText(s,s+1,1/0,e),this._lineRanges.push(e),e=[];else if(!this.measureText(s,s+1,this.maxWidth,e))if(this.wrapMode===1){let d=s;do s++;while(t[s]!==`
`&&r.test(t[s]));let u=e[e.length-1];e.push([d,s,u!==void 0?u[2]:0,!0]),this._lineRanges.push(e),e=[];continue}else this._lineRanges.push(e),e=[],this.measureText(s,s+1,1/0,e)}else n===-1&&(n=s);s++}this._width=this.maxWidth,this._height=i*this._lineRanges.length}}paintGroup(i,e,t,r,n){!e[3]&&e[2]>t&&i.fillText(this.text.slice(e[0],e[1]),r,n)}paint(i,e,t,r){i.save(),i.beginPath(),i.rect(t,r,this.width,this.height),i.clip(),i.font=this.font,i.fillStyle=e,i.textBaseline="alphabetic",this.updateTextDims();let n=this.fullLineHeight,s=r+this._lineHeight;for(let o=0;o<this._lineRanges.length;o++){let a=0,d=this.getLineShift(o);for(let u of this._lineRanges[o])this.paintGroup(i,u,a,t+a+d,s),a=u[2];s+=n}i.restore()}findOffsetFromIndex(i){if(this.updateTextDims(),i<=0||this._lineRanges.length===0)return[this.getLineShift(0),0];let e=0;for(let t of this._lineRanges){if(i<t[t.length-1][1])break;e++}return e>=this._lineRanges.length&&(e=this._lineRanges.length-1,i=this.text.length),[this.getLineRangeWidthUntil(this._lineRanges[e],i)+this.getLineShift(e),e*this.fullLineHeight]}findIndexOffsetFromOffset(i){let e=this.fullLineHeight,t=this.getLineShift(0);if(this.text===""||i[0]<=t&&i[1]<e||i[1]<0)return[0,[t,0]];let r=Math.floor(i[1]/e);if(this.updateTextDims(),r>=this._lineRanges.length){let p=this.text.length;return[p,this.findOffsetFromIndex(p)]}let n=r*e,s=this._lineRanges[r],o=this.getLineShift(r);if(s.length===1&&s[0][0]===s[0][1])return[s[0][0],[s[0][2]+o,n]];let a=0,d=s[0][0],u=s[s.length-1][1];this.text[u-1]===`
`&&u--;let c=i[0]-o;for(let p=d;p<u;p++){let f=this.getLineRangeWidthUntil(s,p+1),g=(f+a)/2;if(c<g)return[p,[a+o,n]];a=f}return[u,[a+o,n]]}getLine(i){if(i<=0)return 0;this.updateTextDims();for(let e=0;e<this._lineRanges.length;e++){let t=this._lineRanges[e],r=t[t.length-1];if(i<r[1])return e}return this._lineRanges.length-1}getLineStart(i){if(i<=0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let e=this._lineRanges[this._lineRanges.length-1];return e[e.length-1][1]}return this._lineRanges[i][0][0]}getLineEnd(i,e=!0){if(i<0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let s=this._lineRanges[this._lineRanges.length-1];return s[s.length-1][1]}let t=this._lineRanges[i],r=t[t.length-1],n=r[1];return!e&&n>0&&this.text[n-1]===`
`&&r[0]!==r[1]?n-1:n}getLineShift(i){let e=this.alignMode;if(e===0)return 0;if(this.updateTextDims(),i<0)i=0;else if(i>=this._lineRanges.length)return this.width*e;let t=this._lineRanges[i];return(this.width-t[t.length-1][2])*e}get width(){return this.updateTextDims(),this._width}get height(){return this.updateTextDims(),this._height}get lineRanges(){return this.updateTextDims(),[...this._lineRanges]}get actualLineHeight(){return this.updateTextDims(),this._lineHeight}get actualLineSpacing(){return this.updateTextDims(),this._lineSpacing}get actualTabWidth(){return this.updateTextDims(),this._tabWidth}get fullLineHeight(){return this.updateTextDims(),this._lineHeight+this._lineSpacing}};l(C,"TextHelper"),k([G(["_dirty","measureDirty"])],C.prototype,"text",2),k([G(["_dirty","measureDirty","lineHeightSpacingDirty","tabWidthDirty"])],C.prototype,"font",2),k([G(["_dirty","measureDirty"])],C.prototype,"maxWidth",2),k([G(["_dirty","measureDirty","lineHeightSpacingDirty"])],C.prototype,"lineHeight",2),k([G(["_dirty","measureDirty","lineHeightSpacingDirty"])],C.prototype,"lineSpacing",2),k([G(["_dirty","measureDirty","tabWidthDirty"])],C.prototype,"tabWidth",2),k([G(["_dirty","measureDirty"])],C.prototype,"wrapMode",2),k([G(["_dirty"])],C.prototype,"alignMode",2);var W=class{constructor(i,e){this.listener=null;this._fallbackTheme=e,typeof i!="undefined"&&(this._canvasFill=i.canvasFill,this._containerPadding=i.containerPadding,this._containerAlignment=i.containerAlignment,this._multiContainerSpacing=i.multiContainerSpacing,this._multiContainerAlignment=i.multiContainerAlignment,this._primaryFill=i.primaryFill,this._accentFill=i.accentFill,this._backgroundFill=i.backgroundFill,this._backgroundGlowFill=i.backgroundGlowFill,this._sliderMinLength=i.sliderMinLength,this._sliderThickness=i.sliderThickness,this._bodyTextFont=i.bodyTextFont,this._bodyTextFill=i.bodyTextFill,this._bodyTextHeight=i.bodyTextHeight,this._bodyTextSpacing=i.bodyTextSpacing,this._bodyTextAlign=i.bodyTextAlign,this._checkboxLength=i.checkboxLength,this._checkboxInnerPadding=i.checkboxInnerPadding,this._inputBackgroundFill=i.inputBackgroundFill,this._inputSelectBackgroundFill=i.inputSelectBackgroundFill,this._inputTextFont=i.inputTextFont,this._inputTextFill=i.inputTextFill,this._inputTextFillDisabled=i.inputTextFillDisabled,this._inputTextFillInvalid=i.inputTextFillInvalid,this._inputTextHeight=i.inputTextHeight,this._inputTextSpacing=i.inputTextSpacing,this._inputTextInnerPadding=i.inputTextInnerPadding,this._inputTextMinWidth=i.inputTextMinWidth,this._inputTextAlign=i.inputTextAlign,this._blinkRate=i.blinkRate,this._cursorThickness=i.cursorThickness,this._scrollBarThickness=i.scrollBarThickness,this._scrollBarMinPercent=i.scrollBarMinPercent,this._scrollBarMinPixels=i.scrollBarMinPixels,this._radioButtonLength=i.radioButtonLength,this._radioButtonInnerPadding=i.radioButtonInnerPadding)}get fallbackTheme(){return this._fallbackTheme}set fallbackTheme(i){if(this._fallbackTheme===i)return;let e=this._fallbackTheme;typeof e!="undefined"&&this.listener!==null&&e.unsubscribe(this.listener),typeof i!="undefined"&&(this.listener=t=>this.onThemeUpdated(t),i.subscribe(this.listener)),this._fallbackTheme=i,this.onThemeUpdated()}onThemeUpdated(i=null){}get canvasFill(){var i,e,t;return(t=(e=this._canvasFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.canvasFill)!=null?t:"rgba(0,0,0,0.5)"}set canvasFill(i){this._canvasFill!==i&&(this._canvasFill=i,this.onThemeUpdated("canvasFill"))}get containerPadding(){var i,e,t;return(t=(e=this._containerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerPadding)!=null?t:{left:4,right:4,top:4,bottom:4}}set containerPadding(i){this._containerPadding!==i&&(this._containerPadding=i,this.onThemeUpdated("containerPadding"))}get containerAlignment(){var i,e,t;return(t=(e=this._containerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.containerAlignment)!=null?t:{horizontal:0,vertical:0}}set containerAlignment(i){this._containerAlignment!==i&&(this._containerAlignment=i,this.onThemeUpdated("containerAlignment"))}get multiContainerSpacing(){var i,e,t;return(t=(e=this._multiContainerSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerSpacing)!=null?t:4}set multiContainerSpacing(i){this._multiContainerSpacing!==i&&(this._multiContainerSpacing=i,this.onThemeUpdated("multiContainerSpacing"))}get multiContainerAlignment(){var i,e,t;return(t=(e=this._multiContainerAlignment)!=null?e:(i=this._fallbackTheme)==null?void 0:i.multiContainerAlignment)!=null?t:{main:"between",cross:"stretch"}}set multiContainerAlignment(i){this._multiContainerAlignment!==i&&(this._multiContainerAlignment=i,this.onThemeUpdated("multiContainerAlignment"))}get primaryFill(){var i,e,t;return(t=(e=this._primaryFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.primaryFill)!=null?t:"rgb(0,127,255)"}set primaryFill(i){this._primaryFill!==i&&(this._primaryFill=i,this.onThemeUpdated("primaryFill"))}get accentFill(){var i,e,t;return(t=(e=this._accentFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.accentFill)!=null?t:"rgb(0,195,255)"}set accentFill(i){this._accentFill!==i&&(this._accentFill=i,this.onThemeUpdated("accentFill"))}get backgroundFill(){var i,e,t;return(t=(e=this._backgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundFill)!=null?t:"rgb(32,32,32)"}set backgroundFill(i){this._backgroundFill!==i&&(this._backgroundFill=i,this.onThemeUpdated("backgroundFill"))}get backgroundGlowFill(){var i,e,t;return(t=(e=this._backgroundGlowFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.backgroundGlowFill)!=null?t:"rgb(48,48,48)"}set backgroundGlowFill(i){this._backgroundGlowFill!==i&&(this._backgroundGlowFill=i,this.onThemeUpdated("backgroundGlowFill"))}get sliderMinLength(){var i,e,t;return(t=(e=this._sliderMinLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderMinLength)!=null?t:100}set sliderMinLength(i){this._sliderMinLength!==i&&(this._sliderMinLength=i,this.onThemeUpdated("sliderMinLength"))}get sliderThickness(){var i,e,t;return(t=(e=this._sliderThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.sliderThickness)!=null?t:10}set sliderThickness(i){this._sliderThickness!==i&&(this._sliderThickness=i,this.onThemeUpdated("sliderThickness"))}get bodyTextFont(){var i,e,t;return(t=(e=this._bodyTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFont)!=null?t:"1rem sans-serif"}set bodyTextFont(i){this._bodyTextFont!==i&&(this._bodyTextFont=i,this.onThemeUpdated("bodyTextFont"))}get bodyTextFill(){var i,e,t;return(t=(e=this._bodyTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextFill)!=null?t:"white"}set bodyTextFill(i){this._bodyTextFill!==i&&(this._bodyTextFill=i,this.onThemeUpdated("bodyTextFill"))}get bodyTextHeight(){var i,e,t;return(t=(e=this._bodyTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextHeight)!=null?t:null}set bodyTextHeight(i){this._bodyTextHeight!==i&&(this._bodyTextHeight=i,this.onThemeUpdated("bodyTextHeight"))}get bodyTextSpacing(){var i,e,t;return(t=(e=this._bodyTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextSpacing)!=null?t:null}set bodyTextSpacing(i){this._bodyTextSpacing!==i&&(this._bodyTextSpacing=i,this.onThemeUpdated("bodyTextSpacing"))}get bodyTextAlign(){var i,e,t;return(t=(e=this._bodyTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.bodyTextAlign)!=null?t:0}set bodyTextAlign(i){this._bodyTextAlign!==i&&(this._bodyTextAlign=i,this.onThemeUpdated("bodyTextAlign"))}get checkboxLength(){var i,e,t;return(t=(e=this._checkboxLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxLength)!=null?t:12}set checkboxLength(i){this._checkboxLength!==i&&(this._checkboxLength=i,this.onThemeUpdated("checkboxLength"))}get checkboxInnerPadding(){var i,e,t;return(t=(e=this._checkboxInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.checkboxInnerPadding)!=null?t:2}set checkboxInnerPadding(i){this._checkboxInnerPadding!==i&&(this._checkboxInnerPadding=i,this.onThemeUpdated("checkboxInnerPadding"))}get inputBackgroundFill(){var i,e,t;return(t=(e=this._inputBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputBackgroundFill)!=null?t:"white"}set inputBackgroundFill(i){this._inputBackgroundFill!==i&&(this._inputBackgroundFill=i,this.onThemeUpdated("inputBackgroundFill"))}get inputSelectBackgroundFill(){var i,e,t;return(t=(e=this._inputSelectBackgroundFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputSelectBackgroundFill)!=null?t:"rgb(0,195,255)"}set inputSelectBackgroundFill(i){this._inputSelectBackgroundFill!==i&&(this._inputSelectBackgroundFill=i,this.onThemeUpdated("inputSelectBackgroundFill"))}get inputTextFont(){var i,e,t;return(t=(e=this._inputTextFont)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFont)!=null?t:"1rem monospace"}set inputTextFont(i){this._inputTextFont!==i&&(this._inputTextFont=i,this.onThemeUpdated("inputTextFont"))}get inputTextFill(){var i,e,t;return(t=(e=this._inputTextFill)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFill)!=null?t:"black"}set inputTextFill(i){this._inputTextFill!==i&&(this._inputTextFill=i,this.onThemeUpdated("inputTextFill"))}get inputTextFillDisabled(){var i,e,t;return(t=(e=this._inputTextFillDisabled)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillDisabled)!=null?t:"grey"}set inputTextFillDisabled(i){this._inputTextFillDisabled!==i&&(this._inputTextFillDisabled=i,this.onThemeUpdated("inputTextFillDisabled"))}get inputTextFillInvalid(){var i,e,t;return(t=(e=this._inputTextFillInvalid)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextFillInvalid)!=null?t:"red"}set inputTextFillInvalid(i){this._inputTextFillInvalid!==i&&(this._inputTextFillInvalid=i,this.onThemeUpdated("inputTextFillInvalid"))}get inputTextHeight(){var i,e,t;return(t=(e=this._inputTextHeight)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextHeight)!=null?t:null}set inputTextHeight(i){this._inputTextHeight!==i&&(this._inputTextHeight=i,this.onThemeUpdated("inputTextHeight"))}get inputTextSpacing(){var i,e,t;return(t=(e=this._inputTextSpacing)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextSpacing)!=null?t:null}set inputTextSpacing(i){this._inputTextSpacing!==i&&(this._inputTextSpacing=i,this.onThemeUpdated("inputTextSpacing"))}get inputTextInnerPadding(){var i,e,t;return(t=(e=this._inputTextInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextInnerPadding)!=null?t:2}set inputTextInnerPadding(i){this._inputTextInnerPadding!==i&&(this._inputTextInnerPadding=i,this.onThemeUpdated("inputTextInnerPadding"))}get inputTextMinWidth(){var i,e,t;return(t=(e=this._inputTextMinWidth)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextMinWidth)!=null?t:100}set inputTextMinWidth(i){this._inputTextMinWidth!==i&&(this._inputTextMinWidth=i,this.onThemeUpdated("inputTextMinWidth"))}get inputTextAlign(){var i,e,t;return(t=(e=this._inputTextAlign)!=null?e:(i=this._fallbackTheme)==null?void 0:i.inputTextAlign)!=null?t:0}set inputTextAlign(i){this._inputTextAlign!==i&&(this._inputTextAlign=i,this.onThemeUpdated("inputTextAlign"))}get blinkRate(){var i,e,t;return(t=(e=this._blinkRate)!=null?e:(i=this._fallbackTheme)==null?void 0:i.blinkRate)!=null?t:.8}set blinkRate(i){this._blinkRate!==i&&(this._blinkRate=i,this.onThemeUpdated("blinkRate"))}get cursorThickness(){var i,e,t;return(t=(e=this._cursorThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.cursorThickness)!=null?t:1}set cursorThickness(i){this._cursorThickness!==i&&(this._cursorThickness=i,this.onThemeUpdated("cursorThickness"))}get scrollBarThickness(){var i,e,t;return(t=(e=this._scrollBarThickness)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarThickness)!=null?t:8}set scrollBarThickness(i){this._scrollBarThickness!==i&&(this._scrollBarThickness=i,this.onThemeUpdated("scrollBarThickness"))}get scrollBarMinPercent(){var i,e,t;return(t=(e=this._scrollBarMinPercent)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPercent)!=null?t:.1}set scrollBarMinPercent(i){this._scrollBarMinPercent!==i&&(this._scrollBarMinPercent=i,this.onThemeUpdated("scrollBarMinPercent"))}get scrollBarMinPixels(){var i,e,t;return(t=(e=this._scrollBarMinPixels)!=null?e:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPixels)!=null?t:20}set scrollBarMinPixels(i){this._scrollBarMinPixels!==i&&(this._scrollBarMinPixels=i,this.onThemeUpdated("scrollBarMinPixels"))}get radioButtonLength(){var i,e,t;return(t=(e=this._radioButtonLength)!=null?e:(i=this._fallbackTheme)==null?void 0:i.radioButtonLength)!=null?t:12}set radioButtonLength(i){this._radioButtonLength!==i&&(this._radioButtonLength=i,this.onThemeUpdated("radioButtonLength"))}get radioButtonInnerPadding(){var i,e,t;return(t=(e=this._radioButtonInnerPadding)!=null?e:(i=this._fallbackTheme)==null?void 0:i.radioButtonInnerPadding)!=null?t:2}set radioButtonInnerPadding(i){this._radioButtonInnerPadding!==i&&(this._radioButtonInnerPadding=i,this.onThemeUpdated("radioButtonInnerPadding"))}};l(W,"BaseTheme");var hi=/[%a-zA-Z]+/,Gt=/[0-9]+(\.[0-9]+)?(%|cap|ch|ex|vmin|vmax|Q|r?em|r?lh|i[cn]|[cm]m|p[xct]|v[hwib])/,di=Math.PI*2,m=class extends W{constructor(e,t,r){super(r);this._enabled=!0;this._dirty=!0;this._layoutDirty=!0;this.width=0;this.height=0;this.x=0;this.y=0;this.idealWidth=0;this.idealHeight=0;this.idealX=0;this.idealY=0;this._flex=0;this._root=null;this._viewport=null;this._parent=null;this.tabFocusable=!1;this._cachedFont_bodyTextFont="";this._cachedLastFont_bodyTextFont="";this._cachedFont_inputTextFont="";this._cachedLastFont_inputTextFont="";this.needsClear=e,this.propagatesEvents=t}get flex(){return this._flex}set flex(e){e!==this._flex&&(this._flex=e,this._layoutDirty=!0)}set enabled(e){e!==this._enabled&&(this._enabled=e,this.forceDirty())}get enabled(){return this._enabled}set inheritedTheme(e){this.fallbackTheme=e}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){super.onThemeUpdated(e),this.needsClear&&(e===null||e==="canvasFill")&&(this._dirty=!0)}get dimensions(){return[this.width,this.height]}get idealDimensions(){return[this.idealWidth,this.idealHeight]}get position(){return[this.x,this.y]}get idealPosition(){return[this.idealX,this.idealY]}get bounds(){let e=this.x,t=this.y;return[e,e+this.width,t,t+this.height]}get idealBounds(){let e=this.idealX,t=this.idealY;return[e,e+this.idealWidth,t,t+this.idealHeight]}get rect(){return[this.x,this.y,this.width,this.height]}get idealRect(){return[this.idealX,this.idealY,this.idealWidth,this.idealHeight]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return this.width==0||this.height==0}onFocusGrabbed(e){}onFocusDropped(e){}handleEvent(e){return e.target===this?this:null}dispatchEvent(e){if(!this._enabled)return null;if(e.target===null){if(e instanceof P){if(e.x<this.x||e.y<this.y||e.x>=this.x+this.width||e.y>=this.y+this.height)return null}else if(e instanceof z){if(e.originallyRelativeTo===this)return this;if(!this.propagatesEvents)return null}}else if(e.target!==this&&!this.propagatesEvents)return null;let t=null;if(e.reversed&&(t=this.handleEvent(e)),e instanceof A)if(e.reachedRelative){if(this.tabFocusable&&(t===this||t===null))return this}else e.relativeTo===this&&(e.reachedRelative=!0);return e.reversed||(t=this.handleEvent(e)),t}handlePreLayoutUpdate(){}preLayoutUpdate(){this._enabled&&this.handlePreLayoutUpdate()}resolveDimensions(e,t,r,n){if(!this._enabled){this.width=0,this.height=0,this.idealWidth=0,this.idealHeight=0,this._layoutDirty=!1;return}if(e==1/0)throw new Error("minWidth must not be infinite");if(e>t&&(console.warn(`minWidth (${e}) must not be greater than maxWidth (${t}). Set minWidth to maxWidth. This may be caused by floating pointer precision errors`),e=t),e<0&&(console.warn(`minWidth (${e}) must not be lesser than 0. Set minWidth to 0. This may be caused by floating pointer precision errors`),e=0),r==1/0)throw new Error("minHeight must not be infinite");r>n&&(console.warn(`minHeight (${r}) must not be greater than maxHeight (${n}). Set minHeight to maxHeight. This may be caused by floating pointer precision errors`),r=n),r<0&&(console.warn(`minHeight (${r}) must not be lesser than 0. Set minHeight to 0. This may be caused by floating pointer precision errors`),r=0);let s=this.idealWidth,o=this.idealHeight;if(this.handleResolveDimensions(e,t,r,n),this.idealWidth<e?(this.idealWidth=e,console.error("Horizontal underflow in widget")):this.idealWidth>t&&(this.idealWidth=t,console.error("Horizontal overflow in widget")),this.idealWidth<0||!isFinite(this.idealWidth)||isNaN(this.idealWidth))throw new Error(`Disallowed width (${this.idealWidth}) in widget`);if(this.idealHeight<r?(this.idealHeight=r,console.error("Vertical underflow in widget")):this.idealHeight>n&&(this.idealHeight=n,console.error("Vertical overflow in widget")),this.idealHeight<0||!isFinite(this.idealHeight)||isNaN(this.idealHeight))throw new Error(`Disallowed height (${this.idealHeight}) in widget`);this._layoutDirty=!1,(s!==this.idealWidth||o!==this.idealHeight)&&(this._dirty=!0)}resolveDimensionsAsTop(e,t,r,n){this.resolveDimensions(e,t,r,n),(t===1/0||n===1/0)&&this.resolveDimensions(e,t===1/0?this.idealWidth:t,r,n===1/0?this.idealHeight:n)}afterPositionResolved(){}resolvePosition(e,t){this.idealX=e,this.idealY=t,this.afterPositionResolved()}finalizeBounds(){let[e,t]=this.viewport.effectiveScale,r=Math.floor(this.idealX*e)/e,n=Math.floor(this.idealY*t)/t,s=Math.ceil((this.idealX+this.idealWidth)*e)/e-r,o=Math.ceil((this.idealY+this.idealHeight)*t)/t-n;(r!==this.x||n!==this.y||s!==this.width||o!==this.height)&&(this._dirty=!0),this.x=r,this.y=n,this.width=s,this.height=o}handlePostFinalizeBounds(){}postFinalizeBounds(){this._enabled&&this.handlePostFinalizeBounds()}handlePostLayoutUpdate(){}postLayoutUpdate(){this._enabled&&this.handlePostLayoutUpdate()}clear(e,t,r,n,s=null){let o=this.viewport.context;o.save(),o.globalCompositeOperation="copy",o.fillStyle=s!=null?s:this.canvasFill,o.beginPath(),o.rect(e,t,r,n),o.clip(),o.fill(),o.restore()}clearStart(e=null){let t=this.viewport.context;t.save(),t.globalCompositeOperation="copy",t.fillStyle=e!=null?e:this.canvasFill,t.beginPath()}clearEnd(e="nonzero"){let t=this.viewport.context;t.clip(e),t.fill(),t.restore()}paintCircle(e,t,r){let n=this.viewport.context;n.beginPath(),n.arc(e,t,r,0,di),n.fill()}handlePainting(e){}paint(e=!1){if(this.dimensionless)return this.dryPaint();if(!(!this._dirty&&!e)){if(this._enabled){this.needsClear&&this.clear(this.x,this.y,this.width,this.height);let t=this.viewport.context;t.save(),this.handlePainting(e),t.restore()}this._dirty=!1}}dryPaint(){this._dirty=!1}forceThemeUpdate(){this.onThemeUpdated()}forceDirty(){this._dirty=!0,this._layoutDirty=!0}scaleFont(e,t){let r=e.search(Gt),n,s,o=0;if(r==-1)(r=e.search("xx-small"))!==-1?(s=.5625*t,o=8):(r=e.search("x-small"))!==-1?(s=.625*t,o=7):(r=e.search("small"))!==-1?(s=.8333*t,o=5):(r=e.search("medium"))!==-1?(s=t,o=6):(r=e.search("large"))!==-1?(s=1.125*t,o=5):(r=e.search("x-large"))!==-1?(s=1.5*t,o=7):(r=e.search("xx-large"))!==-1?(s=2*t,o=8):(r=e.search("smaller"))!==-1?(s=.8333*t,o=7):(r=e.search("larger"))!==-1?(s=1.125*t,o=6):s=t,n="rem";else{let a=e.match(Gt);if(a===null)throw new Error("Unexpected null font-size match");let d=a[0];o=d.length;let u=d.match(hi);if(u===null)throw new Error("Unexpected null font-size suffix match");n=u[0],s=parseFloat(d)*t}return e.substring(0,r)+s.toString()+n+e.substring(r+o,e.length)}get active(){return this._root!==null}get root(){if(!this.active)throw new Error("Cannot get root; Widget is not active");return this._root}get viewport(){if(!this.active)throw new Error("Cannot get viewport; Widget is not active");return this._viewport}get parent(){if(!this.active)throw new Error("Cannot get parent; Widget is not active");return this._parent}activate(e,t,r){if(this.active)throw new Error("Attempt to activate active Widget");this._root=e,this._viewport=t,this._parent=r,this.forceDirty()}deactivate(){if(!this.active)throw new Error("Attempt to deactivate inactive Widget");this._root=null,this._viewport=null,this._parent=null}autoScroll(){this.root.dispatchEvent(new z(this,[0,this.idealWidth,0,this.idealHeight]))}get containerPadding(){var r,n;let e=super.containerPadding,t=(n=(r=this._root)==null?void 0:r.resolution)!=null?n:1;return{left:e.left*t,right:e.right*t,top:e.top*t,bottom:e.bottom*t}}set containerPadding(e){super.containerPadding=e}get multiContainerSpacing(){var e,t;return super.multiContainerSpacing*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set multiContainerSpacing(e){super.multiContainerSpacing=e}get sliderMinLength(){var e,t;return super.sliderMinLength*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set sliderMinLength(e){super.sliderMinLength=e}get sliderThickness(){var e,t;return super.sliderThickness*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set sliderThickness(e){super.sliderThickness=e}get bodyTextFont(){var t,r;let e=super.bodyTextFont;return e!==this._cachedLastFont_bodyTextFont&&(this._cachedLastFont_bodyTextFont=e,this._cachedFont_bodyTextFont=this.scaleFont(e,(r=(t=this._root)==null?void 0:t.resolution)!=null?r:1)),this._cachedFont_bodyTextFont}set bodyTextFont(e){super.bodyTextFont=e}get bodyTextHeight(){var t,r;let e=super.bodyTextHeight;return e===null?e:e*((r=(t=this._root)==null?void 0:t.resolution)!=null?r:1)}set bodyTextHeight(e){super.bodyTextHeight=e}get bodyTextSpacing(){var t,r;let e=super.bodyTextSpacing;return e===null?e:e*((r=(t=this._root)==null?void 0:t.resolution)!=null?r:1)}set bodyTextSpacing(e){super.bodyTextSpacing=e}get checkboxLength(){var e,t;return super.checkboxLength*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set checkboxLength(e){super.checkboxLength=e}get checkboxInnerPadding(){var e,t;return super.checkboxInnerPadding*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set checkboxInnerPadding(e){super.checkboxInnerPadding=e}get inputTextFont(){var t,r;let e=super.inputTextFont;return e!==this._cachedLastFont_inputTextFont&&(this._cachedLastFont_inputTextFont=e,this._cachedFont_inputTextFont=this.scaleFont(e,(r=(t=this._root)==null?void 0:t.resolution)!=null?r:1)),this._cachedFont_inputTextFont}set inputTextFont(e){super.inputTextFont=e}get inputTextHeight(){var t,r;let e=super.inputTextHeight;return e===null?e:e*((r=(t=this._root)==null?void 0:t.resolution)!=null?r:1)}set inputTextHeight(e){super.inputTextHeight=e}get inputTextSpacing(){var t,r;let e=super.inputTextSpacing;return e===null?e:e*((r=(t=this._root)==null?void 0:t.resolution)!=null?r:1)}set inputTextSpacing(e){super.inputTextSpacing=e}get inputTextInnerPadding(){var e,t;return super.inputTextInnerPadding*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set inputTextInnerPadding(e){super.inputTextInnerPadding=e}get inputTextMinWidth(){var e,t;return super.inputTextMinWidth*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set inputTextMinWidth(e){super.inputTextMinWidth=e}get cursorThickness(){var e,t;return super.cursorThickness*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set cursorThickness(e){super.cursorThickness=e}get scrollBarThickness(){var e,t;return super.scrollBarThickness*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set scrollBarThickness(e){super.scrollBarThickness=e}get scrollBarMinPixels(){var e,t;return super.scrollBarMinPixels*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set scrollBarMinPixels(e){super.scrollBarMinPixels=e}get radioButtonLength(){var e,t;return super.radioButtonLength*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set radioButtonLength(e){super.radioButtonLength=e}get radioButtonInnerPadding(){var e,t;return super.radioButtonInnerPadding*((t=(e=this._root)==null?void 0:e.resolution)!=null?t:1)}set radioButtonInnerPadding(e){super.radioButtonInnerPadding=e}};l(m,"Widget");var ke=class extends m{constructor(e,t,r,n){super(t,r,n);this._children=[...e]}set inheritedTheme(e){super.inheritedTheme=e;for(let t of this.children)t.inheritedTheme=e}get inheritedTheme(){return super.inheritedTheme}dryPaint(){super.dryPaint();for(let e of this.children)e.dryPaint()}forceDirty(){super.forceDirty();for(let e of this.children)e.forceDirty()}get childCount(){return this._children.length}get children(){return this._children.values()}activate(e,t,r){super.activate(e,t,r);for(let n of this.children)n.activate(e,t,this)}deactivate(){super.deactivate();for(let e of this.children)e.deactivate()}finalizeBounds(){super.finalizeBounds();for(let e of this.children)e.finalizeBounds()}};l(ke,"Parent");var Ie=class extends ke{add(i){if(Array.isArray(i)){let e=this.active;for(let t of i)this._children.push(t),t.inheritedTheme=this.inheritedTheme,e&&t.activate(this.root,this.viewport,this)}else this._children.push(i),i.inheritedTheme=this.inheritedTheme,this.active&&i.activate(this.root,this.viewport,this);return this.forceDirty(),this}remove(i){if(Array.isArray(i)){let e=this.active;for(let t of i){let r=this._children.indexOf(t);r!==-1&&this._children.splice(r,1),e&&t.deactivate()}}else{let e=this._children.indexOf(i);e!==-1&&this._children.splice(e,1),this.active&&i.deactivate()}return this.forceDirty(),this}clearChildren(){if(this.active)for(let i of this._children)i.deactivate();return this._children.length=0,this.forceDirty(),this}};l(Ie,"MultiParent");var le=class extends Ie{constructor(e,t){super([],!1,!0,t);this.backgroundDirty=!0;this.unusedSpace=0;this.enabledChildCount=0;this.vertical=e}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="multiContainerAlignment"?this._layoutDirty=!0:e==="multiContainerSpacing"&&(this._layoutDirty=!0)}handleEvent(e){let t=this.children;e.reversed&&(t=Array.from(t).reverse());for(let r of t){if(!r.enabled)continue;let n=r.dispatchEvent(e);if(n!==null)return n}return null}handlePreLayoutUpdate(){for(let e of this.children)e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostFinalizeBounds(){for(let e of this.children)e.postFinalizeBounds(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){for(let e of this.children)e.postLayoutUpdate(),e.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=0,o=0,a=0,d=this.vertical?n:t;this.multiContainerAlignment.cross==="stretch"&&(a=this.vertical?t:n,a==1/0&&(a=this.vertical?e:r)),this.enabledChildCount=0;for(let T of this.children){if(!T.enabled){T.resolveDimensions(0,0,0,0);continue}this.enabledChildCount++;let[M,H]=T.idealDimensions;this.vertical?T.resolveDimensions(a,t,0,1/0):T.resolveDimensions(0,1/0,a,n);let[B,Y]=T.idealDimensions;s+=T.flex,o=Math.max(this.vertical?B:Y,o),(B!==M||Y!==H)&&(this.backgroundDirty=!0)}let c=this.vertical?e:r;o<c&&(o=c);let p=this.multiContainerSpacing,f=Math.max(this.enabledChildCount-1,0)*p;for(let T of this.children)!T.enabled||(f+=this.vertical?T.idealDimensions[1]:T.idealDimensions[0]);let g=d-f;if(g==1/0||g<=0){let T=this.idealWidth,M=this.idealHeight;this.vertical?(this.idealWidth=o,this.idealHeight=Math.min(f,n)):(this.idealWidth=Math.min(f,t),this.idealHeight=o),(this.idealWidth!==T||this.idealHeight!==M)&&(this.backgroundDirty=!0),this.unusedSpace=0;let H=d;for(let B of this.children){if(!B.enabled)continue;let[Y,be]=B.idealDimensions;if(this.vertical){let X=Math.min(H,be);B.resolveDimensions(a,t,X,X)}else{let X=Math.min(H,Y);B.resolveDimensions(X,X,a,n)}let[se,it]=B.idealDimensions;(se!==Y||it!==be)&&(this.backgroundDirty=!0);let rt=this.vertical?be:Y;H=Math.max(0,H-rt-p)}return}let b=0,w=0;s>0&&(w=g/s);for(let T of this.children){if(!T.enabled)continue;b!==0&&(b+=p);let M=w*T.flex,[H,B]=T.idealDimensions;if(this.vertical){let se=M+B;T.resolveDimensions(a,t,se,se)}else{let se=M+H;T.resolveDimensions(se,se,a,n)}let[Y,be]=T.idealDimensions;b+=this.vertical?be:Y,(Y!==H||be!==B)&&(this.backgroundDirty=!0)}let x=this.idealWidth,_=this.idealHeight,y;this.vertical?(y=n,this.idealWidth=o,this.idealHeight=y):(y=t,this.idealWidth=y,this.idealHeight=o),(this.idealWidth!==x||this.idealHeight!==_)&&(this.backgroundDirty=!0),this.unusedSpace=Math.max(y-b,0)}afterPositionResolved(){let e=this.multiContainerAlignment,t=e.main==="around",r=e.main==="between"||t,n=r?0:e.main,s=e.cross==="stretch"?0:e.cross,o=this.enabledChildCount-1+(t?2:0),a;o<=0?a=0:a=this.unusedSpace/o;let d=this.multiContainerSpacing;r&&(d+=a);let u=(this.vertical?this.idealY:this.idealX)+n*this.unusedSpace;t&&(u+=a);for(let c of this.children){if(!c.enabled)continue;let[p,f]=c.idealPosition,[g,b]=c.idealDimensions;this.vertical?(c.resolvePosition(this.idealX+s*(this.idealWidth-g),u),u+=b+d):(c.resolvePosition(u,this.idealY+s*(this.idealHeight-b)),u+=g+d);let[w,x]=c.idealPosition;(w!==p||x!==f)&&(this.backgroundDirty=!0)}}handlePainting(e){let t=[];for(let r of this.children)r.paint(e),r.enabled&&(this.backgroundDirty||e)&&t.push(r.rect);if(this.backgroundDirty||e){this.clearStart();let r=this.viewport.context;r.rect(...this.rect);for(let n of t)r.rect(...n);this.clearEnd("evenodd")}this.backgroundDirty=!1}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(){super.forceDirty(),this.backgroundDirty=!0}};l(le,"MultiContainer");var ae=class extends ke{constructor(i,e,t,r){super([i],e,t,r)}get child(){return this._children[0]}};l(ae,"SingleParent");var he=class extends ae{constructor(e,t,r){super(e,!1,t,r);this.backgroundDirty=!0}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this.backgroundDirty=!0):e==="canvasFill"?this.backgroundDirty=!0:e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}handleEvent(e){return this.child.dispatchEvent(e)}handlePreLayoutUpdate(){let e=this.child;e.preLayoutUpdate(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostFinalizeBounds(){let e=this.child;e.postFinalizeBounds(),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let e=this.child;e.postLayoutUpdate(),e.dirty&&(this._dirty=!0),this.backgroundDirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.containerPadding,o=s.left+s.right,a=s.top+s.bottom,d=t-o,u=n-a;d<0&&(d=0),u<0&&(u=0);let c=this.containerAlignment,p=0;c.horizontal==="stretch"&&(d!==1/0?p=d:p=Math.max(e-o,0));let f=0;c.vertical==="stretch"&&(u!==1/0?f=u:f=Math.max(r-a,0));let[g,b]=this.child.idealDimensions;this.child.resolveDimensions(p,d,f,u);let[w,x]=this.child.idealDimensions,[_,y]=[this.idealWidth,this.idealHeight];this.idealWidth=Math.max(e,w+o),this.idealHeight=Math.max(r,x+a),(this.idealWidth!==_||this.idealHeight!==y||w!==g||x!==b)&&(this.backgroundDirty=!0)}afterPositionResolved(){let e=this.containerPadding,t=this.containerAlignment,[r,n]=this.child.idealDimensions,s=r+e.left+e.right,o=n+e.top+e.bottom,a=this.idealX+e.left;if(t.horizontal!=="stretch"){let p=this.idealWidth-s;p>0&&(a+=p*t.horizontal)}let d=this.idealY+e.top;if(t.vertical!=="stretch"){let p=this.idealHeight-o;p>0&&(d+=p*t.vertical)}let[u,c]=this.child.idealPosition;this.child.resolvePosition(a,d),(u!==a||c!==d)&&(this.backgroundDirty=!0)}handleBaseContainerPainting(e,t=null){if(this.backgroundDirty||e){this.clearStart(t);let r=this.viewport.context;r.rect(...this.rect),r.rect(...this.child.rect),this.clearEnd("evenodd"),this.backgroundDirty=!1}this.child.paint(e)}handlePainting(e){this.handleBaseContainerPainting(e)}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(){super.forceDirty(),this.backgroundDirty=!0}};l(he,"BaseContainer");var E=(t=>(t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard",t[t.Tab=2]="Tab",t))(E||{});var $t=(t=>(t[t.Pixel=0]="Pixel",t[t.Line=1]="Line",t[t.Page=2]="Page",t))($t||{});function Nt(h){switch(h){case 0:return 0;case 1:return 1;case 2:return 2;default:return null}}l(Nt,"parseDOMDeltaMode");var $=class extends P{constructor(e,t,r,n,s,o,a,d,u,c,p=null){super(e,t,d,u,c,p,0);this.deltaX=r,this.deltaY=n,this.deltaZ=s,this.deltaMode=o,this.fromDrag=a}correctOffset(e,t){return new $(this.x-e,this.y-t,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(e){return new $(this.x,this.y,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,e)}getDeltaPixels(e,t,r,n,s=0){let o=1/0,a=1/0,d=1/0;if(e||this.deltaMode!==2){let u=t*$.PageLinesError;o=r-Math.min(r*$.PagePercentError,u),a=n-Math.min(n*$.PagePercentError,u),d=s-Math.min(s*$.PagePercentError,u)}switch(this.deltaMode){case 0:return[Math.min(o,Math.abs(this.deltaX))*Math.sign(this.deltaX),Math.min(a,Math.abs(this.deltaY))*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ))*Math.sign(this.deltaZ)];case 1:return[Math.min(o,Math.abs(this.deltaX)*t)*Math.sign(this.deltaX),Math.min(a,Math.abs(this.deltaY)*t)*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ)*t)*Math.sign(this.deltaZ)];case 2:{let u=t*$.PageLinesError;return[(Math.abs(this.deltaX)*r-Math.min(r*$.PagePercentError,u))*Math.sign(this.deltaX),(Math.abs(this.deltaY)*n-Math.min(n*$.PagePercentError,u))*Math.sign(this.deltaY),(Math.abs(this.deltaZ)*s-Math.min(s*$.PagePercentError,u))*Math.sign(this.deltaZ)]}default:throw new Error(`Unknown PointerWheelMode value: ${this.deltaMode}`)}}},D=$;l(D,"PointerWheel"),D.PageLinesError=3,D.PagePercentError=.1;var N=class extends xe{constructor(e,t,r,n,s){super(t,r,n,s,1,!0);this.key=e}};l(N,"KeyEvent");var L=class extends N{cloneWithTarget(i){return new L(this.key,this.shift,this.ctrl,this.alt,i)}};l(L,"KeyPress");var S=class extends O{constructor(i=null){super(i,0,!0)}cloneWithTarget(i){return new S(i)}};l(S,"Leave");var R=class extends W{constructor(e,t){super(e,t);this.subscribers=new Set}get fallbackTheme(){return super.fallbackTheme}set fallbackTheme(e){super.fallbackTheme=e}onThemeUpdated(e=null){for(let t of this.subscribers)t(e)}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}};l(R,"Theme");function bt(h,i=!0){return Math.pow(2,(i?Math.ceil:Math.floor)(Math.log2(h)))}l(bt,"roundToPower2");function yt(h){return(h&h-1)===0}l(yt,"isPower2");var we=class{constructor(i,e=64,t=64){this.constraints=[0,1/0,0,1/0];this.maxCanvasWidth=1/0;this.maxCanvasHeight=1/0;this._dirty=!0;this.child=i,this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t;let r=this.canvas.getContext("2d",{alpha:!0});if(r===null)throw new Error("Failed to get canvas context");this.context=r}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}resolveChildsLayout(){let i=0;if(!this.child.layoutDirty&&!this._dirty&&(this.child.postFinalizeBounds(),i++,!this.child.layoutDirty))return!1;this._dirty=!1;let[e,t]=this.child.dimensions,r=e,n=t,s=!1;for(;this.child.layoutDirty;){if(i>we.maxRelayout){console.warn("Maximum re-layouts exceeded. Is there a Widget type that is immediately marking the layout as dirty after resolving it?");break}let[o,a,d,u]=this.constraints;this.child.resolveDimensionsAsTop(o,a,d,u),this.child.resolvePosition(0,0),[r,n]=this.child.idealDimensions;let[c,p]=this.getAppliedScaleFrom(r,n);r=Math.round(r*c)/c,n=Math.round(n*p)/p,s=r!==e||n!==t,this.child.finalizeBounds(),this.child.postFinalizeBounds(),i++}if(i>1&&console.warn(`The last frame required ${i-1} re-layouts. Make sure to only mark a layout as dirty while resolving the layout unless absolutely necessary`),s){let o=Math.min(Math.max(bt(r),this.canvas.width),this.maxCanvasWidth),a=Math.min(Math.max(bt(n),this.canvas.height),this.maxCanvasHeight);if(o===0||a===0?we.dimensionlessWarned||(we.dimensionlessWarned=!0,console.warn("Canvas has 0 width or height. Are you using an empty Root?")):(!yt(o)||!yt(a))&&(we.powerOf2Warned||(we.powerOf2Warned=!0,console.warn("Canvas has a width or height that is not a power of 2, which may create mipmapping issues. Make sure to use power of 2 starting and maximum canvas dimensions."))),o!==this.canvas.width||a!==this.canvas.height){let d=this.canvas.width,u=this.canvas.height,c=null;if(d!==0&&u!==0){c=document.createElement("canvas"),c.width=d,c.height=u;let p=c.getContext("2d");if(p===null)throw new Error("Failed to get context of temporary canvas for resizing original canvas");p.globalCompositeOperation="copy",p.drawImage(this.canvas,0,0,d,u,0,0,d,u)}this.canvas.width=o,this.canvas.height=a,c!==null&&(this.context.globalCompositeOperation="copy",this.context.drawImage(c,0,0,c.width,c.height,0,0,Math.min(c.width,this.maxCanvasWidth),Math.min(c.height,this.maxCanvasHeight)),this.context.globalCompositeOperation="source-over")}}return s}getAppliedScaleFrom(i,e){let t=1,r=1;return i>this.maxCanvasWidth&&(t=this.maxCanvasWidth/i),e>this.maxCanvasHeight&&(r=this.maxCanvasHeight/e),[t,r]}get effectiveScale(){return this.getAppliedScaleFrom(...this.child.dimensions)}paintToCanvas(i){let e=this.child.dirty,[t,r]=this.effectiveScale,n=t!==1||r!==1;return n&&(this.context.save(),this.context.scale(t,r)),this.child.paint(i),n&&this.context.restore(),e}},U=we;l(U,"Viewport"),U.dimensionlessWarned=!1,U.powerOf2Warned=!1,U.maxRelayout=4,k([lt()],U.prototype,"constraints",2),k([Te],U.prototype,"maxCanvasWidth",2),k([Te],U.prototype,"maxCanvasHeight",2);var at=class{constructor(i,e=null,t=new R){this.drivers=new Set;this._enabled=!0;this.pointerStyle="default";this._currentPointerStyle="default";this._foci=new Map([[1,null],[0,null],[2,null]]);this._fociCapturers=new Map([[1,null],[0,null],[2,null]]);this.textInputHandler=null;this._mobileTextInUse=!1;this._resolution=1;this.viewport=new U(i),this.pointerStyleHandler=e,this.child.inheritedTheme=t,this.child.activate(this,this.viewport,null)}get constraints(){return this.viewport.constraints}set constraints(i){this.viewport.constraints=i}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(i){if(this._enabled!==i)if(this._enabled=i,i)for(let t of this.drivers)t.onEnable(this);else{for(let t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(let t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){return this.enabled?this.viewport.resolveChildsLayout():!1}paint(){return this.enabled?this.viewport.paintToCanvas(!1):!1}dispatchEvent(i){if(!this.enabled)return!1;if(i.focusType!==null&&i.target===null){let r=this._foci.get(i.focusType);if(typeof r=="undefined"&&(r=null),i.needsFocus&&r===null)return i instanceof L&&i.key==="Tab"&&this.dispatchEvent(new A(this.getFocus(2),i.shift)),!1;i=i.cloneWithTarget(r)}(i instanceof P&&!(i instanceof D)||i instanceof S)&&(this.pointerStyle="default");let e=this.child.dispatchEvent(i);if(e===null&&(i instanceof L&&(i.key==="Tab"?this.dispatchEvent(new A(this.getFocus(2),i.shift)):i.key==="Escape"&&this.clearFocus(1)),i instanceof A&&i.relativeTo!==null&&(i=new A(null,i.reversed),e=this.child.dispatchEvent(i))),i instanceof A&&(i.reachedRelative&&e===null&&(e=this.child.dispatchEvent(i)),e&&(!i.reachedRelative&&!at.badTabCaptureWarned&&(at.badTabCaptureWarned=!0,console.warn(`TabSelect event captured by widget (${e.constructor.name}), but reachedRelative was false; a widget type is probably capturing events by default`),console.groupCollapsed("Stack trace"),console.trace(),console.groupEnd()),this.requestFocus(2,e))),i.focusType===null)return e!==null;let t=this.getFocusCapturer(i.focusType);if(t===e)return e!==null;i.focusType===0&&t!==null&&this.child.dispatchEvent(new S(t)),this._fociCapturers.set(i.focusType,e);for(let r of this.drivers)r.onFocusCapturerChanged(this,i.focusType,t,e);return e!==null}preLayoutUpdate(){if(!!this.enabled){for(let i of this.drivers)i.update(this);this.child.preLayoutUpdate()}}postLayoutUpdate(){!this.enabled||(this.child.postLayoutUpdate(),this.updatePointerStyle())}updatePointerStyle(i=null){i!==null&&(this.pointerStyle=i),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,this.pointerStyleHandler!==null&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(i,e){if(e!==null){let t=this._foci.get(i);if(e!==t){this.clearFocus(i),this._foci.set(i,e),e.onFocusGrabbed(i);for(let n of this.drivers)n.onFocusChanged(this,i,e)}let r=null;if(i===1&&(r=2),i===2&&(r=1),r!==null&&e!==this._foci.get(r)){this.clearFocus(r),this._foci.set(r,e),e.onFocusGrabbed(r);for(let n of this.drivers)n.onFocusChanged(this,r,e)}}}dropFocus(i,e){let t=this._foci.get(i);e===t&&this.clearFocus(i)}clearFocus(i){let e=this._foci.get(i);if(e){e.onFocusDropped(i),this._foci.set(i,null);for(let t of this.drivers)t.onFocusChanged(this,i,null)}}getFocus(i){var e;return(e=this._foci.get(i))!=null?e:null}getFocusCapturer(i){var e;return(e=this._fociCapturers.get(i))!=null?e:null}registerDriver(i){this.drivers.has(i)||(this.drivers.add(i),this._enabled&&i.onEnable&&i.onEnable(this))}unregisterDriver(i){!this.drivers.delete(i)||this._enabled&&i.onDisable&&i.onDisable(this)}clearDrivers(){for(let i of this.drivers)this.unregisterDriver(i)}get hasMobileTextInput(){return this.textInputHandler!==null&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(i=""){return At(this,null,function*(){if(this.textInputHandler!==null&&!this._mobileTextInUse){this._mobileTextInUse=!0;let e=yield this.textInputHandler(i);return this._mobileTextInUse=!1,e}return null})}get resolution(){return this._resolution}set resolution(i){this._resolution!==i&&(this._resolution=i,this.child.forceThemeUpdate())}get maxCanvasWidth(){return this.viewport.maxCanvasWidth}set maxCanvasWidth(i){this.viewport.maxCanvasWidth=i}get maxCanvasHeight(){return this.viewport.maxCanvasHeight}set maxCanvasHeight(i){this.viewport.maxCanvasHeight=i}get effectiveScale(){return this.viewport.effectiveScale}get child(){return this.viewport.child}},F=at;l(F,"Root"),F.badTabCaptureWarned=!1;var V=new Map;function ye(h){let i=V.get(h);return i===void 0?(console.warn(`Unknown debug feature "${h}"; defaulting to not enabled`),!1):i[0]}l(ye,"isDebugFeatureEnabled");function ui(h,i){let e=V.get(h);if(e===void 0){console.warn(`Unknown debug feature "${h}"; ignored`);return}let[t,r]=e;i===void 0&&(i=!t),t!==i&&(e[0]=i,console.info(`[canvas-ui] ${i?"En":"Dis"}abled "${h}" debug feature`))}l(ui,"toggleDebugFeature");function ci(){for(let[h,i]of V)console.info(`[canvas-ui] "${h}" (${i[0]?"en":"dis"}abled): ${i[1]}`)}l(ci,"listDebugFeatures");function ht(h,i){let e=`${h.name}.${i}`,t=`watchflag.${e}`;if(V.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=`watchflag.${e}.strace`;if(V.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=new WeakMap;Object.defineProperty(h.prototype,i,{get(){return n.get(this)},set(s){if(ye(t)&&!n.get(this)&&s){let a=`[canvas-ui ${t}] ${this.constructor.name}.${i} set to true`;ye(r)?(console.groupCollapsed(a),console.trace(),console.groupEnd()):console.debug(a)}n.set(this,s)}}),V.set(t,[!1,`Show when ${e} is set to true`]),V.set(r,[!1,`Print stack trace when ${t} shows that a flag has been set`])}l(ht,"injectWatchflagFeature");function dt(h,i,e=null){let t=`${h.name}.${i}`,r=`trace.${t}`;if(V.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=[],s=new Map,o=h.prototype[i],a=0;function d(){a===0&&(ye(r)&&console.debug(`[canvas-ui ${r}] Trace:
${n.join(`
`)}`),a=0,n.length=0,s.clear())}l(d,"logMsgStack"),h.prototype[i]=function(...u){a++;let c=s.get(this);if(c===void 0){c=n.length,s.set(this,c);let f;a>1?f="  ".repeat(a-2)+"> ":f="",n.push(`${f}${this.constructor.name}`)}else n[c]+=", recall";e!==null&&(n[c]+=e.apply(this,u));let p=new Date().getTime();try{let f=o.apply(this,u);return n[c]+=` <${new Date().getTime()-p} ms>`,f}catch(f){throw n[c]+=" <exception thrown>",f}finally{a--,d()}},V.set(r,[!1,`Trace ${t} method calls`])}l(dt,"injectTraceFeature");function Q(h,i){let e=`${h.name}.${i}`,t=`randomfill.${e}`;if(V.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=Object.getOwnPropertyDescriptor(h.prototype,i);Object.defineProperty(h.prototype,i,{get(){if(ye(t))return"#"+Math.floor(Math.random()*16777215).toString(16);if((r==null?void 0:r.get)!==void 0)return r.get.apply(this)},set(n){(r==null?void 0:r.set)!==void 0&&r.set.apply(this,[n])}}),V.set(t,[!1,`(EPILEPSY WARNING) Override the ${e} theme property with a new random colour every time the theme property's value is fetched. Useful for visualising widget painting`])}l(Q,"injectRandomFillFeature");function v(h,i){let e=`${h.name}.${i}`,t=`stacktrace.${e}`;if(V.has(t)){console.warn(`[canvas-ui] Already injected debug feature with name ${t}; ignored`);return}let r=h.prototype[i];h.prototype[i]=function(...n){return ye(t)&&(console.groupCollapsed(`[canvas-ui ${t}] ${h.name}.${i} called`),console.trace(),console.groupEnd()),r.apply(this,n)},V.set(t,[!1,`Print stack trace when ${e} is called`])}l(v,"injectStackTraceFeature");function ut(h,i){let e=Math.abs(h)%1;return e<i?!0:e>1-i}l(ut,"isWhole");var zt=!1;function $r(){if(zt){console.warn("[canvas-ui] Already injected debug code; ignored");return}zt=!0,dt(m,"paint",c=>c?" (forced)":""),dt(m,"resolveDimensions",(c,p,f,g)=>` (${c}, ${p}, ${f}, ${g})`),dt(m,"resolvePosition",(c,p)=>` (${c}, ${p})`),dt(m,"dispatchEvent",c=>` (${c.constructor.name})`),v(F,"resolveLayout"),v(F,"paint"),v(F,"dispatchEvent"),v(F,"preLayoutUpdate"),v(F,"postLayoutUpdate"),v(F,"updatePointerStyle"),v(F,"requestFocus"),v(F,"dropFocus"),v(F,"clearFocus"),v(F,"getFocus"),v(F,"getFocusCapturer"),v(F,"registerDriver"),v(F,"unregisterDriver"),v(F,"clearDrivers"),v(F,"getTextInput"),v(m,"onThemeUpdated"),v(m,"onFocusDropped"),v(m,"handleEvent"),v(m,"dispatchEvent"),v(m,"handlePreLayoutUpdate"),v(m,"preLayoutUpdate"),v(m,"handleResolveDimensions"),v(m,"resolveDimensions"),v(m,"resolveDimensionsAsTop"),v(m,"afterPositionResolved"),v(m,"resolvePosition"),v(m,"handlePostLayoutUpdate"),v(m,"postLayoutUpdate"),v(m,"clear"),v(m,"clearStart"),v(m,"clearEnd"),v(m,"roundRect"),v(m,"handlePainting"),v(m,"paint"),v(m,"dryPaint"),v(m,"forceThemeUpdate"),v(m,"forceDirty"),v(m,"scaleFont"),ht(m,"_dirty"),ht(m,"_layoutDirty"),ht(he,"backgroundDirty"),ht(le,"backgroundDirty"),Q(W,"canvasFill"),Q(W,"primaryFill"),Q(W,"accentFill"),Q(W,"backgroundFill"),Q(W,"backgroundGlowFill"),Q(W,"bodyTextFill"),Q(W,"inputBackgroundFill"),Q(W,"inputSelectBackgroundFill"),Q(W,"inputTextFill"),Q(W,"inputTextFillDisabled"),Q(W,"inputTextFillInvalid"),V.set("textrendergroups",[!1,"Draw text render groups in a TextHelper with alternating background colours (green and red). Width overriding groups have a blue background and zero-width groups have a black background. Throws an exception on negative width groups"]);let h=new Map,i=C.prototype.paint;C.prototype.paint=function(c,p,f,g){h.set(this,!1),i.apply(this,[c,p,f,g])};let e=C.prototype.paintGroup;C.prototype.paintGroup=function(c,p,f,g,b){if(ye("textrendergroups")){let w=c.fillStyle,x=this.actualLineHeight,_=this.fullLineHeight;if(!p[3]&&p[2]>f){let y=h.get(this);c.fillStyle=y?"rgba(255, 0, 0, 0.5)":"rgba(0, 255, 0, 0.5)",c.fillRect(g,b-x,p[2]-f,_),h.set(this,!y),c.fillStyle=w}else{let y=p[2]-f;if(c.fillStyle=y>0?"rgba(0, 0, 255, 0.5)":"rgba(0, 0, 0, 0.5)",y==0)y=4;else if(y<0)throw new Error("Unexpected group with negative width");c.fillRect(g,b-x,y,_)}}e.apply(this,[c,p,f,g,b])},V.set("warnsubpixels",[!1,"Print a console warning whenever a Widget is detected to have non-integer width, height, x or y. Only warned once per Widget type"]);let t=new Set,r=new Set,n=new Set,s=new Set,o='[canvas-ui warnsubpixels] Widget type "',a='" has a non-integer ',d=", which will create clipping issues due to subpixels. This message won't be shown again for this widget type",u=m.prototype.finalizeBounds;m.prototype.finalizeBounds=function(){u.apply(this);let c=this.constructor.name;if(ye("warnsubpixels")){let[p,f]=this.root.effectiveScale,[g,b]=this.position;!ut(g*p,1e-10)&&!t.has(c)&&(t.add(c),console.warn(`${o}${c}${a}X coordinate (${g})${d}`)),!ut(b*f,1e-10)&&!r.has(c)&&(r.add(c),console.warn(`${o}${c}${a}Y coordinate (${b})${d}`));let[w,x]=this.dimensions;!ut(w*p,1e-10)&&!n.has(c)&&(n.add(c),console.warn(`${o}${c}${a}width (${w})${d}`)),!ut(x*f,1e-10)&&!s.has(c)&&(s.add(c),console.warn(`${o}${c}${a}height (${x})${d}`))}},window.canvasDebug={enabled:ye,toggle:ui,list:ci},console.info("[canvas-ui] Injected debug code; the library will be slower"),console.info("[canvas-ui] Check if a debug feature is enabled in the console with canvasDebug.enabled(debugFeature: string)"),console.info("[canvas-ui] Enable a debug feature in the console with canvasDebug.toggle(debugFeature: string, enabled?: boolean)"),console.info("[canvas-ui] List debug features in the console with canvasDebug.list()")}l($r,"injectDebugCode");function zr(h){return new Promise((i,e)=>{function t(){document.body.removeChild(a),document.body.removeChild(o)}l(t,"closePopup");function r(){t(),i(h)}l(r,"cancelHandler");function n(){t(),i(u.value)}l(n,"okHandler");function s(g){g.key=="Enter"&&(g.preventDefault(),n())}l(s,"enterChecker");let o=document.createElement("div");o.id="textInputHandlerOverlay";let a=document.createElement("div");a.id="textInputHandler";let d=document.createElement("p");d.textContent="Change text:";let u=document.createElement("input");u.addEventListener("keyup",s),u.value=h;let c=document.createElement("div"),p=document.createElement("button");p.addEventListener("click",r),p.textContent="Cancel";let f=document.createElement("button");f.addEventListener("click",n),f.textContent="OK",c.appendChild(p),c.appendChild(f),a.appendChild(d),a.appendChild(u),a.appendChild(c),document.body.appendChild(o),document.body.appendChild(a),u.focus({preventScroll:!1})})}l(zr,"DefaultTextInputHandler");var de=class extends O{constructor(e,t=null){super(t,1,!1);this.text=e}cloneWithTarget(e){return new de(this.text,e)}};l(de,"TextPasteEvent");var Oe=class extends F{constructor(e,t=new R){super(e,null,t);this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,this.updateDOMDims();let r=this.domElem.getContext("2d",{alpha:!0});if(r===null)throw new Error("Failed to get DOM canvas context");this.domCanvasContext=r,this.pointerStyleHandler=n=>{this.domElem.style.cursor=n},this.domElem.addEventListener("paste",n=>{n.preventDefault(),n.clipboardData!==null&&this.dispatchEvent(new de(n.clipboardData.getData("text")))}),this.domElem.contentEditable="true",this.domElem.style.outline="0px solid transparent",this.domElem.style.caretColor="transparent",this.domElem.style.cursor="default"}update(){if(this.enabled)this.domElem.style.removeProperty("display");else{this.domElem.style.display="none";return}this.preLayoutUpdate(),this.resolveLayout()&&(this.updateDOMDims(),this.autoScale()),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))}get resolution(){return super.resolution}set resolution(e){super.resolution=e,this.autoScale()}updateDOMDims(){let[e,t]=this.effectiveScale,[r,n]=this.dimensions;this.domElem.width=Math.round(r*e),this.domElem.height=Math.round(n*t)}autoScale(){let[e,t]=this.effectiveScale;this.domElem.style.width=(this.domElem.width/this.resolution/e).toString()+"px",this.domElem.style.height=(this.domElem.height/this.resolution/t).toString()+"px"}};l(Oe,"DOMRoot");var Pe=class extends ae{constructor(i,e){super(i,!1,!0,e)}handleEvent(i){return this.child.dispatchEvent(i)}handlePreLayoutUpdate(){let i=this.child;i.preLayoutUpdate(),i.layoutDirty&&(this._layoutDirty=!0)}handlePostFinalizeBounds(){let i=this.child;i.postFinalizeBounds(),i.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let i=this.child;i.postLayoutUpdate(),i.dirty&&(this._dirty=!0)}handleResolveDimensions(i,e,t,r){let n=this.child;n.resolveDimensions(i,e,t,r),[this.idealWidth,this.idealHeight]=n.idealDimensions}afterPositionResolved(){this.child.resolvePosition(this.idealX,this.idealY)}handlePainting(i){this.child.paint(i)}};l(Pe,"PassthroughWidget");var ve=class extends Pe{constructor(e,t=[0,1/0,0,1/0],r){super(e,r);this._constraints=[0,1/0,0,1/0];this.constraints=[0,1/0,0,1/0];this._constraints=[...t]}handleResolveDimensions(e,t,r,n){var c,p;let s=(p=(c=this.root)==null?void 0:c.resolution)!=null?p:1,o=Math.min(Math.max(this._constraints[0]*s,e),t),a=Math.min(Math.max(this._constraints[2]*s,r),n),d=Math.min(Math.max(this._constraints[1]*s,e),t),u=Math.min(Math.max(this._constraints[3]*s,r),n);o>d&&(o=d),a>u&&(a=u),super.handleResolveDimensions(o,d,a,u)}};l(ve,"ArtificialConstraint"),k([Kt()],ve.prototype,"constraints",2);var ee=(t=>(t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold",t))(ee||{});var Ue=class{constructor(i){this.clickHelpers=i}get lastClickState(){let i=0;for(let e of this.clickHelpers)e.lastClickState>i&&(i=e.lastClickState);return i}get clickState(){let i=0;for(let e of this.clickHelpers)e.clickState>i&&(i=e.clickState);return i}get clickStateChanged(){for(let i of this.clickHelpers)if(i.clickStateChanged)return!0;return!1}get wasClick(){for(let i of this.clickHelpers)if(i.wasClick&&i.clickStateChanged)return!0;return!1}};l(Ue,"CompoundClickHelper");var _e=class{constructor(i){this.lastClickState=0;this.clickState=0;this.clickStateChanged=!1;this.wasClick=!1;this.widget=i}setClickState(i,e){this.clickState!==i?(this.lastClickState=this.clickState,this.clickState=i,this.wasClick=e&&this.lastClickState===2,this.clickStateChanged=!0):this.clickStateChanged=!1}};l(_e,"GenericClickHelper");var ue=class extends N{cloneWithTarget(i){return new ue(this.key,this.shift,this.ctrl,this.alt,i)}};l(ue,"KeyRelease");var Fe=class extends P{constructor(e,t,r,n,s,o,a=null,d=null){super(e,t,n,s,o,a,d);this.button=r}get isLeft(){return this.button===0}get isPrimary(){return this.isLeft}get isRight(){return this.button===1}get isSecondary(){return this.isRight}get isMiddle(){return this.button===2}get isTertiary(){return this.isMiddle}};l(Fe,"PointerButtonEvent");var K=class extends Fe{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o,0)}correctOffset(i,e){return new K(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new K(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};l(K,"PointerRelease");var I=class extends Fe{constructor(i,e,t,r,n,s,o=null){super(i,e,t,r,n,s,o)}correctOffset(i,e){return new I(this.x-i,this.y-e,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new I(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};l(I,"PointerPress");var te=class extends _e{constructor(){super(...arguments);this.pointerPos=null;this.startingPointerPos=null;this.pointerButton=0}getNormalInRect(e,t,r,n,s,o){return[(e-r)/(n-r),(t-s)/(o-s)]}isPointInRect(e,t,r,n,s,o){return e>=r&&e<n&&t>=s&&t<o}isNormalInRect(e,t){return e>=0&&e<1&&t>=0&&t<1}handleClickEvent(e,t,r){if(e instanceof S)return t.dropFocus(0,this.widget),this.pointerPos=null,this.setClickState(0,!1);if(e instanceof P){this.pointerPos=this.getNormalInRect(e.x,e.y,...r);let n=this.isNormalInRect(...this.pointerPos);if(n)t.pointerStyle="pointer";else if(e.target===null)return t.dropFocus(0,this.widget),this.setClickState(0,!1);return e instanceof I&&e.button===this.pointerButton?(this.startingPointerPos=this.pointerPos,t.requestFocus(0,this.widget),this.setClickState(2,n)):e instanceof K&&e.button===this.pointerButton?(t.dropFocus(0,this.widget),n?this.setClickState(1,n):this.setClickState(0,n)):e.target===null?this.setClickState(1,n):this.setClickState(2,n)}else this.clickStateChanged=!1}};l(te,"ClickHelper");var ce=class extends Ue{constructor(e){let t=new te(e),r=new _e(e);super([t,r]);this.pointerClickHelper=t,this.keyboardClickHelper=r,this.widget=e}onFocusGrabbed(e){return e===1?(this.keyboardClickHelper.setClickState(1,!0),this.widget.autoScroll(),!0):!1}onFocusDropped(e){return e===1?(this.keyboardClickHelper.setClickState(0,!1),!0):!1}handleEvent(e,t,r,n){if(e instanceof D)return[!1,!1];if(e instanceof N){if(e.key!=="Enter")return[!1,!1]}else if(!(e instanceof P||e instanceof S))return[!1,!1];return r?(e instanceof L?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(2,!0),this.widget.autoScroll()):e instanceof ue?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(1,!0)):(this.keyboardClickHelper.clickStateChanged=!1,this.pointerClickHelper.handleClickEvent(e,t,n)),[this.clickStateChanged&&this.wasClick,!0]):(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.clickStateChanged=!1,[!1,!0])}};l(ce,"ButtonClickHelper");var Ce=class extends he{constructor(e,t=null,r){super(e,!1,r);this.clickHelper=new ce(this),this.callback=t,this.tabFocusable=!0}click(){if(this.callback!==null)try{this.callback()}catch(e){console.error("Exception in Icon callback",e)}}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)}handleEvent(e){let[t,r]=this.clickHelper.handleEvent(e,this.root,this.callback!==null,this.bounds);return t&&this.click(),r?this:null}};l(Ce,"Button");var Se=class extends Ce{constructor(e,t=null,r){super(e,t,r);this.backgroundProperty="backgroundFill";this.forced=!1;this.childTheme=new R({canvasFill:this.getBackgroundFill()}),this.child.inheritedTheme=this.childTheme}updateBackground(){let e=this.backgroundProperty;if(this.forced)this.backgroundProperty="primaryFill";else switch(this.clickHelper.clickState){case 2:this.backgroundProperty="accentFill";break;case 1:this.backgroundProperty="backgroundGlowFill";break;default:this.backgroundProperty="backgroundFill";break}e!==this.backgroundProperty&&(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill())}getBackgroundFill(){switch(this.backgroundProperty){case"primaryFill":return this.primaryFill;case"accentFill":return this.accentFill;case"backgroundGlowFill":return this.backgroundGlowFill;case"backgroundFill":return this.backgroundFill;default:throw new Error(`Unknown theme property: ${this.backgroundProperty}`)}}set inheritedTheme(e){e!==this.fallbackTheme&&(this.fallbackTheme=e,this.childTheme.fallbackTheme=e)}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(e=null){e===null?(this._layoutDirty=!0,this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e===this.backgroundProperty?(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):e==="containerPadding"?this._layoutDirty=!0:e==="containerAlignment"&&(this._layoutDirty=!0)}onFocusGrabbed(e){super.onFocusGrabbed(e),e===1&&this.updateBackground()}onFocusDropped(e){super.onFocusDropped(e),e===1&&this.updateBackground()}handleEvent(e){let t=super.handleEvent(e);return this.clickHelper.clickStateChanged&&this.updateBackground(),t}handlePainting(e){this.handleBaseContainerPainting(e,this.getBackgroundFill())}};l(Se,"FilledButton"),k([ot(Se.prototype.updateBackground)],Se.prototype,"forced",2);var ie=class extends m{constructor(e,t){super(!0,!1,t);this.textGetter=null;this.wrapText=!0;this.textHelper=new C,this.textHelper.wrapMode=1,this.source=e}set source(e){e instanceof Function?this.textGetter=e:(this.textGetter=null,this.textHelper.text=e)}get source(){return this.textGetter!==null?this.textGetter:this.textHelper.text}get text(){return this.textHelper.text}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="labelMinWidth"||e==="labelMinAscent"||e==="labelMinDescent"?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFill"&&(this._dirty=!0)}handlePreLayoutUpdate(){this.textGetter!==null&&(this.textHelper.text=this.textGetter()),this.textHelper.font=this.bodyTextFont,this.textHelper.lineHeight=this.bodyTextHeight,this.textHelper.lineSpacing=this.bodyTextSpacing,this.textHelper.alignMode=this.bodyTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(e,t,r,n){this.textHelper.maxWidth=this.wrapText?t:1/0,this.textHelper.dirty&&(this._dirty=!0),this.idealWidth=Math.max(Math.min(this.textHelper.width,t),e),this.idealHeight=Math.max(Math.min(this.textHelper.height,n),r)}handlePainting(e){let t=this.viewport.context;this.wrapText||(t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip()),this.textHelper.paint(t,this.bodyTextFill,this.idealX,this.idealY),this.wrapText||t.restore()}};l(ie,"Label"),k([J],ie.prototype,"wrapText",2);var We=class extends Se{constructor(i,e=null,t){let r=q({},t);r.containerAlignment={horizontal:.5,vertical:"stretch"};let n=new ie(i,t);n.wrapText=!1,n.bodyTextAlign=.5,super(n,e,r)}};l(We,"TextButton");var Ke=class extends ve{constructor(i,e=null,t,r=0,n=24,s=24,o){e===null&&(e=i);function a(){return t.shift?e===null?i:e:i}l(a,"getGlyph"),super(new We(a,()=>t.callback(a()),o),[n,1/0,s,1/0],o),this.flex=r}};l(Ke,"GlyphVirtualKey");var pe=class extends le{constructor(i){super(!1,i)}};l(pe,"Row");var Ye=class extends pe{constructor(i,e,t=0,r=24,n=24,s){super(s);for(let o of i)if(typeof o=="function"){let a=o;this.add(a(e,s))}else if(typeof o[0]=="string"&&typeof o[1]=="string"){let a=o[0],d=o[1];for(let u=0;u<a.length;u++){let c=null;u<d.length&&(c=d[u]),this.add(new Ke(a[u],c,e,t,r,n,s))}}else throw new Error(`Unknown virtual key row template format for entry: ${o}`)}};l(Ye,"VirtualKeyRow");var j=class extends ve{constructor(i,e,t=0,r=24,n=24,s){super(new We(i,e,s),[r,1/0,n,1/0],s),this.flex=t}};l(j,"VirtualKey");var Z=class extends j{constructor(i,e,t,r=0,n=24,s=24,o){super(i,()=>t.callback(e),r,n,s,o)}};l(Z,"BasicVirtualKey");var Xe=class extends Z{constructor(i,e=0,t=60,r=24,n){super("Backspace","Backspace",i,e,t,r,n)}};l(Xe,"BackspaceKey");var Ge=class extends Z{constructor(i,e=0,t=24,r=24,n){super("Esc","Escape",i,e,t,r,n)}};l(Ge,"EscapeKey");var $e=class extends Z{constructor(i,e=0,t=72,r=24,n){super("Enter","Enter",i,e,t,r,n)}};l($e,"EnterKey");var Ne=class extends j{constructor(i,e=0,t=84,r=24,n){super("Shift",()=>{i.shift=!i.shift,this.child.forced=i.shift,i.callback("Shift")},e,t,r,n),this.child.forced=i.shift}};l(Ne,"ShiftKey");var ze=class extends Z{constructor(i,e=1,t=84,r=24,n){super("Space"," ",i,e,t,r,n)}};l(ze,"SpaceKey");var Qe=class extends le{constructor(i){super(!0,i)}};l(Qe,"Column");function pi(h,i){return new $e(h,void 0,void 0,void 0,i)}l(pi,"EnterKeyTemplate");function fi(h,i){return new Ne(h,void 0,void 0,void 0,i)}l(fi,"ShiftKeyTemplate");function mi(h,i){return new Xe(h,void 0,void 0,void 0,i)}l(mi,"BackspaceKeyTemplate");function gi(h,i){return new ze(h,void 0,void 0,void 0,i)}l(gi,"SpaceKeyTemplate");function bi(h,i){return new Ge(h,void 0,void 0,void 0,i)}l(bi,"EscapeKeyTemplate");var je=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],pi],[fi,["zxcvbnm,./","ZXCVBNM<>?"]],[mi,gi,bi]],De=class extends Qe{constructor(i,e=je,t=0,r=24,n=24,s){let o=q({},s);o.multiContainerAlignment={main:"between",cross:"stretch"},super(o);let a={callback:d=>{i.keyPress(d,a.shift,a.ctrl,a.alt)},shift:!1,ctrl:!1,alt:!1};for(let d of e)this.add(new Ye(d,a,t,r,n,o))}};l(De,"VirtualKeyboard");var fe=class extends he{constructor(i,e){super(i,!0,e)}};l(fe,"Container");var He=class extends fe{constructor(i,e){let t=q({},e);t.containerAlignment={horizontal:.5,vertical:.5},super(i,t)}};l(He,"Margin");var vt=class extends Oe{constructor(e,t=je,r=new R){super(new He(new De(e,t)),r);this.keyboardDriver=e}update(){this.enabled=this.keyboardDriver.needsInput,super.update()}};l(vt,"DOMVirtualKeyboardRoot");var xt=class extends F{constructor(e,t=je,r=null,n=new R){super(new He(new De(e,t)),r,n);this.keyboardDriver=e}updateVisibility(){this.enabled=this.keyboardDriver.needsInput}};l(xt,"VirtualKeyboardRoot");var Ze=class{constructor(){this.eventQueues=new Map;this.keysDown=new Set;this.focus=null;this.lastActivity=null}getEventQueue(i){if(i===null)return null;let e=this.eventQueues.get(i);return typeof e=="undefined"?null:e}changeFocusedRoot(i){this.focus!==i&&(this.focus!==null&&this.focus.clearFocus(1),this.focus=i,this.keysDown.clear())}getFocusedRoot(){return this.focus}getEffectiveFocusedRoot(){return this.focus?this.focus:this.lastActivity?this.lastActivity:this.eventQueues.size>0?this.eventQueues.keys().next().value:null}clearFocus(){this.changeFocusedRoot(null)}keyDown(i,e,t,r){this.keysDown.add(i);let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new L(i,e,t,r,null))}keyUp(i,e,t,r){if(this.keysDown.delete(i)){let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new ue(i,e,t,r,null))}}keyPress(i,e,t,r){let n=this.isKeyDown(i);this.keyDown(i,e,t,r),n||this.keyUp(i,e,t,r)}isKeyDown(i){return this.keysDown.has(i)}onEnable(i){this.eventQueues.has(i)||this.eventQueues.set(i,[])}onDisable(i){this.eventQueues.has(i)&&(this.eventQueues.delete(i),i===this.focus&&this.clearFocus())}update(i){let e=this.getEventQueue(i);if(e!==null){for(let t of e)i.dispatchEvent(t);e.length=0}}onFocusChanged(i,e,t){t!==null&&(this.lastActivity=i),e===1&&i!==this.focus&&t!==null&&this.changeFocusedRoot(i)}onFocusCapturerChanged(i,e,t,r){}get needsInput(){return this.focus!==null&&this.focus.getFocus(1)!==null}};l(Ze,"KeyboardDriver");var yi=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp","Tab"," "]),vi=new Set(["a","A"]),xi=new Set(["Tab"]);function Qt(h){return[h.key,h.shiftKey,h.ctrlKey,h.altKey]}l(Qt,"unpackKeyboardEvent");var Tt=class extends Ze{constructor(){super(...arguments);this.domElems=new Map}maybePreventDefault(e){var t,r;(yi.has(e.key)||vi.has(e.key)&&e.ctrlKey)&&(xi.has(e.key)||((r=(t=this.getFocusedRoot())==null?void 0:t.getFocus(1))!=null?r:null)!==null)&&e.preventDefault()}bindDOMElem(e,t=!0){let r=this.domElems.get(e);r!==void 0?(console.warn("Rebinding DOMKeyboardDriver. Are you calling bindDOMElem with the same HTML element multiple times?"),this.removeListeners(e,r)):(r={blurListen:null,keydownListen:null,keyupListen:null},this.domElems.set(e,r)),this.addListeners(e,r,t)}unbindDOMElem(e){let t=this.domElems.get(e);t!==void 0&&(this.removeListeners(e,t),this.domElems.delete(e))}addListeners(e,t,r=!0){t.blurListen=n=>{this.shouldClearFocus(n.relatedTarget)&&this.clearFocus()},e.addEventListener("blur",t.blurListen),r&&(t.keydownListen=n=>{this.maybePreventDefault(n),this.keyDown(...Qt(n))},t.keyupListen=n=>{this.maybePreventDefault(n),this.keyUp(...Qt(n))},e.addEventListener("keydown",t.keydownListen),e.addEventListener("keyup",t.keyupListen))}removeListeners(e,t){t.blurListen&&(e.removeEventListener("blur",t.blurListen),t.blurListen=null),t.keydownListen&&(e.removeEventListener("keydown",t.keydownListen),t.keydownListen=null),t.keyupListen&&(e.removeEventListener("keyup",t.keyupListen),t.keyupListen=null)}shouldClearFocus(e){return e===null||!this.domElems.has(e)}};l(Tt,"DOMKeyboardDriver");function kt(h,i){let e=i.getBoundingClientRect();return[(h.clientX-e.left)/e.width,(h.clientY-e.top)/e.height]}l(kt,"getPointerEventNormPos");var re=class extends P{constructor(i,e,t,r,n,s=null){super(i,e,t,r,n,s,0)}correctOffset(i,e){return new re(this.x-i,this.y-e,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new re(this.x,this.y,this.shift,this.ctrl,this.alt,i)}};l(re,"PointerMove");var jt=(t=>(t[t.None=0]="None",t[t.Hovering=1]="Hovering",t[t.Pressing=2]="Pressing",t))(jt||{});var Le=class{constructor(){this.states=new Map;this.nextPointerID=0;this.hints=new Map;this.dragToScroll=new Map}unassignPointer(i,e){e.pointer!==null&&this.setPointerHint(e.pointer,0),e.pointer=null,e.hovering&&e.eventQueue.push(new S(i.getFocusCapturer(0))),e.hovering=!1,e.pressing=0,e.dragLast=null}registerPointer(i=!1){let e=this.nextPointerID++;return this.setPointerHint(e,0),this.dragToScroll.set(e,i),e}unregisterPointer(i){for(let[e,t]of this.states)t.pointer===i&&this.unassignPointer(e,t);this.hints.delete(i),this.dragToScroll.delete(i)}canQueueEvent(i,e,t,r){let n=t.pointer===null;n&&(t.pointer=e);let s=t.pointer===e;if(!s||n)for(let[o,a]of this.states)o!==i&&a.pointer===e&&this.unassignPointer(o,a);return!s&&(!r||t.pressing>0)?!1:(r&&t.pointer!==e&&(this.unassignPointer(i,t),t.pointer=e),!0)}denormaliseCoords(i,e,t){let[r,n]=i.dimensions;return[e*r,t*n]}movePointer(i,e,t,r,n,s,o,a){let d=this.states.get(i);if(typeof d=="undefined"||(n===null&&(n=d.pressing),!this.canQueueEvent(i,e,d,n>0)))return;d.hovering=!0;let[u,c]=this.denormaliseCoords(i,t,r);if(n!==d.pressing){let p=Math.floor(Math.log2(Math.max(n,d.pressing)));for(let f=0;f<=p;f++){let g=(d.pressing>>f&1)===1,b=(n>>f&1)===1;g!==b&&(b?d.eventQueue.push(new I(u,c,f,s,o,a)):d.eventQueue.push(new K(u,c,f,s,o,a)))}d.pressing=n}else d.eventQueue.push(new re(u,c,s,o,a));d.pressing>0?this.setPointerHint(e,2):this.setPointerHint(e,1)}leavePointer(i,e){let t=this.states.get(i);typeof t!="undefined"&&t.hovering&&t.pointer==e&&(t.hovering=!1,t.pressing=0,t.dragLast=null,t.eventQueue.push(new S(i.getFocusCapturer(0))),this.setPointerHint(e,0))}leaveAnyPointer(i){for(let e of this.states.keys())this.leavePointer(e,i)}wheelPointer(i,e,t,r,n,s,o,a,d,u,c){let p=this.states.get(i);if(typeof p=="undefined"||!this.canQueueEvent(i,e,p,!0))return;p.hovering=!0;let[f,g]=this.denormaliseCoords(i,t,r);p.eventQueue.push(new D(f,g,n,s,o,a,!1,d,u,c))}setPointerHint(i,e){return this.hints.get(i)!==e?(this.hints.set(i,e),!0):!1}getPointerHint(i){var e;return(e=this.hints.get(i))!=null?e:0}onEnable(i){this.states.set(i,{eventQueue:[],pointer:null,pressing:0,hovering:!1,dragLast:null,dragOrigin:[0,0]})}onDisable(i){i.dispatchEvent(new S);let e=this.states.get(i);typeof e!="undefined"&&e.pointer!==null&&(this.setPointerHint(e.pointer,0),e.dragLast=null),this.states.delete(i)}update(i){let e=this.states.get(i);if(typeof e=="undefined")return;let t=e.pointer===null?!1:this.dragToScroll.get(e.pointer);for(let r of e.eventQueue){if(r instanceof P&&e.dragLast!==null){let[n,s]=e.dragLast;i.dispatchEvent(new D(...e.dragOrigin,n-r.x,s-r.y,0,0,!1,!1,!1,!0)),r instanceof K?e.dragLast=null:(e.dragLast[0]=r.x,e.dragLast[1]=r.y);continue}i.dispatchEvent(r)?e.dragLast=null:t&&r instanceof I&&(e.dragLast=[r.x,r.y],e.dragOrigin[0]=r.x,e.dragOrigin[1]=r.y)}e.eventQueue.length=0}onFocusChanged(i,e,t){}onFocusCapturerChanged(i,e,t,r){}};l(Le,"PointerDriver");function Zt(h){return[h.shiftKey,h.ctrlKey,h.altKey]}l(Zt,"unpackModifiers");var wt=class extends Le{constructor(){super();this.domElems=new WeakMap;this.pointers=new Map;this.mousePointerID=this.registerPointer(!1)}bindDOMElem(e,t){let r=this.domElems.get(e);r!==void 0?(console.warn("Rebinding DOMPointerDriver. Are you calling bindDOMElem with the same HTML element multiple times?"),this.removeListeners(r)):(r={domElem:t,pointerListen:null,pointerleaveListen:null,wheelListen:null,contextMenuListen:null},this.domElems.set(e,r),t.style.touchAction="none"),e.enabled&&this.addListeners(e,r)}unbindDOMElem(e){let t=this.domElems.get(e);t!==void 0&&(this.removeListeners(t),this.domElems.delete(e))}getPointerID(e){let t=this.pointers.get(e.pointerId);return t===void 0&&(e.pointerType==="mouse"?t=this.mousePointerID:t=this.registerPointer(!0),this.pointers.set(e.pointerId,t)),t}addListeners(e,t){let r=t.domElem;t.pointerListen===null&&(t.pointerListen=n=>{this.movePointer(e,this.getPointerID(n),...kt(n,r),n.buttons,...Zt(n))},r.addEventListener("pointermove",t.pointerListen),r.addEventListener("pointerdown",t.pointerListen),r.addEventListener("pointerup",t.pointerListen)),t.pointerleaveListen===null&&(t.pointerleaveListen=n=>{this.leavePointer(e,this.getPointerID(n))},r.addEventListener("pointerleave",t.pointerleaveListen)),t.wheelListen===null&&(t.wheelListen=n=>{let s=Nt(n.deltaMode);s!==null&&this.wheelPointer(e,this.mousePointerID,...kt(n,r),n.deltaX,n.deltaY,n.deltaZ,s,...Zt(n))},r.addEventListener("wheel",t.wheelListen,{passive:!1})),t.contextMenuListen===null&&(t.contextMenuListen=n=>{n.preventDefault()},r.addEventListener("contextmenu",t.contextMenuListen))}removeListeners(e){e.pointerListen!==null&&(e.domElem.removeEventListener("pointermove",e.pointerListen),e.domElem.removeEventListener("pointerdown",e.pointerListen),e.domElem.removeEventListener("pointerup",e.pointerListen),e.pointerListen=null),e.pointerleaveListen!==null&&(e.domElem.removeEventListener("pointerleave",e.pointerleaveListen),e.pointerleaveListen=null),e.wheelListen!==null&&(e.domElem.removeEventListener("wheel",e.wheelListen),e.wheelListen=null),e.contextMenuListen!==null&&(e.domElem.removeEventListener("contextmenu",e.contextMenuListen),e.contextMenuListen=null)}onEnable(e){super.onEnable(e);let t=this.domElems.get(e);t!==void 0&&this.addListeners(e,t)}onDisable(e){super.onDisable(e);let t=this.domElems.get(e);t!==void 0&&this.removeListeners(t)}};l(wt,"DOMPointerDriver");var Pt=class extends Le{constructor(){super(...arguments);this.sources=new Set}handlePointerRay(e,t,r,n,s,o,a){let[d,u,c]=this.castRay(r,n);d===null?this.leaveAnyPointer(e):this.movePointer(d,e,u,c,t,s,o,a)}addSource(e){this.sources.has(e)||(e.setRayPointerDriver(this),this.sources.add(e))}setPointerHint(e,t){let r=super.setPointerHint(e,t);for(let n of this.sources)n.onPointerHintChanged(e,t);return r}};l(Pt,"RayPointerDriver");var _t=class extends R{constructor(i=new R){super(void 0,i)}get canvasFill(){return"#"+Math.floor(Math.random()*16777215).toString(16)}set canvasFill(i){super.canvasFill=i}};l(_t,"DebugTheme");function Mo(h,i,e=null){return t=>{let r=!0,n=t;for(let s of h)if([r,n]=s(n),!r)return[!1,i];if(e!==null)try{e(n)}catch(s){console.warn("Exception in CompositeValidator callback:",s)}return[!0,n]}}l(Mo,"MakeCompositeValidator");function Ti(h){return[!0,h]}l(Ti,"DefaultTextValidator");function qt(h=null){return h===null?Ti:i=>(h(i),[!0,i])}l(qt,"MakeDefaultTextValidatorWithCallback");var ki=/^-?(\.\d+|\d+(\.(\d+)?)?)(e\d+)?$/;function Vo(h){return ki.test(h)?[!0,parseFloat(h)]:[!1,NaN]}l(Vo,"FloatValidator");var wi=/^-?\d+$/;function Ao(h){return wi.test(h)?[!0,parseInt(h)]:[!1,NaN]}l(Ao,"IntValidator");function Oo(h,i){return e=>e<h?[!1,e]:e>i?[!1,e]:[!0,e]}l(Oo,"MakeRangeValidator");var qe=class{constructor(i){this._dirty=!1;this._value=i}get value(){return this._value}set value(i){this.setValue(i)}get dirty(){let i=this._dirty;return this._dirty=!1,i}setValue(i,e=!0){return this._value===i?!1:(this._value=i,e&&(this._dirty=!0),!0)}};l(qe,"Variable");var me=class extends qe{constructor(){super(...arguments);this.callbacks=new Set}hasCallback(e){return this.callbacks.has(e)}watch(e){return this.hasCallback(e)?!1:(this.callbacks.add(e),!0)}unwatch(e){return this.callbacks.delete(e)}setValue(e,t=!0){let r=super.setValue(e,t);if(r&&t)for(let n of this.callbacks)try{n(e)}catch(s){console.error("Exception in Variable callback",s)}return r}};l(me,"WatchableVariable");var Ft=class extends j{constructor(i,e=0,t=42,r=24,n){super("Alt",()=>{i.alt=!i.alt,this.child.forced=i.alt,i.callback("Alt")},e,t,r,n),this.child.forced=i.alt}};l(Ft,"AltKey");var Ct=class extends j{constructor(i,e=0,t=42,r=24,n){super("Ctrl",()=>{i.ctrl=!i.ctrl,this.child.forced=i.ctrl,i.callback("Control")},e,t,r,n),this.child.forced=i.ctrl}};l(Ct,"ControlKey");var ct=(t=>(t[t.None=0]="None",t[t.Bi=1]="Bi",t[t.Uni=2]="Uni",t))(ct||{});var ne=class extends m{constructor(e,t=null,r="",n){super(!1,!1,n);this.blinkStart=0;this.blinkWasOn=null;this.cursorPos=0;this.cursorOffset=[0,0];this.selectPos=0;this.selectOffset=[0,0];this.cursorOffsetDirty=!1;this._editingEnabled=!0;this.hideText=!1;this.offset=[0,0];this.wrapText=!0;this.inputFilter=null;this.dragging=!1;this.lastClick=0;this.dragStart=-1;this.successiveClickCount=0;this.typeableTab=!1;this.needsAutoScroll=!1;this.tabFocusable=!0,this.textHelper=new C,this.variable=new me(r),this.variable.watch(s=>{let[o,a]=e(s);o&&(this._validValue=a),o!==this._valid&&(this._valid=o,this._dirty=!0)}),[this._valid,this._validValue]=e(r),this.inputFilter=t}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0,this.cursorOffsetDirty=!0):e==="inputTextInnerPadding"||e==="inputTextFont"||e==="inputTextHeight"||e==="inputTextSpacing"?(this._layoutDirty=!0,this._dirty=!0):e==="inputBackgroundFill"||e==="inputTextFill"||e==="inputTextFillInvalid"||e==="inputTextFillDisabled"||e==="cursorThickness"?this._dirty=!0:e==="inputTextAlign"&&(this.cursorOffsetDirty=!0)}get blinkOn(){if(this.blinkStart===0)return null;let e=this.blinkRate;return Math.trunc((Date.now()-this.blinkStart)/(500*e)%2)===0}get editingEnabled(){return this._editingEnabled}set editingEnabled(e){this._editingEnabled!==e&&(this._editingEnabled=e,e||(this.blinkStart=0,this.moveCursorTo(0,!1)),this._dirty=!0)}set text(e){this.variable.value=e;let t=this.variable.value.length;this.cursorPos>t&&(this.cursorPos=t,this.cursorOffsetDirty=!0),this.selectPos>t&&(this.selectPos=t,this.cursorOffsetDirty=!0)}get text(){return this.variable.value}get displayedText(){return this.hideText?"\u25CF".repeat(this.variable.value.length):this.variable.value}get valid(){return this._valid}get validValue(){return this._validValue}get line(){return this.textHelper.getLine(this.cursorPos)}autoScrollCaret(){this.blinkStart!==0&&(this.needsAutoScroll=!0)}moveCursorTo(e,t){this.cursorPos=Math.min(Math.max(e,0),this.text.length),t||(this.selectPos=this.cursorPos),this.cursorOffsetDirty=!0,this._dirty=!0,this.autoScrollCaret()}moveCursor(e,t){this.moveCursorTo(this.cursorPos+e,t)}moveCursorFromOffset(e,t,r){[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset([e,t]),r||(this.selectPos=this.cursorPos,this.selectOffset=this.cursorOffset),this.blinkStart=Date.now(),this._dirty=!0,this.autoScrollCaret()}moveCursorLine(e,t){this.moveCursorFromOffset(this.cursorOffset[0],this.cursorOffset[1]+(.5+e)*this.textHelper.fullLineHeight,t)}moveCursorStart(e){this.moveCursorTo(this.textHelper.getLineStart(this.line),e)}moveCursorEnd(e){this.moveCursorTo(this.textHelper.getLineEnd(this.line,!1),e)}moveCursorWord(e,t){if(e==0)return;let r=/\w/,n=this.text,s=this.cursorPos;if(e>0)for(;e>0;){let o=!1;for(;s<=n.length;s++)if(s<n.length&&r.test(n[s]))o=!0;else if(o)break;e--}else for(;e<0;){s--;let o=!1;for(;s>=0;s--)if(s>=0&&r.test(n[s]))o=!0;else if(o)break;s++,e++}this.moveCursorTo(s,t)}deleteRange(e,t){e!==t&&(this.variable.value=this.text.substring(0,e)+this.text.substring(t),this.cursorPos=this.selectPos=e,this.cursorOffsetDirty=!0,this.autoScrollCaret())}deleteWord(e){if(e===0)return;if(this.cursorPos!==this.selectPos){this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));return}let t=this.cursorPos;this.moveCursorWord(e,!1),t!==this.cursorPos&&this.deleteRange(Math.min(t,this.cursorPos),Math.max(t,this.cursorPos))}insertText(e){if(!(this.inputFilter!==null&&!this.inputFilter(e)))if(this.selectPos===this.cursorPos)this.variable.value=this.text.substring(0,this.cursorPos)+e+this.text.substring(this.cursorPos),this.moveCursor(e.length,!1);else{let t=Math.min(this.cursorPos,this.selectPos),r=Math.max(this.cursorPos,this.selectPos);this.variable.value=this.text.substring(0,t)+e+this.text.substring(r),this.moveCursorTo(t+e.length,!1)}}deleteText(e){e!==0&&(this.cursorPos!==this.selectPos?this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos)):e>0?(this.variable.value=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+e),this.cursorOffsetDirty=!0,this.autoScrollCaret()):(this.variable.value=this.text.substring(0,this.cursorPos+e)+this.text.substring(this.cursorPos),this.moveCursor(e,!1)))}selectRangeAt(e){let t=this.text,r=/\w/,n=r.test(t[e]),s=e;for(;e>=0&&r.test(t[e])===n;e--);let o=e+1;for(e=s;e<t.length&&r.test(t[e])===n;e++);return this.autoScrollCaret(),[o,e]}onFocusGrabbed(e){e===1&&this.blinkStart===0&&(this.blinkStart=Date.now(),this.selectPos=this.variable.value.length,this.cursorPos=this.selectPos,this.cursorOffsetDirty=!0,this.autoScrollCaret())}onFocusDropped(e){e===1&&(this.blinkStart=0)}handleEvent(e){if(!this._editingEnabled)return null;let t=this.root;if(e instanceof S)return this.dragging=!1,this.lastClick=0,this;if(e instanceof D)return null;if(e instanceof P){if(t.pointerStyle="text",e instanceof I||e instanceof re){let r=e instanceof I&&e.isPrimary;if(r){this.dragging=!0;let s=new Date().getTime();s-this.lastClick<500?(this.successiveClickCount++,this.successiveClickCount>2&&(this.successiveClickCount=0)):this.successiveClickCount=0,this.lastClick=s}else if(!this.dragging)return this;let n=this.inputTextInnerPadding;if(this.moveCursorFromOffset(e.x-this.idealX-n+this.offset[0],e.y-this.idealY-n+this.offset[1],!r&&this.dragging),r&&(this.cursorPos!==this.dragStart&&(this.successiveClickCount=0),this.dragStart=this.cursorPos),this.successiveClickCount>0){let s,o;if(this.successiveClickCount===1){let[a,d]=this.selectRangeAt(this.dragStart),[u,c]=this.selectRangeAt(this.cursorPos);s=Math.min(a,u),o=Math.max(d,c)}else{let a=Math.min(this.cursorPos,this.dragStart),d=this.textHelper.getLine(a);s=this.textHelper.getLineStart(d);let u=Math.max(this.cursorPos,this.dragStart),c=this.textHelper.getLine(u);o=this.textHelper.getLineEnd(c)}this.cursorPos>=this.dragStart?(this.selectPos=s,this.cursorPos=o):(this.selectPos=o,this.cursorPos=s),this.cursorOffsetDirty=!0}t.requestFocus(1,this)}else e instanceof K&&e.isPrimary&&(this.dragging=!1,t.hasMobileTextInput&&t.getTextInput(this.text).then(r=>{r!==null&&this.text!==r&&(this.text=r,this.moveCursorTo(r.length,!1))}));return this}else if(e instanceof L){if(this.dragging=!1,this.lastClick=0,e.alt)return this;if(e.ctrl){if(e.key==="Backspace")this.deleteWord(-1);else if(e.key==="Delete")this.deleteWord(1);else if(e.key==="ArrowLeft")this.moveCursorWord(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursorWord(1,e.shift);else if(e.key==="c"||e.key==="C"){if(this.cursorPos===this.selectPos)return this;let r=this.text.slice(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));if(navigator.clipboard)navigator.clipboard.writeText(r);else return this}else if(e.key==="a"||e.key==="A")this.cursorPos=this.text.length,this.selectPos=0,this.cursorOffsetDirty=!0,this._dirty=!0;else return this;return this.blinkStart=Date.now(),this}if(e.key.length===1)this.insertText(e.key);else if(e.key==="Backspace")this.deleteText(-1);else if(e.key==="Delete")this.deleteText(1);else if(e.key==="ArrowLeft")this.moveCursor(-1,e.shift);else if(e.key==="ArrowRight")this.moveCursor(1,e.shift);else if(e.key==="ArrowUp")this.moveCursorLine(-1,e.shift);else if(e.key==="ArrowDown")this.moveCursorLine(1,e.shift);else if(e.key==="PageUp")this.moveCursorLine(-5,e.shift);else if(e.key==="PageDown")this.moveCursorLine(5,e.shift);else if(e.key==="Home")this.moveCursorStart(e.shift);else if(e.key==="End")this.moveCursorEnd(e.shift);else{if(e.key==="Escape")return null;if(e.key==="Enter")this.insertText(`
`);else if(e.key==="Tab")if(this.typeableTab){if(e.shift)return t.dispatchEvent(new A(this,!1)),this;this.insertText("	")}else return null;else return this}this.blinkStart=Date.now()}else if(e instanceof de)e.target===this&&(this.insertText(e.text),this.blinkStart=Date.now());else if(e.target!==this)return null;return this}handlePreLayoutUpdate(){this.editingEnabled||this.root.dropFocus(1,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.inputTextFont,this.textHelper.lineHeight=this.inputTextHeight,this.textHelper.lineSpacing=this.inputTextSpacing,this.textHelper.alignMode=this.inputTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handlePostFinalizeBounds(){this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.selectPos===this.cursorPos?(this.selectOffset[0]=this.cursorOffset[0],this.selectOffset[1]=this.cursorOffset[1]):this.selectOffset=this.textHelper.findOffsetFromIndex(this.selectPos),this.cursorOffsetDirty=!1);let e=this.inputTextInnerPadding,t=this.textHelper.width,r=this.textHelper.height,n=this.idealWidth-e*2,s=this.idealHeight-e*2,o=this.offset,[a,d]=this.cursorOffset;if(t>n){let u=Math.min(20,n/2),c=o[0]+u,p=o[0]+n-u;a>p&&(o[0]+=a-p),a<c&&(o[0]-=c-a),o[0]+n>t&&(o[0]=t-n),o[0]<0&&(o[0]=0)}else o[0]=0;if(r>s){let u=this.textHelper.fullLineHeight;if(u>=s)o[1]=d+Math.max(this.textHelper.actualLineHeight-s,0);else{let c=s<2*u?0:u/2,p=o[1]+c,f=o[1]+s-c-u;d<p&&(o[1]-=p-d),d>f&&(o[1]+=d-f),o[1]+s>r&&(o[1]=r-s),o[1]<0&&(o[1]=0)}}else o[1]=0;this.offset=o,this.needsAutoScroll&&(this.needsAutoScroll=!1,this.root.dispatchEvent(new z(this,this.caretBounds)))}handleResolveDimensions(e,t,r,n){let s=2*this.inputTextInnerPadding;this.textHelper.maxWidth=this.wrapText?Math.max(t-s,0):1/0,this.textHelper.dirty&&(this._dirty=!0);let o=Math.min(Math.max(this.inputTextMinWidth,e),t);this.idealWidth=Math.min(Math.max(o,this.textHelper.width+s),t),this.idealHeight=Math.min(Math.max(r,this.textHelper.height+s),n)}get caretRect(){let e=this.inputTextInnerPadding;return[e+this.cursorOffset[0]-this.offset[0],e+this.cursorOffset[1]-this.offset[1],this.cursorThickness,this.textHelper.fullLineHeight]}get caretAbsoluteRect(){let[e,t,r,n]=this.caretRect;return[e+this.idealX,t+this.idealY,r,n]}get caretBounds(){let[e,t,r,n]=this.caretRect;return[e,e+r,t,t+n]}handlePainting(e){let t=this.viewport.context;t.fillStyle=this.inputBackgroundFill,t.fillRect(this.x,this.y,this.width,this.height),t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip();let r=this.inputTextInnerPadding;if(this.cursorPos!==this.selectPos)if(t.fillStyle=this.inputSelectBackgroundFill,this.cursorOffset[1]===this.selectOffset[1]){let o=Math.min(this.cursorOffset[0],this.selectOffset[0]),a=Math.max(this.cursorOffset[0],this.selectOffset[0]);t.fillRect(this.idealX+r+o-this.offset[0],this.idealY+r+this.cursorOffset[1]-this.offset[1],a-o,this.textHelper.fullLineHeight)}else{let o,a;this.cursorOffset[1]<this.selectOffset[1]?(o=this.cursorOffset,a=this.selectOffset):(a=this.cursorOffset,o=this.selectOffset);let d=this.textHelper.fullLineHeight,u=this.idealWidth+this.offset[0]-o[0]-r;u>0&&t.fillRect(this.idealX+r+o[0]-this.offset[0],this.idealY+r+o[1]-this.offset[1],u,d);let c=a[0]+r-this.offset[0];c>0&&t.fillRect(this.idealX,this.idealY+r+a[1]-this.offset[1],c,d);let p=o[1]+d,f=a[1]-p;f>0&&t.fillRect(this.idealX,this.idealY+r+p-this.offset[1],this.idealWidth,f)}let n;this._editingEnabled?this._valid?n=this.inputTextFill:n=this.inputTextFillInvalid:n=this.inputTextFillDisabled,this.textHelper.paint(t,n,this.idealX+r-this.offset[0],this.idealY+r-this.offset[1]);let s=this.blinkOn;this.blinkWasOn=s,s&&(t.fillStyle=n,t.fillRect(...this.caretAbsoluteRect)),t.restore()}};l(ne,"TextInput"),k([G(["cursorOffsetDirty","_dirty"])],ne.prototype,"hideText",2),k([lt()],ne.prototype,"offset",2),k([J],ne.prototype,"wrapText",2);var St=class extends ne{constructor(i=null,e="",t){let r=qt(i);super(r,null,e,t)}};l(St,"BasicTextInput");var Wt=class extends fe{constructor(i,e){let t=q({},e);t.containerAlignment={horizontal:.5,vertical:.5},t.containerPadding={left:0,right:0,top:0,bottom:0},super(i,t)}};l(Wt,"Center");var Je=class extends m{constructor(e=null,t=!1,r){super(!0,!1,r);this.offsetX=0;this.offsetY=0;this.actualLength=0;this.tabFocusable=!0,this.variable=new me(t),e&&this.variable.watch(e),this.clickHelper=new ce(this)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="checkboxLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="checkboxInnerPadding")&&(this._dirty=!0)}set checked(e){this.variable.value=e}get checked(){return this.variable.value}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(e,this.root,!0,[t,t+this.actualLength,r,r+this.actualLength]);return n&&(this.checked=!this.checked),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handlePostLayoutUpdate(){this.variable.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=Math.min(this.checkboxLength,t,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<e&&(this.idealWidth=e),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.checkboxLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){let t=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;t?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.offsetX+this.x,s=this.offsetY+this.y;if(r.fillRect(n,s,this.actualLength,this.actualLength),this.checked){t?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let o=this.checkboxInnerPadding,a=this.actualLength-o*2;a<=0?r.fillRect(n,s,this.actualLength,this.actualLength):r.fillRect(n+o,s+o,a,a)}}};l(Je,"Checkbox");var Pi=/^.*\.(webm|og[gv]|m(p4|4v|ov)|avi|qt)$/i,ge=class extends m{constructor(e,t=null,r=null,n=null,s){super(!0,!1,s);this.lastSrc=null;this.rotation=0;this.imageWidth=null;this.imageHeight=null;this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.loadedmetadataListener=null;this.canplayListener=null;this.frameCallback=null;if(typeof e=="string")if(Pi.test(e)){let o=document.createElement("video");o.src=e,o.preload="auto",e=o}else{let o=document.createElement("img");o.src=e,e=o}this._image=e,this.imageWidth=t,this.imageHeight=r,this.viewBox=n,this.setupVideoEvents()}setupVideoEvents(){if(this.image instanceof HTMLVideoElement)if(this.loadedmetadataListener=e=>this._layoutDirty=!0,this.image.addEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener=e=>this._dirty=!0,this.image.addEventListener("canplay",this.canplayListener),"requestVideoFrameCallback"in this.image){console.warn("requestVideoFrameCallback available; if video playback is choppy or broken, please report it on Github");let e=this.image;this.frameCallback=(t,r)=>{this._dirty=!0,console.log("set dirty"),this.image===e&&this.frameCallback!==null&&this.image.requestVideoFrameCallback(this.frameCallback)},this.image.requestVideoFrameCallback(this.frameCallback)}else console.warn("requestVideoFrameCallback not available; video will be played back on every frame when not paused")}set image(e){e!==this._image&&(this._image instanceof HTMLVideoElement&&(this.loadedmetadataListener!==null&&this._image.removeEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener!==null&&this._image.removeEventListener("canplay",this.canplayListener)),this._image=e,this.lastSrc=null,this.loadedmetadataListener=null,this.canplayListener=null,this.frameCallback=null,this.setupVideoEvents())}get image(){return this._image}handlePreLayoutUpdate(){var e,t;this._image instanceof HTMLVideoElement?!this._image.paused&&this.frameCallback===null&&(this._dirty=!0):((e=this._image)==null?void 0:e.src)!==this.lastSrc&&((t=this._image)==null?void 0:t.complete)&&(this._layoutDirty=!0,this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.imageWidth;s===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?s=this._image.videoWidth:s=this._image.naturalWidth:s=this.viewBox[2]),this.idealWidth=Math.max(Math.min(s,t),e);let o=this.imageHeight;o===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?o=this._image.videoHeight:o=this._image.naturalHeight:o=this.viewBox[3]),this.idealHeight=Math.max(Math.min(o,n),r);let a=this.idealWidth/s,d=this.idealHeight/o,u=Math.min(a,d);this.actualWidth=s*u,this.actualHeight=o*u,this.offsetX=(this.idealWidth-this.actualWidth)/2,this.offsetY=(this.idealHeight-this.actualHeight)/2}handlePainting(e){var o;if(this._image instanceof HTMLImageElement&&!((o=this._image)!=null&&o.complete)){this.lastSrc=null;return}this.lastSrc=this._image.src;let t=this.x+this.offsetX,r=this.y+this.offsetY,n=this.rotation!==0,s=this.viewport.context;n&&(s.save(),s.beginPath(),s.rect(this.x,this.y,this.width,this.height),s.clip(),s.translate(this.x+this.offsetX+this.actualWidth/2,this.y+this.offsetY+this.actualHeight/2),t=-this.actualWidth/2,r=-this.actualHeight/2,s.rotate(this.rotation)),this.viewBox===null?s.drawImage(this._image,t,r,this.actualWidth,this.actualHeight):s.drawImage(this._image,...this.viewBox,t,r,this.actualWidth,this.actualHeight),n&&s.restore()}dryPaint(){var e;this._image instanceof HTMLImageElement&&((e=this._image)==null?void 0:e.complete)?this.lastSrc=this._image.src:this.lastSrc=null,super.dryPaint()}};l(ge,"Icon"),k([Te],ge.prototype,"rotation",2),k([Yt(!0)],ge.prototype,"viewBox",2),k([J],ge.prototype,"imageWidth",2),k([J],ge.prototype,"imageHeight",2);var Dt=class extends Ce{constructor(i,e=null,t=null,r=null,n=null,s){super(new ge(i,e,t,r,s),n,s)}};l(Dt,"IconButton");var Me=class extends m{constructor(e=1,t=0,r=0,n){super(!0,!1,n);this.flex=e,this.minWidth=t,this.minHeight=r}handleResolveDimensions(e,t,r,n){t!==1/0?this.idealWidth=t:this.idealWidth=Math.max(e,this.minWidth),n!==1/0?this.idealHeight=n:this.idealHeight=Math.max(r,this.minHeight)}};l(Me,"Spacing");var Ht=class extends pe{constructor(i,e=null,t=!1,r){super(r),this.add([new ie(i,r),new Me(1,0,0,r),new Je(e,t,r)])}};l(Ht,"LabelledCheckbox");var et=class extends m{constructor(e,t,r){super(!0,!1,r);this.offsetX=0;this.offsetY=0;this.actualLength=0;this._wasSelected=!1;this.tabFocusable=!0,this.variable=e,this.value=t,this.clickHelper=new ce(this),this.callback=this.handleChange.bind(this),this._wasSelected=this.selected}handleChange(e){this.selected!==this._wasSelected&&(this._dirty=!0)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="radioButtonLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundGlowFill"||e==="backgroundFill"||e==="accentFill"||e==="primaryFill"||e==="radioButtonInnerPadding")&&(this._dirty=!0)}select(){this.variable.value=this.value}get selected(){return this.variable.value===this.value}onFocusGrabbed(e){this.clickHelper.onFocusGrabbed(e)&&(this._dirty=!0)}onFocusDropped(e){this.clickHelper.onFocusDropped(e)&&(this._dirty=!0)}handleEvent(e){let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(e,this.root,!0,[t,t+this.actualLength,r,r+this.actualLength]);return n&&this.select(),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(e,t,r,n){let s=Math.min(this.radioButtonLength,t,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<e&&(this.idealWidth=e),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.radioButtonLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(e){this._wasSelected=this.selected;let t=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;t?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.actualLength/2,s=this.offsetX+this.x+n,o=this.offsetY+this.y+n;if(this.paintCircle(s,o,n),this.selected){t?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let a=this.actualLength-this.radioButtonInnerPadding*2;if(a<=0)this.paintCircle(s,o,n);else{let d=a/2;this.paintCircle(s,o,d)}}}activate(e,t,r){super.activate(e,t,r),this.variable.watch(this.callback)}deactivate(){super.deactivate(),this.variable.unwatch(this.callback)}};l(et,"RadioButton");var Lt=class extends pe{constructor(i,e,t,r){super(r),this.add([new ie(i,r),new Me(1,0,0,r),new et(e,t,r)])}};l(Lt,"LabelledRadioButton");var Ee=class extends ae{constructor(e,t=0,r=0,n=0,s=0,o=!1,a){super(e,!1,!0,a);this._offset=[0,0];this._constraints=[0,1/0,0,1/0];this.forceReLayout=!0;this.forceRePaint=!0;this.internalViewport=o?new U(e):null,this.minWidth=t,this.minHeight=r,this._widthCoupling=n,this._heightCoupling=s,this._constraints=[0,1/0,0,1/0]}get usesViewport(){return this.internalViewport!==null}get offset(){return[...this._offset]}set offset(e){(this._offset[0]!==e[0]||this._offset[1]!==e[1])&&(this._offset[0]=e[0],this._offset[1]=e[1],this._dirty=!0,this.correctChildPosition())}set constraints(e){(e[0]!==this._constraints[0]||e[1]!==this._constraints[1]||e[2]!==this._constraints[2]||e[3]!==this._constraints[3])&&(this._constraints[0]=e[0],this._constraints[1]=e[1],this._constraints[2]=e[2],this._constraints[3]=e[3],this.internalViewport===null?this.forceReLayout=!0:this.internalViewport.constraints=e)}get constraints(){return[...this._constraints]}get widthCoupling(){return this._widthCoupling}set widthCoupling(e){this._widthCoupling!==e&&(this._widthCoupling=e,this._layoutDirty=!0,this.forceReLayout=!0)}get heightCoupling(){return this._heightCoupling}set heightCoupling(e){this._heightCoupling!==e&&(this._heightCoupling=e,this._layoutDirty=!0,this.forceReLayout=!0)}get scaledMinWidth(){var e,t;return this.minWidth*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}get scaledMinHeight(){var e,t;return this.minHeight*((t=(e=this.root)==null?void 0:e.resolution)!=null?t:1)}get scaledConstraints(){var t,r;let e=(r=(t=this.root)==null?void 0:t.resolution)!=null?r:1;return[this._constraints[0]*e,this._constraints[1]*e,this._constraints[2]*e,this._constraints[3]*e]}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="canvasFill"&&(this._dirty=!0)}getBoundsOf(e){let[t,r]=e.idealDimensions,[n,s]=e.idealPosition,[o,a]=this.child.idealPosition,d=this.idealX+this.offset[0]+n-o,u=this.idealY+this.offset[1]+s-a;return[d,d+t,u,u+r]}handleEvent(e){if(e instanceof P){let[t,r,n,s]=this.getBoundsOf(this.child);if(e.target===null&&(e.x<t||e.x>=r||e.y<n||e.y>=s))return null;this.internalViewport!==null&&(e=e.correctOffset(t,n))}return this.child.dispatchEvent(e)}handlePreLayoutUpdate(){let e=this.child;e.preLayoutUpdate(),this._widthCoupling!==0||this._heightCoupling!==0?e.layoutDirty&&(this._layoutDirty=!0):this.internalViewport!==null?(this.internalViewport.constraints=this.scaledConstraints,this.internalViewport.resolveChildsLayout()):(e.layoutDirty||this.forceReLayout)&&(e.resolveDimensionsAsTop(...this.scaledConstraints),this.correctChildPosition())}handlePostFinalizeBounds(){if(this.internalViewport===null){let e=this.child;e.postFinalizeBounds(),e.layoutDirty&&(this._layoutDirty=!0)}}handlePostLayoutUpdate(){let e=this.child;this.forceReLayout=!1,e.postLayoutUpdate(),e.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this._widthCoupling!==0,o=this._heightCoupling!==0,a=Math.min(Math.max(e,this.scaledMinWidth),t),d=Math.min(Math.max(r,this.scaledMinHeight),n);if(this._widthCoupling!==1&&(this.idealWidth=Math.min(a,t),this._widthCoupling===2&&(a=this.idealWidth)),this.idealWidth===0&&this.minWidth===0&&this._widthCoupling!==1&&console.warn("ViewportWidget has no minimum width and width isn't bi-directionally coupled, therefore, it may be dimensionless. Set a minimum width and/or bi-directionally couple the width"),this._heightCoupling!==1&&(this.idealHeight=Math.min(d,n),this._heightCoupling===2&&(d=this.idealHeight)),this.idealHeight===0&&this.minHeight===0&&this._heightCoupling!==1&&console.warn("ViewportWidget has no minimum height and height isn't bi-directionally coupled, therefore, it may be dimensionless. Set a minimum height and/or bi-directionally couple the height"),s||o){let u=this.scaledConstraints;s&&(u[0]=a,this._widthCoupling===1&&(u[1]=t)),o&&(u[2]=d,this._heightCoupling===1&&(u[3]=n));let c=this.child;this.internalViewport===null?(c.resolveDimensionsAsTop(...u),this.correctChildPosition()):(this.internalViewport.constraints=u,this.internalViewport.resolveChildsLayout()),this._widthCoupling===1&&(this.idealWidth=c.idealDimensions[0]),this._heightCoupling===1&&(this.idealHeight=c.idealDimensions[1])}}afterPositionResolved(){this.correctChildPosition(),this.internalViewport===null&&(this.forceRePaint=!0)}finalizeBounds(){if(m.prototype.finalizeBounds.call(this),this.internalViewport===null)for(let e of this.children)e.finalizeBounds()}activate(e,t,r){m.prototype.activate.call(this,e,t,r);let n=this.internalViewport===null?t:this.internalViewport;for(let s of this.children)s.activate(e,n,r)}correctChildPosition(){if(this.internalViewport!==null)return;let[e,t]=this.offset;this.child.resolvePosition(this.idealX+e,this.idealY+t),this.child.finalizeBounds()}handlePainting(e){this.internalViewport!==null&&this.internalViewport.paintToCanvas(e);let[t,r,n,s]=this.rect,[o,a]=this.child.dimensions,[d,u]=this.offset,c=t+n,p=r+s,f=this.x+d,g=this.y+u,b=Math.min(Math.max(f,t),c),w=Math.min(Math.max(g,r),p),x=Math.min(Math.max(f+o,t),c)-b,_=Math.min(Math.max(g+a,r),p)-w;if(x===0||_===0){this.internalViewport===null&&this.child.dryPaint(),this.forceRePaint=!1;return}let y=this.viewport.context;this.clearStart(),y.rect(t,r,n,s),y.clip(),this.internalViewport!==null&&y.drawImage(this.internalViewport.canvas,b-f,w-g,x,_,b,w,x,_),y.rect(b,w,x,_),this.clearEnd("evenodd"),this.internalViewport===null&&(y.save(),y.beginPath(),y.rect(b,w,x,_),y.clip(),this.child.paint(e||this.forceRePaint),y.restore()),this.forceRePaint=!1}};l(Ee,"ViewportWidget"),k([J],Ee.prototype,"minWidth",2),k([J],Ee.prototype,"minHeight",2);var Jt=(t=>(t[t.Overlay=0]="Overlay",t[t.Layout=1]="Layout",t[t.Hidden=2]="Hidden",t))(Jt||{}),tt=class extends Ee{constructor(e,t=0,r=0,n=0,s=0,o=0,a=!1,d){super(e,t,r,n,s,a,d);this.effectiveWidth=0;this.effectiveHeight=0;this.verticalDragged=null;this.startingScroll=0;this.startingOffset=0;this.lastScroll=0;this.horizWasPainted=!1;this.vertWasPainted=!1;this._scrollLineHeight=0;this._scrollbarMode=o,this.horizontalClickHelper=new te(this),this.verticalClickHelper=new te(this),this.updateScrollLineHeight()}get scrollbarMode(){return this._scrollbarMode}set scrollbarMode(e){if(this._scrollbarMode!==e){let t=this.scroll;this._scrollbarMode=e,this.scroll=t,this._layoutDirty=!0,this._dirty=!0}}get offset(){return super.offset}set offset(e){let[t,r]=this.child.idealDimensions;super.offset=[-Math.max(Math.min(-e[0],t-this.effectiveWidth),0),-Math.max(Math.min(-e[1],r-this.effectiveHeight),0)]}get widthCoupling(){return super.widthCoupling}set widthCoupling(e){let t=this.scroll;super.widthCoupling=e,this.scroll=t}get heightCoupling(){return super.heightCoupling}set heightCoupling(e){let t=this.scroll;super.heightCoupling=e,this.scroll=t}get scroll(){let[e,t]=this.offset,[r,n]=this.child.idealDimensions,s=r-this.effectiveWidth,o=n-this.effectiveHeight;return[s===0?0:Math.min(Math.max(-e/s,0),1),o===0?0:Math.min(Math.max(-t/o,0),1)]}set scroll(e){let[t,r]=this.child.idealDimensions;this.offset=[-e[0]*(t-this.effectiveWidth),-e[1]*(r-this.effectiveHeight)]}getClickHelper(e){return e?this.verticalClickHelper:this.horizontalClickHelper}handleEventScrollbar(e,t,r,n){if(this.verticalDragged!==null&&this.verticalDragged!==e)return!1;let[s,o]=this.getScrollbarRects(e,t),a=this._scrollbarMode===0,d=a?s:o,u=[d[0],d[0]+d[2],d[1],d[1]+d[3]],c=this.getClickHelper(e);c.handleClickEvent(r,n,u);let p=c.clickState,f=c.clickStateChanged;if(f&&(this._dirty=!0),p===2){if(c.pointerPos===null||!(r instanceof P))return!0;let g=e?1:0,b=this.scroll,w=a;w||(w=c.isPointInRect(r.x,r.y,s[0],s[0]+s[2],s[1],s[1]+s[3]));let x;if(a?x=c.getNormalInRect(r.x,r.y,o[0],o[0]+o[2],o[1],o[1]+o[3])[g]:x=c.pointerPos[g],f){if(!w){let _=e?this.effectiveHeight:this.effectiveWidth,y=this.child.idealDimensions[g],T=_/y;b[g]=(x-T/2)/(1-T),this.scroll=b}this.startingOffset=x,this.startingScroll=b[g],this.verticalDragged=e}else{let _=e?this.effectiveHeight:this.effectiveWidth,y=this.child.idealDimensions[g],T=_/y,M=x-this.startingOffset;b[g]=this.startingScroll+M/(1-T),this.scroll=b}return!0}else{if(p===1)return!0;if(f)return this.verticalDragged=null,!0}return!1}clampOffset(e){let[t,r]=this.child.idealDimensions,n=-(t-this.effectiveWidth);n>=0?e[0]=0:e[0]<n&&(e[0]=n);let s=-(r-this.effectiveHeight);s>=0?e[1]=0:e[1]<s&&(e[1]=s)}handleWheelEvent(e){let t=this.offset,[r,n]=t,[s,o]=e.getDeltaPixels(!0,this._scrollLineHeight,this.idealWidth,this.idealHeight);t[0]-=e.shift?o:s,t[1]-=e.shift?s:o,this.clampOffset(t),this.offset=t;let[a,d]=this.offset,u=a!==r||d!==n,c=this.lastScroll,p=new Date().getTime();return this.lastScroll=p,u?!0:e.fromDrag?!1:p-c<200}updateScrollLineHeight(){let e=new C;e.font=this.bodyTextFont,e.lineHeight=this.bodyTextHeight,e.lineSpacing=this.bodyTextSpacing,this._scrollLineHeight=e.fullLineHeight}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="bodyTextFont"||e==="bodyTextHeight"||e==="bodyTextSpacing"?this.updateScrollLineHeight():e==="scrollBarThickness"?(this._layoutDirty=!0,this._dirty=!0):(e==="backgroundFill"||e==="scrollBarMinPercent"||e==="scrollBarMinPixels"||e==="primaryFill"||e==="accentFill"||e==="backgroundGlowFill")&&(this._dirty=!0)}handleEvent(e){let t=this.widthCoupling===1,r=this.heightCoupling===1;if(this._scrollbarMode!==2&&(e instanceof S||e instanceof P)&&(e.target===null||e.target===this)){let[s,o]=this.child.idealDimensions,a=this._scrollbarMode===0,d=!a&&!t&&!r,u=s>this.idealWidth,c=o>this.idealHeight,p=!1;if(!t&&(u||!a)&&this.handleEventScrollbar(!1,c||d,e,this.root)&&(p=!0),!r&&(c||!a)&&this.handleEventScrollbar(!0,u||d,e,this.root)&&(p=!0),p)return e instanceof D&&this.handleWheelEvent(e),this}let n=super.handleEvent(e);if(n!==null&&e instanceof z){let s=this._scrollbarMode===1,o=s&&!r,a=s&&!t,d=this.effectiveWidth,u=this.effectiveHeight;if(!o||!a){let X=this.scrollBarThickness,[Re,ft]=this.child.idealDimensions,ei=Re>this.idealWidth,ti=ft>this.idealHeight,ii=this.scrollbarNeedsPaint(!1,ei),ri=this.scrollbarNeedsPaint(!0,ti);this._scrollbarMode!==2&&(!o&&ri&&(d=Math.max(0,d-X)),!a&&ii&&(u=Math.max(0,u-X)))}let[c,p]=n.idealPosition,[f,g]=this.offset,b=f,w=g;this.usesViewport&&(c+=this.idealX+f,p+=this.idealY+g);let[x,_,y,T]=e.bounds;x+=c,_+=c,y+=p,T+=p;let M=this.idealX+d,H=this.idealY+u,B=!t&&!(x>=this.idealX&&_<=M)&&!(this.idealX>=x&&M<=_);if(B){let X=_-x>d,Re=x<this.idealX;X!==Re?f+=this.idealX-x:f+=M-_}let Y=!r&&!(y>=this.idealY&&T<=H)&&!(this.idealY>=y&&H<=T);if(Y){let X=T-y>u,Re=y<this.idealY;X!==Re?g+=this.idealY-y:g+=H-T}(B||Y)&&(this.offset=[f,g]);let[be,se]=this.offset,it=be-b+c-this.idealX,rt=se-w+p-this.idealY;return e.bounds[0]+=it,e.bounds[1]+=it,e.bounds[2]+=rt,e.bounds[3]+=rt,this}return n===null&&e instanceof D&&this.handleWheelEvent(e)?this:n}handleResolveDimensions(e,t,r,n){let s=this.scrollBarThickness,o=this._scrollbarMode===1,a=o&&this.heightCoupling!==1,d=o&&this.widthCoupling!==1,u,c,p,f;a?(c=Math.max(t-s,0),u=Math.min(e,c)):(c=t,u=e),d?(f=Math.max(n-s,0),p=Math.min(r,f)):(f=n,p=r),super.handleResolveDimensions(u,c,p,f),this.effectiveWidth=this.idealWidth,this.effectiveHeight=this.idealHeight,a&&(this.idealWidth=Math.min(Math.max(this.idealWidth+s,e),t)),d&&(this.idealHeight=Math.min(Math.max(this.idealHeight+s,r),n))}handlePostLayoutUpdate(){super.handlePostLayoutUpdate();let e=this.offset;this.clampOffset(e),this.offset=e}handlePainting(e){let[t,r]=this.child.idealDimensions,n=t>this.idealWidth,s=r>this.idealHeight,o=this.scrollbarNeedsPaint(!1,n),a=this.scrollbarNeedsPaint(!0,s);this.horizWasPainted!==o||this.vertWasPainted!==a?(this.horizWasPainted=o,this.vertWasPainted=a,this.forceRePaint=!0):this.scrollbarMode===0&&(this.forceRePaint=!0),super.handlePainting(e);let d=this._scrollbarMode===1&&this.widthCoupling!==1&&this.heightCoupling!==1;if(o&&this.paintScrollbar(!1,n,s||d),a&&this.paintScrollbar(!0,s,n||d),d){let u=this.scrollBarThickness,c=this.viewport.context;c.fillStyle=this.backgroundFill,c.fillRect(this.x+this.width-u,this.y+this.height-u,u,u)}}getScrollbarRects(e,t){let r=this._scrollbarMode===0,n=e?1:0,s=this.scroll[n],o=this.child.idealDimensions[n],a=e?this.effectiveHeight:this.effectiveWidth,d=this.scrollBarThickness,u=this.scrollBarMinPercent,c=this.scrollBarMinPixels,p=a;r&&(p-=t?d:0);let f=Math.min(Math.max(c,Math.max(a/o,u)*p),p),g=(p-f)*s,b,w,x,_;e?(b=this.idealX+this.idealWidth-d,w=this.idealY+g,x=d,_=f):(b=this.idealX+g,w=this.idealY+this.idealHeight-d,x=f,_=d);let y,T,M,H;return e?(y=b,T=this.idealY,M=d,H=p):(y=this.idealX,T=w,M=p,H=d),[[b,w,x,_],[y,T,M,H]]}scrollbarNeedsPaint(e,t){return this._scrollbarMode===2||!t&&this._scrollbarMode===0?!1:e?this.heightCoupling!==1:this.widthCoupling!==1}paintScrollbar(e,t,r){let[n,s]=this.getScrollbarRects(e,r),o=this.viewport.context;if(this._scrollbarMode!==0&&(o.fillStyle=this.backgroundFill,o.fillRect(...s)),t)switch(this.getClickHelper(e).clickState){case 0:o.fillStyle=this.primaryFill;break;case 1:case 2:o.fillStyle=this.accentFill;break}else o.fillStyle=this.backgroundGlowFill;o.fillRect(...n)}};l(tt,"ScrollableViewportWidget");var pt=class extends m{constructor(e=null,t=0,r=1,n=0,s=0,o=!1,a){super(!0,!1,a);this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.keyboardFocused=!1;if(r<t)throw new Error("Slider max value can't be smaller than minimum value");if(!isFinite(t)||isNaN(t))throw new Error("Slider min value must be a valid finite number");if(!isFinite(r)||isNaN(r))throw new Error("Slider max value must be a valid finite number");if(!isFinite(n)||isNaN(n))throw new Error("Slider increment value must be a valid finite number");if(n<0)throw new Error("Slider increment value must be greater or equal to zero");this.clickHelper=new te(this),this.variable=new me(this.clamp(s)),e&&this.variable.watch(e),this.minValue=t,this.maxValue=r,this.snapIncrement=n,this.vertical=o,this.tabFocusable=!0}set value(e){this.setValue(e)}get value(){return this.variable.value}clamp(e){return e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),e}setValue(e,t=!0){this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),this.variable.setValue(this.clamp(e),t)}stepValue(e,t){let r=this.snapIncrement;r===0&&(r=.01*(this.maxValue-this.minValue)),r*=t;let n=e?1:-1;this.value=this.clamp((Math.round(this.value/r)+n)*r)}onThemeUpdated(e=null){super.onThemeUpdated(e),e===null?(this._layoutDirty=!0,this._dirty=!0):e==="sliderThickness"||e==="sliderMinLength"?(this._layoutDirty=!0,this._dirty=!0):(e==="accentFill"||e==="primaryFill"||e==="backgroundFill")&&(this._dirty=!0)}onFocusGrabbed(e){e===1&&(this.keyboardFocused=!0)}onFocusDropped(e){e===1&&(this.keyboardFocused=!1)}handleEvent(e){if(e instanceof D||!(e instanceof P||e instanceof N||e instanceof S)||e instanceof L&&(e.key==="Tab"||e.key==="Escape"))return null;if(e instanceof N){if(e instanceof L){let n=e.shift?10:1;e.key==="ArrowLeft"||e.key==="ArrowDown"?this.stepValue(!1,n):(e.key==="ArrowRight"||e.key==="ArrowUp")&&this.stepValue(!0,n)}return this}let t=this.idealX+this.offsetX,r=this.idealY+this.offsetY;if(this.clickHelper.handleClickEvent(e,this.root,[t,t+this.actualWidth,r,r+this.actualHeight]),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState==2)&&this.clickHelper.pointerPos!==null){let n=this.clickHelper.pointerPos[0];this.value=this.minValue+n*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handlePostLayoutUpdate(){this.variable.dirty&&(this._dirty=!0)}handleResolveDimensions(e,t,r,n){let s=this.sliderThickness,o=this.sliderMinLength;this.vertical?(n!=1/0?this.idealHeight=n:this.idealHeight=Math.max(o,r),this.idealWidth=Math.min(Math.max(s,e),t)):(t!=1/0?this.idealWidth=t:this.idealWidth=Math.max(o,e),this.idealHeight=Math.min(Math.max(s,r),n))}finalizeBounds(){super.finalizeBounds(),this.vertical?(this.actualWidth=Math.min(this.width,this.sliderThickness),this.actualHeight=this.height,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=0):(this.actualWidth=this.width,this.actualHeight=Math.min(this.height,this.sliderThickness),this.offsetX=0,this.offsetY=(this.height-this.actualHeight)/2)}handlePainting(e){let t=this.x+this.offsetX,r=this.y+this.offsetY,n=this.viewport.context,s=this.keyboardFocused||this.clickHelper.clickState===1||this.clickHelper.clickState===2;s?n.fillStyle=this.accentFill:n.fillStyle=this.primaryFill;let o=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);n.fillRect(t,r,o,this.actualHeight),s?n.fillStyle=this.backgroundGlowFill:n.fillStyle=this.backgroundFill;let a=this.actualWidth-o;n.fillRect(t+o,r,a,this.actualHeight)}};l(pt,"Slider"),k([Te],pt.prototype,"keyboardFocused",2);var Mt=class extends tt{constructor(i,e=null,t="",r=0,n=0,s=2,o=!1,a){super(new ne(i,e,t,a),r,n,2,2,s,o),this.child.typeableTab=!0}get textInput(){return this.child}};l(Mt,"TextArea");var Et=class extends fe{constructor(i,e){let t=q({},e);t.containerAlignment={horizontal:.5,vertical:"stretch"},super(i,t)}};l(Et,"TextMargin");var Rt=class extends Pe{constructor(e,t){super(e);this.scopeTheme=t}set inheritedTheme(e){super.inheritedTheme=this.scopeTheme}get inheritedTheme(){return this.scopeTheme}};l(Rt,"ThemeScope");export{oe as Alignment,Ft as AltKey,ve as ArtificialConstraint,z as AutoScroll,ct as AxisCoupling,Xe as BackspaceKey,he as BaseContainer,W as BaseTheme,St as BasicTextInput,Z as BasicVirtualKey,Ce as Button,ce as ButtonClickHelper,Wt as Center,Je as Checkbox,te as ClickHelper,ee as ClickState,Qe as Column,Ue as CompoundClickHelper,fe as Container,Ct as ControlKey,Tt as DOMKeyboardDriver,wt as DOMPointerDriver,Oe as DOMRoot,vt as DOMVirtualKeyboardRoot,_t as DebugTheme,zr as DefaultTextInputHandler,Ti as DefaultTextValidator,$e as EnterKey,Ge as EscapeKey,O as Event,Se as FilledButton,nt as FlexAlignment,Vo as FloatValidator,E as FocusType,_e as GenericClickHelper,Ke as GlyphVirtualKey,ge as Icon,Dt as IconButton,Ao as IntValidator,N as KeyEvent,L as KeyPress,ue as KeyRelease,Ze as KeyboardDriver,ie as Label,Ht as LabelledCheckbox,Lt as LabelledRadioButton,S as Leave,Mo as MakeCompositeValidator,qt as MakeDefaultTextValidatorWithCallback,Oo as MakeRangeValidator,He as Margin,xe as ModifierEvent,le as MultiContainer,Ie as MultiParent,ke as Parent,Pe as PassthroughWidget,Fe as PointerButtonEvent,Le as PointerDriver,P as PointerEvent,jt as PointerHint,re as PointerMove,I as PointerPress,K as PointerRelease,D as PointerWheel,$t as PointerWheelMode,et as RadioButton,Pt as RayPointerDriver,F as Root,pe as Row,tt as ScrollableViewportWidget,Jt as ScrollbarMode,Ne as ShiftKey,ae as SingleParent,pt as Slider,ze as SpaceKey,Me as Spacing,A as TabSelect,gt as TextAlignMode,Mt as TextArea,We as TextButton,C as TextHelper,ne as TextInput,Et as TextMargin,de as TextPasteEvent,R as Theme,Rt as ThemeScope,qe as Variable,U as Viewport,Ee as ViewportWidget,j as VirtualKey,Ye as VirtualKeyRow,De as VirtualKeyboard,xt as VirtualKeyboardRoot,me as WatchableVariable,m as Widget,Xt as WrapMode,je as defaultVirtualKeyboardTemplate,Ut as flagArrayField,It as flagField,kt as getPointerEventNormPos,$r as injectDebugCode,Q as injectRandomFillFeature,v as injectStackTraceFeature,dt as injectTraceFeature,ht as injectWatchflagFeature,ye as isDebugFeatureEnabled,yt as isPower2,Kt as layoutArrayField,J as layoutField,ci as listDebugFeatures,st as measureTextDims,li as multiFlagArrayField,G as multiFlagField,lt as paintArrayField,Te as paintField,Yt as paintLayoutArrayField,Ai as paintLayoutField,Nt as parseDOMDeltaMode,bt as roundToPower2,ui as toggleDebugFeature,Ot as watchArrayField,ot as watchField};
//# sourceMappingURL=index.esm.js.map
