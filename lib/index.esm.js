import{Mixin as t}from"ts-mixer";function e(t){return new Promise(((e,i)=>{function s(){document.body.removeChild(h),document.body.removeChild(r)}function n(){s(),e(a.value)}const r=document.createElement("div");r.id="textInputHandlerOverlay";const h=document.createElement("div");h.id="textInputHandler";const l=document.createElement("p");l.textContent="Change text:";const a=document.createElement("input");a.addEventListener("keyup",(function(t){"Enter"==t.key&&(t.preventDefault(),n())})),a.value=t;const o=document.createElement("div"),c=document.createElement("button");c.addEventListener("click",(function(){s(),e(t)})),c.textContent="Cancel";const u=document.createElement("button");u.addEventListener("click",n),u.textContent="OK",o.appendChild(c),o.appendChild(u),h.appendChild(l),h.appendChild(a),h.appendChild(o),document.body.appendChild(r),document.body.appendChild(h),a.focus({preventScroll:!1})}))}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function i(t,e,i,s){return new(i||(i=Promise))((function(n,r){function h(t){try{a(s.next(t))}catch(t){r(t)}}function l(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(h,l)}a((s=s.apply(t,e||[])).next())}))}function s(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function n(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i}class r{constructor(t,e=null){this.properties=t,this.fallback=e}getProperty(t){let e=this.properties.get(t);if(void 0===e){if(null===this.fallback)throw new Error(`Theme property ${t} is not available`);e=this.fallback.getProperty(t)}return e}getString(t){const e=this.getProperty(t);if("string"!=typeof e)throw new Error(`Theme property ${t} is not a string`);return e}getNumber(t){const e=this.getProperty(t);if("number"!=typeof e)throw new Error(`Theme property ${t} is not a number`);return e}getPadding(t){return this.getProperty(t)}getAlignment(t){return this.getProperty(t)}getAlignment2D(t){return this.getProperty(t)}getFill(t){return this.getString(t)}getFont(t){return this.getString(t)}getSize(t){return this.getNumber(t)}}var h,l;!function(t){t[t.CanvasFill=0]="CanvasFill",t[t.ContainerPadding=1]="ContainerPadding",t[t.ContainerSpacing=2]="ContainerSpacing",t[t.ContainerAlignment=3]="ContainerAlignment",t[t.PrimaryFill=4]="PrimaryFill",t[t.AccentFill=5]="AccentFill",t[t.BackgroundFill=6]="BackgroundFill",t[t.BackgroundGlowFill=7]="BackgroundGlowFill",t[t.SliderFlexRatio=8]="SliderFlexRatio",t[t.SliderMainBasis=9]="SliderMainBasis",t[t.SliderCrossBasis=10]="SliderCrossBasis",t[t.BodyTextFont=11]="BodyTextFont",t[t.BodyTextFill=12]="BodyTextFill",t[t.LabelMinWidth=13]="LabelMinWidth",t[t.LabelMinAscent=14]="LabelMinAscent",t[t.LabelMinDescent=15]="LabelMinDescent",t[t.CheckboxLength=16]="CheckboxLength",t[t.CheckboxInnerPadding=17]="CheckboxInnerPadding",t[t.InputBackgroundFill=18]="InputBackgroundFill",t[t.InputTextFont=19]="InputTextFont",t[t.InputTextFill=20]="InputTextFill",t[t.InputTextFillDisabled=21]="InputTextFillDisabled",t[t.InputTextFillInvalid=22]="InputTextFillInvalid",t[t.InputTextFlexRatio=23]="InputTextFlexRatio",t[t.InputTextMinWidth=24]="InputTextMinWidth",t[t.InputTextMinAscent=25]="InputTextMinAscent",t[t.InputTextMinDescent=26]="InputTextMinDescent",t[t.BlinkRate=27]="BlinkRate",t[t.CursorPadding=28]="CursorPadding",t[t.CursorThickness=29]="CursorThickness",t[t.ScrollBarThickness=30]="ScrollBarThickness"}(h||(h={})),function(t){t[t.Stretch=0]="Stretch",t[t.Start=1]="Start",t[t.Center=2]="Center",t[t.End=3]="End"}(l||(l={}));const a=new r(new Map([[h.CanvasFill,"rgba(0,0,0,0.5)"],[h.ContainerPadding,{left:4,right:4,top:4,bottom:4}],[h.ContainerAlignment,{horizontal:l.Start,vertical:l.Start}],[h.ContainerSpacing,4],[h.PrimaryFill,"rgb(0,127,255)"],[h.AccentFill,"rgb(0,195,255)"],[h.BackgroundFill,"rgb(32,32,32)"],[h.BackgroundGlowFill,"rgb(48,48,48)"],[h.SliderFlexRatio,1],[h.SliderMainBasis,100],[h.SliderCrossBasis,10],[h.BodyTextFont,"16px sans"],[h.BodyTextFill,"white"],[h.LabelMinWidth,0],[h.LabelMinAscent,0],[h.LabelMinDescent,3],[h.CheckboxLength,12],[h.CheckboxInnerPadding,2],[h.InputBackgroundFill,"white"],[h.InputTextFont,"16px mono"],[h.InputTextFill,"black"],[h.InputTextFillDisabled,"grey"],[h.InputTextFillInvalid,"red"],[h.InputTextFlexRatio,1],[h.InputTextMinWidth,100],[h.InputTextMinAscent,16],[h.InputTextMinDescent,3],[h.BlinkRate,.8],[h.CursorPadding,2],[h.CursorThickness,2],[h.ScrollBarThickness,10]]));var o,c,u;!function(t){t[t.Pointer=0]="Pointer",t[t.Keyboard=1]="Keyboard"}(o||(o={}));class d{constructor(t,e,i){this.target=t,this.focusType=e,this.needsFocus=i}}class p extends d{constructor(t=null){super(t,o.Pointer,!0)}cloneWithTarget(t){return new p(t)}}function f(t,e=!0){const i=e?Math.ceil:Math.floor;return Math.pow(2,i(Math.log2(t)))}class v{constructor(t,e,i){this.hBasis=0,this.vBasis=0,this.hFlex=0,this.vFlex=0,this.sizeChanged=!1,this.maxWidth=t,this.maxHeight=e,this.vertical=i}clone(){const t=new v(this.maxWidth,this.maxHeight,this.vertical);return t.hBasis=this.hBasis,t.vBasis=this.vBasis,t.hFlex=this.hFlex,t.vFlex=this.vFlex,t}addBasis(t,e){this.vertical?(this.vBasis+=e,t>this.hBasis&&(this.hBasis=t)):(this.hBasis+=t,e>this.vBasis&&(this.vBasis=e))}}class g{constructor(t=64,e=64){this._maxDimensions=[0,0],this.forceLayout=!1,this.vertical=!0,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e;const i=this.canvas.getContext("2d",{alpha:!0});if(null===i)throw"Failed to get canvas context";this.context=i}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}set maxDimensions(t){this._maxDimensions[0]===t[0]&&this._maxDimensions[1]===t[1]||(this._maxDimensions[0]=t[0],this._maxDimensions[1]=t[1],this.forceLayout=!0)}get maxDimensions(){return[this._maxDimensions[0],this._maxDimensions[1]]}populateChildsLayout(t){if(this.forceLayout&&(this.forceLayout=!1,t.forceLayoutDirty()),!t.layoutDirty)return null;const e=new v(this._maxDimensions[0],this._maxDimensions[1],this.vertical);return t.populateLayout(e),e}resolveChildsLayout(t,e){if(!t.layoutDirty||null===e)return!1;const[i,s]=t.dimensions;t.resolveLayout(e);const[n,r]=t.dimensions;let h=!1;if(n!==i||r!==s){const t=f(n);t>this.canvas.width&&(this.canvas.width=t);const e=f(r);e>this.canvas.height&&(this.canvas.height=e),h=!0}return(e.sizeChanged||h)&&t.forceLayoutDirty(),h}paintToCanvas(t){const e=t.dirty;return e&&t.paint(0,0,...t.dimensions,this.context),e}}class m{constructor(t,e=null,i=a){this.drivers=new Set,this._enabled=!0,this.pointerStyle="default",this._currentPointerStyle="default",this._foci=new Map([[o.Keyboard,null],[o.Pointer,null]]),this._fociCapturers=new Map([[o.Keyboard,null],[o.Pointer,null]]),this.textInputHandler=null,this._mobileTextInUse=!1,this.viewport=new g,this.child=t,this.pointerStyleHandler=e,this.child.inheritedTheme=i}get maxDimensions(){return this.viewport.maxDimensions}set maxDimensions(t){this.viewport.maxDimensions=t}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t)if(this._enabled=t,t)for(const t of this.drivers)t.onEnable(this);else{for(const t of this.drivers)t.onDisable(this);this.updatePointerStyle("default");for(const t of this._foci.keys())this.clearFocus(t)}}get canvas(){return this.viewport.canvas}resolveLayout(){if(!this.enabled)return!1;const t=this.viewport.populateChildsLayout(this.child);return this.viewport.resolveChildsLayout(this.child,t)}paint(){return!!this.enabled&&this.viewport.paintToCanvas(this.child)}dispatchEvent(t){var e;if(!this.enabled)return;if(null!==t.focusType&&null===t.target){let e=this._foci.get(t.focusType);if(void 0===e&&(e=null),t.needsFocus&&null===e)return;t=t.cloneWithTarget(e)}this.pointerStyle="default";const[i,s]=this.dimensions,n=this.child.dispatchEvent(t,i,s,this);if(null===n&&null!==t.focusType&&this.clearFocus(t.focusType),null===t.focusType)return;const r=null!==(e=this._fociCapturers.get(t.focusType))&&void 0!==e?e:null;if(r!==n){t.focusType===o.Pointer&&null!==r&&this.child.dispatchEvent(new p(r),i,s,this),this._fociCapturers.set(t.focusType,n);for(const e of this.drivers)e.onFocusCapturerChanged(this,t.focusType,r,n)}}preLayoutUpdate(){if(this.enabled){for(const t of this.drivers)t.update(this);this.child.preLayoutUpdate(this)}}postLayoutUpdate(){this.enabled&&(this.child.postLayoutUpdate(this),this.updatePointerStyle())}updatePointerStyle(t=null){null!==t&&(this.pointerStyle=t),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,null!==this.pointerStyleHandler&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(t,e){if(null!==e){if(e!==this._foci.get(t)){this.clearFocus(t),this._foci.set(t,e);for(const i of this.drivers)i.onFocusChanged(this,t,e)}}}dropFocus(t,e){e===this._foci.get(t)&&this.clearFocus(t)}clearFocus(t){const e=this._foci.get(t);if(null!=e){e.onFocusDropped(t,this),this._foci.set(t,null);for(const e of this.drivers)e.onFocusChanged(this,t,null)}}getFocus(t){var e;return null!==(e=this._foci.get(t))&&void 0!==e?e:null}getFocusCapturer(t){var e;return null!==(e=this._fociCapturers.get(t))&&void 0!==e?e:null}registerDriver(t){this.drivers.has(t)||(this.drivers.add(t),this._enabled&&t.onEnable&&t.onEnable(this))}unregisterDriver(t){this.drivers.delete(t)&&this._enabled&&t.onDisable&&t.onDisable(this)}clearDrivers(){if(this._enabled)for(const t of this.drivers)this.unregisterDriver(t)}get hasMobileTextInput(){return null!==this.textInputHandler&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(t=""){return i(this,void 0,void 0,(function*(){if(null!==this.textInputHandler&&!this._mobileTextInUse){this._mobileTextInUse=!0;const e=yield this.textInputHandler(t);return this._mobileTextInUse=!1,e}return null}))}}class y extends m{constructor(t,e=a){super(t,null,e),c.set(this,void 0),this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,[this.domElem.width,this.domElem.height]=this.dimensions;const i=this.domElem.getContext("2d",{alpha:!0});if(null===i)throw"Failed to get DOM canvas context";n(this,c,i),this.pointerStyleHandler=t=>{this.domElem.style.cursor=t}}update(){this.enabled?(this.domElem.style.removeProperty("display"),this.preLayoutUpdate(),this.resolveLayout()&&([this.domElem.width,this.domElem.height]=this.dimensions),this.postLayoutUpdate(),this.paint()&&(s(this,c).globalCompositeOperation="copy",s(this,c).drawImage(this.canvas,0,0))):this.domElem.style.display="none"}}c=new WeakMap;class x extends d{constructor(t,e,i=null,s=null){super(i,s,!1),this.x=t,this.y=e}}class _ extends x{constructor(t,e,i=null){super(t,e,i,o.Pointer)}correctOffset(t,e){return new _(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new _(this.x,this.y,t)}}class b extends x{constructor(t,e,i=null){super(t,e,i)}correctOffset(t,e){return new b(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new b(this.x,this.y,t)}}class C{constructor(t,e,i){this._enabled=!0,this._dirty=!0,this._layoutDirty=!0,this._theme=null,this._inheritedTheme=null,this.resolvedWidth=0,this.resolvedHeight=0,this.needsClear=e,this.propagatesEvents=i,this._themeOverride=t}updateInheritedTheme(){}updateTheme(){null===this._themeOverride?this._theme=this._inheritedTheme:(this._themeOverride.fallback=this._inheritedTheme,this._theme=this._themeOverride)}get theme(){if(null===this._theme)throw"Widget theme is not ready";return this._theme}set enabled(t){t!==this._enabled&&(this._enabled=t,this._dirty=t,this._layoutDirty=!0)}get enabled(){return this._enabled}setThemeOverride(t){this._themeOverride!==t&&(this._themeOverride=t,this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set themeOverride(t){this.setThemeOverride(t)}get themeOverride(){return this._themeOverride}inheritTheme(t){this._inheritedTheme!==t&&(this._inheritedTheme=t,this.updateInheritedTheme(),this.updateTheme(),this._enabled&&(this._layoutDirty=!0,this._dirty=!0))}set inheritedTheme(t){this.inheritTheme(t)}get inheritedTheme(){return this._inheritedTheme}get dimensions(){return[this.resolvedWidth,this.resolvedHeight]}get dirty(){return this._dirty}get layoutDirty(){return this._layoutDirty}onFocusDropped(t,e){}handleEvent(t,e,i,s){return t.target===this||t instanceof x&&null===t.target?this:null}dispatchEvent(t,e,i,s){if(!this._enabled)return null;if(null===t.target){if(t instanceof x&&(t.x<0||t.y<0||t.x>=e||t.y>=i))return null}else if(t.target!==this&&!this.propagatesEvents)return null;return this.handleEvent(t,e,i,s)}handlePreLayoutUpdate(t){}preLayoutUpdate(t){this._enabled&&this.handlePreLayoutUpdate(t)}handlePopulateLayout(t){throw"Widget.handlePopulateLayout must be implemented"}handleResolveLayout(t){throw"Widget.handleResolveLayout must be implemented"}populateLayout(t){this._enabled&&this.handlePopulateLayout(t)}resolveLayout(t){if(!this._enabled)return this.resolvedWidth=0,this.resolvedHeight=0,void(this._layoutDirty=!1);if(this._layoutDirty){const e=this.resolvedWidth,i=this.resolvedHeight;this.handleResolveLayout(t),this._layoutDirty=!1,e===this.resolvedWidth&&i===this.resolvedHeight||(this._dirty=!0)}}forceLayoutDirty(){this._layoutDirty=!0,this._dirty=!0}handlePostLayoutUpdate(t){}postLayoutUpdate(t){this._enabled&&this.handlePostLayoutUpdate(t)}clear(t,e,i,s,n){n.save(),n.globalCompositeOperation="copy",n.fillStyle=this.theme.getFill(h.CanvasFill),n.beginPath(),n.rect(Math.trunc(t),Math.trunc(e),Math.ceil(i),Math.ceil(s)),n.clip(),n.fill(),n.restore()}handlePainting(t,e,i,s,n){}paint(t,e,i,s,n){this._dirty&&(this._enabled&&(this.needsClear&&this.clear(t,e,i,s,n),n.save(),this.handlePainting(t,e,i,s,n),n.restore()),this._dirty=!1)}}!function(t){t[t.Released=0]="Released",t[t.Hover=1]="Hover",t[t.Hold=2]="Hold"}(u||(u={}));class w extends C{constructor(){super(...arguments),this.lastClickState=u.Released,this.clickState=u.Released,this.clickStateChanged=!1,this.wasClick=!1,this.pointerPos=null,this.startingPointerPos=null}getNormalInRect(t,e,i,s,n,r){return[(t-i)/(s-i),(e-n)/(r-n)]}isPointInRect(t,e,i,s,n,r){return t>=i&&t<s&&e>=n&&e<r}isNormalInRect(t,e){return t>=0&&t<1&&e>=0&&e<1}setClickState(t,e){this.clickState!==t?(this.lastClickState=this.clickState,this.clickState=t,this.wasClick=e&&this.lastClickState===u.Hold,this.clickStateChanged=!0):this.clickStateChanged=!1}handleClickEvent(t,e,i){if(t instanceof p)return e.dropFocus(o.Pointer,this),this.pointerPos=null,this.setClickState(u.Released,!1);if(t instanceof x){this.pointerPos=this.getNormalInRect(t.x,t.y,...i);const s=this.isNormalInRect(...this.pointerPos);if(s)e.pointerStyle="pointer";else if(null===t.target)return e.dropFocus(o.Pointer,this),this.setClickState(u.Released,!1);return t instanceof b?(this.startingPointerPos=this.pointerPos,e.requestFocus(o.Pointer,this),this.setClickState(u.Hold,s)):t instanceof _?(e.dropFocus(o.Pointer,this),s?this.setClickState(u.Hover,s):this.setClickState(u.Released,s)):null===t.target?this.setClickState(u.Hover,s):this.setClickState(u.Hold,s)}this.clickStateChanged=!1}}class B extends C{constructor(t,e,i,s){super(e,i,s),this._children=[];for(const e of t)this._children.push(e)}updateInheritedTheme(){const t=this.inheritedTheme;if(null!==t)for(const e of this.children)e.inheritedTheme=t}forceLayoutDirty(){if(super.forceLayoutDirty(),this.enabled&&null!==this._children)for(const t of this.children)t.forceLayoutDirty()}get childCount(){return this._children.length}get children(){return this._children.values()}}class k extends B{constructor(t,e,i,s){super([t],e,i,s)}get child(){return this._children[0]}}class L extends k{constructor(t,e,i=null){super(t,i,!1,e),this._backgroundDirty=!0}handleEvent(t,e,i,s){const[n,r,h,l]=this.calcChildViewport(0,0,e,i);return t instanceof x&&(t=t.correctOffset(n,h)),this.child.dispatchEvent(t,r-n,l-h,s)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}forceLayoutDirty(){this._backgroundDirty=!0,super.forceLayoutDirty()}handlePopulateLayout(t){const e=this.theme.getPadding(h.ContainerPadding);let i=t.maxWidth;const s=e.left+e.right;t.vertical&&(i-=s);let n=t.maxHeight;const r=e.top+e.bottom;t.vertical||(n-=r);const l=new v(i,n,t.vertical);this.child.populateLayout(l),t.addBasis(l.hBasis+s,l.vBasis+r),t.hFlex+=l.hFlex,t.vFlex+=l.vFlex;const a=l.hBasis+s;a>t.maxWidth&&(t.maxWidth=a);const o=l.vBasis+r;o>t.maxHeight&&(t.maxHeight=o)}handleResolveLayout(t){const e=this.theme.getPadding(h.ContainerPadding),i=e.left+e.right;let s=t.maxWidth;t.vertical&&(s-=i);const n=e.top+e.bottom;let r=t.maxHeight;t.vertical||(r-=n);const l=t.clone();l.maxWidth=s,l.maxHeight=r;const a=this.child;a.resolveLayout(l);const[o,c]=a.dimensions;if(isNaN(o)||isNaN(c)||o<0||c<0)throw console.error("Child resolved to invalid dimensions:",o,c,a),new Error("Child resolved to invalid dimensions");l.sizeChanged&&(t.sizeChanged=!0);const u=this.resolvedWidth,d=this.resolvedHeight;this.resolvedWidth=o+i,this.resolvedHeight=c+n,u===this.resolvedWidth&&d===this.resolvedHeight||(this._backgroundDirty=!0)}handlePainting(t,e,i,s,n){this._backgroundDirty&&this.clear(t,e,i,s,n),this._backgroundDirty=!1;const[r,h,l,a]=this.calcChildViewport(t,e,i,s);this.child.paint(r,l,h-r,a-l,n)}calcChildViewport(t,e,i,s){const n=this.theme.getPadding(h.ContainerPadding);let r=t+n.left,a=t+i-n.right,o=e+n.top,c=e+s-n.bottom;if(r>a||o>c)return console.warn("Not enough space for padding in Container widget! Falling back to using no padding"),[t,e,i,s];const u=this.theme.getAlignment2D(h.ContainerAlignment);if(u.horizontal!==l.Stretch){const t=a-r-this.resolvedWidth;if(t>0)switch(u.horizontal){case l.Start:a-=t;break;case l.Center:r+=t/2,a-=t/2;break;case l.End:r+=t}}if(u.vertical!==l.Stretch){const t=c-o-this.resolvedHeight;if(t>0)switch(u.vertical){case l.Start:c-=t;break;case l.Center:o+=t/2,c-=t/2;break;case l.End:o+=t}}return[r,a,o,c]}}class D extends(t(L,w)){constructor(t,e=null,i=null){super(t,!1,i),this.callback=e}handleEvent(t,e,i,s){if(null===this.callback)return this.clickStateChanged=!1,this;if(this.handleClickEvent(t,s,[0,e,0,i]),this.clickStateChanged&&this.wasClick)try{this.callback()}catch(t){console.error("Exception in Icon callback",t)}return this}}class F extends D{constructor(){super(...arguments),this.backgroundProperty=h.BackgroundFill,this._forced=!1}updateBackground(){var t;if(this._forced)this.backgroundProperty=h.PrimaryFill;else switch(this.clickState){case u.Hold:this.backgroundProperty=h.AccentFill;break;case u.Hover:this.backgroundProperty=h.BackgroundGlowFill;break;default:this.backgroundProperty=h.BackgroundFill}const e=this.theme.getFill(this.backgroundProperty),i=new r(new Map([[h.CanvasFill,e]]),null===(t=this.inheritedTheme)||void 0===t?void 0:t.fallback);super.inheritTheme(i),this._backgroundDirty=!0}set forced(t){t!==this._forced&&(this._forced=t,this.updateBackground())}get forced(){return this._forced}setThemeOverride(t){if(this._backgroundDirty=!0,null===t)return super.setThemeOverride(null);try{const e=t.getFill(this.backgroundProperty),i=new r(new Map([[h.CanvasFill,e]]));super.setThemeOverride(i)}catch(t){return super.setThemeOverride(null)}}inheritTheme(t){this._backgroundDirty=!0;const e=t.getFill(this.backgroundProperty),i=new r(new Map([[h.CanvasFill,e]]),t);super.inheritTheme(i)}handlePostLayoutUpdate(t){super.handlePostLayoutUpdate(t),this._dirty&&(this._backgroundDirty=!0)}handleEvent(t,e,i,s){const n=super.handleEvent(t,e,i,s);return this.clickStateChanged&&this.updateBackground(),n}}class S extends C{constructor(){super(...arguments),this._flexRatio=1,this._mainBasis=0,this._crossBasis=0,this._internalMainBasis=0,this._internalCrossBasis=0,this._effectiveMainBasis=0,this._effectiveCrossBasis=0,this._vertical=null,this.lastVertical=!0}get flexRatio(){return this._flexRatio}set flexRatio(t){this._flexRatio!==t&&(this._flexRatio=t,this._layoutDirty=!0)}get vertical(){return this._vertical}set vertical(t){this._vertical!==t&&(this._vertical=t,this._layoutDirty=!0)}get mainBasis(){return this._mainBasis}set mainBasis(t){this._mainBasis!==t&&(this._mainBasis=t,this.updateEffectiveMainBasis())}get crossBasis(){return this._crossBasis}set crossBasis(t){this._crossBasis!==t&&(this._crossBasis=t,this.updateEffectiveCrossBasis())}get internalMainBasis(){return this._internalMainBasis}set internalMainBasis(t){this._internalMainBasis!==t&&(this._internalMainBasis=t,this.updateEffectiveMainBasis())}get internalCrossBasis(){return this._internalCrossBasis}set internalCrossBasis(t){this._internalCrossBasis!==t&&(this._internalCrossBasis=t,this.updateEffectiveCrossBasis())}updateEffectiveMainBasis(){const t=Math.max(this._mainBasis,this._internalMainBasis);this._effectiveMainBasis!==t&&(this._effectiveMainBasis=t,this._layoutDirty=!0)}updateEffectiveCrossBasis(){const t=Math.max(this._crossBasis,this._internalCrossBasis);this._effectiveCrossBasis!==t&&(this._effectiveCrossBasis=t,this._layoutDirty=!0)}handlePopulateLayout(t){var e;const i=null!==(e=this.vertical)&&void 0!==e?e:t.vertical;this.lastVertical=i,t.vertical===i?i?(this._flexRatio>0&&(t.vFlex+=this._flexRatio),t.vBasis+=this._effectiveMainBasis,this._effectiveCrossBasis>t.hBasis&&(t.hBasis=this._effectiveCrossBasis)):(this._flexRatio>0&&(t.hFlex+=this._flexRatio),t.hBasis+=this._effectiveMainBasis,this._effectiveCrossBasis>t.vBasis&&(t.vBasis=this._effectiveCrossBasis)):i?(t.hBasis+=this._effectiveCrossBasis,this._effectiveMainBasis>t.vBasis&&(t.vBasis=this._effectiveMainBasis)):(t.vBasis+=this._effectiveCrossBasis,this._effectiveMainBasis>t.hBasis&&(t.hBasis=this._effectiveMainBasis))}handleResolveLayout(t){var e;let i;const s=null!==(e=this.vertical)&&void 0!==e?e:t.vertical;t.vertical!==s?i=this._flexRatio>0?s?t.maxHeight:t.maxWidth:this._effectiveMainBasis:this._flexRatio>0?(i=s?(t.maxHeight-t.vBasis)*this._flexRatio/t.vFlex:(t.maxWidth-t.hBasis)*this._flexRatio/t.hFlex,i=this._effectiveMainBasis+Math.max(0,i)):i=this._effectiveMainBasis,s?(this.resolvedWidth=this._effectiveCrossBasis,this.resolvedHeight=i):(this.resolvedWidth=i,this.resolvedHeight=this._effectiveCrossBasis)}}let P=null;const T=new Map;function M(t,e){if(""===t)return[0,0,0];if(null===P){const t=document.createElement("canvas");if(P=t.getContext("2d"),null===P)throw"Failed to get canvas context"}let i;if(P.font=e,T.has(e))i=T.get(e);else{const t=P.measureText("-");i=Math.abs(t.actualBoundingBoxLeft)+Math.abs(t.actualBoundingBoxRight),T.set(e,i)}const s=P.measureText("-"+t+"-");return[Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight)-2*i,Math.abs(s.actualBoundingBoxAscent),Math.abs(s.actualBoundingBoxDescent)]}class E extends C{constructor(){super(...arguments),this._text="",this._font="",this._minLabelWidth=0,this._minLabelAscent=0,this._minLabelDescent=0,this._labelWidth=0,this._labelAscent=0,this._labelDescent=0,this.labelDirty=!0}updateTextDims(){if(!this.labelDirty)return;const[t,e,i]=M(this._text,this._font);this._labelWidth=Math.max(t,this._minLabelWidth),this._labelAscent=Math.max(e,this._minLabelAscent),this._labelDescent=Math.max(i,this._minLabelDescent),this.labelDirty=!1}findOffsetFromIndex(t){return t<=0?0:M(this._text.substring(0,t),this._font)[0]}findIndexOffsetFromOffset(t){if(t<=0)return[0,0];let e=0,i="",s=0;for(const n of this._text){i+=n;const r=M(i,this._font)[0];if(t<(r+s)/2)return[e,s];e++,s=r}return[this._text.length,s]}setLabelDirty(){this.labelDirty=!0,this._layoutDirty=!0}get labelWidth(){return this.updateTextDims(),this._labelWidth}get labelAscent(){return this.updateTextDims(),this._labelAscent}get labelDescent(){return this.updateTextDims(),this._labelDescent}get labelHeight(){return this.updateTextDims(),this._labelAscent+this._labelDescent}setText(t){this._text!==t&&(this._text=t,this._dirty=!0,this.setLabelDirty())}setFont(t){this._font!==t&&(this._font=t,this._dirty=!0,this.setLabelDirty())}setMinLabelWidth(t){this._minLabelWidth!==t&&(this._minLabelWidth=t,this.setLabelDirty())}setMinLabelAscent(t){this._minLabelAscent!==t&&(this._minLabelAscent=t,this.setLabelDirty())}setMinLabelDescent(t){this._minLabelDescent!==t&&(this._minLabelDescent=t,this.setLabelDirty())}}class W extends(t(S,E)){constructor(t,e=null){super(e,!0,!1),this.textGetter=null,this.text=t,this.flexRatio=0,this.vertical=!1}set text(t){t instanceof Function?this.textGetter=t:this.setText(t)}get text(){return null!==this.textGetter?this.textGetter:this._text}get currentText(){return this._text}handlePreLayoutUpdate(t){null!==this.textGetter&&this.setText(this.textGetter()),this.setFont(this.theme.getFont(h.BodyTextFont)),this.setMinLabelWidth(this.theme.getSize(h.LabelMinWidth)),this.setMinLabelAscent(this.theme.getSize(h.LabelMinAscent)),this.setMinLabelDescent(this.theme.getSize(h.LabelMinDescent)),this.internalMainBasis=this.labelWidth,this.internalCrossBasis=this.labelHeight}handlePainting(t,e,i,s,n){n.font=this._font,n.fillStyle=this.theme.getFill(h.BodyTextFill),n.fillText(this._text,t,e+s-this.labelDescent)}}function I(t,e=null,i=null){return new F(new W(t,i),e,i)}function R(t,e,i,s=null){return I(t,(()=>i.callback(e)),s)}function H(t,e=null){return R("Backspace","Backspace",t,e)}function O(t,e=null){return R("Esc","Escape",t,e)}function U(t,e=null){return R("Enter","Enter",t,e)}function V(t,e=null){const i=I("Shift",(()=>{t.shift=!t.shift,i.forced=t.shift,t.callback("Shift")}),e);return i.forced=t.shift,i}function A(t,e=null){return R("Space"," ",t,e)}function z(t,e=null,i,s=null){function n(){return i.shift?null===e?t:e:t}return null===e&&(e=t),I(n,(()=>i.callback(n())),s)}class N extends B{constructor(t,e,i,s){super(t,e,i,s)}add(t){if(Array.isArray(t))for(const e of t)this._children.push(e);else this._children.push(t);return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}remove(t){if(Array.isArray(t))for(const e of t){const t=this._children.indexOf(e);-1!==t&&this._children.splice(t,1)}else{const e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1)}return this.updateInheritedTheme(),this._layoutDirty=!0,this._dirty=!0,this}clearChildren(){return this._children.length=0,this._layoutDirty=!0,this._dirty=!0,this}}var Q,K,G,$;class q extends N{constructor(t,e=null){super([],e,!1,!0),Q.set(this,!0),K.set(this,void 0),G.set(this,null),n(this,K,t)}handleEvent(t,e,i,n){const r=this.theme.getSize(h.ContainerSpacing);for(const h of this.children){if(!h.enabled)continue;const l=s(this,K)?h.dimensions[1]:h.dimensions[0];let a,o;s(this,K)?(a=e,o=l):(a=l,o=i);const c=h.dispatchEvent(t,a,o,n);if(null!==c)return c;t instanceof x&&(t=s(this,K)?t.correctOffset(0,l+r):t.correctOffset(l+r,0))}return null}handlePreLayoutUpdate(t){let e=!1;for(const i of this.children)i.preLayoutUpdate(t),i.layoutDirty&&(e=!0);e&&this.forceLayoutDirty()}handlePostLayoutUpdate(t){for(const e of this.children)e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}forceLayoutDirty(){n(this,Q,!0),super.forceLayoutDirty()}handlePopulateLayout(t){const e=s(this,K)===t.vertical;let i;e?i=t:(n(this,G,new v(t.maxWidth,t.maxHeight,s(this,K))),i=s(this,G));for(const t of this.children)t.populateLayout(i);const r=this.childCount,l=this.theme.getSize(h.ContainerSpacing);if(r>1&&l>0){const t=l*(r-1);i.vertical?i.vBasis+=t:i.hBasis+=t}e||t.addBasis(i.hBasis,i.vBasis),i.hBasis>t.maxWidth&&(t.maxWidth=i.hBasis),i.vBasis>t.maxHeight&&(t.maxHeight=i.vBasis)}handleResolveLayout(t){const e=s(this,K)===t.vertical;let i;if(e)i=t;else{if(i=s(this,G),null===i)throw"Unexpected null innerContext";t.maxWidth>i.maxWidth&&(i.maxWidth=t.maxWidth),t.maxHeight>i.maxHeight&&(i.maxHeight=t.maxHeight)}let r=0,l=0,a=0,o=0,c=0;for(const t of this.children){if(!t.enabled){t.resolveLayout(i);continue}c++;const[e,n]=t.dimensions;t.resolveLayout(i);const[h,u]=t.dimensions;if(isNaN(h)||isNaN(u)||h<0||u<0)throw console.error("Child resolved to invalid dimensions:",h,u,t),new Error("Child resolved to invalid dimensions");s(this,K)?u!==n&&(i.sizeChanged=!0):h!==e&&(i.sizeChanged=!0),a+=h,h>r&&(r=h),o+=u,u>l&&(l=u)}!e&&i.sizeChanged&&(t.sizeChanged=!0),n(this,G,null);const u=this.theme.getSize(h.ContainerSpacing);let d=0;c>1&&u>0&&(d=u*(c-1)),s(this,K)?(this.resolvedWidth=r,this.resolvedHeight=o+d):(this.resolvedWidth=a+d,this.resolvedHeight=l)}handlePainting(t,e,i,r,l){const a=this.theme.getSize(h.ContainerSpacing);s(this,Q)&&a>0&&this.clear(t,e,i,r,l),n(this,Q,!1);const o=s(this,K)?e+r:t+i;for(const n of this.children){if(!n.enabled)continue;let h,c,u=!1;s(this,K)?(h=i,c=n.dimensions[1],e+c>o&&(u=!0,c=o-e)):(h=n.dimensions[0],c=r,t+h>o&&(u=!0,h=o-t)),n.paint(t,e,h,c,l),u&&console.warn("MultiContainer overflow, children may be painted with 0 length"),s(this,K)?e+=c+a:t+=h+a}}}function X(t=null){return new q(!1,t)}function Y(t,e,i=null){const s=X(i);for(const n of t)if("function"==typeof n){const t=n;s.add(t(e,i))}else{if("string"!=typeof n[0]||"string"!=typeof n[1])throw new Error(`Unknown virtual key row template format for entry: ${n}`);{const t=n[0],r=n[1];for(let n=0;n<t.length;n++){let h=null;n<r.length&&(h=r[n]),s.add(z(t[n],h,e,i))}}}return s}Q=new WeakMap,K=new WeakMap,G=new WeakMap;const j=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],U],[V,["zxcvbnm,./","ZXCVBNM<>?"]],[H,A,O]];class J extends q{constructor(t,e=null,i=null){super(!0,i),$.set(this,void 0),n(this,$,{callback:e=>{t.keyPress(e)},shift:!1}),null===e&&(e=j);for(const t of e)this.add(Y(t,s(this,$),i))}}var Z,tt,et,it,st;$=new WeakMap;class nt extends y{constructor(t,e=null,i=a){super(new J(t,e),i),Z.set(this,void 0),n(this,Z,t)}update(){this.enabled=null!==s(this,Z).getFocusedRoot(),super.update()}}Z=new WeakMap;class rt extends m{constructor(t,e=null,i=null,s=a){super(new J(t,e),i,s),this.keyboardDriver=t}updateVisibility(){this.enabled=null!==this.keyboardDriver.getFocusedRoot()}}class ht extends d{constructor(t,e){super(e,o.Keyboard,!0),this.key=t}}class lt extends ht{cloneWithTarget(t){return new lt(this.key,t)}}class at extends ht{cloneWithTarget(t){return new at(this.key,t)}}class ot{constructor(){this.eventQueues=new Map,this.keysDown=new Set,this.focus=null}getEventQueue(t){if(null===t)return null;const e=this.eventQueues.get(t);return void 0===e?null:e}_changeFocusedRoot(t){null!==this.focus&&this.focus.clearFocus(o.Keyboard),this.focus=t,this.keysDown.clear()}getFocusedRoot(){return this.focus}clearFocus(){this._changeFocusedRoot(null)}keyDown(t){this.keysDown.add(t);const e=this.getEventQueue(this.focus);null!==e&&e.push(new at(t,null))}keyUp(t){if(this.keysDown.delete(t)){const e=this.getEventQueue(this.focus);null!==e&&e.push(new lt(t,null))}}keyPress(t){const e=this.isKeyDown(t);this.keyDown(t),e||this.keyUp(t)}isKeyDown(t){return this.keysDown.has(t)}onEnable(t){this.eventQueues.has(t)||this.eventQueues.set(t,[])}onDisable(t){this.eventQueues.has(t)&&(this.eventQueues.delete(t),t===this.focus&&this._changeFocusedRoot(null))}update(t){const e=this.getEventQueue(t);if(null!==e){for(const i of e)t.dispatchEvent(i);e.length=0}}onFocusChanged(t,e,i){e===o.Keyboard&&(t==this.focus?null===i&&this._changeFocusedRoot(null):null!==i&&this._changeFocusedRoot(t))}onFocusCapturerChanged(t,e,i,s){}}class ct extends ot{constructor(){super(...arguments),tt.set(this,new Set)}bindDOMElem(t,e=!0){s(this,tt).has(t)||(s(this,tt).add(t),e&&(t.addEventListener("keydown",(t=>{t.preventDefault(),this.keyDown(t.key)})),t.addEventListener("keyup",(t=>{t.preventDefault(),this.keyUp(t.key)}))),t.addEventListener("blur",(t=>{this.shouldClearFocus(t.relatedTarget)&&this.clearFocus()})))}shouldClearFocus(t){return null===t||!s(this,tt).has(t)}}tt=new WeakMap;class ut extends x{constructor(t,e,i=null){super(t,e,i,o.Pointer)}correctOffset(t,e){return new ut(this.x-t,this.y-e,this.target)}cloneWithTarget(t){return new ut(this.x,this.y,t)}}class dt{constructor(){this._states=new Map,et.set(this,0)}registerPointer(){var t;return n(this,et,1+(t=+s(this,et))),t}unregisterPointer(t){for(const[e,i]of this._states)i.pointer===t&&(i.pointer=null,i.hovering&&i.eventQueue.push(new p(e.getFocusCapturer(o.Pointer))),i.hovering=!1,i.pressing=!1)}movePointer(t,e,i,s,n=null){const r=this._states.get(t);if(void 0===r)return;null===r.pointer&&(r.pointer=e),null===n&&(n=r.pressing);if(!(r.pointer===e)&&(!n||r.pressing))return;const[h,l]=t.dimensions,a=i*h,c=s*l;let u;n!==r.pressing?(u=n?new b(a,c):new _(a,c),r.pressing=n,n&&r.pointer!==e&&(r.eventQueue.push(new p(t.getFocusCapturer(o.Pointer))),r.pointer=e)):u=new ut(a,c),r.eventQueue.push(u),r.hovering=!0}leavePointer(t,e){const i=this._states.get(t);void 0!==i&&i.hovering&&i.pointer==e&&(i.hovering=!1,i.eventQueue.push(new p(t.getFocusCapturer(o.Pointer))))}onEnable(t){this._states.set(t,{eventQueue:[],pointer:null,pressing:!1,hovering:!1})}onDisable(t){t.dispatchEvent(new p),this._states.delete(t)}update(t){const e=this._states.get(t);if(void 0!==e){for(const i of e.eventQueue)t.dispatchEvent(i);e.eventQueue.length=0}}onFocusChanged(t,e,i){}onFocusCapturerChanged(t,e,i,s){}}function pt(t,e){const i=e.getBoundingClientRect();return[(t.clientX-i.left)/i.width,(t.clientY-i.top)/i.height]}et=new WeakMap;class ft extends dt{constructor(){super(),it.set(this,new WeakMap),st.set(this,void 0),n(this,st,this.registerPointer())}bindDOMElem(t,e){let i=s(this,it).get(t);void 0!==i?this.removeListeners(i):(i={domElem:e,pointermoveListen:null,pointerdownListen:null,pointerupListen:null,pointerleaveListen:null},s(this,it).set(t,i)),t.enabled&&this.addListeners(t,i)}addListeners(t,e){const i=e.domElem;e.pointermoveListen=e=>{e.isPrimary&&this.movePointer(t,s(this,st),...pt(e,i))},e.pointerdownListen=e=>{e.isPrimary&&this.movePointer(t,s(this,st),...pt(e,i),!0)},e.pointerupListen=e=>{e.isPrimary&&this.movePointer(t,s(this,st),...pt(e,i),!1)},e.pointerleaveListen=e=>{e.isPrimary&&this.leavePointer(t,s(this,st))},i.addEventListener("pointermove",e.pointermoveListen),i.addEventListener("pointerdown",e.pointerdownListen),i.addEventListener("pointerup",e.pointerupListen),i.addEventListener("pointerleave",e.pointerleaveListen)}removeListeners(t){null!==t.pointermoveListen&&(t.domElem.removeEventListener("pointermove",t.pointermoveListen),t.pointermoveListen=null),null!==t.pointerdownListen&&(t.domElem.removeEventListener("pointerdown",t.pointerdownListen),t.pointerdownListen=null),null!==t.pointerupListen&&(t.domElem.removeEventListener("pointerup",t.pointerupListen),t.pointerupListen=null),null!==t.pointerleaveListen&&(t.domElem.removeEventListener("pointerleave",t.pointerleaveListen),t.pointerleaveListen=null)}onEnable(t){super.onEnable(t);const e=s(this,it).get(t);void 0!==e&&this.addListeners(t,e)}onDisable(t){super.onDisable(t);const e=s(this,it).get(t);void 0!==e&&this.removeListeners(e)}}it=new WeakMap,st=new WeakMap;class vt extends C{constructor(){super(...arguments),this._boxWidth=0,this._boxHeight=0}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth!==t&&(this._boxWidth=t,this._layoutDirty=!0)}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight!==t&&(this._boxHeight=t,this._layoutDirty=!0)}handlePopulateLayout(t){t.addBasis(this._boxWidth,this._boxHeight)}handleResolveLayout(t){this.resolvedWidth=this._boxWidth,this.resolvedHeight=this._boxHeight}}class gt extends C{constructor(){super(...arguments),this.callback=null}get value(){if(void 0===this._value)throw"Value has not been set yet";return this._value}set value(t){this.setValue(t)}setValue(t,e=!0){if(this._value!==t&&(this._value=t,this._dirty=!0,e&&null!==this.callback))try{this.callback(t)}catch(t){console.error("Exception in Variable callback",t)}}}class mt extends L{constructor(t,e=null){super(t,!0,e)}}function yt(t){const e=new r(new Map([[h.ContainerAlignment,{horizontal:l.Center,vertical:l.Center}],[h.ContainerPadding,{left:0,right:0,top:0,bottom:0}]]));return new mt(t,e)}function xt(t=null){return new q(!0,t)}class _t extends gt{}class bt extends(t(vt,w,_t)){constructor(t=null,e=!1,i=null){super(i,!0,!1),this.callback=t,this.setValue(e,!1)}getBoxRect(t,e,i,s){const n=this.theme.getSize(h.CheckboxLength),r=Math.min(n,i,s),l=t+(i-r)/2,a=e+(s-r)/2;return[l,l+r,a,a+r]}handleEvent(t,e,i,s){const n=this.getBoxRect(0,0,e,i);return this.handleClickEvent(t,s,n),this.clickStateChanged&&this.wasClick&&(this.value=!this.value),this}handlePreLayoutUpdate(t){const e=this.theme.getSize(h.CheckboxLength);this.boxWidth=e,this.boxHeight=e}handlePainting(t,e,i,s,n){const[r,l,a,o]=this.getBoxRect(t,e,i,s),c=l-r,d=[u.Hover,u.Hold].includes(this.clickState);if(n.fillStyle=d?this.theme.getFill(h.BackgroundGlowFill):this.theme.getFill(h.BackgroundFill),n.fillRect(r,a,c,c),this.value){n.fillStyle=d?this.theme.getFill(h.AccentFill):this.theme.getFill(h.PrimaryFill);const t=this.theme.getSize(h.CheckboxInnerPadding),e=c-2*t;e<=0?n.fillRect(r,a,c,c):n.fillRect(r+t,a+t,e,e)}}}class Ct extends S{constructor(t=1,e=0,i=0,s=null,n=null){super(n,!0,!1),this.flexRatio=t,this.mainBasis=e,this.crossBasis=i,this.vertical=s}}function wt(t,e=null,i=!1,s=null){return X(s).add([new W(t,s),new Ct(1,0,0,!1,s),new bt(e,i,s)])}function Bt(t){const e=new r(new Map([[h.ContainerAlignment,{horizontal:l.Center,vertical:l.Center}]]));return new mt(t,e)}class kt extends gt{}class Lt extends(t(S,E,kt)){constructor(t,e="",i=null){super(i,!1,!1),this.blinkStart=0,this.blinkWasOn=null,this.cursorPos=0,this.cursorOffset=0,this.cursorOffsetDirty=!1,this._editingEnabled=!0,this._hideText=!1,this.setValue(e,!1),[this._valid,this._validValue]=t(e),this.callback=e=>{const[i,s]=t(e);i&&(this._validValue=s),i!==this._valid&&(this._valid=i,this._dirty=!0)},this.vertical=!1}get blinkOn(){if(0===this.blinkStart)return null;const t=this.theme.getSize(h.BlinkRate);return 0===Math.trunc((Date.now()-this.blinkStart)/(500*t)%2)}get editingEnabled(){return this._editingEnabled}set editingEnabled(t){this._editingEnabled!==t&&(this._editingEnabled=t,t||(this.blinkStart=0,this.moveCursorTo(0)),this._dirty=!0)}get hideText(){return this._hideText}set hideText(t){this._hideText!==t&&(this._hideText=t,this.cursorOffsetDirty=!0,this._dirty=!0)}get text(){return this._hideText?"●".repeat(this.value.length):this.value}get valid(){return this._valid}get validValue(){return this._validValue}moveCursorTo(t){this.cursorPos=Math.min(Math.max(t,0),this.value.length),this.cursorOffsetDirty=!0,this._dirty=!0}moveCursor(t){this.moveCursorTo(this.cursorPos+t)}insertText(t){this.value=this.value.substring(0,this.cursorPos)+t+this.value.substring(this.cursorPos),this.moveCursor(t.length)}deleteText(t){t>0?this.value=this.value.substring(0,this.cursorPos)+this.value.substring(this.cursorPos+t):t<0&&(this.value=this.value.substring(0,this.cursorPos+t)+this.value.substring(this.cursorPos),this.moveCursor(t))}onFocusDropped(t,e){t===o.Keyboard&&(this.blinkStart=0)}handleEvent(t,e,i,s){if(!this._editingEnabled)return this;if(t instanceof x)return s.pointerStyle="text",t instanceof b?([this.cursorPos,this.cursorOffset]=this.findIndexOffsetFromOffset(t.x),this.blinkStart=Date.now(),this._dirty=!0,s.requestFocus(o.Keyboard,this)):t instanceof _&&s.hasMobileTextInput&&s.getTextInput(this.value).then((t=>{null!==t&&this.value!==t&&(this.value=t,this.moveCursorTo(t.length))})),this;if(t instanceof at){if(1===t.key.length)this.insertText(t.key);else if("Backspace"===t.key)this.deleteText(-1);else if("Delete"===t.key)this.deleteText(1);else if("ArrowLeft"===t.key)this.moveCursor(-1);else if("ArrowRight"===t.key)this.moveCursor(1);else if("Home"===t.key)this.moveCursorTo(0);else{if("End"!==t.key)return"Escape"===t.key?(s.dropFocus(o.Keyboard,this),this):this;this.moveCursorTo(this.value.length)}this.blinkStart=Date.now()}return this}handlePreLayoutUpdate(t){this.editingEnabled||t.dropFocus(o.Keyboard,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0);const e=this.theme.getSize(h.CursorPadding)+this.theme.getSize(h.CursorThickness);this.setText(this.text),this.setFont(this.theme.getFont(h.InputTextFont)),this.setMinLabelWidth(this.theme.getSize(h.InputTextMinWidth)-e),this.setMinLabelAscent(this.theme.getSize(h.InputTextMinAscent)),this.setMinLabelDescent(this.theme.getSize(h.InputTextMinDescent)),this.cursorOffsetDirty&&(this.cursorOffset=this.findOffsetFromIndex(this.cursorPos),this.cursorOffsetDirty=!1),this.flexRatio=this.theme.getSize(h.InputTextFlexRatio),this.internalMainBasis=this.labelWidth+e,this.internalCrossBasis=this.labelHeight}handlePainting(t,e,i,s,n){n.fillStyle=this.theme.getFill(h.InputBackgroundFill),n.fillRect(t,e,i,s),n.font=this.theme.getFont(h.InputTextFont),this._editingEnabled?this._valid?n.fillStyle=this.theme.getFill(h.InputTextFill):n.fillStyle=this.theme.getFill(h.InputTextFillInvalid):n.fillStyle=this.theme.getFill(h.InputTextFillDisabled),n.fillText(this.text,t,e+s-this.labelDescent);const r=this.blinkOn;if(this.blinkWasOn=r,!r)return;const l=this.theme.getSize(h.CursorPadding),a=this.theme.getSize(h.CursorThickness);n.fillRect(t+this.cursorOffset,e+l,a,s-2*l)}}function Dt(t){return[!0,t]}function Ft(t=null){return null===t?Dt:e=>(t(e),[!0,e])}function St(t=null,e="",i=null){const s=Ft(t);return new Lt(s,e,i)}class Pt extends r{constructor(t){super(new Map,t)}getFill(t){return super.getFill(t),"#"+Math.floor(16777215*Math.random()).toString(16)}}function Tt(t,e,i=null){return s=>{let n=!0,r=s;for(const i of t)if([n,r]=i(r),!n)return[!1,e];if(null!==i)try{i(r)}catch(t){console.warn("Exception in CompositeValidator callback:",t)}return[!0,r]}}const Mt=/^-?(\.\d+|\d+(\.(\d+)?)?)(e\d+)?$/;function Et(t){return Mt.test(t)?[!0,parseFloat(t)]:[!1,NaN]}const Wt=/^-?\d+$/;function It(t){return Wt.test(t)?[!0,parseInt(t)]:[!1,NaN]}function Rt(t,e){return i=>i<t||i>e?[!1,i]:[!0,i]}class Ht extends(t(vt,w)){constructor(t,e=null,i=null,s=null,n=null,r=null){super(r,!0,!1),this.lastSrc=null,this._rotation=0,this._image=t,this.width=e,this.height=i,this.viewBox=s,this.callback=n,this.updateDimensions()}updateDimensions(){let t=this.width;null===t&&(t=null===this.viewBox?this._image.width:this.viewBox[2]),this.boxWidth!==t&&(this.boxWidth=t);let e=this.height;null===e&&(e=null===this.viewBox?this._image.height:this.viewBox[3]),this.boxHeight!==e&&(this.boxHeight=e)}setImage(t){t!==this._image&&(this._image=t,this.lastSrc=null)}getIconRect(t,e,i,s){const n=i/this.boxWidth,r=s/this.boxHeight,h=Math.min(n,r),l=this.boxWidth*h,a=this.boxHeight*h;return[t+(i-l)/2,e+(s-a)/2,l,a]}handleEvent(t,e,i,s){if(null===this.callback)return s.dropFocus(o.Pointer,this),this;const[n,r,h,l]=this.getIconRect(0,0,e,i);if(this.handleClickEvent(t,s,[n,n+h,r,r+l]),this.clickStateChanged&&this.wasClick)try{this.callback()}catch(t){console.error("Exception in Icon callback",t)}return this}handlePreLayoutUpdate(t){var e,i;(null===(e=this._image)||void 0===e?void 0:e.src)!==this.lastSrc&&(null===(i=this._image)||void 0===i?void 0:i.complete)&&(this._dirty=!0),this.updateDimensions()}get rotation(){return this._rotation}set rotation(t){t!==this._rotation&&(this._rotation=t,this._dirty=!0)}handlePainting(t,e,i,s,n){var r;if(!(null===(r=this._image)||void 0===r?void 0:r.complete))return void(this.lastSrc=null);this.lastSrc=this._image.src;const[h,l,a,o]=this.getIconRect(t,e,i,s);let c=h,u=l;0!==this.rotation&&(n.save(),n.translate(h+a/2,l+o/2),c=-a/2,u=-o/2,n.rotate(this.rotation)),null===this.viewBox?n.drawImage(this._image,c,u,a,o):n.drawImage(this._image,...this.viewBox,c,u,a,o),0!==this.rotation&&n.restore()}}class Ot extends k{constructor(t,e=null){super(t,e,!1,!0)}handleEvent(t,e,i,s){return this.child.dispatchEvent(t,e,i,s)}handlePreLayoutUpdate(t){const e=this.child;e.preLayoutUpdate(t),e.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(t){const e=this.child;e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handlePopulateLayout(t){this.child.populateLayout(t)}handleResolveLayout(t){const e=this.child;e.resolveLayout(t),[this.resolvedWidth,this.resolvedHeight]=e.dimensions}handlePainting(t,e,i,s,n){this.child.paint(t,e,i,s,n)}}class Ut extends(t(k,S)){constructor(t,e=!1,i=!1,s=null){super(t,s,!1,!0),this._offset=[0,0],this.lastChildLayoutCtx=null,this.maxDimensions=[0,0],this.lastViewportDims=[0,0],this.viewport=new g,this.mainBasisTied=e,this.crossBasisTied=i}get canvasDimensions(){return this.viewport.canvasDimensions}get offset(){return[...this._offset]}set offset(t){this._offset[0]===t[0]&&this._offset[1]===t[1]||(this._offset=t,this._dirty=!0)}getChildMainBasis(t){if(null===this.lastChildLayoutCtx)return 0;const e=t?this.lastChildLayoutCtx.vBasis:this.lastChildLayoutCtx.hBasis;return isNaN(e)?0:e}getChildCrossBasis(t){return this.getChildMainBasis(!t)}getMaxMainBasis(t){return t?this.maxDimensions[1]:this.maxDimensions[0]}getMaxCrossBasis(t){return this.getMaxMainBasis(!t)}handleEvent(t,e,i,s){if(null===t.target&&!(t instanceof x))return null;const[n,r]=this.child.dimensions,h=this.offset[0],l=h+n,a=this.offset[1],o=a+r;if(t instanceof x){if(null===t.target){if(t.x<h)return null;if(t.x>=l)return null;if(t.y<a)return null;if(t.y>=o)return null}t=t.correctOffset(h,a)}return this.child.dispatchEvent(t,l-h,o-a,s)}handlePreLayoutUpdate(t){let e=this.vertical;null===e&&(e=!0);const i=this.child;if(e!==this.viewport.vertical&&(this.viewport.vertical=e,i.forceLayoutDirty()),i.preLayoutUpdate(t),i.layoutDirty){if(this._layoutDirty=!0,this.lastChildLayoutCtx=this.viewport.populateChildsLayout(i),this.mainBasisTied){let t=this.getChildMainBasis(e);const i=this.getMaxMainBasis(e);0!==i&&t>i&&(t=i),this.internalMainBasis=t}else this.internalMainBasis=0;if(this.crossBasisTied){let t=this.getChildCrossBasis(e);const i=this.getMaxCrossBasis(e);0!==i&&t>i&&(t=i),this.internalCrossBasis=t}else this.internalCrossBasis=0}}handlePostLayoutUpdate(t){const e=this.child;if(null!==this.lastChildLayoutCtx){let[t,i]=[...this.maxDimensions];(this.viewport.vertical?this.crossBasisTied:this.mainBasisTied)&&(0===t||this.resolvedWidth<t)&&(t=this.resolvedWidth),(this.viewport.vertical?this.mainBasisTied:this.crossBasisTied)&&(0===i||this.resolvedHeight<i)&&(i=this.resolvedHeight),this.viewport.maxDimensions=[t,i],this.lastChildLayoutCtx.maxWidth=t,this.lastChildLayoutCtx.maxHeight=i,this.viewport.resolveChildsLayout(e,this.lastChildLayoutCtx),this.lastChildLayoutCtx=null}e.postLayoutUpdate(t),e.dirty&&(this._dirty=!0)}handlePainting(t,e,i,s,n){this.lastViewportDims=[i,s],this.viewport.paintToCanvas(this.child),n.save();const r=new Path2D;r.rect(Math.trunc(t),Math.trunc(e),Math.ceil(i),Math.ceil(s)),n.clip(r),n.globalCompositeOperation="copy",n.fillStyle=this.theme.getFill(h.CanvasFill),n.fill(r);const[l,a]=this.child.dimensions,[o,c]=this.offset,u=t+o,d=e+c,p=new Path2D;p.rect(Math.trunc(u),Math.trunc(d),Math.ceil(l),Math.ceil(a)),n.clip(p),n.drawImage(this.viewport.canvas,0,0,l,a,u,d,l,a),n.restore()}}class Vt extends gt{}class At extends(t(S,w,Vt)){constructor(t=null,e=100,i=100,s=0,n=null){super(n,!0,!1),this.callback=t,this.setValue(s,!1),this._end=e,this._barLength=i,this.dragValue=s}get end(){return this._end}set end(t){this._end!==t&&(this._end=t,this._dirty=!0)}get barLength(){return this._barLength}set barLength(t){this._barLength!==t&&(this._barLength=t,this._dirty=!0)}setValue(t,e=!0){super.setValue(Math.max(Math.min(this._end-this._barLength,t),0),e)}getBarRect(t,e,i,s){if(this.lastVertical){const n=Math.min(this.crossBasis,i),r=t+(i-n)/2;return[r,r+n,e,e+s]}{const n=Math.min(this.crossBasis,s),r=e+(s-n)/2;return[t,t+i,r,r+n]}}handleEvent(t,e,i,s){if(this.handleClickEvent(t,s,this.getBarRect(0,0,e,i)),this.clickState==u.Hold&&null!==this.pointerPos)if(this.clickStateChanged){let t;t=this.lastVertical?this.pointerPos[1]*this._end:this.pointerPos[0]*this._end;let e=this.value;null===e&&(e=0),(t<e||t>=e+this._barLength)&&(e=t-this._barLength/2,this.value=e),this.dragValue=e}else if(null!==this.startingPointerPos){let t;t=this.lastVertical?this.pointerPos[1]-this.startingPointerPos[1]:this.pointerPos[0]-this.startingPointerPos[0],this.value=this.dragValue+t*this._end}return this.clickStateChanged&&(this._dirty=!0),this}handlePreLayoutUpdate(t){this.flexRatio=0,this.crossBasis=this.theme.getSize(h.ScrollBarThickness)}handlePainting(t,e,i,s,n){const[r,l,a,o]=this.getBarRect(t,e,i,s),[c,d]=[l-r,o-a];let p=this.value;null===p&&(p=0);const f=p/this._end,v=this._barLength/this._end;n.fillStyle=this.theme.getFill(h.BackgroundFill),n.fillRect(r,a,c,d);if([u.Hover,u.Hold].includes(this.clickState)?n.fillStyle=this.theme.getFill(h.AccentFill):n.fillStyle=this.theme.getFill(h.PrimaryFill),this.lastVertical){let t=v*d;t>d&&(t=d),n.fillRect(r,a+f*d,c,t)}else{let t=v*c;t>c&&(t=c),n.fillRect(r+f*c,a,t,d)}}}class zt extends Ot{constructor(t,e,i=!1,s=!1,n=null){super(xt(n),n);const r=new Ut(t,i,s,n);r.vertical=e;const h=new At(null,0,0,0,n);h.vertical=!0;const l=X(n).add([r,h]),a=new At(null,0,0,0,n);a.vertical=!1;this.child.add([l,a]),this.viewport=r,this.vScroll=h,this.hScroll=a,this.vScrollHide=!1,this.hScrollHide=!1,a.callback=t=>{null===t&&(t=0),this.viewport.offset=[-t,this.viewport.offset[1]]},h.callback=t=>{null===t&&(t=0),this.viewport.offset=[this.viewport.offset[0],-t]}}get maxDimensions(){return this.viewport.maxDimensions}set maxDimensions(t){this.viewport.maxDimensions=t}get flexRatio(){return this.viewport.flexRatio}set flexRatio(t){this.viewport.flexRatio=t}get mainBasis(){return this.viewport.mainBasis}set mainBasis(t){this.viewport.mainBasis=t}get crossBasis(){return this.viewport.crossBasis}set crossBasis(t){this.viewport.crossBasis=t}get containedChild(){return this.viewport.child}resetScroll(){this.hScroll.value=0,this.vScroll.value=0}handlePreLayoutUpdate(t){const[e,i]=this.viewport.child.dimensions,[s,n]=this.viewport.dimensions;s<e&&!this.hScrollHide?this.hScroll.enabled=!0:(this.hScroll.value=0,this.hScroll.enabled=!1),n<i&&!this.vScrollHide?this.vScroll.enabled=!0:(this.vScroll.value=0,this.vScroll.enabled=!1),super.handlePreLayoutUpdate(t)}handlePostLayoutUpdate(t){[this.hScroll.end,this.vScroll.end]=this.viewport.child.dimensions,this.hScroll.barLength=this.viewport.lastViewportDims[0],this.vScroll.barLength=this.viewport.lastViewportDims[1],super.handlePostLayoutUpdate(t)}}class Nt extends gt{}class Qt extends(t(S,w,Nt)){constructor(t=null,e=0,i=1,s=0,n=0,r=null){super(r,!0,!1),this.callback=t,this.setValue(n,!1),this.minValue=e,this.maxValue=i,this.snapIncrement=s,this.vertical=!1}getSliderRect(t,e,i,s){const n=Math.min(this.crossBasis,s),r=e+(s-n)/2;return[t,t+i,r,r+n]}handleEvent(t,e,i,s){if(this.handleClickEvent(t,s,this.getSliderRect(0,0,e,i)),(this.clickStateChanged&&this.wasClick||this.clickState==u.Hold)&&null!==this.pointerPos){const t=this.pointerPos[0];let e=this.minValue+t*(this.maxValue-this.minValue);this.snapIncrement>0&&(e=Math.round(e/this.snapIncrement)*this.snapIncrement),e<this.minValue?e=this.minValue:e>this.maxValue&&(e=this.maxValue),this.value=e}return this.clickStateChanged&&(this._dirty=!0),this}handlePreLayoutUpdate(t){this.flexRatio=this.theme.getSize(h.SliderFlexRatio),this.mainBasis=this.theme.getSize(h.SliderMainBasis),this.crossBasis=this.theme.getSize(h.SliderCrossBasis)}handlePainting(t,e,i,s,n){const[r,l,a,o]=this.getSliderRect(t,e,i,s),[c,d]=[l-r,o-a];let p=this.value;null===p&&(p=0);const f=(p-this.minValue)/(this.maxValue-this.minValue);[u.Hover,u.Hold].includes(this.clickState)?n.fillStyle=this.theme.getFill(h.AccentFill):n.fillStyle=this.theme.getFill(h.PrimaryFill);const v=f*c;n.fillRect(r,a,v,d),n.fillStyle=this.theme.getFill(h.BackgroundFill);const g=c-v;n.fillRect(r+v,a,g,d)}}var Kt;class Gt extends Ot{constructor(t,e){super(t,null),Kt.set(this,void 0),n(this,Kt,e)}setThemeOverride(t){n(this,Kt,t),super.inheritTheme(s(this,Kt))}inheritTheme(t){super.inheritTheme(s(this,Kt))}}Kt=new WeakMap;export{l as Alignment,H as BackspaceKey,L as BaseContainer,R as BasicKey,St as BasicTextInput,vt as BoxLayout,D as Button,yt as Center,bt as Checkbox,u as ClickState,w as Clickable,xt as Column,mt as Container,ct as DOMKeyboardDriver,ft as DOMPointerDriver,y as DOMRoot,nt as DOMVirtualKeyboardRoot,Pt as DebugTheme,e as DefaultTextInputHandler,Dt as DefaultTextValidator,U as EnterKey,O as EscapeKey,d as Event,F as FilledButton,S as FlexLayout,Et as FloatValidator,o as FocusType,z as GlyphKey,Ht as Icon,It as IntValidator,ht as KeyEvent,at as KeyPress,lt as KeyRelease,Y as KeyRow,ot as KeyboardDriver,W as Label,E as Labelable,wt as LabelledCheckbox,v as LayoutContext,p as Leave,Tt as MakeCompositeValidator,Ft as MakeDefaultTextValidatorWithCallback,Rt as MakeRangeValidator,Bt as Margin,q as MultiContainer,N as MultiParent,B as Parent,Ot as PassthroughWidget,dt as PointerDriver,x as PointerEvent,ut as PointerMove,b as PointerPress,_ as PointerRelease,m as Root,X as Row,At as ScrollBar,zt as ScrollableViewportWidget,V as ShiftKey,k as SingleParent,Qt as Slider,A as SpaceKey,Ct as Spacing,I as TextButton,Lt as TextInput,r as Theme,h as ThemeProperty,Gt as ThemeScope,gt as Variable,g as Viewport,Ut as ViewportWidget,J as VirtualKeyboard,rt as VirtualKeyboardRoot,C as Widget,a as defaultTheme,M as measureTextDims};
