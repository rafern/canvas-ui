var be=Object.defineProperty;var si=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertySymbols;var oi=Object.prototype.hasOwnProperty,li=Object.prototype.propertyIsEnumerable;var Ve=(l,i,t)=>i in l?be(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t,I=(l,i)=>{for(var t in i||(i={}))oi.call(i,t)&&Ve(l,t,i[t]);if(Ie)for(var t of Ie(i))li.call(i,t)&&Ve(l,t,i[t]);return l};var a=(l,i)=>be(l,"name",{value:i,configurable:!0});var _=(l,i,t,e)=>{for(var r=e>1?void 0:e?si(i,t):i,n=l.length-1,s;n>=0;n--)(s=l[n])&&(r=(e?s(i,t,r):s(r))||r);return e&&r&&be(i,t,r),r};var Be=(l,i,t)=>new Promise((e,r)=>{var n=h=>{try{o(t.next(h))}catch(d){r(d)}},s=h=>{try{o(t.throw(h))}catch(d){r(d)}},o=h=>h.done?e(h.value):Promise.resolve(h.value).then(n,s);o((t=t.apply(l,i)).next())});var Ne="Failed to get DOM canvas context. Make sure the 2D canvas context is supported",ye="Text render group generation is incorrectly implemented. Please report this bug if you are not responsible for text rendering for this Widget.",S={CANVAS_CONTEXT:`${Ne}.`,REUSABLE_CANVAS_CONTEXT:`${Ne} and the canvas is not being reused with a different rendering context.`,NEGATIVE_TEXT_GROUP:`Unexpected text render group with negative width detected. ${ye}`,EMPTY_LINE_RANGE:`Unexpected line range without any text render groups. Empty lines must contain a zero-width text render group. ${ye}`,ROGUE_NEWLINE:`Unexpected line range with newline character in the middle of the range instead of at the end. Text after newline character was ignored. ${ye}`,VIDEO_API_AVAILABLE:"HTMLVideoElement.requestVideoFrameCallback is available and will be used; if video playback is choppy or broken, please report it on Github",DIMENSIONLESS_CANVAS:"Canvas has 0 width or height. Are you using an empty Root? If not, make sure to not over-constrain the Widgets.",NON_POW2_CANVAS:"Canvas has a width or height that is not a power of 2, which may create mipmapping issues for 3D engines. Make sure to use power of 2 starting and maximum canvas dimensions.",DOM_DRIVER_REBIND:"Re-binding DOM driver. Are you calling bindDOMElem with the same HTML element multiple times?",PARENTLESS_CLIPVP:"Attempt to use ClippedViewport without a parent. If you are implementing a custom Root subclass, keep in mind that a Viewport with a rendering context must be used; ClippedViewport can't be used because it inherits a parent Viewport's rendering context."};function at(l){return typeof l=="string"?l:"<Symbol()>"}a(at,"propStr");function It(l){return typeof l=="string"?`"${l}"`:String(l)}a(It,"valueStr");var Oe="This may be caused by floating pointer precision errors.",b={INVALID_BACKGROUND_FILL:l=>`Unknown theme property: ${at(l)}. Valid background fill theme properties: "primaryFill", "accentFill", "backgroundGlowFill" and "backgroundFill".`,SWAPPED_MIN_MAX_NAMED:(l,i,t,e)=>`${at(e)} value (${It(i)}) can't be smaller than ${at(t)} value (${It(l)}).`,SWAPPED_MIN_MAX:(l,i)=>b.SWAPPED_MIN_MAX_NAMED(l,i,"Minimum","Maximum"),INVALID_VALUE:(l,i,t=!1)=>`${at(l)} value (${It(i)}) must be a valid${t?" non-negative":""} finite number. Make sure that it's not infinite and not NaN.`,NEGATIVE_VALUE:(l,i)=>`${at(l)} value (${It(i)}) must be greater or equal to zero.`,NON_ARRAY_VALUE:(l,i)=>`${at(l)} value (${It(i)}) must be an array.`,INVALID_MIN:l=>b.INVALID_VALUE("Minimum",l),INVALID_MAX:l=>b.INVALID_VALUE("Maximum",l),INVALID_INC:l=>b.INVALID_VALUE("Increment",l),NEGATIVE_INC:l=>b.NEGATIVE_VALUE("Increment",l),SWAPPED_MIN_MAX_DIMS:(l,i,t,e)=>`${b.SWAPPED_MIN_MAX_NAMED(l,i,t,e)} Set ${at(t)} to ${at(e)}. ${Oe}`,NEGATIVE_DIMS:(l,i)=>`${b.NEGATIVE_VALUE(i,l)} Set ${at(i)} to 0. ${Oe}`,BROKEN_CONSTRAINTS:(l,i,t,e)=>`${t?"Horizont":"Vertic"}al ${e?"ov":"und"}erflow in Widget; Limit: ${i}, actual value: ${l}.`,INVALID_DIMS:(l,i)=>b.INVALID_VALUE(l?"Width":"Height",i,!0),DETACHED_WIDGET:l=>`Cannot get ${l} property; Widget is not attached to a UI tree. Make sure the Widget is in a UI tree and to never directly call Widget update, layout resolution or painting methods.`,INVALID_ATTACHMENT:l=>`Attempt to ${l?"at":"de"}tach ${l?"at":"de"}tached Widget. Make sure the Widget is not being reused in another Root without first removing it from the first Root.`,INVALID_KB_ROW_TEMPLATE:l=>`Unknown virtual key row template format for entry: ${l}. A key row template must either be a function that returns a VirtualKey instance, or a pair of symbols.`,INVALID_ENUM:(l,i,t,e=!1)=>`${e?"Unexpected":"Unknown"} ${i} value: ${l}. Make sure ${t} is being passed as an enum value instead of its corresponding hardcoded value; this value may have become invalid due to an update.${e?" If this is a valid value, then this may be a bug caused by invalid input combinations. Please report it.":""}`,OVERCAPTURING_WIDGET:l=>`TabSelect event captured by widget (${l.constructor.name}), but reachedRelative was false; a widget type is probably capturing events by default. Make sure to only capture events that you need so that other Widgets aren't broken.`,MAYBE_DIMENSIONLESS:l=>`ViewportWidget has no minimum ${l} and ${l} isn't bi-directionally coupled, therefore, it may be dimensionless. Set a minimum ${l} and/or bi-directionally couple the ${l}.`,UNTARGETABLE_EVENT:l=>`${l} events cannot be targetted to a specific widget. Target ignored`};function Ue(){console.groupCollapsed("Stack trace"),console.trace(),console.groupEnd()}a(Ue,"groupedStackTrace");function ae(l){return function(i,t){let e=new WeakMap;Object.defineProperty(i,t,{set:function(r){let n=e.get(this);r!==n&&(e.set(this,r),l.call(this,n))},get:function(){return e.get(this)},enumerable:!0,configurable:!0})}}a(ae,"watchField");function he(l){return ae(function(i){this[l]=!0})}a(he,"flagField");var vt=he("_dirty"),tt=he("_layoutDirty");function G(l){return ae(function(i){for(let t of l)this[t]=!0})}a(G,"multiFlagField");var Ri=G(["_dirty","_layoutDirty"]);function Ht(l,i=!1){return function(t,e){let r=new WeakMap;Object.defineProperty(t,e,{set:function(n){if(Array.isArray(n)){let s=r.get(this);if(Array.isArray(s)){if(n.length!==s.length){s.length=n.length;for(let o=0;o<n.length;o++)s[o]=n[o];l.call(this)}else for(let o=0;o<n.length;o++)if(s[o]!==n[o]){for(let h=0;h<n.length;h++)s[h]=n[h];l.call(this);return}}else r.set(this,[...n]),l.call(this)}else if(i)r.set(this,n),l.call(this);else throw new Error(b.NON_ARRAY_VALUE(e,n))},get:function(){let n=r.get(this);return Array.isArray(n)?[...n]:n},enumerable:!0,configurable:!0})}}a(Ht,"watchArrayField");function Xe(l,i=!1){return Ht(function(){this[l]=!0},i)}a(Xe,"flagArrayField");function Ke(l=!1){return Xe("_dirty",l)}a(Ke,"paintArrayField");function Ye(l=!1){return Xe("_layoutDirty",l)}a(Ye,"layoutArrayField");function ai(l,i=!1){return Ht(function(){for(let t of l)this[t]=!0},i)}a(ai,"multiFlagArrayField");function $e(l=!1){return ai(["_dirty","_layoutDirty"],l)}a($e,"paintLayoutArrayField");var U=class{constructor(i,t,e,r=!1){this.target=i,this.focusType=t,this.needsFocus=e,this.reversed=r}};a(U,"Event");var _t=class extends U{constructor(t,e,r,n,s,o){super(n,s,o);this.shift=t,this.ctrl=e,this.alt=r}};a(_t,"ModifierEvent");var W=class extends _t{constructor(t,e,r,n,s,o=null,h=null){super(r,n,s,o,h,!1);this.x=t,this.y=e}};a(W,"PointerEvent");var F=class{constructor(i,t){this.parent=null;this.child=i,this.relativeCoordinates=t,this.constraints=[0,1/0,0,1/0],this.rect=[0,0,0,0],this.offset=[0,0]}updateEverything(){this.child.forceDirty(),this.updateChildPos()}forceLayoutDirty(){this.child.forceDirty()}updateChildPos(){if(!this.relativeCoordinates&&this.child.attached){let[i,t,e,r]=this.rect,[n,s]=this.offset,o=i+n,h=t+s,[d,c]=this.child.position;(o!==d||h!==c)&&(this.child.resolvePosition(o,h),this.child.finalizeBounds())}}resolveLayout(){if(!this.child.layoutDirty)return!1;let[i,t]=this.child.dimensions;this.child.resolveDimensionsAsTop(...this.constraints),this.relativeCoordinates?this.child.resolvePosition(0,0):this.child.resolvePosition(...this.child.idealPosition),this.child.finalizeBounds();let[e,r]=this.child.dimensions;return e!==i||r!==t}dispatchEvent(i){if(i instanceof W){let[t,e,r,n]=this.rect,s=t+r,o=e+n;if(i.target===null&&(i.x<t||i.x>=s||i.y<e||i.y>=o))return null;if(this.relativeCoordinates){let[h,d]=this.offset,c=t+h,u=e+d;(c!==0||u!==0)&&(i=i.correctOffset(c,u))}}return this.child.dispatchEvent(i)}getClippedViewport(){let[i,t,e,r]=this.rect,[n,s]=this.child.dimensions,[o,h]=this.offset,d=i+e,c=t+r,u=i+o,m=t+h,f=Math.min(Math.max(u,i),d),p=Math.min(Math.max(m,t),c),g=Math.min(Math.max(u+n,i),d)-f,w=Math.min(Math.max(m+s,t),c)-p;return[i,t,e,r,u,m,f,p,g,w]}};a(F,"BaseViewport"),F.dimensionlessWarned=!1,F.powerOf2Warned=!1,F.maxRelayout=4,_([Ht(F.prototype.forceLayoutDirty)],F.prototype,"constraints",2),_([Ht(F.prototype.updateEverything)],F.prototype,"rect",2),_([Ht(F.prototype.updateChildPos)],F.prototype,"offset",2);function ve(l,i=!0){return Math.pow(2,(i?Math.ceil:Math.floor)(Math.log2(l)))}a(ve,"roundToPower2");function xe(l){return(l&l-1)===0}a(xe,"isPower2");var et=class extends F{constructor(t,e=1,r=!1,n=64,s=64){super(t,!0);this.maxCanvasWidth=16384;this.maxCanvasHeight=16384;this._forceResize=!0;this._prevESX=1;this._prevESY=1;this.shrunk=!1;this.resolution=e,this.preventBleeding=r,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=s;let o=this.canvas.getContext("2d",{alpha:!0});if(o===null)throw new Error(S.CANVAS_CONTEXT);this.context=o,this.child.forceDirty()}get canvasDimensions(){return[this.canvas.width,this.canvas.height]}resolveLayout(){let[t,e]=this.realDimensions,r=super.resolveLayout();if(r||this._forceResize){this._forceResize=!1;let[n,s]=this.realDimensions;(t>n||e>s)&&(this.shrunk=!0);let[o,h]=this.child.dimensions,d=o*this.resolution,c=h*this.resolution,u=Math.min(Math.max(ve(d),this.canvas.width),this.maxCanvasWidth),m=Math.min(Math.max(ve(c),this.canvas.height),this.maxCanvasHeight);u===0||m===0?F.dimensionlessWarned||(F.dimensionlessWarned=!0,console.warn(S.DIMENSIONLESS_CANVAS)):(!xe(u)||!xe(m))&&(F.powerOf2Warned||(F.powerOf2Warned=!0,console.warn(S.NON_POW2_CANVAS)));let f=this.canvas.width,p=this.canvas.height,[g,w]=this.effectiveScale,v=f!==0&&p!==0;if((g!==this._prevESX||w!==this._prevESY)&&(this._prevESX=g,this._prevESY=w,v=!1,r=!0,this.child.forceDirty(!1),this.child.finalizeBounds()),u!==f||m!==p){r=!0;let x=null;if(v){x=document.createElement("canvas"),x.width=f,x.height=p;let T=x.getContext("2d");if(T===null)throw new Error(S.CANVAS_CONTEXT);T.globalCompositeOperation="copy",T.drawImage(this.canvas,0,0,f,p,0,0,f,p)}this.canvas.width=u,this.canvas.height=m,x!==null&&(this.context.globalCompositeOperation="copy",this.context.drawImage(x,0,0,x.width,x.height,0,0,Math.min(x.width,this.maxCanvasWidth),Math.min(x.height,this.maxCanvasHeight)),this.context.globalCompositeOperation="source-over")}}return r}get effectiveScale(){let[t,e]=this.child.dimensions;return[Math.min(this.maxCanvasWidth/t,this.resolution),Math.min(this.maxCanvasHeight/e,this.resolution)]}get realDimensions(){let[t,e]=this.child.dimensions;return[Math.min(this.maxCanvasWidth,Math.ceil(t*this.resolution)),Math.min(this.maxCanvasHeight,Math.ceil(e*this.resolution))]}paintToInternal(t){let e=this.child.dirty,[r,n]=this.effectiveScale,s=r!==1||n!==1;if(s&&(this.context.save(),this.context.scale(r,n)),this.child.paint(t),s&&this.context.restore(),this.preventBleeding&&this.shrunk){this.shrunk=!1;let[o,h]=this.realDimensions,d=this.maxCanvasWidth-o,c=this.maxCanvasHeight-h;d>0&&c>0?(this.context.clearRect(o,0,d,h),this.context.clearRect(0,h,this.maxCanvasWidth,this.maxCanvasHeight)):d>0?this.context.clearRect(o,0,d,this.maxCanvasHeight):c>0&&this.context.clearRect(0,h,this.maxCanvasWidth,this.maxCanvasHeight)}return e}paint(t,e){let r=this.paintToInternal(t);if(this.parent!==null){let[n,s,o,h,d,c,u,m,f,p]=this.getClippedViewport(),g=this.parent.context;if(g.save(),g.globalCompositeOperation="copy",g.fillStyle=e,g.beginPath(),g.rect(n,s,o,h),g.clip(),f!==0&&p!==0){let[w,v]=this.effectiveScale;g.drawImage(this.canvas,(u-d)*w,(m-c)*v,f*w,p*v,u,m,f,p)}g.rect(u,m,f,p),g.clip("evenodd"),g.fill(),g.restore()}return r}};a(et,"CanvasViewport"),_([vt],et.prototype,"maxCanvasWidth",2),_([vt],et.prototype,"maxCanvasHeight",2),_([he("_forceResize")],et.prototype,"resolution",2);var Vt=class extends F{get context(){if(this.parent===null)throw S.PARENTLESS_CLIPVP;return this.parent.context}get effectiveScale(){if(this.parent===null)throw S.PARENTLESS_CLIPVP;return this.parent.effectiveScale}constructor(i){super(i,!1)}paint(i,t){let e=this.child.dirty,[r,n,s,o,h,d,c,u,m,f]=this.getClippedViewport(),p=this.context;return p.save(),p.globalCompositeOperation="copy",p.fillStyle=t,p.beginPath(),p.rect(r,n,s,o),p.clip(),p.rect(c,u,m,f),p.clip("evenodd"),p.fill(),p.restore(),m===0||f===0?(this.child.dryPaint(),e):(p.save(),p.beginPath(),p.rect(r,n,s,o),p.clip(),this.child.paint(i),p.restore(),e)}};a(Vt,"ClippedViewport");var hi=(n=>(n.SpaceBetween="between",n.SpaceAround="around",n[n.Start=0]="Start",n[n.Center=.5]="Center",n[n.End=1]="End",n))(hi||{});var di=(r=>(r.Stretch="stretch",r[r.Start=0]="Start",r[r.Center=.5]="Center",r[r.End=1]="End",r))(di||{});var Bt=class extends U{constructor(t,e){super(null,null,!1);this.originallyRelativeTo=t,this.bounds=[...e]}cloneWithTarget(t){return t!==null&&!Bt.targetWarned&&(Bt.targetWarned=!0,console.warn(b.UNTARGETABLE_EVENT("AutoScroll"))),new Bt(this.originallyRelativeTo,this.bounds)}},j=Bt;a(j,"AutoScroll"),j.targetWarned=!1;var Nt=class extends U{constructor(t,e){super(null,null,!1,e);this.relativeTo=t,this.reachedRelative=t===null}cloneWithTarget(t){t!==null&&!Nt.targetWarned&&(Nt.targetWarned=!0,console.warn(b.UNTARGETABLE_EVENT("TabSelect")));let e=new Nt(this.relativeTo,this.reversed);return e.reachedRelative=this.reachedRelative,e}},O=Nt;a(O,"TabSelect"),O.targetWarned=!1;var Ot=null,Z=[],Ge=64,ci=1e4;function de(l,i){let t=new Date().getTime(),e=null,r=-1,n=Z.length-1;for(let o=0;o<Z.length;o++){let h=Z[o];if(h[0]===i&&h[1]===l){e=h,r=o;break}t-h[4]>ci&&(n=o)}if(e){let o=++e[3];if(e[4]=t,r>0){let h=0;for(;h<r&&!(Z[h][3]<=o);h++);h!==r&&(Z.splice(r,1),Z.splice(h,0,e))}return e[2]}if(Ot===null&&(Ot=document.createElement("canvas").getContext("2d"),Ot===null))throw new Error(S.CANVAS_CONTEXT);Ot.font=i;let s=Ot.measureText(l);if(Ge>0){Z.length===Ge&&Z.splice(n,1);let o=0;for(;o<Z.length&&!(Z[o][3]<=1);o++);Z.splice(o,0,[i,l,s,1,t])}return s}a(de,"measureTextDims");var ui=new Set([`
`,"	"]),ze=(e=>(e[e.None=0]="None",e[e.Normal=1]="Normal",e[e.Shrink=2]="Shrink",e))(ze||{}),fi=(e=>(e[e.Start=0]="Start",e[e.Center=.5]="Center",e[e.End=1]="End",e))(fi||{}),mi="~!@#$%^&*()_+`1234567890-=qwertyuiop[]\\QWERTYUIOP{}|asdfghjkl;'ASDFGHJKL:\"zxcvbnm,./ZXCVBNM<>?",D=class{constructor(){this.text="";this.font="";this.maxWidth=1/0;this.lineHeight=null;this.lineSpacing=null;this.tabWidth=4;this.wrapMode=1;this.alignMode=0;this._width=0;this._height=0;this._lineHeight=0;this._lineSpacing=0;this._tabWidth=0;this.measureDirty=!0;this.maxWidthDirty=!1;this.lineHeightSpacingDirty=!0;this.tabWidthDirty=!0;this._dirty=!1;this._lineRanges=[];this.hasWrappedLines=!1}get dirty(){let i=this._dirty;return this._dirty=!1,i}measureTextSlice(i,t,e){let r=de(this.text.slice(t,e),this.font);return i===0?r.width+Math.max(0,r.actualBoundingBoxLeft):i+r.width}getLineRangeWidthUntil(i,t){if(t<=i[0][0])return 0;let e=0;for(;e<i.length;e++){let s=i[e],o=s[1];if(t==o)return s[2];if(t>=s[0]&&t<o)break}if(e===i.length)return i[e-1][2];let r=0;e>0&&(r=i[e-1][2]);let n=i[e];return n[3]?r+n[2]*(t-n[0])/(n[1]-n[0]):this.measureTextSlice(r,n[0],t)}measureText(i,t,e,r){var u,m;let n=0;for(;n<r.length;n++){let f=r[n];if(i>=f[0]&&i<f[1]){i=f[0];break}}if(n>0){let f=r[n-1];f[1]!==i&&(i=f[1],--n>0?f=r[n]:f=null),f!==null&&!f[3]&&!ui.has(this.text[i])&&(i=f[0],n--)}let s=0;n>0&&(s=r[n-1][2]);let o=i,h=[];for(;o<t;)if(this.text[o]==="	"){let f=this.actualTabWidth;s=(Math.floor(s/f)+1)*f,h.push([o,++o,s,!0])}else if(this.text[o]===`
`){h.push([o,++o,s,!0]),o<t&&console.warn(S.ROGUE_NEWLINE);break}else{let f=this.text.indexOf(`
`,o+1);f===-1&&(f=1/0);let p=this.text.indexOf("	",o+1);p===-1&&(p=1/0);let g=Math.min(f,p,t);s=this.measureTextSlice(s,o,g),h.push([o,g,s,!1]),o=g}let d=n+h.length,c=(m=(u=h[h.length-1])!=null?u:r[n-1])!=null?m:null;return c===null?(r.length=0,r.push([i,i,0,!1]),!0):d===1&&c[1]-c[0]<=1||c[2]<=e?(r.length=n,r.push(...h),!0):!1}updateTextDims(){if(this.lineHeightSpacingDirty){this.lineHeightSpacingDirty=!1;let t=this._lineHeight,e=this._lineSpacing;if(this.lineHeight===null||this.lineSpacing===null){let r=de(mi,this.font);this.lineHeight===null?this._lineHeight=r.actualBoundingBoxAscent:this._lineHeight=this.lineHeight,this.lineSpacing===null?this._lineSpacing=r.actualBoundingBoxDescent:this._lineSpacing=this.lineSpacing}else this._lineHeight=this.lineHeight,this._lineSpacing=this.lineSpacing;(t!==this._lineHeight||e!==this._lineSpacing)&&(this.measureDirty=!0)}if(this.maxWidthDirty&&!this.measureDirty)if(this.maxWidth===1/0)if(this.hasWrappedLines)this.measureDirty=!0;else{this._width=0;for(let t of this._lineRanges){let e=t[t.length-1][2];e>this._width&&(this._width=e)}}else this.hasWrappedLines||this._width>this.maxWidth?this.measureDirty=!0:this._width=this.maxWidth;if(this.maxWidthDirty=!1,this.tabWidthDirty&&(this.tabWidthDirty=!1,this._tabWidth=de(" ",this.font).width*this.tabWidth),!this.measureDirty)return;this.measureDirty=!1,this.hasWrappedLines=!1;let i=this._lineHeight+this._lineSpacing;if(this.text.length===0)this._height=i,this._width=this.maxWidth===1/0?0:this.maxWidth,this._lineRanges.length=1,this._lineRanges[0]=[[0,0,0,!1]];else if(this.maxWidth===1/0||this.wrapMode===0){this._lineRanges.length=0;let t=0;this._height=0,this._width=0;let e=this.text;for(;;){let r=this.text.indexOf(`
`,t),n=r===-1,s=n?e.length:r+1,o=[];this.measureText(t,s,1/0,o),this._lineRanges.push(o),this._height+=i;let h=o[o.length-1][2];if(h>this._width&&(this._width=h),n)break;t=s}this.maxWidth!==1/0&&(this._width=this.maxWidth)}else{this._lineRanges.length=0;let t=[],e=this.text,r=/\s/,n=-1;for(let s=0;s<=e.length;){let o=r.test(e[s]),h=s===e.length;if(o||h){if(n>=0&&!this.measureText(n,s,this.maxWidth,t)){this.hasWrappedLines=!0;let d=[];if(this.measureText(n,s,this.maxWidth,d)){if(t.length===0)throw new Error(S.EMPTY_LINE_RANGE);this._lineRanges.push(t),t=d}else{let c=n;for(;c<s-1&&this.measureText(c,c+1,this.maxWidth,t);c++);this._lineRanges.push(t),t=d,s=c,n=c;continue}}if(n=-1,h){if(t.length===0){let d=this._lineRanges[this._lineRanges.length-1];if(d===void 0)t.push([0,0,0,!1]);else{let c=d[d.length-1];c===void 0?t.push([0,0,0,!1]):t.push([c[1],c[1],0,!1])}}this._lineRanges.push(t);break}if(e[s]===`
`)this.measureText(s,s+1,1/0,t),this._lineRanges.push(t),t=[];else if(!this.measureText(s,s+1,this.maxWidth,t))if(this.wrapMode===2){let d=s;do s++;while(e[s]!==`
`&&r.test(e[s]));let c=t[t.length-1];t.push([d,s,c!==void 0?c[2]:0,!0]),this._lineRanges.push(t),t=[];continue}else if(this.wrapMode===1)this.hasWrappedLines=!0,this._lineRanges.push(t),t=[],this.measureText(s,s+1,1/0,t);else throw new Error(b.INVALID_ENUM(this.wrapMode,"WrapMode","wrapMode",!0))}else n===-1&&(n=s);s++}this._width=this.maxWidth,this._height=i*this._lineRanges.length}}paintGroup(i,t,e,r,n){!t[3]&&t[2]>e&&i.fillText(this.text.slice(t[0],t[1]),r,n)}paint(i,t,e,r){i.save(),i.beginPath(),i.rect(e,r,this.width,this.height),i.clip(),i.font=this.font,i.fillStyle=t,i.textBaseline="alphabetic",this.updateTextDims();let n=this.fullLineHeight,s=r+this._lineHeight;for(let o=0;o<this._lineRanges.length;o++){let h=0,d=this.getLineShift(o);for(let c of this._lineRanges[o])this.paintGroup(i,c,h,e+h+d,s),h=c[2];s+=n}i.restore()}findOffsetFromIndex(i){if(this.updateTextDims(),i<=0||this._lineRanges.length===0)return[this.getLineShift(0),0];let t=0;for(let e of this._lineRanges){if(i<e[e.length-1][1])break;t++}return t>=this._lineRanges.length&&(t=this._lineRanges.length-1,i=this.text.length),[this.getLineRangeWidthUntil(this._lineRanges[t],i)+this.getLineShift(t),t*this.fullLineHeight]}findIndexOffsetFromOffset(i){let t=this.fullLineHeight,e=this.getLineShift(0);if(this.text===""||i[0]<=e&&i[1]<t||i[1]<0)return[0,[e,0]];let r=Math.floor(i[1]/t);if(this.updateTextDims(),r>=this._lineRanges.length){let v=this.text.length;return[v,this.findOffsetFromIndex(v)]}let n=r*t,s=this._lineRanges[r],o=this.getLineShift(r);if(s.length===1&&s[0][0]===s[0][1])return[s[0][0],[s[0][2]+o,n]];let h=s[0][0],d=s[s.length-1][1];this.text[d-1]===`
`&&d--;let c=-1,u=0,m=i[0]-o,f=h,p=d+1,g=0,w=0;do{let v=f+Math.floor((p-f)/2),x=this.getLineRangeWidthUntil(s,v);x>=m?(p=v,c=v,u=x):(f=v+1,g=v,w=x)}while(f!==p);if(g<d){let v=g+1,x=u;c!==v&&(x=this.getLineRangeWidthUntil(s,v));let T=w+(x-w)/2;if(m>=T)return[v,[x+o,n]]}return[g,[w+o,n]]}getLine(i){if(i<=0)return 0;this.updateTextDims();for(let t=0;t<this._lineRanges.length;t++){let e=this._lineRanges[t],r=e[e.length-1];if(i<r[1])return t}return this._lineRanges.length-1}getLineStart(i){if(i<=0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let t=this._lineRanges[this._lineRanges.length-1];return t[t.length-1][1]}return this._lineRanges[i][0][0]}getLineEnd(i,t=!0){if(i<0)return 0;if(this.updateTextDims(),i>=this._lineRanges.length){let s=this._lineRanges[this._lineRanges.length-1];return s[s.length-1][1]}let e=this._lineRanges[i],r=e[e.length-1],n=r[1];return!t&&n>0&&this.text[n-1]===`
`&&r[0]!==r[1]?n-1:n}getLineShift(i){let t=this.alignMode;if(t===0)return 0;if(this.updateTextDims(),i<0)i=0;else if(i>=this._lineRanges.length)return this.width*t;let e=this._lineRanges[i];return(this.width-e[e.length-1][2])*t}get width(){return this.updateTextDims(),this._width}get height(){return this.updateTextDims(),this._height}get lineRanges(){return this.updateTextDims(),[...this._lineRanges]}get actualLineHeight(){return this.updateTextDims(),this._lineHeight}get actualLineSpacing(){return this.updateTextDims(),this._lineSpacing}get actualTabWidth(){return this.updateTextDims(),this._tabWidth}get fullLineHeight(){return this.updateTextDims(),this._lineHeight+this._lineSpacing}};a(D,"TextHelper"),_([G(["_dirty","measureDirty"])],D.prototype,"text",2),_([G(["_dirty","measureDirty","lineHeightSpacingDirty","tabWidthDirty"])],D.prototype,"font",2),_([G(["_dirty","maxWidthDirty"])],D.prototype,"maxWidth",2),_([G(["_dirty","measureDirty","lineHeightSpacingDirty"])],D.prototype,"lineHeight",2),_([G(["_dirty","measureDirty","lineHeightSpacingDirty"])],D.prototype,"lineSpacing",2),_([G(["_dirty","measureDirty","tabWidthDirty"])],D.prototype,"tabWidth",2),_([G(["_dirty","measureDirty"])],D.prototype,"wrapMode",2),_([G(["_dirty"])],D.prototype,"alignMode",2);var M=class{constructor(i,t){this.listener=null;this._fallbackTheme=t,typeof i!="undefined"&&(this._canvasFill=i.canvasFill,this._containerPadding=i.containerPadding,this._containerAlignment=i.containerAlignment,this._multiContainerSpacing=i.multiContainerSpacing,this._multiContainerAlignment=i.multiContainerAlignment,this._primaryFill=i.primaryFill,this._accentFill=i.accentFill,this._backgroundFill=i.backgroundFill,this._backgroundGlowFill=i.backgroundGlowFill,this._sliderMinLength=i.sliderMinLength,this._sliderThickness=i.sliderThickness,this._bodyTextFont=i.bodyTextFont,this._bodyTextFill=i.bodyTextFill,this._bodyTextHeight=i.bodyTextHeight,this._bodyTextSpacing=i.bodyTextSpacing,this._bodyTextAlign=i.bodyTextAlign,this._checkboxLength=i.checkboxLength,this._checkboxInnerPadding=i.checkboxInnerPadding,this._inputBackgroundFill=i.inputBackgroundFill,this._inputSelectBackgroundFill=i.inputSelectBackgroundFill,this._inputTextFont=i.inputTextFont,this._inputTextFill=i.inputTextFill,this._inputTextFillDisabled=i.inputTextFillDisabled,this._inputTextFillInvalid=i.inputTextFillInvalid,this._inputTextHeight=i.inputTextHeight,this._inputTextSpacing=i.inputTextSpacing,this._inputTextInnerPadding=i.inputTextInnerPadding,this._inputTextMinWidth=i.inputTextMinWidth,this._inputTextAlign=i.inputTextAlign,this._blinkRate=i.blinkRate,this._cursorThickness=i.cursorThickness,this._scrollBarThickness=i.scrollBarThickness,this._scrollBarMinPercent=i.scrollBarMinPercent,this._scrollBarMinPixels=i.scrollBarMinPixels,this._radioButtonLength=i.radioButtonLength,this._radioButtonInnerPadding=i.radioButtonInnerPadding)}get fallbackTheme(){return this._fallbackTheme}set fallbackTheme(i){if(this._fallbackTheme===i)return;let t=this._fallbackTheme;typeof t!="undefined"&&this.listener!==null&&t.unsubscribe(this.listener),typeof i!="undefined"&&(this.listener=e=>this.onThemeUpdated(e),i.subscribe(this.listener)),this._fallbackTheme=i,this.onThemeUpdated()}onThemeUpdated(i=null){}get canvasFill(){var i,t,e;return(e=(t=this._canvasFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.canvasFill)!=null?e:"rgba(0,0,0,0.5)"}set canvasFill(i){this._canvasFill!==i&&(this._canvasFill=i,this.onThemeUpdated("canvasFill"))}get containerPadding(){var i,t,e;return(e=(t=this._containerPadding)!=null?t:(i=this._fallbackTheme)==null?void 0:i.containerPadding)!=null?e:{left:4,right:4,top:4,bottom:4}}set containerPadding(i){this._containerPadding!==i&&(this._containerPadding=i,this.onThemeUpdated("containerPadding"))}get containerAlignment(){var i,t,e;return(e=(t=this._containerAlignment)!=null?t:(i=this._fallbackTheme)==null?void 0:i.containerAlignment)!=null?e:{horizontal:0,vertical:0}}set containerAlignment(i){this._containerAlignment!==i&&(this._containerAlignment=i,this.onThemeUpdated("containerAlignment"))}get multiContainerSpacing(){var i,t,e;return(e=(t=this._multiContainerSpacing)!=null?t:(i=this._fallbackTheme)==null?void 0:i.multiContainerSpacing)!=null?e:4}set multiContainerSpacing(i){this._multiContainerSpacing!==i&&(this._multiContainerSpacing=i,this.onThemeUpdated("multiContainerSpacing"))}get multiContainerAlignment(){var i,t,e;return(e=(t=this._multiContainerAlignment)!=null?t:(i=this._fallbackTheme)==null?void 0:i.multiContainerAlignment)!=null?e:{main:"between",cross:"stretch"}}set multiContainerAlignment(i){this._multiContainerAlignment!==i&&(this._multiContainerAlignment=i,this.onThemeUpdated("multiContainerAlignment"))}get primaryFill(){var i,t,e;return(e=(t=this._primaryFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.primaryFill)!=null?e:"rgb(0,127,255)"}set primaryFill(i){this._primaryFill!==i&&(this._primaryFill=i,this.onThemeUpdated("primaryFill"))}get accentFill(){var i,t,e;return(e=(t=this._accentFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.accentFill)!=null?e:"rgb(0,195,255)"}set accentFill(i){this._accentFill!==i&&(this._accentFill=i,this.onThemeUpdated("accentFill"))}get backgroundFill(){var i,t,e;return(e=(t=this._backgroundFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.backgroundFill)!=null?e:"rgb(32,32,32)"}set backgroundFill(i){this._backgroundFill!==i&&(this._backgroundFill=i,this.onThemeUpdated("backgroundFill"))}get backgroundGlowFill(){var i,t,e;return(e=(t=this._backgroundGlowFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.backgroundGlowFill)!=null?e:"rgb(48,48,48)"}set backgroundGlowFill(i){this._backgroundGlowFill!==i&&(this._backgroundGlowFill=i,this.onThemeUpdated("backgroundGlowFill"))}get sliderMinLength(){var i,t,e;return(e=(t=this._sliderMinLength)!=null?t:(i=this._fallbackTheme)==null?void 0:i.sliderMinLength)!=null?e:100}set sliderMinLength(i){this._sliderMinLength!==i&&(this._sliderMinLength=i,this.onThemeUpdated("sliderMinLength"))}get sliderThickness(){var i,t,e;return(e=(t=this._sliderThickness)!=null?t:(i=this._fallbackTheme)==null?void 0:i.sliderThickness)!=null?e:10}set sliderThickness(i){this._sliderThickness!==i&&(this._sliderThickness=i,this.onThemeUpdated("sliderThickness"))}get bodyTextFont(){var i,t,e;return(e=(t=this._bodyTextFont)!=null?t:(i=this._fallbackTheme)==null?void 0:i.bodyTextFont)!=null?e:"1rem sans-serif"}set bodyTextFont(i){this._bodyTextFont!==i&&(this._bodyTextFont=i,this.onThemeUpdated("bodyTextFont"))}get bodyTextFill(){var i,t,e;return(e=(t=this._bodyTextFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.bodyTextFill)!=null?e:"white"}set bodyTextFill(i){this._bodyTextFill!==i&&(this._bodyTextFill=i,this.onThemeUpdated("bodyTextFill"))}get bodyTextHeight(){var i,t,e;return(e=(t=this._bodyTextHeight)!=null?t:(i=this._fallbackTheme)==null?void 0:i.bodyTextHeight)!=null?e:null}set bodyTextHeight(i){this._bodyTextHeight!==i&&(this._bodyTextHeight=i,this.onThemeUpdated("bodyTextHeight"))}get bodyTextSpacing(){var i,t,e;return(e=(t=this._bodyTextSpacing)!=null?t:(i=this._fallbackTheme)==null?void 0:i.bodyTextSpacing)!=null?e:null}set bodyTextSpacing(i){this._bodyTextSpacing!==i&&(this._bodyTextSpacing=i,this.onThemeUpdated("bodyTextSpacing"))}get bodyTextAlign(){var i,t,e;return(e=(t=this._bodyTextAlign)!=null?t:(i=this._fallbackTheme)==null?void 0:i.bodyTextAlign)!=null?e:0}set bodyTextAlign(i){this._bodyTextAlign!==i&&(this._bodyTextAlign=i,this.onThemeUpdated("bodyTextAlign"))}get checkboxLength(){var i,t,e;return(e=(t=this._checkboxLength)!=null?t:(i=this._fallbackTheme)==null?void 0:i.checkboxLength)!=null?e:12}set checkboxLength(i){this._checkboxLength!==i&&(this._checkboxLength=i,this.onThemeUpdated("checkboxLength"))}get checkboxInnerPadding(){var i,t,e;return(e=(t=this._checkboxInnerPadding)!=null?t:(i=this._fallbackTheme)==null?void 0:i.checkboxInnerPadding)!=null?e:2}set checkboxInnerPadding(i){this._checkboxInnerPadding!==i&&(this._checkboxInnerPadding=i,this.onThemeUpdated("checkboxInnerPadding"))}get inputBackgroundFill(){var i,t,e;return(e=(t=this._inputBackgroundFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputBackgroundFill)!=null?e:"white"}set inputBackgroundFill(i){this._inputBackgroundFill!==i&&(this._inputBackgroundFill=i,this.onThemeUpdated("inputBackgroundFill"))}get inputSelectBackgroundFill(){var i,t,e;return(e=(t=this._inputSelectBackgroundFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputSelectBackgroundFill)!=null?e:"rgb(0,195,255)"}set inputSelectBackgroundFill(i){this._inputSelectBackgroundFill!==i&&(this._inputSelectBackgroundFill=i,this.onThemeUpdated("inputSelectBackgroundFill"))}get inputTextFont(){var i,t,e;return(e=(t=this._inputTextFont)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextFont)!=null?e:"1rem monospace"}set inputTextFont(i){this._inputTextFont!==i&&(this._inputTextFont=i,this.onThemeUpdated("inputTextFont"))}get inputTextFill(){var i,t,e;return(e=(t=this._inputTextFill)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextFill)!=null?e:"black"}set inputTextFill(i){this._inputTextFill!==i&&(this._inputTextFill=i,this.onThemeUpdated("inputTextFill"))}get inputTextFillDisabled(){var i,t,e;return(e=(t=this._inputTextFillDisabled)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextFillDisabled)!=null?e:"grey"}set inputTextFillDisabled(i){this._inputTextFillDisabled!==i&&(this._inputTextFillDisabled=i,this.onThemeUpdated("inputTextFillDisabled"))}get inputTextFillInvalid(){var i,t,e;return(e=(t=this._inputTextFillInvalid)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextFillInvalid)!=null?e:"red"}set inputTextFillInvalid(i){this._inputTextFillInvalid!==i&&(this._inputTextFillInvalid=i,this.onThemeUpdated("inputTextFillInvalid"))}get inputTextHeight(){var i,t,e;return(e=(t=this._inputTextHeight)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextHeight)!=null?e:null}set inputTextHeight(i){this._inputTextHeight!==i&&(this._inputTextHeight=i,this.onThemeUpdated("inputTextHeight"))}get inputTextSpacing(){var i,t,e;return(e=(t=this._inputTextSpacing)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextSpacing)!=null?e:null}set inputTextSpacing(i){this._inputTextSpacing!==i&&(this._inputTextSpacing=i,this.onThemeUpdated("inputTextSpacing"))}get inputTextInnerPadding(){var i,t,e;return(e=(t=this._inputTextInnerPadding)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextInnerPadding)!=null?e:2}set inputTextInnerPadding(i){this._inputTextInnerPadding!==i&&(this._inputTextInnerPadding=i,this.onThemeUpdated("inputTextInnerPadding"))}get inputTextMinWidth(){var i,t,e;return(e=(t=this._inputTextMinWidth)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextMinWidth)!=null?e:100}set inputTextMinWidth(i){this._inputTextMinWidth!==i&&(this._inputTextMinWidth=i,this.onThemeUpdated("inputTextMinWidth"))}get inputTextAlign(){var i,t,e;return(e=(t=this._inputTextAlign)!=null?t:(i=this._fallbackTheme)==null?void 0:i.inputTextAlign)!=null?e:0}set inputTextAlign(i){this._inputTextAlign!==i&&(this._inputTextAlign=i,this.onThemeUpdated("inputTextAlign"))}get blinkRate(){var i,t,e;return(e=(t=this._blinkRate)!=null?t:(i=this._fallbackTheme)==null?void 0:i.blinkRate)!=null?e:.8}set blinkRate(i){this._blinkRate!==i&&(this._blinkRate=i,this.onThemeUpdated("blinkRate"))}get cursorThickness(){var i,t,e;return(e=(t=this._cursorThickness)!=null?t:(i=this._fallbackTheme)==null?void 0:i.cursorThickness)!=null?e:1}set cursorThickness(i){this._cursorThickness!==i&&(this._cursorThickness=i,this.onThemeUpdated("cursorThickness"))}get scrollBarThickness(){var i,t,e;return(e=(t=this._scrollBarThickness)!=null?t:(i=this._fallbackTheme)==null?void 0:i.scrollBarThickness)!=null?e:8}set scrollBarThickness(i){this._scrollBarThickness!==i&&(this._scrollBarThickness=i,this.onThemeUpdated("scrollBarThickness"))}get scrollBarMinPercent(){var i,t,e;return(e=(t=this._scrollBarMinPercent)!=null?t:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPercent)!=null?e:.1}set scrollBarMinPercent(i){this._scrollBarMinPercent!==i&&(this._scrollBarMinPercent=i,this.onThemeUpdated("scrollBarMinPercent"))}get scrollBarMinPixels(){var i,t,e;return(e=(t=this._scrollBarMinPixels)!=null?t:(i=this._fallbackTheme)==null?void 0:i.scrollBarMinPixels)!=null?e:20}set scrollBarMinPixels(i){this._scrollBarMinPixels!==i&&(this._scrollBarMinPixels=i,this.onThemeUpdated("scrollBarMinPixels"))}get radioButtonLength(){var i,t,e;return(e=(t=this._radioButtonLength)!=null?t:(i=this._fallbackTheme)==null?void 0:i.radioButtonLength)!=null?e:12}set radioButtonLength(i){this._radioButtonLength!==i&&(this._radioButtonLength=i,this.onThemeUpdated("radioButtonLength"))}get radioButtonInnerPadding(){var i,t,e;return(e=(t=this._radioButtonInnerPadding)!=null?t:(i=this._fallbackTheme)==null?void 0:i.radioButtonInnerPadding)!=null?e:2}set radioButtonInnerPadding(i){this._radioButtonInnerPadding!==i&&(this._radioButtonInnerPadding=i,this.onThemeUpdated("radioButtonInnerPadding"))}};a(M,"BaseTheme");var pi=Math.PI*2,y=class extends M{constructor(t,e,r){var n,s;super(r);this._dirty=!0;this._layoutDirty=!0;this.width=0;this.height=0;this.x=0;this.y=0;this.idealWidth=0;this.idealHeight=0;this.idealX=0;this.idealY=0;this._root=null;this._viewport=null;this._parent=null;this.tabFocusable=!1;this._active=!1;this.needsClear=t,this.propagatesEvents=e,this._enabled=(n=r==null?void 0:r.enabled)!=null?n:!0,this._flex=(s=r==null?void 0:r.flex)!=null?s:0}get flex(){return this._flex}set flex(t){t!==this._flex&&(this._flex=t,this._layoutDirty=!0)}set enabled(t){t!==this._enabled&&(this._enabled=t,this.updateActiveState())}get enabled(){return this._enabled}set inheritedTheme(t){this.fallbackTheme=t}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(t=null){super.onThemeUpdated(t),this.needsClear&&(t===null||t==="canvasFill")&&(this._dirty=!0)}get dimensions(){return[this.width,this.height]}get idealDimensions(){return[this.idealWidth,this.idealHeight]}get position(){return[this.x,this.y]}get idealPosition(){return[this.idealX,this.idealY]}get bounds(){let t=this.x,e=this.y;return[t,t+this.width,e,e+this.height]}get idealBounds(){let t=this.idealX,e=this.idealY;return[t,t+this.idealWidth,e,e+this.idealHeight]}get rect(){return[this.x,this.y,this.width,this.height]}get idealRect(){return[this.idealX,this.idealY,this.idealWidth,this.idealHeight]}get dirty(){return this._dirty&&!this.dimensionless}get layoutDirty(){return this._layoutDirty}get dimensionless(){return this.width==0||this.height==0}onFocusGrabbed(t){}onFocusDropped(t){}handleEvent(t){return t.target===this?this:null}dispatchEvent(t){if(!this._enabled)return null;if(t.target===null){if(t instanceof W){if(t.x<this.x||t.y<this.y||t.x>=this.x+this.width||t.y>=this.y+this.height)return null}else if(t instanceof j){if(t.originallyRelativeTo===this)return this;if(!this.propagatesEvents)return null}}else if(t.target!==this&&!this.propagatesEvents)return null;let e=null;if(t.reversed&&(e=this.handleEvent(t)),t instanceof O)if(t.reachedRelative){if(this.tabFocusable&&(e===this||e===null))return this}else t.relativeTo===this&&(t.reachedRelative=!0);return t.reversed||(e=this.handleEvent(t)),e}handlePreLayoutUpdate(){}preLayoutUpdate(){this._enabled&&this.handlePreLayoutUpdate()}resolveDimensions(t,e,r,n){if(!this._enabled){this.width=0,this.height=0,this.idealWidth=0,this.idealHeight=0,this._layoutDirty=!1;return}if(t==1/0)throw new Error(b.INVALID_VALUE("minWidth",t));if(t>e&&(console.warn(b.SWAPPED_MIN_MAX_DIMS(t,e,"minWidth","maxWidth")),t=e),t<0&&(console.warn(b.NEGATIVE_DIMS(t,"minWidth")),t=0),r==1/0)throw new Error(b.INVALID_VALUE("minHeight",r));r>n&&(console.warn(b.SWAPPED_MIN_MAX_DIMS(r,n,"minHeight","maxHeight")),r=n),r<0&&(console.warn(b.NEGATIVE_DIMS(r,"minHeight")),r=0);let s=this.idealWidth,o=this.idealHeight;if(this.handleResolveDimensions(t,e,r,n),this.idealWidth<t?(this.idealWidth=t,console.error(b.BROKEN_CONSTRAINTS(this.idealWidth,t,!0,!1))):this.idealWidth>e&&(this.idealWidth=e,console.error(b.BROKEN_CONSTRAINTS(this.idealWidth,e,!0,!0))),this.idealWidth<0||!isFinite(this.idealWidth)||isNaN(this.idealWidth))throw new Error(b.INVALID_DIMS(!0,this.idealWidth));if(this.idealHeight<r?(this.idealHeight=r,console.error(b.BROKEN_CONSTRAINTS(this.idealHeight,r,!1,!1))):this.idealHeight>n&&(this.idealHeight=n,console.error(b.BROKEN_CONSTRAINTS(this.idealHeight,n,!1,!0))),this.idealHeight<0||!isFinite(this.idealHeight)||isNaN(this.idealHeight))throw new Error(b.INVALID_DIMS(!1,this.idealHeight));this._layoutDirty=!1,(s!==this.idealWidth||o!==this.idealHeight)&&(this._dirty=!0)}resolveDimensionsAsTop(t,e,r,n){this.resolveDimensions(t,e,r,n),(e===1/0||n===1/0)&&this.resolveDimensions(t,e===1/0?this.idealWidth:e,r,n===1/0?this.idealHeight:n)}resolvePosition(t,e){this.idealX=t,this.idealY=e}finalizeBounds(){let[t,e]=this.viewport.effectiveScale,r=Math.floor(this.idealX*t)/t,n=Math.floor(this.idealY*e)/e,s=Math.ceil((this.idealX+this.idealWidth)*t)/t-r,o=Math.ceil((this.idealY+this.idealHeight)*e)/e-n;(r!==this.x||n!==this.y||s!==this.width||o!==this.height)&&(this._dirty=!0),this.x=r,this.y=n,this.width=s,this.height=o}handlePostLayoutUpdate(){}postLayoutUpdate(){this._enabled&&this.handlePostLayoutUpdate()}clear(t,e,r,n,s=null){let o=this.viewport.context;o.save(),o.globalCompositeOperation="copy",o.fillStyle=s!=null?s:this.canvasFill,o.beginPath(),o.rect(t,e,r,n),o.clip(),o.fill(),o.restore()}clearStart(t=null){let e=this.viewport.context;e.save(),e.globalCompositeOperation="copy",e.fillStyle=t!=null?t:this.canvasFill,e.beginPath()}clearEnd(t="nonzero"){let e=this.viewport.context;e.clip(t),e.fill(),e.restore()}paintCircle(t,e,r){let n=this.viewport.context;n.beginPath(),n.arc(t,e,r,0,pi),n.fill()}handlePainting(t){}paint(t=!1){if(this.dimensionless)return this.dryPaint();if(!(!this._dirty&&!t)){if(this._enabled){this.needsClear&&this.clear(this.x,this.y,this.width,this.height);let e=this.viewport.context;e.save(),this.handlePainting(t),e.restore()}this._dirty=!1}}dryPaint(){this._dirty=!1}forceDirty(t=!0){this._dirty=!0,t&&(this._layoutDirty=!0)}get attached(){return this._root!==null}get root(){if(!this.attached)throw new Error(b.DETACHED_WIDGET("root"));return this._root}get viewport(){if(!this.attached)throw new Error(b.DETACHED_WIDGET("viewport"));return this._viewport}get parent(){if(!this.attached)throw new Error(b.DETACHED_WIDGET("parent"));return this._parent}attach(t,e,r){if(this.attached)throw new Error(b.INVALID_ATTACHMENT(!0));this._root=t,this._viewport=e,this._parent=r,this.updateActiveState()}detach(){if(!this.attached)throw new Error(b.INVALID_ATTACHMENT(!1));this._root.dropFoci(this),this._root=null,this._viewport=null,this._parent=null,this.updateActiveState()}get active(){return this._active}updateActiveState(){let t=this._active;return this._active=!1,this._enabled&&this.attached&&(this._parent===null?this._active=this._root.enabled:this._active=this._parent.active),!t&&this._active?(this.activate(),!0):t&&!this._active?(this.deactivate(),!0):!1}activate(){this._dirty=!0,this._layoutDirty=!0}deactivate(){this._dirty=!0,this._layoutDirty=!0,this.attached&&this._root.dropFoci(this)}autoScroll(){this.root.dispatchEvent(new j(this,[0,this.idealWidth,0,this.idealHeight]))}};a(y,"Widget");var wt=class extends y{constructor(t,e,r,n){super(e,r,n);this._children=[...t]}set inheritedTheme(t){super.inheritedTheme=t;for(let e of this.children)e.inheritedTheme=t}get inheritedTheme(){return super.inheritedTheme}dryPaint(){super.dryPaint();for(let t of this.children)t.dryPaint()}forceDirty(t=!0){super.forceDirty(t);for(let e of this.children)e.forceDirty(t)}get childCount(){return this._children.length}get children(){return this._children.values()}attach(t,e,r){super.attach(t,e,r);for(let n of this.children)n.attach(t,e,this)}detach(){super.detach();for(let t of this.children)t.detach()}updateActiveState(){let t=super.updateActiveState();if(t)for(let e of this._children)e.updateActiveState();return t}finalizeBounds(){super.finalizeBounds();for(let t of this.children)t.finalizeBounds()}};a(wt,"Parent");var Ut=class extends wt{add(i){if(Array.isArray(i)){let t=this.attached;for(let e of i)this._children.push(e),e.inheritedTheme=this.inheritedTheme,t&&e.attach(this.root,this.viewport,this)}else this._children.push(i),i.inheritedTheme=this.inheritedTheme,this.attached&&i.attach(this.root,this.viewport,this);return this.forceDirty(),this}remove(i){let t=this.attached;if(Array.isArray(i))for(let e of i){let r=this._children.indexOf(e);r!==-1&&this._children.splice(r,1),t&&e.detach()}else{let e=this._children.indexOf(i);e!==-1&&this._children.splice(e,1),t&&i.detach()}return this.forceDirty(),this}clearChildren(){if(this.attached)for(let i of this._children)i.detach();return this._children.length=0,this.forceDirty(),this}};a(Ut,"MultiParent");var ht=class extends Ut{constructor(t,e){super([],!1,!0,e);this.backgroundDirty=!0;this.unusedSpace=0;this.enabledChildCount=0;this.vertical=t}activate(){super.activate(),this.backgroundDirty=!0}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this.backgroundDirty=!0):t==="canvasFill"?this.backgroundDirty=!0:t==="multiContainerAlignment"?this._layoutDirty=!0:t==="multiContainerSpacing"&&(this._layoutDirty=!0)}handleEvent(t){let e=this.children;t.reversed&&(e=Array.from(e).reverse());for(let r of e){if(!r.enabled)continue;let n=r.dispatchEvent(t);if(n!==null)return n}return null}handlePreLayoutUpdate(){for(let t of this.children)t.preLayoutUpdate(),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){for(let t of this.children)t.postLayoutUpdate(),t.dirty&&(this._dirty=!0)}handleResolveDimensions(t,e,r,n){let s=0,o=0,h=0,d=this.vertical?n:e;this.multiContainerAlignment.cross==="stretch"&&(h=this.vertical?e:n,h==1/0&&(h=this.vertical?t:r)),this.enabledChildCount=0;for(let P of this.children){if(!P.enabled){P.resolveDimensions(0,0,0,0);continue}this.enabledChildCount++;let[A,H]=P.idealDimensions;this.vertical?P.resolveDimensions(h,e,0,1/0):P.resolveDimensions(0,1/0,h,n);let[N,Y]=P.idealDimensions;s+=P.flex,o=Math.max(this.vertical?N:Y,o),(N!==A||Y!==H)&&(this.backgroundDirty=!0)}let u=this.vertical?t:r;o<u&&(o=u);let m=this.multiContainerSpacing,f=Math.max(this.enabledChildCount-1,0)*m;for(let P of this.children)!P.enabled||(f+=this.vertical?P.idealDimensions[1]:P.idealDimensions[0]);let p=d-f;if(p==1/0||p<=0){let P=this.idealWidth,A=this.idealHeight;this.vertical?(this.idealWidth=o,this.idealHeight=Math.min(f,n)):(this.idealWidth=Math.min(f,e),this.idealHeight=o),(this.idealWidth!==P||this.idealHeight!==A)&&(this.backgroundDirty=!0),this.unusedSpace=0;let H=d;for(let N of this.children){if(!N.enabled)continue;let[Y,yt]=N.idealDimensions;if(this.vertical){let $=Math.min(H,yt);N.resolveDimensions(h,e,$,$)}else{let $=Math.min(H,Y);N.resolveDimensions($,$,h,n)}let[lt,oe]=N.idealDimensions;(lt!==Y||oe!==yt)&&(this.backgroundDirty=!0);let le=this.vertical?yt:Y;H=Math.max(0,H-le-m)}return}let g=0,w=0;s>0&&(w=p/s);for(let P of this.children){if(!P.enabled)continue;g!==0&&(g+=m);let A=w*P.flex,[H,N]=P.idealDimensions;if(this.vertical){let lt=A+N;P.resolveDimensions(h,e,lt,lt)}else{let lt=A+H;P.resolveDimensions(lt,lt,h,n)}let[Y,yt]=P.idealDimensions;g+=this.vertical?yt:Y,(Y!==H||yt!==N)&&(this.backgroundDirty=!0)}let v=this.idealWidth,x=this.idealHeight,T;this.vertical?(T=n,this.idealWidth=o,this.idealHeight=T):(T=e,this.idealWidth=T,this.idealHeight=o),(this.idealWidth!==v||this.idealHeight!==x)&&(this.backgroundDirty=!0),this.unusedSpace=Math.max(T-g,0)}resolvePosition(t,e){super.resolvePosition(t,e);let r=this.multiContainerAlignment,n=r.main==="around",s=r.main==="between"||n,o=s?0:r.main,h=r.cross==="stretch"?0:r.cross,d=this.enabledChildCount-1+(n?2:0),c;d<=0?c=0:c=this.unusedSpace/d;let u=this.multiContainerSpacing;s&&(u+=c);let m=(this.vertical?e:t)+o*this.unusedSpace;n&&(m+=c);for(let f of this.children){if(!f.enabled)continue;let[p,g]=f.idealPosition,[w,v]=f.idealDimensions;this.vertical?(f.resolvePosition(t+h*(this.idealWidth-w),m),m+=v+u):(f.resolvePosition(m,e+h*(this.idealHeight-v)),m+=w+u);let[x,T]=f.idealPosition;(x!==p||T!==g)&&(this.backgroundDirty=!0)}}handlePainting(t){let e=[];for(let r of this.children)r.paint(t),r.enabled&&(this.backgroundDirty||t)&&e.push(r.rect);if(this.backgroundDirty||t){this.clearStart();let r=this.viewport.context;r.rect(...this.rect);for(let n of e)r.rect(...n);this.clearEnd("evenodd")}this.backgroundDirty=!1}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(t=!0){super.forceDirty(t),this.backgroundDirty=!0}};a(ht,"MultiContainer");var dt=class extends wt{constructor(i,t,e,r){super([i],t,e,r)}get child(){return this._children[0]}};a(dt,"SingleParent");var ct=class extends dt{constructor(t,e,r){super(t,!1,e,r);this.backgroundDirty=!0}activate(){super.activate(),this.backgroundDirty=!0}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this.backgroundDirty=!0):t==="canvasFill"?this.backgroundDirty=!0:t==="containerPadding"?this._layoutDirty=!0:t==="containerAlignment"&&(this._layoutDirty=!0)}handleEvent(t){return this.child.dispatchEvent(t)}handlePreLayoutUpdate(){let t=this.child;t.preLayoutUpdate(),t.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let t=this.child;t.postLayoutUpdate(),t.dirty&&(this._dirty=!0),this.backgroundDirty&&(this._dirty=!0)}handleResolveDimensions(t,e,r,n){let s=this.containerPadding,o=s.left+s.right,h=s.top+s.bottom,d=e-o,c=n-h;d<0&&(d=0),c<0&&(c=0);let u=this.containerAlignment,m=0;u.horizontal==="stretch"&&(d!==1/0?m=d:m=Math.max(t-o,0));let f=0;u.vertical==="stretch"&&(c!==1/0?f=c:f=Math.max(r-h,0));let[p,g]=this.child.idealDimensions;this.child.resolveDimensions(m,d,f,c);let[w,v]=this.child.idealDimensions,[x,T]=[this.idealWidth,this.idealHeight];this.idealWidth=Math.max(t,w+o),this.idealHeight=Math.max(r,v+h),(this.idealWidth!==x||this.idealHeight!==T||w!==p||v!==g)&&(this.backgroundDirty=!0)}resolvePosition(t,e){super.resolvePosition(t,e);let r=this.containerPadding,n=this.containerAlignment,[s,o]=this.child.idealDimensions,h=s+r.left+r.right,d=o+r.top+r.bottom,c=t+r.left;if(n.horizontal!=="stretch"){let p=this.idealWidth-h;p>0&&(c+=p*n.horizontal)}let u=e+r.top;if(n.vertical!=="stretch"){let p=this.idealHeight-d;p>0&&(u+=p*n.vertical)}let[m,f]=this.child.idealPosition;this.child.resolvePosition(c,u),(m!==c||f!==u)&&(this.backgroundDirty=!0)}handleBaseContainerPainting(t,e=null){if(this.backgroundDirty||t){this.clearStart(e);let r=this.viewport.context;r.rect(...this.rect),r.rect(...this.child.rect),this.clearEnd("evenodd"),this.backgroundDirty=!1}this.child.paint(t)}handlePainting(t){this.handleBaseContainerPainting(t)}dryPaint(){this.backgroundDirty=!1,super.dryPaint()}forceDirty(t=!0){super.forceDirty(t),this.backgroundDirty=!0}};a(ct,"BaseContainer");var gi=(e=>(e[e.Pointer=0]="Pointer",e[e.Keyboard=1]="Keyboard",e[e.Tab=2]="Tab",e))(gi||{});var Qe=(e=>(e[e.Pixel=0]="Pixel",e[e.Line=1]="Line",e[e.Page=2]="Page",e))(Qe||{});function je(l){switch(l){case 0:return 0;case 1:return 1;case 2:return 2;default:return null}}a(je,"parseDOMDeltaMode");var z=class extends W{constructor(t,e,r,n,s,o,h,d,c,u,m=null){super(t,e,d,c,u,m,0);this.deltaX=r,this.deltaY=n,this.deltaZ=s,this.deltaMode=o,this.fromDrag=h}correctOffset(t,e){return new z(this.x-t,this.y-e,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(t){return new z(this.x,this.y,this.deltaX,this.deltaY,this.deltaZ,this.deltaMode,this.fromDrag,this.shift,this.ctrl,this.alt,t)}getDeltaPixels(t,e,r,n,s=0){let o=1/0,h=1/0,d=1/0;if(t||this.deltaMode!==2){let c=e*z.PageLinesError;o=r-Math.min(r*z.PagePercentError,c),h=n-Math.min(n*z.PagePercentError,c),d=s-Math.min(s*z.PagePercentError,c)}switch(this.deltaMode){case 0:return[Math.min(o,Math.abs(this.deltaX))*Math.sign(this.deltaX),Math.min(h,Math.abs(this.deltaY))*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ))*Math.sign(this.deltaZ)];case 1:return[Math.min(o,Math.abs(this.deltaX)*e)*Math.sign(this.deltaX),Math.min(h,Math.abs(this.deltaY)*e)*Math.sign(this.deltaY),Math.min(d,Math.abs(this.deltaZ)*e)*Math.sign(this.deltaZ)];case 2:{let c=e*z.PageLinesError;return[(Math.abs(this.deltaX)*r-Math.min(r*z.PagePercentError,c))*Math.sign(this.deltaX),(Math.abs(this.deltaY)*n-Math.min(n*z.PagePercentError,c))*Math.sign(this.deltaY),(Math.abs(this.deltaZ)*s-Math.min(s*z.PagePercentError,c))*Math.sign(this.deltaZ)]}default:throw new Error(b.INVALID_ENUM(this.deltaMode,"PointerWheelMode","deltaMode"))}}},L=z;a(L,"PointerWheel"),L.PageLinesError=3,L.PagePercentError=.1;var Q=class extends _t{constructor(t,e,r,n,s){super(e,r,n,s,1,!0);this.key=t}};a(Q,"KeyEvent");var R=class extends Q{cloneWithTarget(i){return new R(this.key,this.shift,this.ctrl,this.alt,i)}};a(R,"KeyPress");var E=class extends U{constructor(i=null){super(i,0,!0)}cloneWithTarget(i){return new E(i)}};a(E,"Leave");var it=class extends M{constructor(t,e){super(t,e);this.subscribers=new Set}get fallbackTheme(){return super.fallbackTheme}set fallbackTheme(t){super.fallbackTheme=t}onThemeUpdated(t=null){for(let e of this.subscribers)e(t)}subscribe(t){this.subscribers.add(t)}unsubscribe(t){this.subscribers.delete(t)}};a(it,"Theme");var ce=class{constructor(i,t){this.drivers=new Set;this._enabled=!0;this.pointerStyle="default";this._currentPointerStyle="default";this._foci=new Map([[1,null],[0,null],[2,null]]);this._fociCapturers=new Map([[1,null],[0,null],[2,null]]);this.textInputHandler=null;this._mobileTextInUse=!1;var e,r;this.viewport=new et(i,t==null?void 0:t.resolution,t==null?void 0:t.preventBleeding,t==null?void 0:t.canvasStartingWidth,t==null?void 0:t.canvasStartingHeight),this.pointerStyleHandler=(e=t==null?void 0:t.pointerStyleHandler)!=null?e:null,this.child.inheritedTheme=(r=t==null?void 0:t.theme)!=null?r:new it,this.child.attach(this,this.viewport,null),t!=null&&t.constraints&&(this.viewport.constraints=t.constraints)}get constraints(){return this.viewport.constraints}set constraints(i){this.viewport.constraints=i}get canvasDimensions(){return this.viewport.canvasDimensions}get dimensions(){return this.child.dimensions}get enabled(){return this._enabled}set enabled(i){if(this._enabled!==i){if(this._enabled=i,i)for(let e of this.drivers)e.onEnable(this);else{for(let e of this.drivers)e.onDisable(this);this.updatePointerStyle("default");for(let e of this._foci.keys())this.clearFocus(e)}this.child.updateActiveState()}}get canvas(){return this.viewport.canvas}resolveLayout(){return this.enabled?this.viewport.resolveLayout():!1}paint(){return this.enabled?this.viewport.paintToInternal(!1):!1}dispatchEvent(i){if(!this.enabled)return!1;if(i.focusType!==null&&i.target===null){let r=this._foci.get(i.focusType);if(typeof r=="undefined"&&(r=null),i.needsFocus&&r===null)return i instanceof R&&i.key==="Tab"&&this.dispatchEvent(new O(this.getFocus(2),i.shift)),!1;i=i.cloneWithTarget(r)}(i instanceof W&&!(i instanceof L)||i instanceof E)&&(this.pointerStyle="default");let t=this.child.dispatchEvent(i);if(t===null&&(i instanceof R&&(i.key==="Tab"?this.dispatchEvent(new O(this.getFocus(2),i.shift)):i.key==="Escape"&&this.clearFocus(1)),i instanceof O&&i.relativeTo!==null&&(i=new O(null,i.reversed),t=this.child.dispatchEvent(i))),i instanceof O&&(i.reachedRelative&&t===null&&(t=this.child.dispatchEvent(i)),t&&(!i.reachedRelative&&!ce.badTabCaptureWarned&&(ce.badTabCaptureWarned=!0,console.warn(b.OVERCAPTURING_WIDGET(t)),Ue()),this.requestFocus(2,t))),i.focusType===null)return t!==null;let e=this.getFocusCapturer(i.focusType);if(e===t)return t!==null;i.focusType===0&&e!==null&&this.child.dispatchEvent(new E(e)),this._fociCapturers.set(i.focusType,t);for(let r of this.drivers)r.onFocusCapturerChanged(this,i.focusType,e,t);return t!==null}preLayoutUpdate(){if(!!this.enabled){for(let i of this.drivers)i.update(this);this.child.preLayoutUpdate()}}postLayoutUpdate(){!this.enabled||(this.child.postLayoutUpdate(),this.updatePointerStyle())}updatePointerStyle(i=null){i!==null&&(this.pointerStyle=i),this.pointerStyle!==this._currentPointerStyle&&(this._currentPointerStyle=this.pointerStyle,this.pointerStyleHandler!==null&&this.pointerStyleHandler(this._currentPointerStyle))}requestFocus(i,t){if(t!==null){let e=this._foci.get(i);if(t!==e){this.clearFocus(i),this._foci.set(i,t),t.onFocusGrabbed(i);for(let n of this.drivers)n.onFocusChanged(this,i,t)}let r=null;if(i===1&&(r=2),i===2&&(r=1),r!==null&&t!==this._foci.get(r)){this.clearFocus(r),this._foci.set(r,t),t.onFocusGrabbed(r);for(let n of this.drivers)n.onFocusChanged(this,r,t)}}}dropFocus(i,t){let e=this._foci.get(i);t===e&&this.clearFocus(i)}dropFoci(i){for(let t of this._foci.keys())this.dropFocus(t,i)}clearFocus(i){let t=this._foci.get(i);if(t){t.onFocusDropped(i),this._foci.set(i,null);for(let e of this.drivers)e.onFocusChanged(this,i,null)}}getFocus(i){var t;return(t=this._foci.get(i))!=null?t:null}getFocusCapturer(i){var t;return(t=this._fociCapturers.get(i))!=null?t:null}registerDriver(i){this.drivers.has(i)||(this.drivers.add(i),this._enabled&&i.onEnable&&i.onEnable(this))}unregisterDriver(i){!this.drivers.delete(i)||this._enabled&&i.onDisable&&i.onDisable(this)}clearDrivers(){for(let i of this.drivers)this.unregisterDriver(i)}get hasMobileTextInput(){return this.textInputHandler!==null&&!this._mobileTextInUse}get usingMobileTextInput(){return this._mobileTextInUse}getTextInput(i=""){return Be(this,null,function*(){if(this.textInputHandler!==null&&!this._mobileTextInUse){this._mobileTextInUse=!0;let t=yield this.textInputHandler(i);return this._mobileTextInUse=!1,t}return null})}get resolution(){return this.viewport.resolution}set resolution(i){this.viewport.resolution=i}get preventBleeding(){return this.viewport.preventBleeding}set preventBleeding(i){this.viewport.preventBleeding=i}get maxCanvasWidth(){return this.viewport.maxCanvasWidth}set maxCanvasWidth(i){this.viewport.maxCanvasWidth=i}get maxCanvasHeight(){return this.viewport.maxCanvasHeight}set maxCanvasHeight(i){this.viewport.maxCanvasHeight=i}get effectiveScale(){return this.viewport.effectiveScale}get child(){return this.viewport.child}destroy(){this.enabled=!1,this.clearDrivers(),this.child.detach(),this.textInputHandler=null}},C=ce;a(C,"Root"),C.badTabCaptureWarned=!1;var B=new Map;function xt(l){let i=B.get(l);return i===void 0?(console.warn(`Unknown debug feature "${l}"; defaulting to not enabled`),!1):i[0]}a(xt,"isDebugFeatureEnabled");function bi(l,i){let t=B.get(l);if(t===void 0){console.warn(`Unknown debug feature "${l}"; ignored`);return}let[e,r]=t;i===void 0&&(i=!e),e!==i&&(t[0]=i,console.info(`[canvas-ui] ${i?"En":"Dis"}abled "${l}" debug feature`))}a(bi,"toggleDebugFeature");function yi(){for(let[l,i]of B)console.info(`[canvas-ui] "${l}" (${i[0]?"en":"dis"}abled): ${i[1]}`)}a(yi,"listDebugFeatures");function ue(l,i){let t=`${l.name}.${i}`,e=`watchflag.${t}`;if(B.has(e)){console.warn(`[canvas-ui] Already injected debug feature with name ${e}; ignored`);return}let r=`watchflag.${t}.strace`;if(B.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=new WeakMap;Object.defineProperty(l.prototype,i,{get(){return n.get(this)},set(s){if(xt(e)&&!n.get(this)&&s){let h=`[canvas-ui ${e}] ${this.constructor.name}.${i} set to true`;xt(r)?(console.groupCollapsed(h),console.trace(),console.groupEnd()):console.debug(h)}n.set(this,s)}}),B.set(e,[!1,`Show when ${t} is set to true`]),B.set(r,[!1,`Print stack trace when ${e} shows that a flag has been set`])}a(ue,"injectWatchflagFeature");function fe(l,i,t=null){let e=`${l.name}.${i}`,r=`trace.${e}`;if(B.has(r)){console.warn(`[canvas-ui] Already injected debug feature with name ${r}; ignored`);return}let n=[],s=new Map,o=l.prototype[i],h=0;function d(){h===0&&(xt(r)&&console.debug(`[canvas-ui ${r}] Trace:
${n.join(`
`)}`),h=0,n.length=0,s.clear())}a(d,"logMsgStack"),l.prototype[i]=function(...c){h++;let u=s.get(this);if(u===void 0){u=n.length,s.set(this,u);let f;h>1?f="  ".repeat(h-2)+"> ":f="",n.push(`${f}${this.constructor.name}`)}else n[u]+=", recall";t!==null&&(n[u]+=t.apply(this,c));let m=new Date().getTime();try{let f=o.apply(this,c);return n[u]+=` <${new Date().getTime()-m} ms>`,f}catch(f){throw n[u]+=" <exception thrown>",f}finally{h--,d()}},B.set(r,[!1,`Trace ${e} method calls`])}a(fe,"injectTraceFeature");function q(l,i){let t=`${l.name}.${i}`,e=`randomfill.${t}`;if(B.has(e)){console.warn(`[canvas-ui] Already injected debug feature with name ${e}; ignored`);return}let r=Object.getOwnPropertyDescriptor(l.prototype,i);Object.defineProperty(l.prototype,i,{get(){if(xt(e))return"#"+Math.floor(Math.random()*16777215).toString(16);if((r==null?void 0:r.get)!==void 0)return r.get.apply(this)},set(n){(r==null?void 0:r.set)!==void 0&&r.set.apply(this,[n])}}),B.set(e,[!1,`(EPILEPSY WARNING) Override the ${t} theme property with a new random colour every time the theme property's value is fetched. Useful for visualising widget painting`])}a(q,"injectRandomFillFeature");function k(l,i){let t=`${l.name}.${i}`,e=`stacktrace.${t}`;if(B.has(e)){console.warn(`[canvas-ui] Already injected debug feature with name ${e}; ignored`);return}let r=l.prototype[i];l.prototype[i]=function(...n){return xt(e)&&(console.groupCollapsed(`[canvas-ui ${e}] ${l.name}.${i} called`),console.trace(),console.groupEnd()),r.apply(this,n)},B.set(e,[!1,`Print stack trace when ${t} is called`])}a(k,"injectStackTraceFeature");function me(l,i){let t=Math.abs(l)%1;return t<i?!0:t>1-i}a(me,"isWhole");var Ze=!1;function hn(){if(Ze){console.warn("[canvas-ui] Already injected debug code; ignored");return}Ze=!0,fe(y,"paint",u=>u?" (forced)":""),fe(y,"resolveDimensions",(u,m,f,p)=>` (${u}, ${m}, ${f}, ${p})`),fe(y,"resolvePosition",(u,m)=>` (${u}, ${m})`),fe(y,"dispatchEvent",u=>` (${u.constructor.name})`),k(C,"resolveLayout"),k(C,"paint"),k(C,"dispatchEvent"),k(C,"preLayoutUpdate"),k(C,"postLayoutUpdate"),k(C,"updatePointerStyle"),k(C,"requestFocus"),k(C,"dropFocus"),k(C,"clearFocus"),k(C,"getFocus"),k(C,"getFocusCapturer"),k(C,"registerDriver"),k(C,"unregisterDriver"),k(C,"clearDrivers"),k(C,"getTextInput"),k(y,"onThemeUpdated"),k(y,"onFocusDropped"),k(y,"handleEvent"),k(y,"dispatchEvent"),k(y,"handlePreLayoutUpdate"),k(y,"preLayoutUpdate"),k(y,"handleResolveDimensions"),k(y,"resolveDimensions"),k(y,"resolveDimensionsAsTop"),k(y,"resolvePosition"),k(y,"handlePostLayoutUpdate"),k(y,"postLayoutUpdate"),k(y,"clear"),k(y,"clearStart"),k(y,"clearEnd"),k(y,"roundRect"),k(y,"handlePainting"),k(y,"paint"),k(y,"dryPaint"),k(y,"forceDirty"),k(y,"scaleFont"),ue(y,"_dirty"),ue(y,"_layoutDirty"),ue(ct,"backgroundDirty"),ue(ht,"backgroundDirty"),q(M,"canvasFill"),q(M,"primaryFill"),q(M,"accentFill"),q(M,"backgroundFill"),q(M,"backgroundGlowFill"),q(M,"bodyTextFill"),q(M,"inputBackgroundFill"),q(M,"inputSelectBackgroundFill"),q(M,"inputTextFill"),q(M,"inputTextFillDisabled"),q(M,"inputTextFillInvalid"),B.set("textrendergroups",[!1,"Draw text render groups in a TextHelper with alternating background colours (green and red). Width overriding groups have a blue background and zero-width groups have a black background. Throws an exception on negative width groups"]);let l=new Map,i=D.prototype.paint;D.prototype.paint=function(u,m,f,p){l.set(this,!1),i.apply(this,[u,m,f,p])};let t=D.prototype.paintGroup;D.prototype.paintGroup=function(u,m,f,p,g){if(xt("textrendergroups")){let w=u.fillStyle,v=this.actualLineHeight,x=this.fullLineHeight;if(!m[3]&&m[2]>f){let T=l.get(this);u.fillStyle=T?"rgba(255, 0, 0, 0.5)":"rgba(0, 255, 0, 0.5)",u.fillRect(p,g-v,m[2]-f,x),l.set(this,!T),u.fillStyle=w}else{let T=m[2]-f;if(u.fillStyle=T>0?"rgba(0, 0, 255, 0.5)":"rgba(0, 0, 0, 0.5)",T==0)T=4;else if(T<0)throw new Error(S.NEGATIVE_TEXT_GROUP);u.fillRect(p,g-v,T,x)}}t.apply(this,[u,m,f,p,g])},B.set("warnsubpixels",[!1,"Print a console warning whenever a Widget is detected to have non-integer width, height, x or y. Only warned once per Widget type"]);let e=new Set,r=new Set,n=new Set,s=new Set,o='[canvas-ui warnsubpixels] Widget type "',h='" has a non-integer ',d=", which will create clipping issues due to subpixels. This message won't be shown again for this widget type",c=y.prototype.finalizeBounds;y.prototype.finalizeBounds=function(){c.apply(this);let u=this.constructor.name;if(xt("warnsubpixels")){let[m,f]=this.root.effectiveScale,[p,g]=this.position;!me(p*m,1e-10)&&!e.has(u)&&(e.add(u),console.warn(`${o}${u}${h}X coordinate (${p})${d}`)),!me(g*f,1e-10)&&!r.has(u)&&(r.add(u),console.warn(`${o}${u}${h}Y coordinate (${g})${d}`));let[w,v]=this.dimensions;!me(w*m,1e-10)&&!n.has(u)&&(n.add(u),console.warn(`${o}${u}${h}width (${w})${d}`)),!me(v*f,1e-10)&&!s.has(u)&&(s.add(u),console.warn(`${o}${u}${h}height (${v})${d}`))}},window.canvasDebug={enabled:xt,toggle:bi,list:yi},console.info("[canvas-ui] Injected debug code; the library will be slower"),console.info("[canvas-ui] Check if a debug feature is enabled in the console with canvasDebug.enabled(debugFeature: string)"),console.info("[canvas-ui] Enable a debug feature in the console with canvasDebug.toggle(debugFeature: string, enabled?: boolean)"),console.info("[canvas-ui] List debug features in the console with canvasDebug.list()")}a(hn,"injectDebugCode");function cn(l){return new Promise((i,t)=>{function e(){document.body.removeChild(s)}a(e,"closePopup");function r(){e(),i(l)}a(r,"cancelHandler");function n(){e(),i(d.value)}a(n,"okHandler");let s=document.createElement("div");s.id="textInputHandlerOverlay";let o=document.createElement("div");o.id="textInputHandler";let h=document.createElement("p");h.textContent="Change text:";let d=document.createElement("textarea");d.value=l;let c=document.createElement("div"),u=document.createElement("button");u.addEventListener("click",r),u.textContent="Cancel";let m=document.createElement("button");m.addEventListener("click",n),m.textContent="OK",c.appendChild(u),c.appendChild(m),o.appendChild(h),o.appendChild(d),o.appendChild(c),s.appendChild(o),document.body.appendChild(s),d.focus({preventScroll:!1})})}a(cn,"DefaultTextInputHandler");var ut=class extends U{constructor(t,e=null){super(e,1,!1);this.text=t}cloneWithTarget(t){return new ut(this.text,t)}};a(ut,"TextPasteEvent");var Xt=class extends C{constructor(t,e){super(t,e);this.domElem=document.createElement("canvas"),this.domElem.tabIndex=1,this.updateDOMDims();let r=this.domElem.getContext("2d",{alpha:!0});if(r===null)throw new Error(S.REUSABLE_CANVAS_CONTEXT);this.domCanvasContext=r,this.pointerStyleHandler===null&&(this.pointerStyleHandler=n=>{this.domElem.style.cursor=n}),this.domElem.addEventListener("paste",n=>{n.preventDefault(),n.clipboardData!==null&&this.dispatchEvent(new ut(n.clipboardData.getData("text")))}),this.domElem.contentEditable="true",this.domElem.style.outline="0px solid transparent",this.domElem.style.caretColor="transparent",this.domElem.style.cursor="default"}update(){if(this.enabled)this.domElem.style.removeProperty("display");else{this.domElem.style.display="none";return}this.preLayoutUpdate(),this.resolveLayout()&&(this.updateDOMDims(),this.autoScale()),this.postLayoutUpdate(),this.paint()&&(this.domCanvasContext.globalCompositeOperation="copy",this.domCanvasContext.drawImage(this.canvas,0,0))}updateDOMDims(){let[t,e]=this.effectiveScale,[r,n]=this.dimensions;this.domElem.width=Math.round(r*t),this.domElem.height=Math.round(n*e)}autoScale(){let[t,e]=this.effectiveScale;this.domElem.style.width=(this.domElem.width/t).toString()+"px",this.domElem.style.height=(this.domElem.height/e).toString()+"px"}};a(Xt,"DOMRoot");var kt=class extends dt{constructor(i,t){super(i,!1,!0,t)}handleEvent(i){return this.child.dispatchEvent(i)}handlePreLayoutUpdate(){let i=this.child;i.preLayoutUpdate(),i.layoutDirty&&(this._layoutDirty=!0)}handlePostLayoutUpdate(){let i=this.child;i.postLayoutUpdate(),i.dirty&&(this._dirty=!0)}handleResolveDimensions(i,t,e,r){let n=this.child;n.resolveDimensions(i,t,e,r),[this.idealWidth,this.idealHeight]=n.idealDimensions}resolvePosition(i,t){super.resolvePosition(i,t),this.child.resolvePosition(i,t)}handlePainting(i){this.child.paint(i)}};a(kt,"PassthroughWidget");var Rt=class extends kt{constructor(t,e,r){super(t,r);this.constraints=[...e]}handleResolveDimensions(t,e,r,n){let s=Math.min(Math.max(this.constraints[0],t),e),o=Math.min(Math.max(this.constraints[2],r),n),h=Math.min(Math.max(this.constraints[1],t),e),d=Math.min(Math.max(this.constraints[3],r),n);s>h&&(s=h),o>d&&(o=d),super.handleResolveDimensions(s,h,o,d)}};a(Rt,"ArtificialConstraint"),_([Ye()],Rt.prototype,"constraints",2);var rt=class extends y{constructor(t="",e){var r;super(!0,!1,e);this.wrapText=(r=e==null?void 0:e.wrapText)!=null?r:!0,this.textHelper=new D,this.textHelper.wrapMode=this.wrapText?2:0,this.text=t}set text(t){this.textHelper.text=t}get text(){return this.textHelper.text}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0):t==="bodyTextFont"||t==="labelMinWidth"||t==="labelMinAscent"||t==="labelMinDescent"?(this._layoutDirty=!0,this._dirty=!0):t==="bodyTextFill"&&(this._dirty=!0)}handlePreLayoutUpdate(){this.textHelper.font=this.bodyTextFont,this.textHelper.lineHeight=this.bodyTextHeight,this.textHelper.lineSpacing=this.bodyTextSpacing,this.textHelper.wrapMode=this.wrapText?2:0,this.textHelper.alignMode=this.bodyTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handleResolveDimensions(t,e,r,n){this.textHelper.maxWidth=e,this.textHelper.dirty&&(this._dirty=!0),this.idealWidth=Math.max(Math.min(this.textHelper.width,e),t),this.idealHeight=Math.max(Math.min(this.textHelper.height,n),r)}handlePainting(t){let e=this.viewport.context;this.wrapText||(e.save(),e.beginPath(),e.rect(this.x,this.y,this.width,this.height),e.clip()),this.textHelper.paint(e,this.bodyTextFill,this.idealX,this.idealY),this.wrapText||e.restore()}};a(rt,"Label"),_([tt],rt.prototype,"wrapText",2);var vi=(e=>(e[e.Released=0]="Released",e[e.Hover=1]="Hover",e[e.Hold=2]="Hold",e))(vi||{});var Kt=class{constructor(i){this.clickHelpers=i}get lastClickState(){let i=0;for(let t of this.clickHelpers)t.lastClickState>i&&(i=t.lastClickState);return i}get clickState(){let i=0;for(let t of this.clickHelpers)t.clickState>i&&(i=t.clickState);return i}get clickStateChanged(){for(let i of this.clickHelpers)if(i.clickStateChanged)return!0;return!1}get wasClick(){for(let i of this.clickHelpers)if(i.wasClick&&i.clickStateChanged)return!0;return!1}reset(){for(let i of this.clickHelpers)i.reset()}};a(Kt,"CompoundClickHelper");var Pt=class{constructor(i){this.lastClickState=0;this.clickState=0;this.clickStateChanged=!1;this.wasClick=!1;this.widget=i}setClickState(i,t){this.clickState!==i?(this.lastClickState=this.clickState,this.clickState=i,this.wasClick=t&&this.lastClickState===2,this.clickStateChanged=!0):this.clickStateChanged=!1}reset(){this.lastClickState=0,this.clickState=0,this.clickStateChanged=!1,this.wasClick=!1}};a(Pt,"GenericClickHelper");var ft=class extends Q{cloneWithTarget(i){return new ft(this.key,this.shift,this.ctrl,this.alt,i)}};a(ft,"KeyRelease");var Wt=class extends W{constructor(t,e,r,n,s,o,h=null,d=null){super(t,e,n,s,o,h,d);this.button=r}get isLeft(){return this.button===0}get isPrimary(){return this.isLeft}get isRight(){return this.button===1}get isSecondary(){return this.isRight}get isMiddle(){return this.button===2}get isTertiary(){return this.isMiddle}};a(Wt,"PointerButtonEvent");var X=class extends Wt{constructor(i,t,e,r,n,s,o=null){super(i,t,e,r,n,s,o,0)}correctOffset(i,t){return new X(this.x-i,this.y-t,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new X(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(X,"PointerRelease");var V=class extends Wt{constructor(i,t,e,r,n,s,o=null){super(i,t,e,r,n,s,o)}correctOffset(i,t){return new V(this.x-i,this.y-t,this.button,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new V(this.x,this.y,this.button,this.shift,this.ctrl,this.alt,i)}};a(V,"PointerPress");var nt=class extends Pt{constructor(){super(...arguments);this.pointerPos=null;this.startingPointerPos=null;this.pointerButton=0}getNormalInRect(t,e,r,n,s,o){return[(t-r)/(n-r),(e-s)/(o-s)]}isPointInRect(t,e,r,n,s,o){return t>=r&&t<n&&e>=s&&e<o}isNormalInRect(t,e){return t>=0&&t<1&&e>=0&&e<1}handleClickEvent(t,e,r){if(t instanceof E)return e.dropFocus(0,this.widget),this.pointerPos=null,this.setClickState(0,!1);if(t instanceof W){this.pointerPos=this.getNormalInRect(t.x,t.y,...r);let n=this.isNormalInRect(...this.pointerPos);if(n)e.pointerStyle="pointer";else if(t.target===null)return e.dropFocus(0,this.widget),this.setClickState(0,!1);return t instanceof V&&t.button===this.pointerButton?(this.startingPointerPos=this.pointerPos,e.requestFocus(0,this.widget),this.setClickState(2,n)):t instanceof X&&t.button===this.pointerButton?(e.dropFocus(0,this.widget),n?this.setClickState(1,n):this.setClickState(0,n)):t.target===null?this.setClickState(1,n):this.setClickState(2,n)}else this.clickStateChanged=!1}reset(){super.reset(),this.pointerPos=null,this.startingPointerPos=null,this.pointerButton=0}};a(nt,"ClickHelper");var mt=class extends Kt{constructor(t){let e=new nt(t),r=new Pt(t);super([e,r]);this.pointerClickHelper=e,this.keyboardClickHelper=r,this.widget=t}onFocusGrabbed(t){return t===1?(this.keyboardClickHelper.setClickState(1,!0),this.widget.autoScroll(),!0):!1}onFocusDropped(t){return t===1?(this.keyboardClickHelper.setClickState(0,!1),!0):!1}handleEvent(t,e,r,n){if(t instanceof L)return[!1,!1];if(t instanceof Q){if(t.key!=="Enter")return[!1,!1]}else if(!(t instanceof W||t instanceof E))return[!1,!1];return r?(t instanceof R?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(2,!0),this.widget.autoScroll()):t instanceof ft?(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.setClickState(1,!0)):(this.keyboardClickHelper.clickStateChanged=!1,this.pointerClickHelper.handleClickEvent(t,e,n)),[this.clickStateChanged&&this.wasClick,!0]):(this.pointerClickHelper.clickStateChanged=!1,this.keyboardClickHelper.clickStateChanged=!1,[!1,!0])}};a(mt,"ButtonClickHelper");var Ct=class extends ct{constructor(t,e,r){super(t,!1,r);this.clickHelper=new mt(this),this.callback=e,this.tabFocusable=!0}click(){if(this.callback!==null)try{this.callback()}catch(t){console.error("Exception in Icon callback:",t)}}activate(){super.activate(),this.clickHelper.reset()}onFocusGrabbed(t){this.clickHelper.onFocusGrabbed(t)}onFocusDropped(t){this.clickHelper.onFocusDropped(t)}handleEvent(t){let[e,r]=this.clickHelper.handleEvent(t,this.root,this.callback!==null,this.bounds);return e&&this.click(),r?this:null}};a(Ct,"Button");var St=class extends Ct{constructor(t,e=null,r){var n;super(t,e,r);this.backgroundProperty="backgroundFill";this.forced=(n=r==null?void 0:r.forced)!=null?n:!1,this.childTheme=new it({canvasFill:this.getBackgroundFill()}),this.child.inheritedTheme=this.childTheme}activate(){super.activate(),this.updateBackground()}updateBackground(){let t=this.backgroundProperty;if(this.forced)this.backgroundProperty="primaryFill";else switch(this.clickHelper.clickState){case 2:this.backgroundProperty="accentFill";break;case 1:this.backgroundProperty="backgroundGlowFill";break;default:this.backgroundProperty="backgroundFill";break}t!==this.backgroundProperty&&(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill())}getBackgroundFill(){switch(this.backgroundProperty){case"primaryFill":return this.primaryFill;case"accentFill":return this.accentFill;case"backgroundGlowFill":return this.backgroundGlowFill;case"backgroundFill":return this.backgroundFill;default:throw new Error(b.INVALID_BACKGROUND_FILL(this.backgroundProperty))}}set inheritedTheme(t){t!==this.fallbackTheme&&(this.fallbackTheme=t,this.childTheme.fallbackTheme=t)}get inheritedTheme(){return this.fallbackTheme}onThemeUpdated(t=null){t===null?(this._layoutDirty=!0,this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):t===this.backgroundProperty?(this.backgroundDirty=!0,this.childTheme.canvasFill=this.getBackgroundFill()):t==="containerPadding"?this._layoutDirty=!0:t==="containerAlignment"&&(this._layoutDirty=!0)}onFocusGrabbed(t){super.onFocusGrabbed(t),t===1&&this.updateBackground()}onFocusDropped(t){super.onFocusDropped(t),t===1&&this.updateBackground()}handleEvent(t){let e=super.handleEvent(t);return this.clickHelper.clickStateChanged&&this.updateBackground(),e}handlePainting(t){this.handleBaseContainerPainting(t,this.getBackgroundFill())}};a(St,"FilledButton"),_([ae(St.prototype.updateBackground)],St.prototype,"forced",2);var Yt=class extends St{constructor(i,t=null,e){e=I({containerAlignment:{horizontal:.5,vertical:"stretch"},bodyTextAlign:.5,wrapText:!1},e),super(new rt(i,e),t,e)}};a(Yt,"TextButton");var K=class extends Rt{constructor(i,t,e=24,r=24,n){super(new Yt(i,t,n),[e,1/0,r,1/0],n)}};a(K,"VirtualKey");var $t=class extends K{constructor(t,e,r,n=24,s=24,o){super("",()=>r.callback(this.currentGlyph),n,s,o);this.glyph=t,this.altGlyph=e===null?t:e,this.keyContext=r,this.child.child.text=this.currentGlyph}handlePreLayoutUpdate(){this.child.child.text=this.currentGlyph,super.handlePreLayoutUpdate()}get currentGlyph(){return this.keyContext.shift?this.altGlyph:this.glyph}};a($t,"GlyphVirtualKey");var pt=class extends ht{constructor(i){super(!1,i)}};a(pt,"Row");var Gt=class extends pt{constructor(i,t,e=24,r=24,n){super(n);for(let s of i)if(typeof s=="function"){let o=s;this.add(o(t,n))}else if(typeof s[0]=="string"&&typeof s[1]=="string"){let o=s[0],h=s[1];for(let d=0;d<o.length;d++){let c=null;d<h.length&&(c=h[d]),this.add(new $t(o[d],c,t,e,r,n))}}else throw new Error(b.INVALID_KB_ROW_TEMPLATE(s))}};a(Gt,"VirtualKeyRow");var J=class extends K{constructor(i,t,e,r=24,n=24,s){super(i,()=>e.callback(t),r,n,s)}};a(J,"BasicVirtualKey");var zt=class extends J{constructor(i,t=60,e=24,r){super("Backspace","Backspace",i,t,e,r)}};a(zt,"BackspaceKey");var Qt=class extends J{constructor(i,t=24,e=24,r){super("Esc","Escape",i,t,e,r)}};a(Qt,"EscapeKey");var jt=class extends J{constructor(i,t=72,e=24,r){super("Enter","Enter",i,t,e,r)}};a(jt,"EnterKey");var Zt=class extends K{constructor(i,t=84,e=24,r){super("Shift",()=>{i.shift=!i.shift,this.child.forced=i.shift,i.callback("Shift")},t,e,r),this.child.forced=i.shift}};a(Zt,"ShiftKey");var qt=class extends J{constructor(i,t=84,e=24,r){r=I({flex:1},r),super("Space"," ",i,t,e,r)}};a(qt,"SpaceKey");var Jt=class extends ht{constructor(i){super(!0,i)}};a(Jt,"Column");function xi(l,i){return new jt(l,void 0,void 0,i)}a(xi,"EnterKeyTemplate");function Ti(l,i){return new Zt(l,void 0,void 0,i)}a(Ti,"ShiftKeyTemplate");function _i(l,i){return new zt(l,void 0,void 0,i)}a(_i,"BackspaceKeyTemplate");function wi(l,i){return new qt(l,void 0,void 0,i)}a(wi,"SpaceKeyTemplate");function ki(l,i){return new Qt(l,void 0,void 0,i)}a(ki,"EscapeKeyTemplate");var te=[[["`1234567890-=","~!@#$%^&*()_+"]],[["qwertyuiop[]\\","QWERTYUIOP{}|"]],[["asdfghjkl;'",'ASDFGHJKL:"'],xi],[Ti,["zxcvbnm,./","ZXCVBNM<>?"]],[_i,wi,ki]],Dt=class extends Jt{constructor(i,t=te,e=24,r=24,n){n=I({multiContainerAlignment:{main:"between",cross:"stretch"}},n),super(n);let s={callback:o=>{i.keyPress(o,s.shift,s.ctrl,s.alt)},shift:!1,ctrl:!1,alt:!1};for(let o of t)this.add(new Gt(o,s,e,r,n))}};a(Dt,"VirtualKeyboard");var gt=class extends ct{constructor(i,t){super(i,!0,t)}};a(gt,"Container");var Et=class extends gt{constructor(i,t){t=I({containerAlignment:{horizontal:.5,vertical:.5}},t),super(i,t)}};a(Et,"Margin");var Te=class extends Xt{constructor(t,e){var r;super(new Et(new Dt(t,(r=e==null?void 0:e.keyboardTemplate)!=null?r:te)),e);this.keyboardDriver=t}update(){this.enabled=this.keyboardDriver.needsInput,super.update()}};a(Te,"DOMVirtualKeyboardRoot");var _e=class extends C{constructor(t,e){var r;super(new Et(new Dt(t,(r=e==null?void 0:e.keyboardTemplate)!=null?r:te)),e);this.keyboardDriver=t}updateVisibility(){this.enabled=this.keyboardDriver.needsInput}};a(_e,"VirtualKeyboardRoot");var ee=class{constructor(){this.eventQueues=new Map;this.keysDown=new Set;this.focus=null;this.lastActivity=null}getEventQueue(i){if(i===null)return null;let t=this.eventQueues.get(i);return typeof t=="undefined"?null:t}changeFocusedRoot(i){this.focus!==i&&(this.focus!==null&&this.focus.clearFocus(1),this.focus=i,this.keysDown.clear())}getFocusedRoot(){return this.focus}getEffectiveFocusedRoot(){return this.focus?this.focus:this.lastActivity?this.lastActivity:this.eventQueues.size>0?this.eventQueues.keys().next().value:null}clearFocus(){this.changeFocusedRoot(null)}keyDown(i,t,e,r){this.keysDown.add(i);let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new R(i,t,e,r,null))}keyUp(i,t,e,r){if(this.keysDown.delete(i)){let n=this.getEventQueue(this.getEffectiveFocusedRoot());n!==null&&n.push(new ft(i,t,e,r,null))}}keyPress(i,t,e,r){let n=this.isKeyDown(i);this.keyDown(i,t,e,r),n||this.keyUp(i,t,e,r)}isKeyDown(i){return this.keysDown.has(i)}onEnable(i){this.eventQueues.has(i)||this.eventQueues.set(i,[])}onDisable(i){this.eventQueues.has(i)&&(this.eventQueues.delete(i),i===this.focus&&this.clearFocus())}update(i){let t=this.getEventQueue(i);if(t!==null){for(let e of t)i.dispatchEvent(e);t.length=0}}onFocusChanged(i,t,e){e!==null&&(this.lastActivity=i),t===1&&i!==this.focus&&e!==null&&this.changeFocusedRoot(i)}onFocusCapturerChanged(i,t,e,r){}get needsInput(){return this.focus!==null&&this.focus.getFocus(1)!==null}};a(ee,"KeyboardDriver");var Pi=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp","Tab"," "]),Wi=new Set(["a","A"]),Ci=new Set(["Tab"]);function qe(l){return[l.key,l.shiftKey,l.ctrlKey,l.altKey]}a(qe,"unpackKeyboardEvent");var we=class extends ee{constructor(){super(...arguments);this.domElems=new Map}maybePreventDefault(t){var e,r;(Pi.has(t.key)||Wi.has(t.key)&&t.ctrlKey)&&(Ci.has(t.key)||((r=(e=this.getFocusedRoot())==null?void 0:e.getFocus(1))!=null?r:null)!==null)&&t.preventDefault()}bindDOMElem(t,e=!0){let r=this.domElems.get(t);r!==void 0?(console.warn(S.DOM_DRIVER_REBIND),this.removeListeners(t,r)):(r={blurListen:null,keydownListen:null,keyupListen:null},this.domElems.set(t,r)),this.addListeners(t,r,e)}unbindDOMElem(t){let e=this.domElems.get(t);e!==void 0&&(this.removeListeners(t,e),this.domElems.delete(t))}addListeners(t,e,r=!0){e.blurListen=n=>{this.shouldClearFocus(n.relatedTarget)&&this.clearFocus()},t.addEventListener("blur",e.blurListen),r&&(e.keydownListen=n=>{this.maybePreventDefault(n),this.keyDown(...qe(n))},e.keyupListen=n=>{this.maybePreventDefault(n),this.keyUp(...qe(n))},t.addEventListener("keydown",e.keydownListen),t.addEventListener("keyup",e.keyupListen))}removeListeners(t,e){e.blurListen&&(t.removeEventListener("blur",e.blurListen),e.blurListen=null),e.keydownListen&&(t.removeEventListener("keydown",e.keydownListen),e.keydownListen=null),e.keyupListen&&(t.removeEventListener("keyup",e.keyupListen),e.keyupListen=null)}shouldClearFocus(t){return t===null||!this.domElems.has(t)}};a(we,"DOMKeyboardDriver");function ke(l,i){let t=i.getBoundingClientRect();return[(l.clientX-t.left)/t.width,(l.clientY-t.top)/t.height]}a(ke,"getPointerEventNormPos");var st=class extends W{constructor(i,t,e,r,n,s=null){super(i,t,e,r,n,s,0)}correctOffset(i,t){return new st(this.x-i,this.y-t,this.shift,this.ctrl,this.alt,this.target)}cloneWithTarget(i){return new st(this.x,this.y,this.shift,this.ctrl,this.alt,i)}};a(st,"PointerMove");var Si=(e=>(e[e.None=0]="None",e[e.Hovering=1]="Hovering",e[e.Pressing=2]="Pressing",e))(Si||{});var Ft=class{constructor(){this.states=new Map;this.nextPointerID=0;this.hints=new Map;this.dragToScroll=new Map}unassignPointer(i,t){t.pointer!==null&&this.setPointerHint(t.pointer,0),t.pointer=null,t.hovering&&t.eventQueue.push(new E(i.getFocusCapturer(0))),t.hovering=!1,t.pressing=0,t.dragLast=null}registerPointer(i=!1){let t=this.nextPointerID++;return this.setPointerHint(t,0),this.dragToScroll.set(t,i),t}unregisterPointer(i){for(let[t,e]of this.states)e.pointer===i&&this.unassignPointer(t,e);this.hints.delete(i),this.dragToScroll.delete(i)}canQueueEvent(i,t,e,r){let n=e.pointer===null;n&&(e.pointer=t);let s=e.pointer===t;if(!s||n)for(let[o,h]of this.states)o!==i&&h.pointer===t&&this.unassignPointer(o,h);return!s&&(!r||e.pressing>0)?!1:(r&&e.pointer!==t&&(this.unassignPointer(i,e),e.pointer=t),!0)}denormaliseCoords(i,t,e){let[r,n]=i.dimensions;return[t*r,e*n]}movePointer(i,t,e,r,n,s,o,h){let d=this.states.get(i);if(typeof d=="undefined"||(n===null&&(n=d.pressing),!this.canQueueEvent(i,t,d,n>0)))return;d.hovering=!0;let[c,u]=this.denormaliseCoords(i,e,r);if(n!==d.pressing){let m=Math.floor(Math.log2(Math.max(n,d.pressing)));for(let f=0;f<=m;f++){let p=(d.pressing>>f&1)===1,g=(n>>f&1)===1;p!==g&&(g?d.eventQueue.push(new V(c,u,f,s,o,h)):d.eventQueue.push(new X(c,u,f,s,o,h)))}d.pressing=n}else d.eventQueue.push(new st(c,u,s,o,h));d.pressing>0?this.setPointerHint(t,2):this.setPointerHint(t,1)}leavePointer(i,t){let e=this.states.get(i);typeof e!="undefined"&&e.hovering&&e.pointer==t&&(e.hovering=!1,e.pressing=0,e.dragLast=null,e.eventQueue.push(new E(i.getFocusCapturer(0))),this.setPointerHint(t,0))}leaveAnyPointer(i){for(let t of this.states.keys())this.leavePointer(t,i)}wheelPointer(i,t,e,r,n,s,o,h,d,c,u){let m=this.states.get(i);if(typeof m=="undefined"||!this.canQueueEvent(i,t,m,!0))return;m.hovering=!0;let[f,p]=this.denormaliseCoords(i,e,r);m.eventQueue.push(new L(f,p,n,s,o,h,!1,d,c,u))}setPointerHint(i,t){return this.hints.get(i)!==t?(this.hints.set(i,t),!0):!1}getPointerHint(i){var t;return(t=this.hints.get(i))!=null?t:0}onEnable(i){this.states.set(i,{eventQueue:[],pointer:null,pressing:0,hovering:!1,dragLast:null,dragOrigin:[0,0]})}onDisable(i){i.dispatchEvent(new E);let t=this.states.get(i);typeof t!="undefined"&&t.pointer!==null&&(this.setPointerHint(t.pointer,0),t.dragLast=null),this.states.delete(i)}update(i){let t=this.states.get(i);if(typeof t=="undefined")return;let e=t.pointer===null?!1:this.dragToScroll.get(t.pointer);for(let r of t.eventQueue){if(r instanceof W&&t.dragLast!==null){let[n,s]=t.dragLast;i.dispatchEvent(new L(...t.dragOrigin,n-r.x,s-r.y,0,0,!1,!1,!1,!0)),r instanceof X?t.dragLast=null:(t.dragLast[0]=r.x,t.dragLast[1]=r.y);continue}i.dispatchEvent(r)?t.dragLast=null:e&&r instanceof V&&(t.dragLast=[r.x,r.y],t.dragOrigin[0]=r.x,t.dragOrigin[1]=r.y)}t.eventQueue.length=0}onFocusChanged(i,t,e){}onFocusCapturerChanged(i,t,e,r){}};a(Ft,"PointerDriver");function Je(l){return[l.shiftKey,l.ctrlKey,l.altKey]}a(Je,"unpackModifiers");var Pe=class extends Ft{constructor(){super();this.domElems=new WeakMap;this.pointers=new Map;this.mousePointerID=this.registerPointer(!1)}bindDOMElem(t,e){let r=this.domElems.get(t);r!==void 0?(console.warn(S.DOM_DRIVER_REBIND),this.removeListeners(r)):(r={domElem:e,pointerListen:null,pointerleaveListen:null,wheelListen:null,contextMenuListen:null},this.domElems.set(t,r),e.style.touchAction="none"),t.enabled&&this.addListeners(t,r)}unbindDOMElem(t){let e=this.domElems.get(t);e!==void 0&&(this.removeListeners(e),this.domElems.delete(t))}getPointerID(t){let e=this.pointers.get(t.pointerId);return e===void 0&&(t.pointerType==="mouse"?e=this.mousePointerID:e=this.registerPointer(!0),this.pointers.set(t.pointerId,e)),e}addListeners(t,e){let r=e.domElem;e.pointerListen===null&&(e.pointerListen=n=>{this.movePointer(t,this.getPointerID(n),...ke(n,r),n.buttons,...Je(n))},r.addEventListener("pointermove",e.pointerListen),r.addEventListener("pointerdown",e.pointerListen),r.addEventListener("pointerup",e.pointerListen)),e.pointerleaveListen===null&&(e.pointerleaveListen=n=>{this.leavePointer(t,this.getPointerID(n))},r.addEventListener("pointerleave",e.pointerleaveListen)),e.wheelListen===null&&(e.wheelListen=n=>{let s=je(n.deltaMode);s!==null&&(this.wheelPointer(t,this.mousePointerID,...ke(n,r),n.deltaX,n.deltaY,n.deltaZ,s,...Je(n)),n.preventDefault())},r.addEventListener("wheel",e.wheelListen,{passive:!1})),e.contextMenuListen===null&&(e.contextMenuListen=n=>{n.preventDefault()},r.addEventListener("contextmenu",e.contextMenuListen))}removeListeners(t){t.pointerListen!==null&&(t.domElem.removeEventListener("pointermove",t.pointerListen),t.domElem.removeEventListener("pointerdown",t.pointerListen),t.domElem.removeEventListener("pointerup",t.pointerListen),t.pointerListen=null),t.pointerleaveListen!==null&&(t.domElem.removeEventListener("pointerleave",t.pointerleaveListen),t.pointerleaveListen=null),t.wheelListen!==null&&(t.domElem.removeEventListener("wheel",t.wheelListen),t.wheelListen=null),t.contextMenuListen!==null&&(t.domElem.removeEventListener("contextmenu",t.contextMenuListen),t.contextMenuListen=null)}onEnable(t){super.onEnable(t);let e=this.domElems.get(t);e!==void 0&&this.addListeners(t,e)}onDisable(t){super.onDisable(t);let e=this.domElems.get(t);e!==void 0&&this.removeListeners(e)}};a(Pe,"DOMPointerDriver");var We=class extends Ft{constructor(){super(...arguments);this.sources=new Set}handlePointerRay(t,e,r,n,s,o,h){let[d,c,u]=this.castRay(r,n);d===null?this.leaveAnyPointer(t):this.movePointer(d,t,c,u,e,s,o,h)}addSource(t){this.sources.has(t)||(t.setRayPointerDriver(this),this.sources.add(t))}setPointerHint(t,e){let r=super.setPointerHint(t,e);for(let n of this.sources)n.onPointerHintChanged(t,e);return r}};a(We,"RayPointerDriver");var bt=class{constructor(i,t,e=!0){this.callbacks=new Set;this._value=i,t&&this.watch(t,e)}get value(){return this._value}set value(i){this.setValue(i)}hasCallback(i){return this.callbacks.has(i)}watch(i,t=!0){return this.hasCallback(i)?!1:(this.callbacks.add(i),t&&this.doCallback(i),!0)}unwatch(i){return this.callbacks.delete(i)}setValue(i,t=!0){if(this._value===i)return!1;if(this._value=i,t)for(let e of this.callbacks)this.doCallback(e);return!0}doCallback(i){try{i(this._value,this)}catch(t){console.error("Exception in Variable callback:",t)}}};a(bt,"Variable");var ie=class extends bt{constructor(t,e=null,r,n=!0){super(t,r,!1);this._valid=!0;this.validator=e,this.validate(t),r&&n&&this.doCallback(r)}get valid(){return this._valid}get validValue(){return this._validValue}setValue(t,e=!0){return this.value===t?!1:(this.validate(t),super.setValue(t,e))}validate(t){if(this.validator){let[e,r]=this.validator(t);this._valid=e,e&&(this._validValue=r)}}};a(ie,"ValidatedVariable");var Ce=class extends it{constructor(i=new it){super(void 0,i)}get canvasFill(){return"#"+Math.floor(Math.random()*16777215).toString(16)}set canvasFill(i){super.canvasFill=i}};a(Ce,"DebugTheme");var Se=class extends K{constructor(i,t=42,e=24,r){super("Alt",()=>{i.alt=!i.alt,this.child.forced=i.alt,i.callback("Alt")},t,e,r),this.child.forced=i.alt}};a(Se,"AltKey");var De=class extends K{constructor(i,t=42,e=24,r){super("Ctrl",()=>{i.ctrl=!i.ctrl,this.child.forced=i.ctrl,i.callback("Control")},t,e,r),this.child.forced=i.ctrl}};a(De,"ControlKey");var Di=(e=>(e[e.None=0]="None",e[e.Bi=1]="Bi",e[e.Uni=2]="Uni",e))(Di||{});var Ee=class extends gt{constructor(i,t){t=I({containerAlignment:{horizontal:.5,vertical:.5},containerPadding:{left:0,right:0,top:0,bottom:0}},t),super(i,t)}};a(Ee,"Center");var re=class extends y{constructor(t=new bt(!1),e){super(!0,!1,e);this.offsetX=0;this.offsetY=0;this.actualLength=0;this.tabFocusable=!0,this.variable=t,this.callback=this.handleChange.bind(this),this.clickHelper=new mt(this)}handleChange(){this._dirty=!0}attach(t,e,r){super.attach(t,e,r),this.variable.watch(this.callback)}detach(){super.detach(),this.variable.unwatch(this.callback)}activate(){super.activate(),this.clickHelper.reset()}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0):t==="checkboxLength"?(this._layoutDirty=!0,this._dirty=!0):(t==="backgroundGlowFill"||t==="backgroundFill"||t==="accentFill"||t==="primaryFill"||t==="checkboxInnerPadding")&&(this._dirty=!0)}set checked(t){this.variable.value=t}get checked(){return this.variable.value}onFocusGrabbed(t){this.clickHelper.onFocusGrabbed(t)&&(this._dirty=!0)}onFocusDropped(t){this.clickHelper.onFocusDropped(t)&&(this._dirty=!0)}handleEvent(t){let e=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(t,this.root,!0,[e,e+this.actualLength,r,r+this.actualLength]);return n&&(this.checked=!this.checked),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(t,e,r,n){let s=Math.min(this.checkboxLength,e,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<t&&(this.idealWidth=t),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.checkboxLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(t){let e=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;e?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.offsetX+this.x,s=this.offsetY+this.y;if(r.fillRect(n,s,this.actualLength,this.actualLength),this.checked){e?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let o=this.checkboxInnerPadding,h=this.actualLength-o*2;h<=0?r.fillRect(n,s,this.actualLength,this.actualLength):r.fillRect(n+o,s+o,h,h)}}};a(re,"Checkbox");var Ei=/^.*\.(webm|og[gv]|m(p4|4v|ov)|avi|qt)$/i,Fi=(e=>(e[e.Contain=0]="Contain",e[e.Cover=1]="Cover",e[e.Fill=2]="Fill",e))(Fi||{}),ot=class extends y{constructor(t,e){var r,n,s,o,h;super(!0,!1,e);this.lastSrc=null;this.rotation=0;this.imageWidth=null;this.imageHeight=null;this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.loadedmetadataListener=null;this.canplayListener=null;this.frameCallback=null;if(typeof t=="string")if(Ei.test(t)){let d=document.createElement("video");d.src=t,d.preload="auto",t=d}else{let d=document.createElement("img");d.src=t,t=d}this._image=t,this.rotation=(r=e==null?void 0:e.rotation)!=null?r:0,this.viewBox=(n=e==null?void 0:e.viewBox)!=null?n:null,this.imageWidth=(s=e==null?void 0:e.width)!=null?s:null,this.imageHeight=(o=e==null?void 0:e.height)!=null?o:null,this.fit=(h=e==null?void 0:e.fit)!=null?h:0,this.setupVideoEvents()}setupVideoEvents(){if(this.image instanceof HTMLVideoElement&&(this.loadedmetadataListener=t=>this._layoutDirty=!0,this.image.addEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener=t=>this._dirty=!0,this.image.addEventListener("canplay",this.canplayListener),"requestVideoFrameCallback"in this.image)){console.warn(S.VIDEO_API_AVAILABLE);let t=this.image;this.frameCallback=(e,r)=>{this._dirty=!0,this.image===t&&this.frameCallback!==null&&this.image.requestVideoFrameCallback(this.frameCallback)},this.image.requestVideoFrameCallback(this.frameCallback)}}set image(t){t!==this._image&&(this._image instanceof HTMLVideoElement&&(this.loadedmetadataListener!==null&&this._image.removeEventListener("loadedmetadata",this.loadedmetadataListener),this.canplayListener!==null&&this._image.removeEventListener("canplay",this.canplayListener)),this._image=t,this.lastSrc=null,this.loadedmetadataListener=null,this.canplayListener=null,this.frameCallback=null,this.setupVideoEvents())}get image(){return this._image}handlePreLayoutUpdate(){var t,e;this._image instanceof HTMLVideoElement?!this._image.paused&&this.frameCallback===null&&(this._dirty=!0):((t=this._image)==null?void 0:t.src)!==this.lastSrc&&((e=this._image)==null?void 0:e.complete)&&(this._layoutDirty=!0,this._dirty=!0)}handleResolveDimensions(t,e,r,n){let s=this.imageWidth;s===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?s=this._image.videoWidth:s=this._image.naturalWidth:s=this.viewBox[2]),this.idealWidth=Math.max(Math.min(s,e),t);let o=this.imageHeight;switch(o===null&&(this.viewBox===null?this._image instanceof HTMLVideoElement?o=this._image.videoHeight:o=this._image.naturalHeight:o=this.viewBox[3]),this.idealHeight=Math.max(Math.min(o,n),r),this.fit){case 0:case 1:{let h=this.idealWidth/s,d=this.idealHeight/o,c;this.fit===0?c=Math.min(h,d):c=Math.max(h,d),this.actualWidth=s*c,this.actualHeight=o*c,this.offsetX=(this.idealWidth-this.actualWidth)/2,this.offsetY=(this.idealHeight-this.actualHeight)/2;break}case 2:this.actualWidth=this.idealWidth,this.actualHeight=this.idealHeight,this.offsetX=0,this.offsetY=0;break;default:throw new Error(b.INVALID_ENUM(this.fit,"IconFit","fit"))}}handlePainting(t){var h;if(this._image instanceof HTMLImageElement&&!((h=this._image)!=null&&h.complete)){this.lastSrc=null;return}this.lastSrc=this._image.src;let e=this.x+this.offsetX,r=this.y+this.offsetY,n=this.rotation!==0,s=n||this.fit===1,o=this.viewport.context;s&&(o.save(),o.beginPath(),o.rect(this.x,this.y,this.width,this.height),o.clip(),n&&(o.translate(this.x+this.offsetX+this.actualWidth/2,this.y+this.offsetY+this.actualHeight/2),e=-this.actualWidth/2,r=-this.actualHeight/2,o.rotate(this.rotation))),this.viewBox===null?o.drawImage(this._image,e,r,this.actualWidth,this.actualHeight):o.drawImage(this._image,...this.viewBox,e,r,this.actualWidth,this.actualHeight),s&&o.restore()}dryPaint(){var t;this._image instanceof HTMLImageElement&&((t=this._image)==null?void 0:t.complete)?this.lastSrc=this._image.src:this.lastSrc=null,super.dryPaint()}};a(ot,"Icon"),_([vt],ot.prototype,"rotation",2),_([$e(!0)],ot.prototype,"viewBox",2),_([tt],ot.prototype,"imageWidth",2),_([tt],ot.prototype,"imageHeight",2),_([vt],ot.prototype,"fit",2);var Fe=class extends Ct{constructor(i,t,e){super(new ot(i,e),t,e)}};a(Fe,"IconButton");var Mt=class extends y{constructor(t){var e,r;t=I({flex:1},t);super(!0,!1,t);this.minWidth=(e=t==null?void 0:t.minWidth)!=null?e:0,this.minHeight=(r=t==null?void 0:t.minHeight)!=null?r:0}handleResolveDimensions(t,e,r,n){e!==1/0?this.idealWidth=e:this.idealWidth=Math.max(t,this.minWidth),n!==1/0?this.idealHeight=n:this.idealHeight=Math.max(r,this.minHeight)}};a(Mt,"Spacing");var Me=class extends pt{constructor(i,t,e){super(e),this.add([new rt(i,e),new Mt(e),new re(t,e)])}};a(Me,"LabelledCheckbox");var ne=class extends y{constructor(t,e,r){super(!0,!1,r);this.offsetX=0;this.offsetY=0;this.actualLength=0;this._wasSelected=!1;this.tabFocusable=!0,this.variable=t,this.value=e,this.clickHelper=new mt(this),this.callback=this.handleChange.bind(this),this._wasSelected=this.selected}handleChange(){this.selected!==this._wasSelected&&(this._dirty=!0)}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0):t==="radioButtonLength"?(this._layoutDirty=!0,this._dirty=!0):(t==="backgroundGlowFill"||t==="backgroundFill"||t==="accentFill"||t==="primaryFill"||t==="radioButtonInnerPadding")&&(this._dirty=!0)}select(){this.variable.value=this.value}get selected(){return this.variable.value===this.value}onFocusGrabbed(t){this.clickHelper.onFocusGrabbed(t)&&(this._dirty=!0)}onFocusDropped(t){this.clickHelper.onFocusDropped(t)&&(this._dirty=!0)}handleEvent(t){let e=this.idealX+this.offsetX,r=this.idealY+this.offsetY,[n,s]=this.clickHelper.handleEvent(t,this.root,!0,[e,e+this.actualLength,r,r+this.actualLength]);return n&&this.select(),this.clickHelper.clickStateChanged&&(this._dirty=!0),s?this:null}handleResolveDimensions(t,e,r,n){let s=Math.min(this.radioButtonLength,e,n);this.idealWidth=s,this.idealHeight=s,this.idealWidth<t&&(this.idealWidth=t),this.idealHeight<r&&(this.idealHeight=r)}finalizeBounds(){super.finalizeBounds(),this.actualLength=Math.min(this.radioButtonLength,this.width,this.height),this.offsetX=(this.width-this.actualLength)/2,this.offsetY=(this.height-this.actualLength)/2}handlePainting(t){this._wasSelected=this.selected;let e=this.clickHelper.clickState===1||this.clickHelper.clickState===2,r=this.viewport.context;e?r.fillStyle=this.backgroundGlowFill:r.fillStyle=this.backgroundFill;let n=this.actualLength/2,s=this.offsetX+this.x+n,o=this.offsetY+this.y+n;if(this.paintCircle(s,o,n),this.selected){e?r.fillStyle=this.accentFill:r.fillStyle=this.primaryFill;let h=this.actualLength-this.radioButtonInnerPadding*2;if(h<=0)this.paintCircle(s,o,n);else{let d=h/2;this.paintCircle(s,o,d)}}}attach(t,e,r){super.attach(t,e,r),this.variable.watch(this.callback)}detach(){super.detach(),this.variable.unwatch(this.callback)}activate(){super.activate(),this.clickHelper.reset()}};a(ne,"RadioButton");var Le=class extends pt{constructor(i,t,e,r){super(r),this.add([new rt(i,r),new Mt(r),new ne(t,e,r)])}};a(Le,"LabelledRadioButton");var Lt=class extends dt{constructor(t,e){var r,n,s,o,h,d;super(t,!1,!0,e);this._constraints=[0,1/0,0,1/0];this.forceRePaint=!0;this.reservedX=0;this.reservedY=0;this.useCanvas=(r=e==null?void 0:e.useCanvas)!=null?r:!1,this.useCanvas?this.internalViewport=new et(t):this.internalViewport=new Vt(t),this.minWidth=(n=e==null?void 0:e.minWidth)!=null?n:0,this.minHeight=(s=e==null?void 0:e.minHeight)!=null?s:0,this._widthCoupling=(o=e==null?void 0:e.widthCoupling)!=null?o:0,this._heightCoupling=(h=e==null?void 0:e.heightCoupling)!=null?h:0,this._constraints=(d=e==null?void 0:e.constraints)!=null?d:[0,1/0,0,1/0]}get offset(){return[...this.internalViewport.offset]}set offset(t){(this.internalViewport.offset[0]!==t[0]||this.internalViewport.offset[1]!==t[1])&&(this.internalViewport.offset=[t[0],t[1]],this._dirty=!0)}set constraints(t){(t[0]!==this._constraints[0]||t[1]!==this._constraints[1]||t[2]!==this._constraints[2]||t[3]!==this._constraints[3])&&(this._constraints[0]=t[0],this._constraints[1]=t[1],this._constraints[2]=t[2],this._constraints[3]=t[3],this.internalViewport.constraints=t)}get constraints(){return[...this._constraints]}get widthCoupling(){return this._widthCoupling}set widthCoupling(t){this._widthCoupling!==t&&(this._widthCoupling=t,this._layoutDirty=!0)}get heightCoupling(){return this._heightCoupling}set heightCoupling(t){this._heightCoupling!==t&&(this._heightCoupling=t,this._layoutDirty=!0)}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0):t==="canvasFill"&&(this._dirty=!0)}getBoundsOf(t){let[e,r]=t.idealDimensions,[n,s]=t.idealPosition,[o,h]=this.child.idealPosition,d=this.idealX+this.offset[0]+n-o,c=this.idealY+this.offset[1]+s-h;return[d,d+e,c,c+r]}handleEvent(t){return this.internalViewport.dispatchEvent(t)}handlePreLayoutUpdate(){let t=this.child;t.preLayoutUpdate(),t.layoutDirty&&(this._layoutDirty=!0),this.useCanvas&&(this.internalViewport.resolution=this.root.resolution)}handlePostLayoutUpdate(){this.internalViewport.rect=[this.x,this.y,this.width,this.height];let t=this.child;t.postLayoutUpdate(),t.dirty&&(this._dirty=!0)}handleResolveDimensions(t,e,r,n){let s=Math.max(e-this.reservedX,0),o=Math.max(n-this.reservedY,0),h=Math.min(Math.max(t,this.minWidth)-this.reservedX,s),d=Math.min(Math.max(r,this.minHeight)-this.reservedY,o);this._widthCoupling!==1&&(this.idealWidth=h,this._widthCoupling===2&&(h=this.idealWidth)),this.idealWidth===0&&this.minWidth===0&&this._widthCoupling!==1&&console.warn(b.MAYBE_DIMENSIONLESS("width")),this._heightCoupling!==1&&(this.idealHeight=d,this._heightCoupling===2&&(d=this.idealHeight)),this.idealHeight===0&&this.minHeight===0&&this._heightCoupling!==1&&console.warn(b.MAYBE_DIMENSIONLESS("height"));let c=[...this._constraints];this._widthCoupling!==0&&(c[0]=h,this._widthCoupling===1&&(c[1]=s)),this._heightCoupling!==0&&(c[2]=d,this._heightCoupling===1&&(c[3]=o));let u=this.child;this.internalViewport.constraints=c,this.internalViewport.resolveLayout(),this._widthCoupling===1&&(this.idealWidth=Math.max(0,u.idealDimensions[0])),this._heightCoupling===1&&(this.idealHeight=Math.max(0,u.idealDimensions[1]))}attach(t,e,r){y.prototype.attach.call(this,t,e,r),this.internalViewport.parent=e,this.child.attach(t,this.internalViewport,r)}detach(){this.internalViewport.parent=null,super.detach()}handlePainting(t){this.internalViewport.paint(t||this.forceRePaint,this.canvasFill),this.forceRePaint=!1}};a(Lt,"ViewportWidget"),_([tt],Lt.prototype,"minWidth",2),_([tt],Lt.prototype,"minHeight",2);var ti=(e=>(e[e.Overlay=0]="Overlay",e[e.Layout=1]="Layout",e[e.Hidden=2]="Hidden",e))(ti||{}),se=class extends Lt{constructor(t,e){var r;super(t,e);this.effectiveWidth=0;this.effectiveHeight=0;this.verticalDragged=null;this.startingScroll=0;this.startingOffset=0;this.lastScroll=0;this.horizWasPainted=!1;this.vertWasPainted=!1;this._scrollLineHeight=0;this._scrollbarMode=(r=e==null?void 0:e.scrollbarMode)!=null?r:0,this.horizontalClickHelper=new nt(this),this.verticalClickHelper=new nt(this),this.updateScrollLineHeight()}get scrollbarMode(){return this._scrollbarMode}set scrollbarMode(t){if(this._scrollbarMode!==t){let e=this.scroll;this._scrollbarMode=t,this.scroll=e,this._layoutDirty=!0,this._dirty=!0}}get offset(){return super.offset}set offset(t){let[e,r]=this.child.idealDimensions;super.offset=[-Math.max(Math.min(-t[0],e-this.effectiveWidth),0),-Math.max(Math.min(-t[1],r-this.effectiveHeight),0)]}get widthCoupling(){return super.widthCoupling}set widthCoupling(t){let e=this.scroll;super.widthCoupling=t,this.scroll=e}get heightCoupling(){return super.heightCoupling}set heightCoupling(t){let e=this.scroll;super.heightCoupling=t,this.scroll=e}get scroll(){let[t,e]=this.offset,[r,n]=this.child.idealDimensions,s=r-this.effectiveWidth,o=n-this.effectiveHeight;return[s===0?0:Math.min(Math.max(-t/s,0),1),o===0?0:Math.min(Math.max(-e/o,0),1)]}set scroll(t){let[e,r]=this.child.idealDimensions;this.offset=[-t[0]*(e-this.effectiveWidth),-t[1]*(r-this.effectiveHeight)]}getClickHelper(t){return t?this.verticalClickHelper:this.horizontalClickHelper}handleEventScrollbar(t,e,r,n){if(this.verticalDragged!==null&&this.verticalDragged!==t)return!1;let[s,o]=this.getScrollbarRects(t,e),h=this._scrollbarMode===0,d=h?s:o,c=[d[0],d[0]+d[2],d[1],d[1]+d[3]],u=this.getClickHelper(t);u.handleClickEvent(r,n,c);let m=u.clickState,f=u.clickStateChanged;if(f&&(this._dirty=!0),m===2){if(u.pointerPos===null||!(r instanceof W))return!0;let p=t?1:0,g=this.scroll,w=h;w||(w=u.isPointInRect(r.x,r.y,s[0],s[0]+s[2],s[1],s[1]+s[3]));let v;if(h?v=u.getNormalInRect(r.x,r.y,o[0],o[0]+o[2],o[1],o[1]+o[3])[p]:v=u.pointerPos[p],f){if(!w){let x=t?this.effectiveHeight:this.effectiveWidth,T=this.child.idealDimensions[p],P=x/T;g[p]=(v-P/2)/(1-P),this.scroll=g}this.startingOffset=v,this.startingScroll=g[p],this.verticalDragged=t}else{let x=t?this.effectiveHeight:this.effectiveWidth,T=this.child.idealDimensions[p],P=x/T,A=v-this.startingOffset;g[p]=this.startingScroll+A/(1-P),this.scroll=g}return!0}else{if(m===1)return!0;if(f)return this.verticalDragged=null,!0}return!1}clampOffset(t){let[e,r]=this.child.idealDimensions,n=-(e-this.effectiveWidth);n>=0?t[0]=0:t[0]<n&&(t[0]=n);let s=-(r-this.effectiveHeight);s>=0?t[1]=0:t[1]<s&&(t[1]=s)}handleWheelEvent(t){let e=this.offset,[r,n]=e,[s,o]=t.getDeltaPixels(!0,this._scrollLineHeight,this.idealWidth,this.idealHeight);e[0]-=t.shift?o:s,e[1]-=t.shift?s:o,this.clampOffset(e),this.offset=e;let[h,d]=this.offset,c=h!==r||d!==n,u=this.lastScroll,m=new Date().getTime();return this.lastScroll=m,c?!0:t.fromDrag?!1:m-u<200}updateScrollLineHeight(){let t=new D;t.font=this.bodyTextFont,t.lineHeight=this.bodyTextHeight,t.lineSpacing=this.bodyTextSpacing,this._scrollLineHeight=t.fullLineHeight}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0):t==="bodyTextFont"||t==="bodyTextHeight"||t==="bodyTextSpacing"?this.updateScrollLineHeight():t==="scrollBarThickness"?(this._layoutDirty=!0,this._dirty=!0):(t==="backgroundFill"||t==="scrollBarMinPercent"||t==="scrollBarMinPixels"||t==="primaryFill"||t==="accentFill"||t==="backgroundGlowFill")&&(this._dirty=!0)}handleEvent(t){let e=this.widthCoupling===1,r=this.heightCoupling===1;if(this._scrollbarMode!==2&&(t instanceof E||t instanceof W)&&(t.target===null||t.target===this)){let[s,o]=this.child.idealDimensions,h=this._scrollbarMode===0,d=!h&&!e&&!r,c=s>this.idealWidth,u=o>this.idealHeight,m=!1;if(!e&&(c||!h)&&this.handleEventScrollbar(!1,u||d,t,this.root)&&(m=!0),!r&&(u||!h)&&this.handleEventScrollbar(!0,c||d,t,this.root)&&(m=!0),m)return t instanceof L&&this.handleWheelEvent(t),this}let n=super.handleEvent(t);if(n!==null&&t instanceof j){let s=this._scrollbarMode===1,o=s&&!r,h=s&&!e,d=this.effectiveWidth,c=this.effectiveHeight;if(!o||!h){let $=this.scrollBarThickness,[At,ge]=this.child.idealDimensions,ei=At>this.idealWidth,ii=ge>this.idealHeight,ri=this.scrollbarNeedsPaint(!1,ei),ni=this.scrollbarNeedsPaint(!0,ii);this._scrollbarMode!==2&&(!o&&ni&&(d=Math.max(0,d-$)),!h&&ri&&(c=Math.max(0,c-$)))}let[u,m]=n.idealPosition,[f,p]=this.offset,g=f,w=p;this.internalViewport.relativeCoordinates&&(u+=this.idealX+f,m+=this.idealY+p);let[v,x,T,P]=t.bounds;v+=u,x+=u,T+=m,P+=m;let A=this.idealX+d,H=this.idealY+c,N=!e&&!(v>=this.idealX&&x<=A)&&!(this.idealX>=v&&A<=x);if(N){let $=x-v>d,At=v<this.idealX;$!==At?f+=this.idealX-v:f+=A-x}let Y=!r&&!(T>=this.idealY&&P<=H)&&!(this.idealY>=T&&H<=P);if(Y){let $=P-T>c,At=T<this.idealY;$!==At?p+=this.idealY-T:p+=H-P}(N||Y)&&(this.offset=[f,p]);let[yt,lt]=this.offset,oe=yt-g+u-this.idealX,le=lt-w+m-this.idealY;return t.bounds[0]+=oe,t.bounds[1]+=oe,t.bounds[2]+=le,t.bounds[3]+=le,this}return n===null&&t instanceof L&&this.handleWheelEvent(t)?this:n}handleResolveDimensions(t,e,r,n){let s=this.scrollBarThickness,o=this._scrollbarMode===1;this.reservedX=o&&this.heightCoupling!==1?s:0,this.reservedY=o&&this.widthCoupling!==1?s:0,super.handleResolveDimensions(t,e,r,n),this.effectiveWidth=this.idealWidth,this.effectiveHeight=this.idealHeight,this.idealWidth=Math.min(Math.max(this.idealWidth+this.reservedX,t),e),this.idealHeight=Math.min(Math.max(this.idealHeight+this.reservedY,r),n)}handlePostLayoutUpdate(){super.handlePostLayoutUpdate();let t=this.offset;this.clampOffset(t),this.offset=t}handlePainting(t){let[e,r]=this.child.idealDimensions,n=e>this.effectiveWidth,s=r>this.effectiveHeight,o=this.scrollbarNeedsPaint(!1,n),h=this.scrollbarNeedsPaint(!0,s);this.horizWasPainted!==o||this.vertWasPainted!==h?(this.horizWasPainted=o,this.vertWasPainted=h,this.forceRePaint=!0):this.scrollbarMode===0&&(this.forceRePaint=!0),super.handlePainting(t);let d=this._scrollbarMode===1&&this.widthCoupling!==1&&this.heightCoupling!==1;if(o&&this.paintScrollbar(!1,n,s||d),h&&this.paintScrollbar(!0,s,n||d),d){let c=this.scrollBarThickness,u=this.viewport.context;u.fillStyle=this.backgroundFill,u.fillRect(this.x+this.width-c,this.y+this.height-c,c,c)}}getScrollbarRects(t,e){let r=this._scrollbarMode===0,n=t?1:0,s=this.scroll[n],o=this.child.idealDimensions[n],h=t?this.effectiveHeight:this.effectiveWidth,d=Math.min(this.scrollBarThickness,this.width/2,this.height/2),c=this.scrollBarMinPercent,u=this.scrollBarMinPixels,m=h;r&&(m-=e?d:0);let f=Math.min(Math.max(u,Math.max(h/o,c)*m),h),p=(m-f)*s,g,w,v,x;t?(g=this.idealX+this.idealWidth-d,w=this.idealY+p,v=d,x=f):(g=this.idealX+p,w=this.idealY+this.idealHeight-d,v=f,x=d);let T,P,A,H;return t?(T=g,P=this.idealY,A=d,H=m):(T=this.idealX,P=w,A=m,H=d),[[g,w,v,x],[T,P,A,H]]}scrollbarNeedsPaint(t,e){return this._scrollbarMode===2||!e&&this._scrollbarMode===0?!1:t?this.heightCoupling!==1:this.widthCoupling!==1}paintScrollbar(t,e,r){let[n,s]=this.getScrollbarRects(t,r),o=this.viewport.context;if(this._scrollbarMode!==0&&(o.fillStyle=this.backgroundFill,o.fillRect(...s)),e)switch(this.getClickHelper(t).clickState){case 0:o.fillStyle=this.primaryFill;break;case 1:case 2:o.fillStyle=this.accentFill;break}else o.fillStyle=this.backgroundGlowFill;o.fillRect(...n)}};a(se,"ScrollableViewportWidget");var pe=class extends y{constructor(t=new bt(0),e=0,r=1,n){var o,h;super(!0,!1,n);this.offsetX=0;this.offsetY=0;this.actualWidth=0;this.actualHeight=0;this.keyboardFocused=!1;this.dragBounds=[0,0,0,0];if(r<e)throw new Error(b.SWAPPED_MIN_MAX(e,r));if(!isFinite(e)||isNaN(e))throw new Error(b.INVALID_MIN(e));if(!isFinite(r)||isNaN(r))throw new Error(b.INVALID_MAX(r));let s=(o=n==null?void 0:n.snapIncrement)!=null?o:0;if(!isFinite(s)||isNaN(s))throw new Error(b.INVALID_INC(r));if(s<0)throw new Error(b.NEGATIVE_INC(r));this.clickHelper=new nt(this),this.minValue=e,this.maxValue=r,this.snapIncrement=s,this.vertical=(h=n==null?void 0:n.vertical)!=null?h:!1,this.tabFocusable=!0,this.variable=t,this.callback=this.handleChange.bind(this)}handleChange(){this._dirty=!0}attach(t,e,r){super.attach(t,e,r),this.variable.watch(this.callback)}detach(){super.detach(),this.variable.unwatch(this.callback)}activate(){super.activate(),this.clickHelper.reset()}set value(t){this.setValue(t)}get value(){return this.variable.value}clamp(t){return t<this.minValue?t=this.minValue:t>this.maxValue&&(t=this.maxValue),t}setValue(t,e=!0){this.snapIncrement>0&&(t=Math.round(t/this.snapIncrement)*this.snapIncrement),this.variable.setValue(this.clamp(t),e)}stepValue(t,e){let r=this.snapIncrement;r===0&&(r=.01*(this.maxValue-this.minValue)),r*=e;let n=t?1:-1;this.value=this.clamp((Math.round(this.value/r)+n)*r)}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0):t==="sliderThickness"||t==="sliderMinLength"?(this._layoutDirty=!0,this._dirty=!0):(t==="accentFill"||t==="primaryFill"||t==="backgroundFill")&&(this._dirty=!0)}onFocusGrabbed(t){t===1&&(this.keyboardFocused=!0)}onFocusDropped(t){t===1&&(this.keyboardFocused=!1)}handleEvent(t){if(t instanceof L||!(t instanceof W||t instanceof Q||t instanceof E)||t instanceof R&&(t.key==="Tab"||t.key==="Escape"))return null;if(t instanceof Q){if(t instanceof R){let e=t.shift?10:1;t.key==="ArrowLeft"||t.key==="ArrowDown"?this.stepValue(!1,e):(t.key==="ArrowRight"||t.key==="ArrowUp")&&this.stepValue(!0,e)}return this}if(t instanceof V||this.clickHelper.clickState!==2){let e=this.idealX+this.offsetX,r=this.idealY+this.offsetY;this.dragBounds=[e,e+this.actualWidth,r,r+this.actualHeight]}if(this.clickHelper.handleClickEvent(t,this.root,this.dragBounds),(this.clickHelper.clickStateChanged&&this.clickHelper.wasClick||this.clickHelper.clickState===2)&&this.clickHelper.pointerPos!==null){let e=this.clickHelper.pointerPos[0];this.value=this.minValue+e*(this.maxValue-this.minValue)}return this.clickHelper.clickStateChanged&&(this._dirty=!0),this}handleResolveDimensions(t,e,r,n){let s=this.sliderThickness,o=this.sliderMinLength;this.vertical?(n!=1/0?this.idealHeight=n:this.idealHeight=Math.max(o,r),this.idealWidth=Math.min(Math.max(s,t),e)):(e!=1/0?this.idealWidth=e:this.idealWidth=Math.max(o,t),this.idealHeight=Math.min(Math.max(s,r),n))}finalizeBounds(){super.finalizeBounds(),this.vertical?(this.actualWidth=Math.min(this.width,this.sliderThickness),this.actualHeight=this.height,this.offsetX=(this.width-this.actualWidth)/2,this.offsetY=0):(this.actualWidth=this.width,this.actualHeight=Math.min(this.height,this.sliderThickness),this.offsetX=0,this.offsetY=(this.height-this.actualHeight)/2)}handlePainting(t){let e=this.x+this.offsetX,r=this.y+this.offsetY,n=this.viewport.context,s=this.keyboardFocused||this.clickHelper.clickState===1||this.clickHelper.clickState===2;s?n.fillStyle=this.accentFill:n.fillStyle=this.primaryFill;let o=this.actualWidth*(this.value-this.minValue)/(this.maxValue-this.minValue);n.fillRect(e,r,o,this.actualHeight),s?n.fillStyle=this.backgroundGlowFill:n.fillStyle=this.backgroundFill;let h=this.actualWidth-o;n.fillRect(e+o,r,h,this.actualHeight)}};a(pe,"Slider"),_([vt],pe.prototype,"keyboardFocused",2);var Tt=class extends y{constructor(t=new ie(""),e){var r,n,s,o,h;super(!1,!1,e);this.blinkStart=0;this.blinkWasOn=null;this.cursorPos=0;this.cursorOffset=[0,0];this.selectPos=0;this.selectOffset=[0,0];this.cursorOffsetDirty=!1;this.offset=[0,0];this.dragging=!1;this.lastClick=0;this.dragStart=-1;this.successiveClickCount=0;this.needsAutoScroll=!1;this.tabFocusable=!0,this.textHelper=new D,this.variable=t,this.callback=this.handleChange.bind(this),this.hideText=(r=e==null?void 0:e.hideText)!=null?r:!1,this.wrapText=(n=e==null?void 0:e.wrapText)!=null?n:!0,this.inputFilter=(s=e==null?void 0:e.inputFilter)!=null?s:null,this.typeableTab=(o=e==null?void 0:e.typeableTab)!=null?o:!1,this._editingEnabled=(h=e==null?void 0:e.editingEnabled)!=null?h:!0}handleChange(){this._dirty=!0}attach(t,e,r){super.attach(t,e,r),this.variable.watch(this.callback)}detach(){super.detach(),this.variable.unwatch(this.callback)}activate(){super.activate(),this.blinkStart=0,this.moveCursorTo(0,!1)}onThemeUpdated(t=null){super.onThemeUpdated(t),t===null?(this._layoutDirty=!0,this._dirty=!0,this.cursorOffsetDirty=!0):t==="inputTextInnerPadding"||t==="inputTextFont"||t==="inputTextHeight"||t==="inputTextSpacing"?(this._layoutDirty=!0,this._dirty=!0):t==="inputBackgroundFill"||t==="inputTextFill"||t==="inputTextFillInvalid"||t==="inputTextFillDisabled"||t==="cursorThickness"?this._dirty=!0:t==="inputTextAlign"&&(this.cursorOffsetDirty=!0)}get blinkOn(){if(this.blinkStart===0)return null;let t=this.blinkRate;return Math.trunc((Date.now()-this.blinkStart)/(500*t)%2)===0}get editingEnabled(){return this._editingEnabled}set editingEnabled(t){this._editingEnabled!==t&&(this._editingEnabled=t,t||(this.blinkStart=0,this.moveCursorTo(0,!1)),this._dirty=!0)}set text(t){this.variable.value=t;let e=this.variable.value.length;this.cursorPos>e&&(this.cursorPos=e,this.cursorOffsetDirty=!0),this.selectPos>e&&(this.selectPos=e,this.cursorOffsetDirty=!0)}get text(){return this.variable.value}get displayedText(){return this.hideText?"\u25CF".repeat(this.variable.value.length):this.variable.value}get line(){return this.textHelper.getLine(this.cursorPos)}autoScrollCaret(){this.blinkStart!==0&&(this.needsAutoScroll=!0)}moveCursorTo(t,e){this.cursorPos=Math.min(Math.max(t,0),this.text.length),e||(this.selectPos=this.cursorPos),this.cursorOffsetDirty=!0,this._dirty=!0,this.autoScrollCaret()}moveCursor(t,e){this.moveCursorTo(this.cursorPos+t,e)}moveCursorFromOffset(t,e,r){[this.cursorPos,this.cursorOffset]=this.textHelper.findIndexOffsetFromOffset([t,e]),r||(this.selectPos=this.cursorPos,this.selectOffset=this.cursorOffset),this.blinkStart=Date.now(),this._dirty=!0,this.autoScrollCaret()}moveCursorLine(t,e){this.moveCursorFromOffset(this.cursorOffset[0],this.cursorOffset[1]+(.5+t)*this.textHelper.fullLineHeight,e)}moveCursorStart(t){this.moveCursorTo(this.textHelper.getLineStart(this.line),t)}moveCursorEnd(t){this.moveCursorTo(this.textHelper.getLineEnd(this.line,!1),t)}moveCursorWord(t,e){if(t==0)return;let r=/\w/,n=this.text,s=this.cursorPos;if(t>0)for(;t>0;){let o=!1;for(;s<=n.length;s++)if(s<n.length&&r.test(n[s]))o=!0;else if(o)break;t--}else for(;t<0;){s--;let o=!1;for(;s>=0;s--)if(s>=0&&r.test(n[s]))o=!0;else if(o)break;s++,t++}this.moveCursorTo(s,e)}deleteRange(t,e){t!==e&&(this.variable.value=this.text.substring(0,t)+this.text.substring(e),this.cursorPos=this.selectPos=t,this.cursorOffsetDirty=!0,this.autoScrollCaret())}deleteWord(t){if(t===0)return;if(this.cursorPos!==this.selectPos){this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));return}let e=this.cursorPos;this.moveCursorWord(t,!1),e!==this.cursorPos&&this.deleteRange(Math.min(e,this.cursorPos),Math.max(e,this.cursorPos))}insertText(t){if(!(this.inputFilter!==null&&!this.inputFilter(t)))if(this.selectPos===this.cursorPos)this.variable.value=this.text.substring(0,this.cursorPos)+t+this.text.substring(this.cursorPos),this.moveCursor(t.length,!1);else{let e=Math.min(this.cursorPos,this.selectPos),r=Math.max(this.cursorPos,this.selectPos);this.variable.value=this.text.substring(0,e)+t+this.text.substring(r),this.moveCursorTo(e+t.length,!1)}}deleteText(t){t!==0&&(this.cursorPos!==this.selectPos?this.deleteRange(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos)):t>0?(this.variable.value=this.text.substring(0,this.cursorPos)+this.text.substring(this.cursorPos+t),this.cursorOffsetDirty=!0,this.autoScrollCaret()):(this.variable.value=this.text.substring(0,this.cursorPos+t)+this.text.substring(this.cursorPos),this.moveCursor(t,!1)))}selectRangeAt(t){let e=this.text,r=/\w/,n=r.test(e[t]),s=t;for(;t>=0&&r.test(e[t])===n;t--);let o=t+1;for(t=s;t<e.length&&r.test(e[t])===n;t++);return this.autoScrollCaret(),[o,t]}onFocusGrabbed(t){t===1&&this.blinkStart===0&&(this.blinkStart=Date.now(),this.selectPos=this.variable.value.length,this.cursorPos=this.selectPos,this.cursorOffsetDirty=!0,this.autoScrollCaret())}onFocusDropped(t){t===1&&(this.blinkStart=0)}handleEvent(t){if(!this._editingEnabled)return null;let e=this.root;if(t instanceof E)return this.dragging=!1,this.lastClick=0,this;if(t instanceof L)return null;if(t instanceof W){if(e.pointerStyle="text",t instanceof V||t instanceof st){let r=t instanceof V&&t.isPrimary;if(r){this.dragging=!0;let s=new Date().getTime();s-this.lastClick<500?(this.successiveClickCount++,this.successiveClickCount>2&&(this.successiveClickCount=0)):this.successiveClickCount=0,this.lastClick=s}else if(!this.dragging)return this;let n=this.inputTextInnerPadding;if(this.moveCursorFromOffset(t.x-this.idealX-n+this.offset[0],t.y-this.idealY-n+this.offset[1],!r&&this.dragging||r&&t.shift),r&&(this.cursorPos!==this.dragStart&&(this.successiveClickCount=0),this.dragStart=this.cursorPos),this.successiveClickCount>0){let s,o;if(this.successiveClickCount===1){let[h,d]=this.selectRangeAt(this.dragStart),[c,u]=this.selectRangeAt(this.cursorPos);s=Math.min(h,c),o=Math.max(d,u)}else{let h=Math.min(this.cursorPos,this.dragStart),d=this.textHelper.getLine(h);s=this.textHelper.getLineStart(d);let c=Math.max(this.cursorPos,this.dragStart),u=this.textHelper.getLine(c);o=this.textHelper.getLineEnd(u)}this.cursorPos>=this.dragStart?(this.selectPos=s,this.cursorPos=o):(this.selectPos=o,this.cursorPos=s),this.cursorOffsetDirty=!0}e.requestFocus(1,this)}else t instanceof X&&t.isPrimary&&(this.dragging=!1,e.hasMobileTextInput&&e.getTextInput(this.text).then(r=>{r===null||this.inputFilter!==null&&!this.inputFilter(r)||this.text!==r&&(this.text=r,this.moveCursorTo(r.length,!1))}));return this}else if(t instanceof R){if(this.dragging=!1,this.lastClick=0,t.alt)return this;if(t.ctrl){if(t.key==="Backspace")this.deleteWord(-1);else if(t.key==="Delete")this.deleteWord(1);else if(t.key==="ArrowLeft")this.moveCursorWord(-1,t.shift);else if(t.key==="ArrowRight")this.moveCursorWord(1,t.shift);else if(t.key==="c"||t.key==="C"){if(this.cursorPos===this.selectPos)return this;let r=this.text.slice(Math.min(this.cursorPos,this.selectPos),Math.max(this.cursorPos,this.selectPos));if(navigator.clipboard)navigator.clipboard.writeText(r);else return this}else if(t.key==="a"||t.key==="A")this.cursorPos=this.text.length,this.selectPos=0,this.cursorOffsetDirty=!0,this._dirty=!0;else return this;return this.blinkStart=Date.now(),this}if(t.key.length===1)this.insertText(t.key);else if(t.key==="Backspace")this.deleteText(-1);else if(t.key==="Delete")this.deleteText(1);else if(t.key==="ArrowLeft")this.moveCursor(-1,t.shift);else if(t.key==="ArrowRight")this.moveCursor(1,t.shift);else if(t.key==="ArrowUp")this.moveCursorLine(-1,t.shift);else if(t.key==="ArrowDown")this.moveCursorLine(1,t.shift);else if(t.key==="PageUp"||t.key==="PageDown"){let r=t.key==="PageUp"?-1:1,[n,s,o,h]=this.viewport.rect,d=Math.max(Math.floor(h/this.textHelper.fullLineHeight),3);this.moveCursorLine(d*r,t.shift)}else if(t.key==="Home")this.moveCursorStart(t.shift);else if(t.key==="End")this.moveCursorEnd(t.shift);else{if(t.key==="Escape")return null;if(t.key==="Enter")this.insertText(`
`);else if(t.key==="Tab")if(this.typeableTab){if(t.shift)return e.dispatchEvent(new O(this,!1)),this;this.insertText("	")}else return null;else return this}this.blinkStart=Date.now()}else if(t instanceof ut)t.target===this&&(this.insertText(t.text),this.blinkStart=Date.now());else if(t.target!==this)return null;return this}handlePreLayoutUpdate(){this.editingEnabled||this.root.dropFocus(1,this),this.blinkOn!==this.blinkWasOn&&(this._dirty=!0),this.textHelper.text=this.displayedText,this.textHelper.font=this.inputTextFont,this.textHelper.lineHeight=this.inputTextHeight,this.textHelper.lineSpacing=this.inputTextSpacing,this.textHelper.alignMode=this.inputTextAlign,this.textHelper.dirty&&(this._dirty=!0,this._layoutDirty=!0)}handlePostLayoutUpdate(){this.cursorOffsetDirty&&(this.cursorOffset=this.textHelper.findOffsetFromIndex(this.cursorPos),this.selectPos===this.cursorPos?(this.selectOffset[0]=this.cursorOffset[0],this.selectOffset[1]=this.cursorOffset[1]):this.selectOffset=this.textHelper.findOffsetFromIndex(this.selectPos),this.cursorOffsetDirty=!1);let t=this.inputTextInnerPadding,e=this.textHelper.width,r=this.textHelper.height,n=this.idealWidth-t*2,s=this.idealHeight-t*2,o=this.offset,[h,d]=this.cursorOffset;if(e>n){let c=Math.min(20,n/2),u=o[0]+c,m=o[0]+n-c;h>m&&(o[0]+=h-m),h<u&&(o[0]-=u-h),o[0]+n>e&&(o[0]=e-n),o[0]<0&&(o[0]=0)}else o[0]=0;if(r>s){let c=this.textHelper.fullLineHeight;if(c>=s)o[1]=d+Math.max(this.textHelper.actualLineHeight-s,0);else{let u=s<2*c?0:c/2,m=o[1]+u,f=o[1]+s-u-c;d<m&&(o[1]-=m-d),d>f&&(o[1]+=d-f),o[1]+s>r&&(o[1]=r-s),o[1]<0&&(o[1]=0)}}else o[1]=0;this.offset=o,this.needsAutoScroll&&(this.needsAutoScroll=!1,this.root.dispatchEvent(new j(this,this.caretBounds)))}handleResolveDimensions(t,e,r,n){let s=2*this.inputTextInnerPadding;this.textHelper.maxWidth=this.wrapText?Math.max(e-s,0):1/0,this.textHelper.dirty&&(this._dirty=!0);let o=Math.min(Math.max(this.inputTextMinWidth,t),e);this.idealWidth=Math.min(Math.max(o,this.textHelper.width+s),e),this.idealHeight=Math.min(Math.max(r,this.textHelper.height+s),n)}get caretRect(){let t=this.inputTextInnerPadding;return[t+this.cursorOffset[0]-this.offset[0],t+this.cursorOffset[1]-this.offset[1],this.cursorThickness,this.textHelper.fullLineHeight]}get caretAbsoluteRect(){let[t,e,r,n]=this.caretRect;return[t+this.idealX,e+this.idealY,r,n]}get caretBounds(){let[t,e,r,n]=this.caretRect;return[t,t+r,e,e+n]}handlePainting(t){let e=this.viewport.context;e.fillStyle=this.inputBackgroundFill,e.fillRect(this.x,this.y,this.width,this.height),e.save(),e.beginPath(),e.rect(this.x,this.y,this.width,this.height),e.clip();let r=this.inputTextInnerPadding;if(this.cursorPos!==this.selectPos)if(e.fillStyle=this.inputSelectBackgroundFill,this.cursorOffset[1]===this.selectOffset[1]){let o=Math.min(this.cursorOffset[0],this.selectOffset[0]),h=Math.max(this.cursorOffset[0],this.selectOffset[0]);e.fillRect(this.idealX+r+o-this.offset[0],this.idealY+r+this.cursorOffset[1]-this.offset[1],h-o,this.textHelper.fullLineHeight)}else{let o,h;this.cursorOffset[1]<this.selectOffset[1]?(o=this.cursorOffset,h=this.selectOffset):(h=this.cursorOffset,o=this.selectOffset);let d=this.textHelper.fullLineHeight,c=this.idealWidth+this.offset[0]-o[0]-r;c>0&&e.fillRect(this.idealX+r+o[0]-this.offset[0],this.idealY+r+o[1]-this.offset[1],c,d);let u=h[0]+r-this.offset[0];u>0&&e.fillRect(this.idealX,this.idealY+r+h[1]-this.offset[1],u,d);let m=o[1]+d,f=h[1]-m;f>0&&e.fillRect(this.idealX,this.idealY+r+m-this.offset[1],this.idealWidth,f)}let n;this._editingEnabled?this.variable.valid?n=this.inputTextFill:n=this.inputTextFillInvalid:n=this.inputTextFillDisabled,this.textHelper.paint(e,n,this.idealX+r-this.offset[0],this.idealY+r-this.offset[1]);let s=this.blinkOn;this.blinkWasOn=s,s&&(e.fillStyle=n,e.fillRect(...this.caretAbsoluteRect)),e.restore()}};a(Tt,"TextInput"),_([G(["cursorOffsetDirty","_dirty"])],Tt.prototype,"hideText",2),_([Ke()],Tt.prototype,"offset",2),_([tt],Tt.prototype,"wrapText",2);var He=class extends se{constructor(i,t){t=I({widthCoupling:2,heightCoupling:2,scrollbarMode:2,typeableTab:!0},t),super(new Tt(i,t),t)}get textInput(){return this.child}};a(He,"TextArea");var Re=class extends gt{constructor(i,t){t=I({containerAlignment:{horizontal:.5,vertical:"stretch"}},t),super(i,t)}};a(Re,"TextMargin");var Ae=class extends kt{constructor(t,e){super(t);this.scopeTheme=e}set inheritedTheme(t){super.inheritedTheme=this.scopeTheme}get inheritedTheme(){return this.scopeTheme}};a(Ae,"ThemeScope");export{di as Alignment,Se as AltKey,Rt as ArtificialConstraint,j as AutoScroll,Di as AxisCoupling,zt as BackspaceKey,ct as BaseContainer,M as BaseTheme,F as BaseViewport,J as BasicVirtualKey,Ct as Button,mt as ButtonClickHelper,et as CanvasViewport,Ee as Center,re as Checkbox,nt as ClickHelper,vi as ClickState,Vt as ClippedViewport,Jt as Column,Kt as CompoundClickHelper,gt as Container,De as ControlKey,we as DOMKeyboardDriver,Pe as DOMPointerDriver,Xt as DOMRoot,Te as DOMVirtualKeyboardRoot,Ce as DebugTheme,cn as DefaultTextInputHandler,b as DynMsg,jt as EnterKey,Qt as EscapeKey,U as Event,St as FilledButton,hi as FlexAlignment,gi as FocusType,Pt as GenericClickHelper,$t as GlyphVirtualKey,ot as Icon,Fe as IconButton,Fi as IconFit,Q as KeyEvent,R as KeyPress,ft as KeyRelease,ee as KeyboardDriver,rt as Label,Me as LabelledCheckbox,Le as LabelledRadioButton,E as Leave,Et as Margin,_t as ModifierEvent,S as Msg,ht as MultiContainer,Ut as MultiParent,wt as Parent,kt as PassthroughWidget,Wt as PointerButtonEvent,Ft as PointerDriver,W as PointerEvent,Si as PointerHint,st as PointerMove,V as PointerPress,X as PointerRelease,L as PointerWheel,Qe as PointerWheelMode,ne as RadioButton,We as RayPointerDriver,C as Root,pt as Row,se as ScrollableViewportWidget,ti as ScrollbarMode,Zt as ShiftKey,dt as SingleParent,pe as Slider,qt as SpaceKey,Mt as Spacing,O as TabSelect,fi as TextAlignMode,He as TextArea,Yt as TextButton,D as TextHelper,Tt as TextInput,Re as TextMargin,ut as TextPasteEvent,it as Theme,Ae as ThemeScope,ie as ValidatedVariable,bt as Variable,Lt as ViewportWidget,K as VirtualKey,Gt as VirtualKeyRow,Dt as VirtualKeyboard,_e as VirtualKeyboardRoot,y as Widget,ze as WrapMode,te as defaultVirtualKeyboardTemplate,Xe as flagArrayField,he as flagField,ke as getPointerEventNormPos,Ue as groupedStackTrace,hn as injectDebugCode,q as injectRandomFillFeature,k as injectStackTraceFeature,fe as injectTraceFeature,ue as injectWatchflagFeature,xt as isDebugFeatureEnabled,xe as isPower2,Ye as layoutArrayField,tt as layoutField,yi as listDebugFeatures,de as measureTextDims,ai as multiFlagArrayField,G as multiFlagField,Ke as paintArrayField,vt as paintField,$e as paintLayoutArrayField,Ri as paintLayoutField,je as parseDOMDeltaMode,ve as roundToPower2,bi as toggleDebugFeature,Ht as watchArrayField,ae as watchField};
//# sourceMappingURL=index.esm.js.map
